Q:

Why does the definite article for country names vary so much? (e.g. "no Brasil", "na Alemanha", "em Portugal")

In Portuguese, countries' names can be preceded by either masculine, feminine or no definite article. For example:

"O Brasil fica na América do Sul" 
"A Alemanha fica na Europa"
"Portugal também fica na Europa"

Why does this happen and what are the rules for which is which?

A:

This seems to happen for no other reason than it sounds more natural for native speakers for no specific, definable reason.
As Fernando correctly pointed out, it's not the gender that varies. In Portuguese, all nouns have a gender. What happens is that the definite article can be omitted in some cases.
The names by which speakers of a language call stuff whose proper name is in another language (for example, country, city names, etc) are called exonyms (exônimos).
The genders of exonyms follow basically the same general gender rules as any other noun. For example, most words ending in -a are feminine, and so is Alemanha. Both civil and perfil are masculine, and so is Brasil. Hospital, local and natal are masculine, and so is Portugal.
The question remains, though: why do we omit the definite article for words seemingly so similar? (e.g. *Passarei o natal em Portugal).
But there seems to be no definite answer to that. Here is a statement from Prof. Sérgio Nogueira, a well-known teacher of the Portuguese language:

A maioria dos nomes de países exigem o artigo: a Argentina, o Brasil, a Alemanha, o Peru, a Espanha, o Uruguai... Mas há um bom número que rejeita o artigo: Israel, Portugal, Cuba, Angola, Moçambique, Cabo Verde...

Source: G1 - Quais cidades, estados brasileiros e países pedem artigo definido?
And he concludes, not only on the matter of articles for countries, but also for cities and states:

Como podemos constatar, não há propriamente uma regra.

Here is a map from Wikimedia on the genders of articles in Portuguese. Green is masculine, Purple is feminine, yellow means article is omitted.

For non-native Portuguese speakers, I'm afraid the only way out is memorisation, and a developed sense of what sounds right over time. All evidence from my research points to the fact that if there is a rule, it's complex and/or obscure enough not to be taught as one.
PS: After some research, and despite Fernando's answer, I decided to try my own answer.

A:

The article depends on the gender of the word. The article is sometimes ommited for countries, but the gender still exists. Sometimes the gender comes from classifications; cities are generally feminine; countries and states are generally masculine; but in some cases I see no reason or logic behind it.
In Brazil there is no "neutral" gender, so all nouns/substantives have a gender, which sometimes is arbitrary and can be confusing: "sea" is masculine in Portuguese, but feminine in Spanish. I don't know of a better way to know which gender is proper, other than to just memorize as you read more and more, or looking up the gender on dictionaries (s.m. and s.f. for "substantivo masculino" and "- feminino"). And thank God we do not write thousands of different small characters like Japanese and Chinese!
So Brazil is masculine, as most countries; Germany is feminine; United States is masculine (because state is masculine), but America and Europe are feminine. Actually all continents are feminine, so you get a break.
As you know, if it's feminine it should take the feminine article a, and if masculine it should take the masculine article o. But you can drop the article (as is common use in many cases) and use em. That is the problem. It may be considered "correct" if you write em when an article was expected, but it will be at least confusing.
São Paulo City, for instance, is usually referred to using em, as are most cities, but if you talk about the metropolitan region you say "na grande São Paulo" (and the same applies to most cities). Rio de Janeiro, on the other hand, is masculine, probably because the word "Rio" is masculine, which means people will say "no Rio de Janeiro".
About Portugal, it actually is masculine (as most countries), which means you can google (for instance) for "meu Portugal" (with quotes) and find a ton of stuff about Portugal.
It's just that common use is to drop the article.
The same actually happens with people's names. In the north-eastern region in Brazil (Bahia for example) it's common use to omit articles before people's names (so if I'm going to João's place, I would say "vou a casa de João"), while in the south-eastern region it is almost mandatory to use the article ("vou a casa do João"), despite formal Portuguese saying we should not put articles in front of people's names.

