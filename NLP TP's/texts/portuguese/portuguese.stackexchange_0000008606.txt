Q:

How did “a pesar de” signify “in spite of”?

In Spanish and Portuguese, a pesar de means in (de)spite of. But in both languages, pesar has never meant spite. pesar hails from Vulgar Latin *pēsāre, from Classical Latin pēnsāre. But then how does pesar yield the meaning in spite of?

A:

Funny enough pesar comes ultimately from Latin pendere, which (see Lewis & Short's Latin Dictionary) meant “to cause to hang down, to suspend; esp[ecialy] of scales in weighing;” and hence pensare, which is the frequentative of pendere, meant ’to weigh’ (also ’to ponder, consider’).
Pensare became pesar in Portuguese (except in the sense ’to think’, which appeared later in Medieval Latin; see Wiktionary). But in addition to the Classical Latin senses, pesar added the meaning ’to cause sorrow, to sadden, to cause a feeling of oppression’, and became also a noun meaning ’great sadness, sorrow.’ (see Aulete of Michaelis). According to Houaiss dictionary these new senses existed in the 1200s already. Presumably we got them from ’to weigh’ because sadness can be seen as a weight that oppresses you. So in Old Galician-Portuguese, a pesar de (now apesar de in modern Portuguese) would quite literally mean ’to the sorrow of’, and so ’against the will of’ (you could also say a meu/teu/seu/etc. pesar)and hence ’notwithstanding’ (see this Glosario da poesía medieval profana galego-portuguesa).
Now, to compare with in (de)spite of, according to Etymonline it meant originally ’in defiance or contempt of’ (the prepositional use of despite is short for in despite of, and spite was shortened from despite); despite meaning ’contemptuous challenge, defiance; act designed to insult or humiliate someone’ scorn, contempt;’ from Old French despit, ultimately from Latin despectus, ’act of looking down on, scorn, contempt’.
So if X is a potential obstacle to your doing something, but you do it anyway, in English you do it in spite of X, or in contempt of X; whereas in Portuguese we do it apesar de X, or ’to the sadness of’ X.
If you want to go into details
I think native Portuguese speakers can easily make sense of apesar (if we bother to think about it at all) because everyone knows pesar means ’sadness.’ But we no longer say apesar, or even a pesar, to mean ’to the sadness of;’ we would say para pesar de instead, as in:

João rompeu o noivado e entrou para um convento, para grade pesar de sua mãe
João broke off his engagement and joined a convent, to the great sorrow of his mother

We no longer say apesar to mean ’against the will of’ either. For instance, to say João married against the will of his parents, we would say João casou contra vontade dos pais or apesar da oposição dos pais; just apesar dos pais would sound strange. But ’against the will’ is still how Portuguese dictionaries of the 1600s (our earliest) define a pesar. They are Portuguese-Latin dictionaries and render a pesar as Latin invite or invitus (see this 1619 one and this 1647 one), which according to Lewis and Short Dictionary means “against one’s will, unwilling, reluctant.” The 1611 Agostinho Barbosa dictionary is quite explicit:

(It is spelled a pezar: by this time people were already mixing up s and z, as in Brasil and Brazil; see this question.)
For an actual example of the old usage see the following verses from this late 1200s/early 1300s “cantiga de amor”. Folks at the Universidade Nova de Lisboa explain  a pesar de mim as “para meu pesar, contra minha vontade”  (’to my sorrow, against my will’; follow the link and click on the icons for the explanations; my English translation):

Nostro Senhor, assi El me perdom:            Our Lord, so He may forgive me
nom me deu morte, que de coraçom,          hasn’t given me death, which from my heart
Lhe roguei sempr’e muito Lha pedi,           I always begged of Him and asked of Him
mais deu-me vida, a pesar de mim           but gave me life, to my sorrow/against my will

There are many more examples in the Glosario da poesía medieval profana galego-portuguesa.
Now, only people can feel sorrow or have will, and early on, accordingly, you only find a pesar de someone, not something. I looked up this Corpus do Português and the earliest examples of apesar de something I found are from the 1500s as in “a pesar do mal que me resiste” (Camões) (’despite the evil that resists me’), “a pesar dos ventos” (João de Barros) (’despite the winds’), “a pesar de quantos inconvenientes ante mi vejo” (’despite the inconveniences I see before me’.
Looking at this Spanish Corpus (CORDE), a pesar developed similarly, except that I find a few a pesar de something in the late 1300s already (a pesar de someone from the mid-1100s).
Now curiously, to mean  ’I do something with great sadness, against my heart's desire,’ in Old Portuguese people could say I do it a meu pesar or a pesar de mim (see this cantiga de amor); in English you can say you did it with a heavy heart. It’s sort of the same weight metaphor.

