Q:

Plural de substantivos compostos: e.g. por que “cavalos-vapor” mas “decretos-leis”?

As vezes fico confuso com a flexão de substantivos compostos. A seguir alguns exemplos:

Exemplo (1):
Cavalo-vapor / para-lama
Cavalos-vapor / para-lamas
Exemplo (2):
Decreto-lei / matéria-prima
Decretos-leis / matérias-primas
Exemplo (3):
Salvo-conduto / vice-diretor
Salvos-condutos / vice-diretores
Exemplo (4):
Surdo-mudo / bem-falante
Surdos-mudos / bem-falantes

Os exemplos são de Fernando Moura, Gramática aplicada ao texto, Vestacon: Brasilia-DF, 2005, e usados em comentários sobre uma questão de concurso da Universidade de Brasília: UnB.
Qual é a regra que foi utilizada para flexionar ou não os elementos desses substantivos?

A:

«Não é fácil a formação do plural dos substantivos compostos» — é como Celso Cunha e Lindley Cintra abrem a exposição do assunto na Nova Gramática do Português Contemporâneo (Lisboa, 2014, p. 248-50). E este artigo no Ciberdúvidas diz que o assunto é «por vezes, complicado e um tanto controverso». Mas lá apresentam algumas regularidades. O que se segue baseia-se sobretudo no Cunha e Cintra. Confirmei a correção de todos os exemplos no Vocabulário Ortográfico Comum.
Verbo + substantivo. O verbo não se altera, e só o segundo elemento é que passa para o plural:

guarda-chuva, guarda-chuvas
  pica-pau, pica-paus
  para-sol, para-sóis

Está também neste caso o para-lama, para-lamas. Com uma observação: podemos também usar para-lamas como substantivo singular: um para-lamas. Isto é comum com este tipo de substantivos. Mais exemplos de substantivos de dois números: abre-latas, saca-rolhas, quebra-nozes, para-raios.
Advérbio, prefixo ou elemento que funcione como prefixo + substantivo ou adjetivo. Advérbios e prefixos são invariáveis, portanto só o segundo elemento é que passa para o plural. Caiem neste caso os teus exemplos vice-diretor e bem-falante. Outros exemplos:

abaixo-assinado, abaixo-assinados
  sempre-viva, sempre-vivas
  pré-história, pré-histórias
  arqui-inimigo, arqui-inimigos

Adjetivo e Substantivo. Normalmente os dois elementos passam ao plural. É o caso do teu exemplo matéria-prima e salvo-conduto. Outros exemplos:

Amor-perfeito, amores-perfeitos
  Gentil-homem, gentis-homens
  Alto-comissário, altos-comissários

Dois substantivos. Este é o caso mais complicado. O mais comum é ambos os elementos passarem ao plural (indico apenas os plurais): surdos-mudos, tenentes-coronéis, tios-avôs
Mas há uma exceção: só o primeiro elemento passa ao plural quando o segundo substantivo «funciona como determinante específico» (Cunha e Cintra, p. 249). Por exemplo, livro-caixa, livros-caixa. O livro-caixa é um livro onde se registam as entradas e saídas de dinheiro em caixa. Portanto caixa determina o tipo do livro; não se pode dizer o inverso, que livro determina o tipo de caixa; nem se pode dizer que livro-caixa seja livro e caixa ao mesmo tempo, ou uma coisa intermédia entre livro e caixa. Cunha e Cintra dão como exemplos (indico apenas o plural) navios-escola, salários-família, bananas-prata, mangas-espada; no Ciberdúvidas temos ainda cafés-concerto e livros-razão. E está neste caso o teu cavalos-vapor.
O problema é que ou esta regra não é sempre seguida ou nem sempre é claro se o segundo substantivo determina o tipo do primeiro. E alguns exemplos dados pelo Cunha e Cintra e artigo do Ciberdúvidas como pertencendo a esta categoria aparecem no Vocabulário Ortográfico Comum (navio-escola) e em vários dicionários com dois plurais possíveis:

Navio escola: navios-escola ou navios-escolas
  Café-concerto: cafés-concerto ou cafés-concertos 

Também decreto-lei, contrariamente à opinião do Fernando Moura, admite os plurais decretos-lei e decretos-leis. Alguns casos onde há consenso que apensas o primeiro exemplo passa ao plural: livros-caixa, livros-razão, cavalos-vapor, anos-luz, banana-prata.

