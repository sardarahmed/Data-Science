Q:

Running vslam_system with stereo images via uvc_camera

I've been able to successfully install and run uvc_camera stereo_node. I can see published images with rviz, with data on following topics
/left/image_raw
/left/camera_info
/right/image_raw
/right/camera_info

so everything fine so far. I've also already read this thread, but this doesn't solve my problem.
I'm using the following launch-file:
<launch>

  <!--<param name="/use_sim_time" value="True" />-->

    <node name="stereo_vslam_node" pkg="vslam_system" type="stereo_vslam_node" args="$(find vocabulary_tree)/holidays.tree $(find vocabulary_tree)/holidays.weights $(find vslam_system)/data/calonder.rtc" output="screen" cwd="node">
      <remap from="left/image_rect" to="/left/image_raw" />
      <remap from="right/image_rect" to="/right/image_raw" />
      <remap from="left/camera_info" to="/left/camera_info" />
      <remap from="right/camera_info" to="/right/camera_info" />
    </node>

  <!-- Show VO tracks -->
  <node name="vo_tracks_view" pkg="image_view" type="image_view">
    <remap from="image" to="/vslam/vo_tracks/image" />
  </node>

</launch>

After launching uvc_camera and vslam_system, I'm getting the following error:
process[stereo_vslam_node-1]: started with pid [14984]
[OK] Loaded RTC, quantization=4 bits
[OK] RTC: overall 24816/9011200 (0.275%) zeros in float leaves
          overall 464923/9011200 (5.159%) zeros in uint8 leave[roscpp_internal] 

[2011-04-29 15:19:28,316] [thread 0xb68e4890]: [DEBUG] UDPROS server listening on port [56579]
[roscpp_internal] [2011-04-29 15:19:28,324] [thread 0xb68e4890]: [DEBUG] Started node [/stereo_vslam_node], pid [14984], bound on [minigun], xmlrpc port [55094], tcpros port [60156], logging to [/home/user/.ros/log/496c507e-7263-11e0-a7b0-001f3c37bd78/stereo_vslam_node-1.log], using [real] time
        [ INFO] [1304083170.284822563]: In callback, seq = 340
        [stereo_vslam_node-1] process has died [pid 14984, exit code -11].
        log files: /home/user/.ros/log/496c507e-7263-11e0-a7b0-001f3c37bd78/stereo_vslam_node-1*.log

Saying (sorry about the size):
[roscpp_internal] [2011-04-29 15:19:28,414] [thread 0xb68e4890]: [DEBUG] XML-RPC call [searchParam] returned an error (-1): [Cannot find parameter [tf_prefix] in an upwards search]
[roscpp_internal] [2011-04-29 15:19:28,416] [thread 0xb68e4890]: [DEBUG] Publisher update for [/tf]:  already have these connections: 
[roscpp_internal] [2011-04-29 15:19:28,416] [thread 0xb68e4890]: [DEBUG] Creating intraprocess link for topic [/tf]
[roscpp_internal] [2011-04-29 15:19:28,418] [thread 0xb68e4890]: [DEBUG] XML-RPC call [lookupService] returned an error (-1): [no provider]
[roscpp_internal] [2011-04-29 15:19:28,422] [thread 0xb68e4890]: [DEBUG] XML-RPC call [searchParam] returned an error (-1): [Cannot find parameter [tf_prefix] in an upwards search]
[roscpp_internal] [2011-04-29 15:19:28,466] [thread 0xb68e2b70]: [DEBUG] Accepted connection on socket [7], new socket [12]
[roscpp_internal] [2011-04-29 15:19:28,467] [thread 0xb68e2b70]: [DEBUG] TCPROS received a connection from [127.0.0.1:60994]
[roscpp_internal] [2011-04-29 15:19:28,467] [thread 0xb68e2b70]: [DEBUG] Connection: Creating TransportSubscriberLink for topic [/rosout] connected to [callerid=[/rosout] address=[TCPROS connection to [127.0.0.1:60994 on socket 12]]]
[roscpp_internal] [2011-04-29 15:19:28,613] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/detector] is not set]
[roscpp_internal] [2011-04-29 15:19:28,615] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/fast_threshold] is not set]
[roscpp_internal] [2011-04-29 15:19:28,616] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/fast_nonmax_suppression] is not set]
[roscpp_internal] [2011-04-29 15:19:28,618] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/harris_max_keypoints] is not set]
[roscpp_internal] [2011-04-29 15:19:28,620] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/harris_block_size] is not set]
[roscpp_internal] [2011-04-29 15:19:28,621] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/harris_min_distance] is not set]
[roscpp_internal] [2011-04-29 15:19:28,623] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/harris_quality_level] is not set]
[roscpp_internal] [2011-04-29 15:19:28,625] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/harris_k] is not set]
[roscpp_internal] [2011-04-29 15:19:28,627] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/star_max_size] is not set]
[roscpp_internal] [2011-04-29 15:19:28,629] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/star_response_threshold] is not set]
[roscpp_internal] [2011-04-29 15:19:28,631] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/star_line_threshold_projected] is not set]
[roscpp_internal] [2011-04-29 15:19:28,632] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/star_line_threshold_binarized] is not set]
[roscpp_internal] [2011-04-29 15:19:28,636] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/star_suppress_nonmax_size] is not set]
[roscpp_internal] [2011-04-29 15:19:28,639] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/surf_hessian_threshold] is not set]
[roscpp_internal] [2011-04-29 15:19:28,641] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/surf_octaves] is not set]
[roscpp_internal] [2011-04-29 15:19:28,643] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/surf_octave_layers] is not set]
[roscpp_internal] [2011-04-29 15:19:28,646] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/grid_adapter] is not set]
[roscpp_internal] [2011-04-29 15:19:28,648] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/grid_max_keypoints] is not set]
[roscpp_internal] [2011-04-29 15:19:28,649] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/grid_rows] is not set]
[roscpp_internal] [2011-04-29 15:19:28,651] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/grid_cols] is not set]
[roscpp_internal] [2011-04-29 15:19:28,653] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/vo_ransac_iterations] is not set]
[roscpp_internal] [2011-04-29 15:19:28,655] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/vo_polish] is not set]
[roscpp_internal] [2011-04-29 15:19:28,656] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/vo_window_x] is not set]
[roscpp_internal] [2011-04-29 15:19:28,658] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/vo_window_y] is not set]
[roscpp_internal] [2011-04-29 15:19:28,659] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/min_keyframe_dist] is not set]
[roscpp_internal] [2011-04-29 15:19:28,661] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/min_keyframe_angle] is not set]
[roscpp_internal] [2011-04-29 15:19:28,663] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/min_inliers] is not set]
[roscpp_internal] [2011-04-29 15:19:28,665] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/pr_ransac_iterations] is not set]
[roscpp_internal] [2011-04-29 15:19:28,667] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/pr_polish] is not set]
[roscpp_internal] [2011-04-29 15:19:28,670] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/pr_window_x] is not set]
[roscpp_internal] [2011-04-29 15:19:28,675] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/pr_window_y] is not set]
[roscpp_internal] [2011-04-29 15:19:28,677] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/pr_skip] is not set]
[roscpp_internal] [2011-04-29 15:19:28,678] [thread 0xb68e4890]: [DEBUG] XML-RPC call [getParam] returned an error (-1): [Parameter [/stereo_vslam_node/pr_inliers] is not set]
[roscpp_internal] [2011-04-29 15:19:30,063] [thread 0xb68e4890]: [DEBUG] Publisher update for [/left/image_raw]: http://minigun:36551/,  already have these connections: 
[roscpp_internal] [2011-04-29 15:19:30,063] [thread 0xb68e4890]: [DEBUG] Began asynchronous xmlrpc connection to [minigun:36551]
[roscpp_internal] [2011-04-29 15:19:30,066] [thread 0xb68e4890]: [DEBUG] Publisher update for [/left/camera_info]: http://minigun:36551/,  already have these connections: 
[roscpp_internal] [2011-04-29 15:19:30,067] [thread 0xb68e4890]: [DEBUG] Began asynchronous xmlrpc connection to [minigun:36551]
[roscpp_internal] [2011-04-29 15:19:30,072] [thread 0xb68e4890]: [DEBUG] Publisher update for [/right/image_raw]: http://minigun:36551/,  already have these connections: 
[roscpp_internal] [2011-04-29 15:19:30,072] [thread 0xb68e4890]: [DEBUG] Began asynchronous xmlrpc connection to [minigun:36551]
[roscpp_internal] [2011-04-29 15:19:30,075] [thread 0xb68e4890]: [DEBUG] Publisher update for [/right/camera_info]: http://minigun:36551/,  already have these connections: 
[roscpp_internal] [2011-04-29 15:19:30,075] [thread 0xb68e4890]: [DEBUG] Began asynchronous xmlrpc connection to [minigun:36551]
[roscpp_internal] [2011-04-29 15:19:30,170] [thread 0xb60e1b70]: [DEBUG] Connecting via tcpros to topic [/left/image_raw] at host [minigun:38407]
[roscpp_internal] [2011-04-29 15:19:30,170] [thread 0xb60e1b70]: [DEBUG] Resolved publisher host [minigun] to [127.0.0.1] for socket [15]
[roscpp_internal] [2011-04-29 15:19:30,170] [thread 0xb60e1b70]: [DEBUG] Async connect() in progress to [minigun:38407] on socket [15]
[roscpp_internal] [2011-04-29 15:19:30,171] [thread 0xb60e1b70]: [DEBUG] Connected to publisher of topic [/left/image_raw] at [minigun:38407]
[roscpp_internal] [2011-04-29 15:19:30,171] [thread 0xb60e1b70]: [DEBUG] Connecting via tcpros to topic [/left/camera_info] at host [minigun:38407]
[roscpp_internal] [2011-04-29 15:19:30,171] [thread 0xb60e1b70]: [DEBUG] Resolved publisher host [minigun] to [127.0.0.1] for socket [16]
[roscpp_internal] [2011-04-29 15:19:30,171] [thread 0xb60e1b70]: [DEBUG] Async connect() in progress to [minigun:38407] on socket [16]
[roscpp_internal] [2011-04-29 15:19:30,171] [thread 0xb60e1b70]: [DEBUG] Connected to publisher of topic [/left/camera_info] at [minigun:38407]
[roscpp_internal] [2011-04-29 15:19:30,272] [thread 0xb60e1b70]: [DEBUG] Connecting via tcpros to topic [/right/image_raw] at host [minigun:38407]
[roscpp_internal] [2011-04-29 15:19:30,273] [thread 0xb60e1b70]: [DEBUG] Resolved publisher host [minigun] to [127.0.0.1] for socket [10]
[roscpp_internal] [2011-04-29 15:19:30,273] [thread 0xb60e1b70]: [DEBUG] Async connect() in progress to [minigun:38407] on socket [10]
[roscpp_internal] [2011-04-29 15:19:30,273] [thread 0xb60e1b70]: [DEBUG] Connected to publisher of topic [/right/image_raw] at [minigun:38407]
[roscpp_internal] [2011-04-29 15:19:30,273] [thread 0xb60e1b70]: [DEBUG] Connecting via tcpros to topic [/right/camera_info] at host [minigun:38407]
[roscpp_internal] [2011-04-29 15:19:30,274] [thread 0xb60e1b70]: [DEBUG] Resolved publisher host [minigun] to [127.0.0.1] for socket [11]
[roscpp_internal] [2011-04-29 15:19:30,274] [thread 0xb60e1b70]: [DEBUG] Async connect() in progress to [minigun:38407] on socket [11]
[roscpp_internal] [2011-04-29 15:19:30,274] [thread 0xb60e1b70]: [DEBUG] Connected to publisher of topic [/right/camera_info] at [minigun:38407]
[ros.vslam_system] [2011-04-29 15:19:30,284] [thread 0xb68e4890]: [INFO] In callback, seq = 340s

It seems many parameters are not set and some tf_prefix information is missing. In case it's important: I'm using 320x240 resolution on both cameras and haven't calibrated them yet.
Any hints appreciated.

Originally posted by tom on ROS Answers with karma: 1079 on 2011-04-29
Post score: 0

A:

Ok, in case anyone else got stuck as I did: the problem was, I just used uvc_camera to publish raw camera images, which is too little for vslam_system to work. You need synchronized, rectified images to use vslam (as it says in the wiki, but just not clear enough for me to notice right away :) ). So the solution for uvc cameras is:

Install and run uvc_camera to publish raw images
Calibrate the cameras using camera_calibration cameracalibrator.py to calibrate your stereo cameras (using a checkerboard, as described here)
Rerun uvc_camera for it to grab the generated calibration files
run: rosrun stereo_image_proc stereo_image_proc (this will publish rectified camera images)
Do as it says here

Hope it helps.

Originally posted by tom with karma: 1079 on 2011-05-04
This answer was ACCEPTED on the original site
Post score: 0

