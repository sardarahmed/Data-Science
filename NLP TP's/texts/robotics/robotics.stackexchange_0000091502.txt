Q:

Unable to update data field of Float32MultiArray std msg

I am trying to publish a float array. To do this, I am utilizing the Float32MultiArray std message:
#include <ros.h>
#include <std_msgs/Float32MultiArray.h>
    
float values[3] = {1.0, 2.0, 3.0};

ros::NodeHandle nh;
std_msgs::Float32MultiArray array_msg;
ros::Publisher pub("array_publisher", &array_msg);

void setup() {
  nh.initNode();
  nh.advertise(pub);
}

void loop(){
  array_msg.data = values;
  pub.publish(&array_msg);
  nh.spinOnce();
  delay(1000);
}

However, when I rostopic echo the publisher, the message is empty i.e. the data field is unpopulated:
rostopic echo /array_publisher
layout:
  dim: []
  data_offset: 0
data: []

Originally posted by jkarimi91 on ROS Answers with karma: 16 on 2019-04-24
Post score: 0

Original comments
Comment by ahendrix on 2019-04-24:
On arduino, I think you also need to set the array length, but I don't remember how to do it offhand.
Comment by jayess on 2019-04-24:
Take a look at array section on the limitations of rosserial page.

A:

On the arduino side, array messages have an extra variable added to their class definitions used to define their length. In our case, this means that the Float32MultiArray msg has a data and data_length field; in order to set the data field we first need to set the data_length field:
#include <ros.h>
#include <std_msgs/Float32MultiArray.h>

int array_length = 3;
float values[array_length] = {1.0, 2.0, 3.0};

ros::NodeHandle nh;
std_msgs::Float32MultiArray array_msg;
ros::Publisher pub("array_publisher", &array_msg);

void setup() {
  nh.initNode();
  nh.advertise(pub);
}

void loop(){
  array_msg.data_length = array_length;
  array_msg.data = values;
  pub.publish(&array_msg);
  nh.spinOnce();
  delay(1000);
}

For more information, see the array section of the rosserial limitations page.

Originally posted by jkarimi91 with karma: 16 on 2019-04-25
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by jayess on 2019-04-25:
@jkarimi91If this solved your problem, then please mark your answer as correct by clicking on the check mark next to the answer.
Comment by jkarimi91 on 2019-04-25:
@jayess I don't have enough points to accept or unaccept my own answer

