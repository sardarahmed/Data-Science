Q:

Segmentation fault in publishing array message

Hi
I'm trying to publish polygonal position as message. The publisher is make correct but "segmentation error" shows when I rosrun the publisher, saying "Segmentation fault (core dumped)".
int main(int argc,char** argv)
{
    ros::init(argc, argv, "line_formation");
    ros::NodeHandle na;
    geometry_msgs::Polygon destination;

    ros::Subscriber sub= na.subscribe<sensor_msgs::Joy>("/joy",1,joyCallback);
    ros::Publisher pub= na.advertise<geometry_msgs::Polygon>("uav_positions",10);
    ros::Rate loop_rate(2);

   while (ros::ok)
   {
      central_x +=array[4]; 
      central_y +=-array[3];
      central_z +=array[1];

      destination.points[0].x=central_x;
      destination.points[0].y=central_y;
      destination.points[0].z=central_z;

      pub.publish(destination);
      ros::spinOnce();
      loop_rate.sleep();
   }
}
 

As it shows, I use message "geometry_msgs/Polygon". It seems its caused by publishing array. If I publish single point message as "geometry_msgs/Point", it works. But I need to publish several points. So I have to publish array.
Any idea how to solve it or other ways to publish several points position?
Thanks
Glen

Originally posted by Glen on ROS Answers with karma: 40 on 2014-08-01
Post score: 0

A:

In C++ ROS messages, variable-sized arrays are implemented as a std::vector, which start with a size of 0. You're probably getting a segmentation fault because you're trying to use an array index that is out of bounds.
You should probably call resize() to set the size of the points array:
destination.points.resize(1);

If you're interested in learning more about the std::vector, my favorite reference is http://www.cplusplus.com/reference/vector/vector/

Originally posted by ahendrix with karma: 47576 on 2014-08-01
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Glen on 2014-08-01:
It shows "geometry_msgs::Polygon has no member named 'resize' ". I'm nor sure is that because declaration of "geometry_msgs/Polygon". Still reading the reference you sent to me, trying to figure it out.
Comment by Glen on 2014-08-01:
Sorry, it worked! I make a typing error when resize it. Thanks!

