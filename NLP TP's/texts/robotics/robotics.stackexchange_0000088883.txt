Q:

How can I publish Twist messages to /gazebo node(amcl_demo.launch)

Hello! I'm runnning TurtleBot on rviz, and I want to publish Twist messages to the "/gazebo" node  in order to control robot's velocity.
I wrote a publisher as below but it didn't work. 
How can I solve this ploblem? Could you tell me please?
my code↓↓
#!/usr/bin/env python
import rospy
from geometry_msgs.msg import Twist
def callback(data):
    pub=rospy.Publisher("/gazebo",Twist,queue_size=10)
    vel_msg=Twist()
    print(data.linear.x,data.angular.z)
    vel_msg.linear.x=0
    vel_msg.angular.z=0
    pub.publish(vel_msg)

def main():
    rospy.init_node("GetVelocity")
    sub=rospy.Subscriber("/mobile_base/commands/velocity",Twist,callback)
    rospy.spin()

if __name__== "__main__":
    try:
        main()
    except rospy.ROSInterruptException:
        pass

rqt_graph Image↓↓(while running "amcl_demo.launch"&"rviz"&"turtlebot_world.launch"&"above code")
rqt_graph(red arrow in this picture shows what  I want to do)

Originally posted by Reulix on ROS Answers with karma: 3 on 2018-09-06
Post score: 0

Original comments
Comment by Choco93 on 2018-09-06:
can you post the whole rqt_graph?
Comment by Reulix on 2018-09-06:
Yes, sure. Here you are!
all nodes

A:

There are few mistakes in your code :

You shouldn't initialize the publisher inside the callback it can create errors. Initialize it in the main function.

You don't have to subscribe to any topic if you only want to publish a speed command.

You are trying to publish data on the topic "/gazebo" but it's actually the name of the gazebo node so it cannot work.

Since you have a cmd_vel multiplexer you can publish data on the topic /cmd_vel OR /mobile_base/commands/velocity

You should set vel_msg.linear.x to some value (1 for example) to directly see your robot moving (it will be easier for you to debug)

It should work fine with those change.

Originally posted by Delb with karma: 3907 on 2018-09-06
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Reulix on 2018-09-06:
Thank you for your quick reply!!
Yes, subscriber isn't needed for this purpose, but I just wanted to check how TurtleBot would move
Ok I'll try it！
Comment by Choco93 on 2018-09-06:
as mentioned in answer, publish to /mobile_base/commands/velocity, gazebo is just subscribing to this topic so you shouldn't publish anything to gazebo.
Comment by Reulix on 2018-09-06:
I made a Publisher in main function, set it to publish Twist topics to /mobile_base/commands velocity as you said, and I finally found TurtleBot would move as desired speed!!! Thanks to you, I could solve the problem!
Comment by Delb on 2018-09-06:
I'm glad it worked well ! You can mark the answer as correct if you have no more issue
Comment by Reulix on 2018-09-06:
I did it!

