Q:

Error for autoware on jetson AGX "Could not find a primary shell extension for creating an environment hook"

Hello!
I have Nvidia Jetson AGX Xavier with jetpack 4.3. Am trying to get Autoware on it but consistently keep on getting the following error. I am trying to compile with CUDA. Have tried with the master version and the 1.12 but keep on getting the same issue.
drillvision@drillvision-desktop:~/autoware.ai$ AUTOWARE_COMPILE_WITH_CUDA=1 colcon build --cmake-args -DCMAKE_BUILD_TYPE=Release
Starting >>> autoware_build_flags
Starting >>> autoware_msgs
Starting >>> vector_map_msgs
Starting >>> autoware_config_msgs                                    
Starting >>> tablet_socket_msgs
Starting >>> autoware_system_msgs
Starting >>> autoware_can_msgs                                       
Starting >>> mrt_cmake_modules
Finished <<< mrt_cmake_modules [2.58s]                                      
Starting >>> lanelet2_core                                                  
Finished <<< autoware_build_flags [6.08s]                                     
Starting >>> gnss
Finished <<< lanelet2_core [9.24s]                                    
Starting >>> lanelet2_io                                              
Finished <<< autoware_can_msgs [17.5s]                                   
Starting >>> lanelet2_traffic_rules
Finished <<< tablet_socket_msgs [18.8s]                                  
Starting >>> sick_ldmrs_description
Finished <<< lanelet2_io [13.2s]                                         
Starting >>> lanelet2_projection
Finished <<< lanelet2_traffic_rules [8.03s]                              
Starting >>> lanelet2_routing                                            
Finished <<< gnss [20.2s]                                                
Starting >>> sick_ldmrs_msgs
Finished <<< sick_ldmrs_description [10.6s]                              
Starting >>> ds4_msgs
Finished <<< autoware_system_msgs [30.6s]                                
Starting >>> autoware_health_checker
Finished <<< lanelet2_projection [7.35s]                                  
Starting >>> lanelet2_maps                                                
Finished <<< lanelet2_maps [3.02s]                                        
Starting >>> custom_msgs
Finished <<< lanelet2_routing [10.4s]                                     
Starting >>> lanelet2_python
Finished <<< ds4_msgs [10.9s]                                             
Starting >>> ds4_driver
Finished <<< autoware_config_msgs [41.8s]                                 
Starting >>> gazebo_camera_description
Finished <<< ds4_driver [4.38s]                                           
Starting >>> gazebo_imu_description
Finished <<< gazebo_camera_description [7.92s]                            
Starting >>> ndt_cpu
Finished <<< gazebo_imu_description [7.88s]                                   
Starting >>> ndt_tku
Finished <<< sick_ldmrs_msgs [30.3s]                                          
Starting >>> sick_ldmrs_driver
Finished <<< vector_map_msgs [58.7s]                                          
Starting >>> vector_map
Finished <<< ndt_tku [13.2s]                                                  
Starting >>> pcl_omp_registration
Finished <<< custom_msgs [55.6s]              
Starting >>> fastvirtualscan
[102.320s] ERROR:colcon.colcon_core.shell:Exception in shell extension 'powershell': [Errno 13] Permission denied: '/home/drillvision/autoware.ai/install/autoware_msgs/share/autoware_msgs/hook/ros_package_path.ps1'
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/colcon_core/shell/__init__.py", line 390, in create_environment_hook
    subdirectory)
  File "/usr/lib/python3/dist-packages/colcon_powershell/shell/powershell.py", line 131, in create_hook_prepend_value
    'subdirectory': subdirectory,
  File "/usr/lib/python3/dist-packages/colcon_core/shell/template/__init__.py", line 45, in expand_template
    with destination_path.open('w') as h:
  File "/usr/lib/python3.6/pathlib.py", line 1183, in open
    opener=self._opener)
  File "/usr/lib/python3.6/pathlib.py", line 1037, in _opener
    return self._accessor.open(self, flags, mode)
  File "/usr/lib/python3.6/pathlib.py", line 387, in wrapped
    return strfunc(str(pathobj), *args)
PermissionError: [Errno 13] Permission denied: '/home/drillvision/autoware.ai/install/autoware_msgs/share/autoware_msgs/hook/ros_package_path.ps1'

[102.331s] ERROR:colcon.colcon_core.shell:Exception in shell extension 'dsv': [Errno 13] Permission denied: '/home/drillvision/autoware.ai/install/autoware_msgs/share/autoware_msgs/hook/ros_package_path.dsv'
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/colcon_core/shell/__init__.py", line 390, in create_environment_hook
    subdirectory)
  File "/usr/lib/python3/dist-packages/colcon_core/shell/dsv.py", line 64, in create_hook_prepend_value
    'value': subdirectory,
  File "/usr/lib/python3/dist-packages/colcon_core/shell/template/__init__.py", line 45, in expand_template
    with destination_path.open('w') as h:
  File "/usr/lib/python3.6/pathlib.py", line 1183, in open
    opener=self._opener)
  File "/usr/lib/python3.6/pathlib.py", line 1037, in _opener
    return self._accessor.open(self, flags, mode)
  File "/usr/lib/python3.6/pathlib.py", line 387, in wrapped
    return strfunc(str(pathobj), *args)
PermissionError: [Errno 13] Permission denied: '/home/drillvision/autoware.ai/install/autoware_msgs/share/autoware_msgs/hook/ros_package_path.dsv'

[102.337s] ERROR:colcon.colcon_core.shell:Exception in shell extension 'sh': [Errno 13] Permission denied: '/home/drillvision/autoware.ai/install/autoware_msgs/share/autoware_msgs/hook/ros_package_path.sh'
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/colcon_core/shell/__init__.py", line 390, in create_environment_hook
    subdirectory)
  File "/usr/lib/python3/dist-packages/colcon_core/shell/sh.py", line 106, in create_hook_prepend_value
    'subdirectory': subdirectory,
  File "/usr/lib/python3/dist-packages/colcon_core/shell/template/__init__.py", line 45, in expand_template
    with destination_path.open('w') as h:
  File "/usr/lib/python3.6/pathlib.py", line 1183, in open
    opener=self._opener)
  File "/usr/lib/python3.6/pathlib.py", line 1037, in _opener
    return self._accessor.open(self, flags, mode)
  File "/usr/lib/python3.6/pathlib.py", line 387, in wrapped
    return strfunc(str(pathobj), *args)
PermissionError: [Errno 13] Permission denied: '/home/drillvision/autoware.ai/install/autoware_msgs/share/autoware_msgs/hook/ros_package_path.sh'
                                              
--- stderr: autoware_msgs
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/colcon_core/executor/__init__.py", line 91, in __call__
    rc = await self.task(*args, **kwargs)
  File "/usr/lib/python3/dist-packages/colcon_core/task/__init__.py", line 92, in __call__
    return await task_method(*args, **kwargs)
  File "/usr/lib/python3/dist-packages/colcon_ros/task/catkin/build.py", line 79, in build
    'ROS_PACKAGE_PATH', 'share', mode='prepend')
  File "/usr/lib/python3/dist-packages/colcon_core/shell/__init__.py", line 409, in create_environment_hook
    'Could not find a primary shell extension for creating an '
RuntimeError: Could not find a primary shell extension for creating an environment hook
---
Failed   <<< autoware_msgs  [ Exited with code 1 ]
--- stderr: autoware_health_checker                      
make[2]: *** No rule to make target '/usr/lib/aarch64-linux-gnu/libopencv_objdetect.so.3.2.0', needed by 'devel/lib/autoware_health_checker/health_aggregator'.  Stop.
make[2]: *** Waiting for unfinished jobs....
make[1]: *** [CMakeFiles/health_aggregator.dir/all] Error 2
make: *** [all] Error 2
---
Aborted  <<< autoware_health_checker
Aborted  <<< fastvirtualscan                             
--- stderr: pcl_omp_registration                         
** WARNING ** io features related to ensenso will be disabled
** WARNING ** io features related to davidSDK will be disabled
** WARNING ** io features related to dssdk will be disabled
** WARNING ** io features related to pcap will be disabled
** WARNING ** io features related to png will be disabled
** WARNING ** io features related to libusb-1.0 will be disabled
** WARNING ** visualization features related to ensenso will be disabled
** WARNING ** visualization features related to davidSDK will be disabled
** WARNING ** visualization features related to dssdk will be disabled
** WARNING ** visualization features related to rssdk will be disabled
---
Aborted  <<< pcl_omp_registration
Aborted  <<< vector_map                                  
--- stderr: ndt_cpu                                      
** WARNING ** io features related to ensenso will be disabled
** WARNING ** io features related to davidSDK will be disabled
** WARNING ** io features related to dssdk will be disabled
** WARNING ** io features related to pcap will be disabled
** WARNING ** io features related to png will be disabled
** WARNING ** io features related to libusb-1.0 will be disabled
** WARNING ** visualization features related to ensenso will be disabled
** WARNING ** visualization features related to davidSDK will be disabled
** WARNING ** visualization features related to dssdk will be disabled
** WARNING ** visualization features related to rssdk will be disabled
---
Aborted  <<< ndt_cpu
Aborted  <<< sick_ldmrs_driver                           
Aborted  <<< lanelet2_python                 

Summary: 22 packages finished [9min 33s]
  1 package failed: autoware_msgs
  7 packages aborted: autoware_health_checker fastvirtualscan lanelet2_python ndt_cpu pcl_omp_registration sick_ldmrs_driver vector_map
  4 packages had stderr output: autoware_health_checker autoware_msgs ndt_cpu pcl_omp_registration
  120 packages not processed
Could not find a primary shell extension for creating an environment hook

Originally posted by msaeUF on ROS Answers with karma: 53 on 2020-01-29
Post score: 1

A:

I was able to solve this issue and build on Jetson Xavier AGX. I cleaned up everything, reflashed the OS onto it. This time 4.2
Installed Opencv following: https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=11&cad=rja&uact=8&ved=2ahUKEwirlZKazcXnAhURKqwKHXCQCcMQtwIwCnoECAUQAQ&url=https%3A%2F%2Fwww.jetsonhacks.com%2F2018%2F11%2F08%2Fbuild-opencv-3-4-on-nvidia-jetson-agx-xavier-developer-kit%2F&usg=AOvVaw26Y0BrsJisM1XFtvCQuRMd
Installed  Ros Melodic following: https://www.jetsonhacks.com/2018/10/26/robot-operating-system-ros-on-nvidia-jetson-agx-xavier-developer-kit/
Installed Qt5
Installed other dependencies listed in: https://gitlab.com/autowarefoundation/autoware.ai/autoware/-/wikis/Source-Build
and was able to build from source just fine

Originally posted by msaeUF with karma: 53 on 2020-02-09
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by Josh Whitley on 2020-02-11:
Thanks for the follow-up!

