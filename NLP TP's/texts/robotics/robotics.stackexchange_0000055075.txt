Q:

Hydro missing turtlesim/Velocity.h in the tutorial writing a tf listener

Hi there,
Ubuntu 12.04;
Ros Hydro;
C++;
link page on ROS: tf/Tutorials/Writing a tf listener (C++)
phenomenon: When I tried to follow the tutorial to write a tf listener in C++ and catkin_make it, error cannot find Velocity.h in the system.
I searched and found that there is Velocity.h in Groovy. In this page(remove turtlesim velocity and use Twist msg in Github),  jihoonl says we should change turtlesimVelocity.h to geometry_msgs/Twist.h.
How should I change the C++ tutorial code in 'writing a tf listener'? I tried to change it properly, but failed. Any suggestion is highly appreciated :)
Thank you very much.

Originally posted by pymsmile on ROS Answers with karma: 1 on 2013-10-27
Post score: 1

A:

Hi,
I know it is been a long time, but if anyone is still looking, please find the answer for changing turtlesimVelocity.h to geometry_msgs/Twist.h below:
I am using Ubuntu 16.04, ROS kinetic. Even though the answer below is specific for those trying the tutorial to write a tf listener in C++ and catkin_make (http://wiki.ros.org/tf/Tutorials/Writing%20a%20tf%20listener%20(C++)), but it can be extended as well.
You need to make changes in the following four places: (please note that the lines below "old" has to be replaced with lines below "new")
//1) old
#include <turtlesim/Velocity.h>

//1) new
#include <geometry_msgs/Twist.h>

//2) old
  ros::Publisher turtle_vel = node.advertise<geometry_msgs::Twist>("turtle2/cmd_vel", 10);

//2) new
  ros::Publisher turtle_vel = node.advertise<geometry_msgs::Twist>("turtle2/cmd_vel", 10);

//3) old
try{
  listener.lookupTransform("/turtle2", "/turtle1",  
                           ros::Time(0), transform);
}
catch (tf::TransformException ex){
  ROS_ERROR("tf listener: %s",ex.what());
  ros::Duration(1.0).sleep();
}

//3) new
try {
    listener.waitForTransform("/turtle2", "/turtle1", ros::Time(0), ros::Duration(10.0) );
    listener.lookupTransform("/turtle2", "/turtle1", ros::Time(0), transform);
} catch (tf::TransformException ex) {
    ROS_ERROR("%s",ex.what());
}

//4) old
turtlesim::Velocity vel_msg;
vel_msg.angular = 4.0 * atan2(transform.getOrigin().y(),
                            transform.getOrigin().x());
vel_msg.linear = 0.5 * sqrt(pow(transform.getOrigin().x(), 2) +
                            pow(transform.getOrigin().y(), 2));

//4) new
geometry_msgs::Twist vel_msg;
vel_msg.angular.z = 4.0 * atan2(transform.getOrigin().y(),
                            transform.getOrigin().x());
vel_msg.linear.x = 0.5 * sqrt(pow(transform.getOrigin().x(), 2) +
                            pow(transform.getOrigin().y(), 2));

Originally posted by balajithevoyager with karma: 80 on 2017-04-14
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by balajithevoyager on 2017-04-14:
If anyone is getting the error "turtle2" passed to lookupTransform argument target_frame does not exist then please do the 3rd change mentioned above - add listener.waitForTransform.
Comment by Sparkle Eyes on 2019-03-31:
Thanks so much for the answer. It helped me on the same problem.

