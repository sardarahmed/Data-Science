Q:

How to send and receive CAN messages on Ubuntu 18.04 using ROS Melodic

I am trying to use a PCAN-USB device (from Peak-System) to be able to send and receive CAN messages which I would like to use to control a robot using ROS at some point for work.From the research I have done, I have found out that there are different drivers and python libraries and different APIs to achieve what I am looking for. The problem is there is no guides or clear instructions on how to get started.
I go to a page and then it tells me to look at something else and this keeps happening. I would like to use the PEAK-System API and drivers, installed both already but I don't know how to make it work with python but and I am not sure if what I have downloaded is even the right thing.
Essentially what I am looking for is some guidance on how to check if the drivers and API is installed correctly and how to get a simple python script going, and then I'll have something to build on.
I have tried to give as much detail as possible and not make the question too broad sorry if it's still not specific enough.
Thanks.

A:

You can use python-can. I find the documentation on https://python-can.readthedocs.io/en/stable/index.html very well written, it should be easy to follow.
I have used this library with ROS 2 without any problem. You can also use it in your ROS 1 package. Note that, drivers are already included in the linux kernel for PCAN.
Don't forget to enable your existing can interface. See https://python-can.readthedocs.io/en/stable/interfaces/socketcan.html
sudo ip link set can0 up type can bitrate 250000

Here is a sample python script to send a message;
import can

bus = can.interface.Bus(interface='socketcan', channel='can0')
msg = can.Message(
    arbitration_id=0xC0FFEE,
    data=[0, 25, 0, 1, 3, 1, 4, 1],
    is_extended_id=True
)
bus.send(msg)

For receiving can messages, I recommend using the Notifier object. It creates a thread to read messages from the bus and distributes them to listeners, i.e., your callback function to process incoming can messages.

