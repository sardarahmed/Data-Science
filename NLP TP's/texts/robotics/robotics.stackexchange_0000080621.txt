Q:

Arduino Ethernet Driver | Custom hardware publishing on topic via ethernet

I have a custom sensor which I am using with an Arduino.  My ultimate goal (TL:DR) is to publish these sensor values on a ROS topic via Ethernet.
I am using a Ethernet shield and have completed the Arduino Ethernet tutorial which walked through creating a server which 'publishes' the sensor data via HTTP. On my PC browser (on the same network) I can navigate to the server/ethernet shield IP address and view the sensor values.
I am familiar with fundamental ROS concepts but just a beginner in Ethernet communication, TCP/IP, etc
So what I'm trying to do is write a driver which 'reads' these sensor values, formats them into a custom rosmsg and publishes this rosmsg on a topic.
I would appreciate some tips if anyone is familiar with interfacing between custom hardware and ROS via ethernet. How would one go about the above things I mentioned? I guess it's to set up a socket listening to the sensor but have no idea how to start on this. I realise that a many sensor drivers do a similar thing as I'm trying to do. I know some SICK sensors communicate via Ethernet so effectively I'm trying to reproduce the same funtionality with my custom hardware. I did look at some of these drivers however couldn't understand them very well. If anyone has any links to tutorials / guide of something similar that would be great.
Also if anyone has any wisdom to impart or tips to offer, that would be great!
Cheers

Originally posted by mcarr on ROS Answers with karma: 145 on 2017-05-04
Post score: 2

A:

Will answer this myself.
I used the Arduino example "WebServer" from the library Ethernet2 as my Server. I then needed a client socket to 'listen' to this data. I used this code from the website Binary Tides as a base for my client socket and this tutorial to understand how the code works.
The next part was to use a string stream to convert the data being received into int arrays (actually vectors) of my desired size. I then created a custom ROS msg by following this tutorial then formatted my data as desired and published it using a basic ros publisher node.
If anyone is trying to publish data from an arduino (e.g. custom sensor) on a ROS topic via ethernet (TCP/IP) feel free to ask for help

Originally posted by mcarr with karma: 145 on 2017-05-09
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by Arnav08 on 2017-05-24:
hey I am trying something same, so I need to subscribe some ros messages and control servo motors. the communication has to be over ethernet. Any suggestions?
Comment by Arnav08 on 2017-05-24:
the arduino has to subscribe the ros messages
Comment by mcarr on 2017-05-26:
If you follow the links in my answer, you should be able to at least create a ROS node which can communicate with Arduino via Ethernet. Then you need make it subscribe to your servo topic as well. The Arduino Example "WebServer" is already reading data, have a look at that.
Comment by mcarr on 2017-05-26:
HERE is my code. You will have to edit most of it to be used in your application
Comment by Arnav08 on 2017-05-29:
Hey Thank you, i ll take a look at your code and will make sense out of it. Thanks for the help . i really appreciate it . Will contact you if face problems
Comment by Noel Cort√©s on 2017-06-22:
Hi, I'm trying to do the opposite way com, I mean, I'm trying to send data to arduino trough the Ethernet shield for remote operation of some actuators.... Could you please give me some ideas for do this? Thank you
Comment by mcarr on 2017-07-03:
Hi Noel, what I've discussed will let you communicate both directions with your Arduino. You will need to write a subscriber for the topic and the code I linked above can be used to send that data to your Arduino. Then you can use that to control your actuators.
Hope that helps, Max

