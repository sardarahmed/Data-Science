Q:

nav2: how to ignore part of the robot on the lidar scan plane

I'm using nav2 on a real robot. It has a 360ยบ Lidar and right behind it it has magnetometer mounting pole. Lidar driver has not angle range limit parameter. So I'm wondering how to ignore an object that is inside the robot to be considered as an obstacle in the local costmap.

A:

Your magnetometer is at a fixed position and will correspond to a fixed range in your LaserScan data of LIDAR. For example if your LIDAR provides you 360 elements in and your magnetometer pole corresponds to range say, [175 to 185] so you can subscribe to LaserScan data edit these data points and then republish on a different scan topic and use that scan topic for local costmap.
import rclpy
from rclpy.node import Node
from sensor_msgs.msg import LaserScan
from rclpy.qos import QoSProfile, qos_profile_sensor_data

class LaserModify(Node):
    def __init__(self):
        super().__init__('laser_modify')

        qos = QoSProfile(depth = 10)

        # Subscribe to original LaseScan data:
        self.scan_laser = self.create_subscription(
            LaserScan, 
            '/scan', 
            self.laser_callback, 
            qos_profile_sensor_data
        )

        # Publisher for modified LaserScan data:
        self.laser_pub = self.create_publisher(LaserScan, '/modified_scan', qos)

    def laser_callback(self, msg):
        for i in range(175,185):
            msg.ranges[i] = float('inf')

        self.laser_pub.publish(msg)

# Main Function(entry Point)
def main(args=None):
    rclpy.init(args=args)
    lm = LaserModify()

    try:
        rclpy.spin(lm)
    except KeyboardInterrupt:
        lm.destroy_node()
        rclpy.shutdown()

# Driver Code       
if __name__=='__main__':
    main()

Here i have edited the range value corresponding to the Magnetometer pole to infinity which essentially means your LIDAR will not see anything there.
You can replace it with some other value maybe by extrapolating the data just outside your magnetometer pole region.

In above picture you can see the cylinder is not visible in the pointcloud corresponding to the modified_scan topic(i removed 170 to 190 index in this case in your case i will depend on the size of the magnetometer pole).

