Q:

Turtlebot navigation tf error

When running the Turtlebot navigation demo I often get the following error:
Waiting on transform from /base_link to /map to become available before running costmap, tf error

Which occurs repeatedly until I quit.  On about 20% of attempts the navigation starts normally.  Any ideas on what might be causing this?  One thing which I'm doing differently is using a map with resolution of 0.02, so perhaps it could be something related to the map being larger than expected.
tf_monitor output when the problem occurs is as follows:
RESULTS: for all Frames

Frames:
Frame: /base_footprint published by /robot_pose_ekf Average Delay: 0.0555048 Max Delay: 0.0800429
Frame: /base_link published by /robot_state_publisher Average Delay: -0.484329 Max Delay: 0
Frame: /front_wheel_link published by /robot_state_publisher Average Delay: -0.484305 Max Delay: 0
Frame: /gyro_link published by /robot_state_publisher Average Delay: -0.484302 Max Delay: 0
Frame: /kinect_depth_frame published by /robot_state_publisher Average Delay: -0.4843 Max Delay: 0
Frame: /kinect_depth_optical_frame published by /robot_state_publisher Average Delay: -0.484297 Max Delay: 0
Frame: /kinect_link published by /robot_state_publisher Average Delay: -0.484324 Max Delay: 0
Frame: /kinect_rgb_frame published by /robot_state_publisher Average Delay: -0.484294 Max Delay: 0
Frame: /kinect_rgb_optical_frame published by /robot_state_publisher Average Delay: -0.484291 Max Delay: 0
Frame: /laser published by /robot_state_publisher Average Delay: -0.484289 Max Delay: 0
Frame: /left_cliff_sensor_link published by /robot_state_publisher Average Delay: -0.484321 Max Delay: 0
Frame: /left_wheel_link published by /robot_state_publisher Average Delay: -0.950178 Max Delay: 0
Frame: /leftfront_cliff_sensor_link published by /robot_state_publisher Average Delay: -0.484319 Max Delay: 0
Frame: /plate_0_link published by /robot_state_publisher Average Delay: -0.484286 Max Delay: 0
Frame: /plate_1_link published by /robot_state_publisher Average Delay: -0.484284 Max Delay: 0
Frame: /plate_2_link published by /robot_state_publisher Average Delay: -0.484282 Max Delay: 0
Frame: /plate_3_link published by /robot_state_publisher Average Delay: -0.484279 Max Delay: 0
Frame: /rear_wheel_link published by /robot_state_publisher Average Delay: -0.484277 Max Delay: 0
Frame: /right_cliff_sensor_link published by /robot_state_publisher Average Delay: -0.484313 Max Delay: 0
Frame: /right_wheel_link published by /robot_state_publisher Average Delay: -0.950172 Max Delay: 0
Frame: /rightfront_cliff_sensor_link published by /robot_state_publisher Average Delay: -0.48431 Max Delay: 0
Frame: /spacer_0_link published by /robot_state_publisher Average Delay: -0.484274 Max Delay: 0
Frame: /spacer_1_link published by /robot_state_publisher Average Delay: -0.484272 Max Delay: 0
Frame: /spacer_2_link published by /robot_state_publisher Average Delay: -0.484269 Max Delay: 0
Frame: /spacer_3_link published by /robot_state_publisher Average Delay: -0.484267 Max Delay: 0
Frame: /standoff_2in_0_link published by /robot_state_publisher Average Delay: -0.484265 Max Delay: 0
Frame: /standoff_2in_1_link published by /robot_state_publisher Average Delay: -0.484262 Max Delay: 0
Frame: /standoff_2in_2_link published by /robot_state_publisher Average Delay: -0.484259 Max Delay: 0
Frame: /standoff_2in_3_link published by /robot_state_publisher Average Delay: -0.484256 Max Delay: 0
Frame: /standoff_2in_4_link published by /robot_state_publisher Average Delay: -0.484254 Max Delay: 0
Frame: /standoff_2in_5_link published by /robot_state_publisher Average Delay: -0.484251 Max Delay: 0
Frame: /standoff_2in_6_link published by /robot_state_publisher Average Delay: -0.484247 Max Delay: 0
Frame: /standoff_2in_7_link published by /robot_state_publisher Average Delay: -0.484243 Max Delay: 0
Frame: /standoff_8in_0_link published by /robot_state_publisher Average Delay: -0.48424 Max Delay: 0
Frame: /standoff_8in_1_link published by /robot_state_publisher Average Delay: -0.484237 Max Delay: 0
Frame: /standoff_8in_2_link published by /robot_state_publisher Average Delay: -0.484234 Max Delay: 0
Frame: /standoff_8in_3_link published by /robot_state_publisher Average Delay: -0.484231 Max Delay: 0
Frame: /standoff_kinect_0_link published by /robot_state_publisher Average Delay: -0.484228 Max Delay: 0
Frame: /standoff_kinect_1_link published by /robot_state_publisher Average Delay: -0.484225 Max Delay: 0
Frame: /wall_sensor_link published by /robot_state_publisher Average Delay: -0.484307 Max Delay: 0

All Broadcasters:
Node: /robot_pose_ekf 10.051 Hz, Average Delay: 0.0555048 Max Delay: 0.0800429
Node: /robot_state_publisher 31.0555 Hz, Average Delay: -0.499502 Max Delay: 0

And when navigation starts normally:
RESULTS: for all Frames

Frames:
Frame: /base_footprint published by /robot_pose_ekf Average Delay: 0.0562317 Max Delay: 0.0831862
Frame: /base_link published by /robot_state_publisher Average Delay: -0.483662 Max Delay: 0
Frame: /front_wheel_link published by /robot_state_publisher Average Delay: -0.483628 Max Delay: 0
Frame: /gyro_link published by /robot_state_publisher Average Delay: -0.483624 Max Delay: 0
Frame: /kinect_depth_frame published by /robot_state_publisher Average Delay: -0.48362 Max Delay: 0
Frame: /kinect_depth_optical_frame published by /robot_state_publisher Average Delay: -0.483616 Max Delay: 0
Frame: /kinect_link published by /robot_state_publisher Average Delay: -0.483654 Max Delay: 0
Frame: /kinect_rgb_frame published by /robot_state_publisher Average Delay: -0.483612 Max Delay: 0
Frame: /kinect_rgb_optical_frame published by /robot_state_publisher Average Delay: -0.483608 Max Delay: 0
Frame: /laser published by /robot_state_publisher Average Delay: -0.483604 Max Delay: 0
Frame: /left_cliff_sensor_link published by /robot_state_publisher Average Delay: -0.48365 Max Delay: 0
Frame: /left_wheel_link published by /robot_state_publisher Average Delay: -0.948303 Max Delay: 0
Frame: /leftfront_cliff_sensor_link published by /robot_state_publisher Average Delay: -0.483645 Max Delay: 0
Frame: /odom published by /amcl Average Delay: -0.856934 Max Delay: 0
Frame: /plate_0_link published by /robot_state_publisher Average Delay: -0.4836 Max Delay: 0
Frame: /plate_1_link published by /robot_state_publisher Average Delay: -0.483596 Max Delay: 0
Frame: /plate_2_link published by /robot_state_publisher Average Delay: -0.483593 Max Delay: 0
Frame: /plate_3_link published by /robot_state_publisher Average Delay: -0.483589 Max Delay: 0
Frame: /rear_wheel_link published by /robot_state_publisher Average Delay: -0.483585 Max Delay: 0
Frame: /right_cliff_sensor_link published by /robot_state_publisher Average Delay: -0.483641 Max Delay: 0
Frame: /right_wheel_link published by /robot_state_publisher Average Delay: -0.948296 Max Delay: 0
Frame: /rightfront_cliff_sensor_link published by /robot_state_publisher Average Delay: -0.483636 Max Delay: 0
Frame: /spacer_0_link published by /robot_state_publisher Average Delay: -0.483581 Max Delay: 0
Frame: /spacer_1_link published by /robot_state_publisher Average Delay: -0.483577 Max Delay: 0
Frame: /spacer_2_link published by /robot_state_publisher Average Delay: -0.483573 Max Delay: 0
Frame: /spacer_3_link published by /robot_state_publisher Average Delay: -0.483569 Max Delay: 0
Frame: /standoff_2in_0_link published by /robot_state_publisher Average Delay: -0.483564 Max Delay: 0
Frame: /standoff_2in_1_link published by /robot_state_publisher Average Delay: -0.48356 Max Delay: 0
Frame: /standoff_2in_2_link published by /robot_state_publisher Average Delay: -0.483556 Max Delay: 0
Frame: /standoff_2in_3_link published by /robot_state_publisher Average Delay: -0.48355 Max Delay: 0
Frame: /standoff_2in_4_link published by /robot_state_publisher Average Delay: -0.483546 Max Delay: 0
Frame: /standoff_2in_5_link published by /robot_state_publisher Average Delay: -0.483541 Max Delay: 0
Frame: /standoff_2in_6_link published by /robot_state_publisher Average Delay: -0.483536 Max Delay: 0
Frame: /standoff_2in_7_link published by /robot_state_publisher Average Delay: -0.483532 Max Delay: 0
Frame: /standoff_8in_0_link published by /robot_state_publisher Average Delay: -0.483528 Max Delay: 0
Frame: /standoff_8in_1_link published by /robot_state_publisher Average Delay: -0.483523 Max Delay: 0
Frame: /standoff_8in_2_link published by /robot_state_publisher Average Delay: -0.483518 Max Delay: 0
Frame: /standoff_8in_3_link published by /robot_state_publisher Average Delay: -0.483514 Max Delay: 0
Frame: /standoff_kinect_0_link published by /robot_state_publisher Average Delay: -0.483509 Max Delay: 0
Frame: /standoff_kinect_1_link published by /robot_state_publisher Average Delay: -0.483505 Max Delay: 0
Frame: /wall_sensor_link published by /robot_state_publisher Average Delay: -0.483631 Max Delay: 0

All Broadcasters:
Node: /amcl 14.3912 Hz, Average Delay: -0.856934 Max Delay: 0
Node: /robot_pose_ekf 10.0275 Hz, Average Delay: 0.0562317 Max Delay: 0.0831862
Node: /robot_state_publisher 31.0251 Hz, Average Delay: -0.498419 Max Delay: 0

The difference between rostopic listings is that when the error occurs many fewer move_base topics are listed.
/move_base/current_goal
/move_base/goal
/move_base_simple/goal

Compared to the normal condition
/move_base/NavfnROS/NavfnROS_costmap/inflated_obstacles
/move_base/NavfnROS/NavfnROS_costmap/obstacles
/move_base/NavfnROS/NavfnROS_costmap/robot_footprint
/move_base/NavfnROS/NavfnROS_costmap/unknown_space
/move_base/NavfnROS/plan
/move_base/TrajectoryPlannerROS/cost_cloud
/move_base/TrajectoryPlannerROS/global_plan
/move_base/TrajectoryPlannerROS/local_plan
/move_base/TrajectoryPlannerROS/parameter_descriptions
/move_base/TrajectoryPlannerROS/parameter_updates
/move_base/cancel
/move_base/current_goal
/move_base/feedback
/move_base/global_costmap/inflated_obstacles
/move_base/global_costmap/obstacles
/move_base/global_costmap/parameter_descriptions
/move_base/global_costmap/parameter_updates
/move_base/global_costmap/robot_footprint
/move_base/global_costmap/unknown_space
/move_base/goal
/move_base/local_costmap/inflated_obstacles
/move_base/local_costmap/obstacles
/move_base/local_costmap/parameter_descriptions
/move_base/local_costmap/parameter_updates
/move_base/local_costmap/robot_footprint
/move_base/local_costmap/unknown_space
/move_base/parameter_descriptions
/move_base/parameter_updates
/move_base/result
/move_base/status
/move_base_simple/goal

By inserting a lot of INFOs into move_base.cpp it seems that when the problem occurs move_base gets stuck at this line:
planner_costmap_ros_ = new costmap_2d::Costmap2DROS("global_costmap", tf_);

Originally posted by JediHamster on ROS Answers with karma: 995 on 2011-11-19
Post score: 1

Original comments
Comment by eitan on 2011-11-28:
It seems like AMCL is not publishing the transform from map to odom in the case where you see the warning. Are you sure that its getting odometry and laser data and running correctly?

A:

I had the same error and found that minimal.launch (turtlebot) wasn't running.  Double check roscore?

Originally posted by brianpen with karma: 183 on 2012-02-22
This answer was ACCEPTED on the original site
Post score: 0

