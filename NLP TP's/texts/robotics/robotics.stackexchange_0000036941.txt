Q:

Error in building point cloud

In the effort of building a point cloud, I encounter an error. The code snippet is as below:
static tf::TransformBroadcaster tfb;
tf::Transform xform;
xform.setOrigin(tf::Vector3(pose3D_LD2.pose.position.x, pose3D_LD2.pose.position.y, pose3D_LD2.pose.position.z));
xform.setRotation(qq);
tfb.sendTransform(tf::StampedTransform(xform, ros::Time(pose3D_LD2.header.stamp), "base_frame", "target_frame"));
projector_.transformLaserScanToPointCloud("base_link", previous_scan_, cloud, tfListener_);

The error I obtained is as follows:
terminate called after throwing an instance of 'tf::LookupException'
what():  Frame id / does not exist! Frames (6): Frame /laser exists with parent /base_link.
Frame /base_link exists with parent /world.
Frame /world exists with parent NO_PARENT.
Frame /target_frame exists with parent /base_frame.
Frame /base_frame exists with parent NO_PARENT.

[pointcloud_builder_node-4] process has died [pid 24672, exit code -6].

What could be the potential mistake that I've made looking at the code snippet and the corresponding error message?
EDIT:
Here is the latest version after rewriting the code:
static tf::TransformBroadcaster tfb;
tf::Transform xform;
xform.setOrigin(tf::Vector3(pose3D_LD2.pose.position.x, pose3D_LD2.pose.position.y, pose3D_LD2.pose.position.z));
xform.setRotation(qq);

tfb.sendTransform(tf::StampedTransform(xform, ros::Time(pose3D_LD2.header.stamp), "/base_link", "/laser"));
tfListener_.waitForTransform("/base_link", previous_scan_.header.frame_id.c_str(), ros::Time(0), ros::Duration(2.0));
projector_.transformLaserScanToPointCloud("/base_link", previous_scan_, cloud, tfListener_);

Corresponding error after updating the code snippet:
terminate called after throwing an instance of 'tf::LookupException'
  what():  Frame id / does not exist! Frames (4): Frame /laser exists with parent     /base_link.
Frame /base_link exists with parent /world.
Frame /world exists with parent NO_PARENT.

[pointcloud_builder_node-4] process has died [pid 27786, exit code -6].

Originally posted by alfa_80 on ROS Answers with karma: 1053 on 2012-01-10
Post score: 0

A:

The first major problem that I see is that your tfb.sendTransform() method publishes a transform between "base_link" and "target_frame". This might not be a mistake if you actually have a frame named "target_frame".
Secondly, the function transformLaserScanToPointCloud() transforms the points in the scan from the scan's frame_id to the target frame_id. As such, if your scan is coming in with a frame_id of "/" (which I think it is), this function will not work.
Also, you have to make sure that your tf exists before trying to use it. Before your call to transformLaserScanToPointCloud(), I would add the line:
tfListener_.waitForTransform("/base_link", previous_scan_.header.frame_id.c_str(), ros::Time(0), ros::Duration(2.0));

This will wait until the transform exists before trying to look for it.

Originally posted by DimitriProsser with karma: 11163 on 2012-01-10
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by alfa_80 on 2012-01-16:
If we refer to the documentation, the second parameter in the transformLaserScanToPointCloud() is a scan message pointer right? it's frame_id..or i didn't get you.
Comment by alfa_80 on 2012-01-16:
@dornhege : Thanks for the help. 'previous_scan_' has been initialized, it is subscribed from another node called "/scan". Any opinion?
Comment by dornhege on 2012-01-16:
No, something requests frame_id "/", not "/laser". Is it probably that you are using previous_scan uninitialized?
Comment by alfa_80 on 2012-01-16:
@DimitriProsser: Thanks for the reply. You mean, instead of writing 'scan.header.frame_id = "laser";', I should change it to 'scan.header.frame_id = "/laser";'? As simple as that right, what you meant?
Comment by DimitriProsser on 2012-01-16:
You are not publishing a transform for "/". That means you cannot transform using that frame.
Comment by alfa_80 on 2012-01-15:
@DimitriProsser: What do you actually mean by this "if your scan is coming in with a frame_id of "/" (which I think it is), this function will not work. "?
Comment by alfa_80 on 2012-01-10:
@dornhege: Yes, previous_scan's frame_id = laser
Comment by alfa_80 on 2012-01-10:
In the tfListener_.waitForTransform(), is this one valid since I'm using my dataset's timestamp of ros::Time(pose3D_LD2.header.stamp) over time.
Comment by alfa_80 on 2012-01-10:
From my output of rostopic echo /scan => frame_id: laser
Comment by dornhege on 2012-01-10:
Is the previous_scan's frame_id = /laser?
Comment by DimitriProsser on 2012-01-10:
Did you check to see what frame_id the income LaserScan has?
Comment by alfa_80 on 2012-01-10:
@DimitriProsser: "Secondly, the function transformLaserScanToPointCloud() transforms.." Very sorry i don't actually get your point..Could you clarify a bit more..
Comment by alfa_80 on 2012-01-10:
Cont'd: Frame /world exists with parent NO_PARENT.
[pointcloud_builder_node-4] process has died [pid 25647, exit code -6].
Comment by alfa_80 on 2012-01-10:
After changing the code as aou suggested I received this error: terminate called after throwing an instance of 'tf::LookupException'
what():  Frame id / does not exist! Frames (4): Frame /laser exists with parent /base_link.
Frame /base_link exists with parent /world.
Comment by DimitriProsser on 2012-01-10:
Yes. You just need to change the words "target_frame" to "/laser" or "/world".
Comment by alfa_80 on 2012-01-10:
@DimitriProsser: Could the target_frame be set to /laser? or /world? I somehow confused with this..

