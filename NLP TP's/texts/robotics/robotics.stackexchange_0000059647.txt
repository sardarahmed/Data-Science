Q:

Undefined reference using libdmtx with ROS

Hi,
I am trying to use libdmtx to read a ecc200 flashcode. My code is similar to the example code on the Man page.
I include:
#include <dmtx.h>

And the whole function looks like this:
void readDMC(cv::Mat& image, int timeout){

unsigned char *pxl;
DmtxImage *img;
DmtxDecode *dec;
DmtxRegion *reg;
DmtxMessage *msg;
DmtxTime t;

img = dmtxImageCreate(image.data, image.cols, image.rows, DmtxPack24bppRGB);
//dmtxImageSetProp(img, DmtxPropImageFlip, DmtxFlipY);
assert(img != NULL);
dec = dmtxDecodeCreate(img, 1);
assert(dec != NULL);

t = dmtxTimeAdd(dmtxTimeNow(), timeout);

reg = dmtxRegionFindNext(dec, &t);
if(reg != NULL) {
   msg = dmtxDecodeMatrixRegion(dec, reg, DmtxUndefined);
   if(msg != NULL) {

      dmtxMessageDestroy(&msg);
   }
   dmtxRegionDestroy(&reg);
}

dmtxDecodeDestroy(&dec);
dmtxImageDestroy(&img);
            free(pxl);

            exit(0);
}

My CMakeList.txt:
cmake_minimum_required(VERSION 2.8.3)
project(kuka_vision)

find_package(catkin REQUIRED COMPONENTS
  cv_bridge
  image_transport
  roscpp
  rospy
  std_msgs
  visp_bridge
  visp_tracker
  visp_auto_tracker
  )

 find_package(catkin REQUIRED

  )  

  include_directories(
  ${catkin_INCLUDE_DIRS}
  ${OpenCV_INCLUDE_DIRS}
  ${visp_auto_tracker_INCLUDE_DIRS}
  ${visp_tracker_INCLUDE_DIRS}
  ${visp_bridge_INCLUDE_DIRS}
  ${auto_tracker_INCLUDE_DIRS}
  ${cmd_line_INCLUDE_DIRS}
  ${libdmtx_INCLUDE_DIRS} 
  )

  target_link_libraries(kuka_vision_node
    ${catkin_LIBRARIES}
    ${OpenCV_LIBRARIES}
    ${visp_auto_tracker_LIBRARIES}
    ${visp_tracker_LIBRARIES}
    ${visp_bridge_LIBRARIES}
    ${auto_tracker_LIBRARIES}
    ${cmd_line_LIBRARIES}
    ${libdmtx_LIBRARIES} 
    )

In my opinion it should work, but i get an 'undefined reference' error, looks like this:
[100%] Building CXX object kuka_vision/CMakeFiles/kuka_vision_node.dir/src/kuka_vision_node.cpp.o 
Linking CXX executable /home/faps/catkin_ws/devel/lib/kuka_vision/kuka_vision_node
CMakeFiles/kuka_vision_node.dir/src/kuka_vision_node.cpp.o: In function `readDMC(cv::Mat&, int)':
/home/faps/catkin_ws/src/kuka_vision/src/kuka_vision_node.cpp:66: undefined reference to `dmtxImageCreate'
/home/faps/catkin_ws/src/kuka_vision/src/kuka_vision_node.cpp:69: undefined reference to `dmtxDecodeCreate'
/home/faps/catkin_ws/src/kuka_vision/src/kuka_vision_node.cpp:72: undefined reference to `dmtxTimeNow'
/home/faps/catkin_ws/src/kuka_vision/src/kuka_vision_node.cpp:72: undefined reference to `dmtxTimeAdd'
/home/faps/catkin_ws/src/kuka_vision/src/kuka_vision_node.cpp:74: undefined reference to `dmtxRegionFindNext'
/home/faps/catkin_ws/src/kuka_vision/src/kuka_vision_node.cpp:76: undefined reference to `dmtxDecodeMatrixRegion'
/home/faps/catkin_ws/src/kuka_vision/src/kuka_vision_node.cpp:79: undefined reference to `dmtxMessageDestroy'
/home/faps/catkin_ws/src/kuka_vision/src/kuka_vision_node.cpp:81: undefined reference to `dmtxRegionDestroy'
/home/faps/catkin_ws/src/kuka_vision/src/kuka_vision_node.cpp:84: undefined reference to `dmtxDecodeDestroy'
/home/faps/catkin_ws/src/kuka_vision/src/kuka_vision_node.cpp:85: undefined reference to `dmtxImageDestroy'
collect2: ld returned 1 exit status 
make[2]: *** [/home/faps/catkin_ws/devel/lib/kuka_vision/kuka_vision_node] Error 1
make[1]: *** [kuka_vision/CMakeFiles/kuka_vision_node.dir/all] Error 2
make: *** [all] Error 2
Invoking "make" failed

It would help me a lot, if anyone has an idea for this problem.
Thanks a lot in advance!

Originally posted by Sebastian Meister on ROS Answers with karma: 3 on 2014-05-27
Post score: 0

A:

The error you're seeing is happening because you're not linking against the dmtx libraries.
In your CMakeLists.txt, you use the ${libdmtx_LIBRARIES} variable, but you don't have the matching find_package() call that should set it. (and cmake doesn't warn you if you use undefined variables).
You should include a CMake module for finding DMTX in your package, and use it from your CMakeLists.txt by calling find_package(DMTX REQUIRED). A quick google search turns up this example of a DMTX Cmake module: https://github.com/Nikoli/qlandkartegt/blob/master/cmake/Modules/FindDMTX.cmake

Originally posted by ahendrix with karma: 47576 on 2014-05-27
This answer was ACCEPTED on the original site
Post score: 0

