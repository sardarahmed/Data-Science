Q:

rostest - Minimum Working Example

I'm having problems developing tests for a package with catkin, specifically tests that run within a launch file using C++/gtest.
You can download my files here.
CMakeLists.txt
cmake_minimum_required(VERSION 2.8.3)
project(davidscheck)

find_package(catkin REQUIRED COMPONENTS roscpp)

catkin_package()

include_directories(
  ${catkin_INCLUDE_DIRS}
)

find_package(rostest REQUIRED)
find_package(gtest)

add_rostest_gtest(tests_mynode test/alaunch.launch test/mytest.cpp)
target_link_libraries(tests_mynode ${catkin_LIBRARIES} ${GTEST_LIBRARIES})

test/alaunch.launch
<launch>
 <test test-name="test_mynode" pkg="davidscheck" type="test_mynode" />
</launch>

teset/mytest.cpp
#include <gtest/gtest.h>

TEST(DavidsTester, basicTest){
  EXPECT_TRUE(true);
}

int main(int argc, char** argv){
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}

Problem: The executable is not being built.
Note that I do want it to run within the launch file, so adding catkin_add_gtest will not work.

Originally posted by David Lu on ROS Answers with karma: 10932 on 2014-07-01
Post score: 8

Original comments
Comment by fergs on 2014-07-01:
It just doesn't even try to build the executable? Or the build fails?
Comment by William on 2014-07-01:
Did you pass run_tests as a make target when building?
Comment by David Lu on 2014-07-01:
Slight correction: The executable is being built, but the launch file cannot find it. Output snippet is here: http://pastebin.com/raw.php?i=JVV8QfXA .
Comment by David Lu on 2014-07-01:
(compiled with run_tests)
Comment by galou on 2015-01-06:
I cannot run your example with indigo. CMake cannot find the package gtest:
"Could not find a package configuration file provided by "gtest""
If I remove it, I get no error. But if I remove your package from my workspace I get the error "Unknown CMake command "add_rostest_gtest"". What do I miss?
Comment by galou on 2015-01-06:
The answer to my own question is "find_package(rostest REQUIRED)"
Comment by Dirk Thomas on 2015-01-06:
You should also wrap all testing stuff in a conditional block as mentioned in the other answer.

A:

Your node is called "tests_mynode" (with an S on test) and the launch file loads type "test_mynode" (no S). Fix the launch and all worked on my system under hydro.

Originally posted by fergs with karma: 13902 on 2014-07-01
This answer was ACCEPTED on the original site
Post score: 4

Original comments
Comment by David Lu on 2014-07-01:
Fair enough. :)
Comment by VictorLamoine on 2017-02-01:
Full minimum working example here: https://gitlab.com/InstitutMaupertuis/simple_rostest
Comment by thinwybk on 2017-05-16:
@VictorLamoine under what license do you distribute the example code?
Comment by VictorLamoine on 2017-05-17:
@thinwybk BSD, https://gitlab.com/InstitutMaupertuis/simple_rostest/blob/kinetic/package.xml#L8.
Do whatever you want it with!
Comment by thinwybk on 2017-05-17:
@VictorLamoine Great. Thanks a lot.
Comment by gocarlos on 2017-10-03:
here another example: https://github.com/gocarlos/ros_unit_tests_example

