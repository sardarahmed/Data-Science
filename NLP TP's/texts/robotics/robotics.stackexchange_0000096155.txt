Q:

ROS2, TypeError when publishing custom message to Topic

Hi everyone,
I have defined a custom message:
uint8[] data

The custom message is imported in my Node class with no problems:
from my_shared.msg import MyMessage

In the same Node, I create the publisher with:
self.my_publisher = self.create_publisher(MyMessage, 'topic_in', 200)

and I publish the message with:
self.my_publisher.publish(my_msg)

my_msg is built in the following way:
payload_bitstream = np.fromstring(my_data, np.uint8)
my_msg = payload_bitstream.tolist()

Sadly, I get a TypeError:
File "/opt/ros/eloquent/lib/python3.6/site-packages/rclpy/publisher.py", line 68, in publish
    raise TypeError()
TypeError

Could you help out with this if you know what I am doing wrong pls?
Thanks in advance,
G.

Originally posted by anthares on ROS Answers with karma: 60 on 2020-06-11
Post score: 0

A:

The variable you pass to self.my_publisher.publish() must be of the same type as the one used to create the publisher, in your case MyMessage. So you need to first create an instance of that class:
my_msg = MyMessage()

and then populate the fields in that message with the desired data:
my_msg.data = payload_bitstream.tolist()

I would assume you don't even need .to_list() in the last line but can assign payload_bitstream directly:
ms_msg.data = payload_bitstream

Originally posted by Dirk Thomas with karma: 16276 on 2020-06-11
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by anthares on 2020-06-11:
Thank you so much! .tolist() is still required. But everything else that you provided was the exact answer and approach.. I mean.. it works: I publish and receive on the subscriber. Thanks so much!!!

