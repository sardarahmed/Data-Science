Q:

openni_tracker rviz transform

I have a question about coordinate transforms related to openni_camera and oppennI_tracker
When I visualize both and set the fixed frame to openni_camera, it appears that the skeleton points are not in the same location as the corresponding body points are in the image. (see picture)

Does anybody know why this is happening and how to fix it?
Additionally here is the output from view_frames

Any help would be greatly apreciated

Originally posted by ngidgas on ROS Answers with karma: 41 on 2011-05-07
Post score: 4

A:

It seems there's an inconsistency between the frame conventions used by openni_camera and openni_tracker nodes. You should probably open a ticket with this issue.
In the meantime, you can take advantage of the fact that the pointcloud is published with reference frame openni_rgb_optical_frame and the skeleton with frame openni_depth_frame. The relation between those two frames is established in openni_camera/launch/kinect_frames.launch file, so you can change the static transforms declared in that file (or a copy of it, then you should also copy openni_node.launch and make it reference your copy of kinect_frames.launch) so that the skeleton and the depth data coincide.
Also, you should consider that the openni_tracker loades a configuration file (openni_tracker/openni_tracker.xml) for the OpenNI generators that set the mirror parameter to true. You should check if this is the behaviour you want.
If I can find the time to do it I'll try to prepare a patch that fixes these issues. Please tell me if you'd be interested.
Update: Using the frame David Lu suggests in his comment, plus a couple of changes in openni_tracker.xml and openni_tracker.cpp I've prepared a patch that should fix these issues. You need to run the openni_tracker node by using the new openni_tracker.launch file that should by added by the patch.
I must admit I'm not used to create patch files, so if there's something wrong you can easily make the changes manually by inspecting the file.
You can find the file here: http://snipt.org/xHmk

Originally posted by Miguel Prada with karma: 1071 on 2011-05-12
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by Miguel Prada on 2011-06-02:
Also, I'd like to note that I modified it by adding the transformation inside openni_tracker.cpp, and thus not requiring the extra 'openni_tracker_frame' that was on the first solution. This way no specific launch file is required.
Comment by Miguel Prada on 2011-06-02:
Hi @tfoote, I just filled patches 4994 and 4995 about this issue. The first is about making the skeleton show in the right place (related to the point cloud data) and the second is about disabling the OpenNI mirror mode option. I was not sure if they should be placed together.
Comment by tfoote on 2011-06-02:
@Miguel Prada please file a ticket with this patch to make sure it gets into the next release.
Comment by Miguel Prada on 2011-05-15:
That's also a good point, David. In fact, I think I saw that functionality in some previous version and that it later got removed. Is that possible or am I making things up?
Comment by David Lu on 2011-05-15:
Great! Also, in terms of other useful patches, I also submitted this one: https://code.ros.org/trac/ros-pkg/ticket/4954 for tracking multiple users at once, fixing something that always bugged me about this package.
Comment by Pi Robot on 2011-05-15:
P.S. Note to David--Miguel's modified openni_tracker.cpp file was the key to getting mirroring to work properly for me.
Comment by Pi Robot on 2011-05-15:
Hi Miguel--while I couldn't get your patch to work with the "patch" command (kept getting "Hunk FAILED" messages), I made your modifications manually to the various files and it works beautifully.  This tf and mirroring problem has been bugging me for months so many thanks for posting a solution!
Comment by Miguel Prada on 2011-05-15:
That's a good point. I used the openni_ros trunk. However, I think the changes should work as well with the openni_tracker source inside the Diamondback debian package.
Comment by Pi Robot on 2011-05-15:
Thanks David and Miguel--this is great.  One question for Miguel: what sources did you start with for your patch?  The openni_ros trunk or the Diamondback openni_kinect debian package?
Comment by Miguel Prada on 2011-05-12:
Ok, I no longer have the Kinect with me. I'll see if I can do it tomorrow after work or during the weekend.
Comment by Pi Robot on 2011-05-12:
Hi Miguel--I would certainly be interested and perhaps more than a few others would be too.  Thanks!

