Q:

Gazebo 5 (Jade deb) velocity motor issue

Ubuntu 14.04  ROS Jade
I'm trying to update the a iRobot Create model based on the Turtlebot, which hasn't been updated since Hydro.
The plugin was using the setVelocity(0,wheel_speed)  command, but the robot wasn't moving.  As best I can tell this was broken when Coulomb friction added.
The standard answer from similar tickets (see question 8371)  seems to be to now use:
joint_steering_->SetParam ( "vel", 0, applied_steering_speed );

as shown in https://github.com/ros-simulation/gazebo_ros_pkgs/blob/jade-devel/gazebo_plugins/src/gazebo_ros_tricycle_drive.cpp#L262
When I try this (and the "fmax"), I get
[Wrn] [ODEJoint.cc:443] The 'vel' parameter is deprecated to enable Coulomb joint friction with the 'friction' parameter
[Wrn] [ODEJoint.cc:427] The 'fmax' parameter is deprecated to enable Coulomb joint friction with the 'friction' parameter
[Err] [ODEJoint.cc:495] SetParam(fmax) boost any_cast error:boost::bad_any_cast: failed conversion using boost::any_cast

And the wheels still do not turn.
A rostopic echo shows the joint velocity of ~8 rad/s, but the joint position is not moving (it vibrates with joint position moving in 4th decimal place)
Any pointers appreciated.

Originally posted by dcconner on Gazebo Answers with karma: 298 on 2016-01-28
Post score: 1

Original comments
Comment by dcconner on 2016-01-28:
I found this link https://github.com/mayfieldrobotics/kobuki_desktop/commit/4246c6e4330f39725df3eb39a0b77a7fcc6185b1 , which says to remove setMaxForce, but still used setVelocity.  This got the wheels spinning, but not behaving properly.
Comment by dcconner on 2016-02-02:
Fixed my movement issue by fixing the mu parameters to 100000, and large Kp,Kd which relate to contact forces and damping of body, and not any sort of controller.  I removed the setMaxForce as suggested above.  I suspect the  mu = 1.0 from original model was causing penetration of ground plane and locking the wheels.  Apparently SetVelocity still works as before inspite of other comments.  Leaving this open due to issues with inconsistencies found during my debugging of other issue.
Comment by dcconner on 2016-02-02:
also needed to set step size to 0.001 and update to 1000 to get system to run properlyl

A:

Looking back at my code; it seems that I fixed this by modifying parameters as above comment and then modifying my custom gazebo_ros_create.cpp plugin to change
joints_[LEFT]->SetMaxForce(0, torque_)  to
joints_[LEFT]->SetEffortLimit(0, torque_)
RIGHT similarly

Originally posted by dcconner with karma: 298 on 2016-12-19
This answer was ACCEPTED on the original site
Post score: 0

