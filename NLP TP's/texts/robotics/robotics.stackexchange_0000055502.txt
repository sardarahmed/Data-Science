Q:

Undefined Reference using Cereal_Port, -l doesn't fix

Hello, I'm currently writing two ros_nodes. One is finished, and captures data from a gyro. It uses the ros cereal_port library found in the following stack: /opt/ros/fuerte/stacks/serial_communication/cereal_port/lib
I have no issues with this node compiling, and it runs perfectly in Fuerte on Ubuntu 12.04 precise.
I'm now trying to use the cereal_port library in another package, but I keep getting undefined references in libcereal_port.so to various boost functions. I've been at this for 2 days now, and I don't understand why adding -lboost_thread-mt is not enough for the undefined reference to be resolved. I've validated that the path/file for libboost_thread-mt.so exist, but I cannot eliminate the problem.
Here are the manifest.xml and CMakeLists.txt for the gyro rosnode that is currently compiling and executing properly:
manifest.xml:
<package>
<description brief="kvh_dsp_1750_ros_interface">

 kvh_dsp_1750_ros_interface

</description>
<author>am3p-pc2</author>
<license>BSD</license>
<review status="unreviewed" notes=""/>
<url>http:// ros.org/wiki/kvh_dsp_1750_ros_interface</url>

<depend package="roscpp"/>
<depend package="cereal_port"/>

<export>
<cpp cflags="-I${prefix}/include" lflags="-Wl,-rpath,$prefix}/lib -L${prefix}/lib -lKVH_DSP1750"/>
</export>
</package>

CMakeLists.txt:
cmake_minimum_required(VERSION 2.4.6)
include($ENV{ROS_ROOT}/core/rosbuild/rosbuild.cmake)

# Set the build type.  Options are:
#  Coverage       : w/ debug symbols, w/o optimization, w/ code-coverage
#  Debug          : w/ debug symbols, w/o optimization
#  Release        : w/o debug symbols, w/ optimization
#  RelWithDebInfo : w/ debug symbols, w/ optimization
#  MinSizeRel     : w/o debug symbols, w/ optimization, stripped binaries
#set(ROS_BUILD_TYPE RelWithDebInfo)

rosbuild_init()

#set the default path for built executables to the "bin" directory
set(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)
#set the default path for built libraries to the "lib" directory
set(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/lib)

rosbuild_genmsg()

rosbuild_add_library(KVH_DSP1750 include/KVHDSP1750.h src/KVHDSP1750.cpp)

rosbuild_add_executable(dsp1750_node src/kvh_dsp_1750_ros_interface.cpp)
target_link_libraries(dsp1750_node KVH_DSP1750)

Here are the manifest.xml and CMakeLists.txt for the GPS rosnode that is NOT currently building:
manifest.xml:
<package>
<description brief="novatel_oem628_driver">

   novatel_oem628_driver

</description>
<author>am3p-pc2</author>
<license>BSD</license>
<review status="unreviewed" notes=""/>
<url>http:// ros.org/wiki/novatel_oem628_driver</url>

<depend package="roscpp"/>
<depend package="cereal_port"/>

<export>
<cpp cflags="-I${prefix}/include" lflags="-Wl,-rpath,$prefix}/lib -L${prefix}/lib -lNOVATEL_LIB"/>
</export>
</package>

CMakeLists.txt:
cmake_minimum_required(VERSION 2.4.6)
include($ENV{ROS_ROOT}/core/rosbuild/rosbuild.cmake)

# Set the build type.  Options are:
#  Coverage       : w/ debug symbols, w/o optimization, w/ code-coverage
#  Debug          : w/ debug symbols, w/o optimization
#  Release        : w/o debug symbols, w/ optimization
#  RelWithDebInfo : w/ debug symbols, w/ optimization
#  MinSizeRel     : w/o debug symbols, w/ optimization, stripped binaries
#set(ROS_BUILD_TYPE RelWithDebInfo)

rosbuild_init()

#set the default path for built executables to the "bin" directory
set(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)
#set the default path for built libraries to the "lib" directory
set(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/lib)

#uncomment if you have defined messages
#rosbuild_genmsg()
#uncomment if you have defined services
#rosbuild_gensrv()
FIND_PACKAGE(Boost COMPONENTS thread)
INCLUDE_DIRECTORIES(${Boost_INCLUDE_DIR})

message("\\\${Boost_INCLUDE_DIR} = ${Boost_INCLUDE_DIR}")
message("\\\${Boost_LIBRARIES} = ${Boost_LIBRARIES}")

rosbuild_add_library(NOVATEL_LIB include/novatel.h src/lib/novatel.cpp)
#rosbuild_add_library(cereal_port /opt/ros/fuerte/stacks/serial_communication/cereal_port/include/cereal_port/CerealPort.h /opt/ros/fuerte/stacks/serial_communication/cereal_port/src/CerealPort.cpp)

rosbuild_add_executable(novatel src/example/main.cpp)
target_link_libraries(novatel NOVATEL_LIB -lrt ${Boost_LIBRARIES})

Here is the output from SUCCESSFULLY building the first rosnode by calling VERBOSE=1 rosmake -v:
[ rosmake ] rosmake starting...                                                                                                                                          
[ rosmake ] No package specified.  Building ['kvh_dsp_1750_ros_interface']                                                                                               
[ rosmake ] Packages requested are: ['kvh_dsp_1750_ros_interface']                                                                                                       
[ rosmake ] Logging to directory /home/am3p-pc2/.ros/rosmake/rosmake_output-20131115-142506                                                                              
[ rosmake ] /home/am3p-pc2/.ros/rosmake/rosmake_output-20131115-142506 doesn't exist: creating                                                                           
[ rosmake ] Finished setting up logging                                                                                                                                  
[ rosmake ] Expanded args ['kvh_dsp_1750_ros_interface'] to:
['kvh_dsp_1750_ros_interface']                                                                              
[ rosmake ] Processing kvh_dsp_1750_ros_interface and all dependencies(1 of 1 requested)                                                                                 
[ rosmake ] Building packages [u'roslang', u'roscpp', u'cereal_port', 'kvh_dsp_1750_ros_interface']                                                                      
[rosmake-0] Starting >>> roslang [ make ]                                                                                                                                
[rosmake-0] Finished <<< roslang  No Makefile in package roslang                                                                                                         
[rosmake-0] Starting >>> roscpp [ make ]                                                                                                                                 
[rosmake-0] Finished <<< roscpp  No Makefile in package roscpp                                                                                                           
[rosmake-0] Starting >>> cereal_port [ make ]                                                                                                                            
[rosmake-0] Finished <<< cereal_port ROS_NOBUILD in package cereal_port                                                                                                  
[rosmake-0] Starting >>> kvh_dsp_1750_ros_interface [ make ]                                                                                                             
[rosmake-6] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-1] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-4] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-7] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-5] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-3] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-2] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-0] Finished <<< kvh_dsp_1750_ros_interface [PASS] [ 0.66 seconds ]                                                                                              
[ rosmake ] Results:                                                                                                                                                     
[ rosmake ] Built 4 packages with 0 failures.                                                                                                                            
[ rosmake ] Summary output to directory                                                                                                                                  
[ rosmake ] /home/am3p-pc2/.ros/rosmake/rosmake_output-20131115-142506 

Here is the output from UNSUCCESSFULLY building the GPS rosnode using VERBOSE=1 rosmake -v:
[ rosmake ] rosmake starting...                                                                                                                                          
[ rosmake ] No package specified.  Building ['novatel_oem628_driver']                                                                                                    
[ rosmake ] Packages requested are: ['novatel_oem628_driver']                                                                                                            
[ rosmake ] Logging to directory /home/am3p-pc2/.ros/rosmake/rosmake_output-20131115-142740                                                                              
[ rosmake ] /home/am3p-pc2/.ros/rosmake/rosmake_output-20131115-142740 doesn't exist: creating                                                                           
[ rosmake ] Finished setting up logging                                                                                                                                  
[ rosmake ] Expanded args ['novatel_oem628_driver'] to:
['novatel_oem628_driver']                                                                                        
[ rosmake ] Processing novatel_oem628_driver and all dependencies(1 of 1 requested)                                                                                      
[ rosmake ] Building packages [u'roslang', u'roscpp', u'cereal_port', 'novatel_oem628_driver']                                                                           
[rosmake-0] Starting >>> roslang [ make ]                                                                                                                                
[rosmake-0] Finished <<< roslang  No Makefile in package roslang                                                                                                         
[rosmake-0] Starting >>> roscpp [ make ]                                                                                                                                 
[rosmake-0] Finished <<< roscpp  No Makefile in package roscpp                                                                                                           
[rosmake-0] Starting >>> cereal_port [ make ]                                                                                                                            
[rosmake-0] Finished <<< cereal_port ROS_NOBUILD in package cereal_port                                                                                                  
[rosmake-5] Starting >>> novatel_oem628_driver [ make ]                                                                                                                  
[rosmake-4] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-0] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-3] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-6] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-1] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-7] [ Build Terminated Thread Exiting ]                                                                                                                          
[rosmake-2] [ Build Terminated Thread Exiting ]                                                                                                                          
[ rosmake ] Last 40 linesvatel_oem628_driver: 0.5 sec ]                                                                                         [ 1 Active 3/4 Complete ]
{-------------------------------------------------------------------------------
make -f CMakeFiles/rosbuild_precompile.dir/build.make CMakeFiles/rosbuild_precompile.dir/build
make[3]: Entering directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
make[3]: Nothing to be done for `CMakeFiles/rosbuild_precompile.dir/build'.
make[3]: Leaving directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
/usr/bin/cmake -E cmake_progress_report /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build/CMakeFiles 
[  0%] Built target rosbuild_precompile
make -f CMakeFiles/NOVATEL_LIB.dir/build.make CMakeFiles/NOVATEL_LIB.dir/depend
make[3]: Entering directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
cd /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build && /usr/bin/cmake -E cmake_depends "Unix Makefiles" /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build/CMakeFiles/NOVATEL_LIB.dir/DependInfo.cmake --color=
make[3]: Leaving directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
make -f CMakeFiles/NOVATEL_LIB.dir/build.make CMakeFiles/NOVATEL_LIB.dir/build
make[3]: Entering directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
make[3]: Nothing to be done for `CMakeFiles/NOVATEL_LIB.dir/build'.
make[3]: Leaving directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
/usr/bin/cmake -E cmake_progress_report /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build/CMakeFiles  1
[ 50%] Built target NOVATEL_LIB
make -f CMakeFiles/novatel.dir/build.make CMakeFiles/novatel.dir/depend
make[3]: Entering directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
cd /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build && /usr/bin/cmake -E cmake_depends "Unix Makefiles" /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build /home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build/CMakeFiles/novatel.dir/Depend    Info.cmake --color=
make[3]: Leaving directory `/home/am3p-  pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
make -f CMakeFiles/novatel.dir/build.make CMakeFiles/novatel.dir/build
make[3]: Entering directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
Linking CXX executable ../bin/novatel
/usr/bin/cmake -E cmake_link_script CMakeFiles/novatel.dir/link.txt --verbose=1
/usr/bin/c++   -O2 -g    -Wl,-rpath,/opt/ros/fuerte/stacks/serial_communication/cereal_port/lib -pthread CMakeFiles/novatel.dir/src/example/main.o  -o ../bin/novatel -rdynamic -L/opt/ros/fuerte/lib -L/opt/ros/fuerte/stacks/serial_communication/cereal_port/lib -L/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/lib -lroscpp -lrostime -lrosconsole -lroscpp_serialization -lxmlrpcpp -lcereal_port ../lib/libNOVATEL_LIB.so -lrt -lboost_thread-mt -lroscpp -lrostime -lrosconsole -lroscpp_serialization -lxmlrpcpp -lcereal_port -Wl,-rpath,/opt/ros/fuerte/lib:/opt/ros/fuerte/stacks/serial_communication/cereal_port/lib:/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/lib 
../lib/libNOVATEL_LIB.so: undefined reference to `clock_gettime'
/opt/ros/fuerte/stacks/serial_communication/cereal_port/lib/libcereal_port.so: undefined reference to `vtable for boost::detail::thread_data_base'
/opt/ros/fuerte/stacks/serial_communication/cereal_port/lib/libcereal_port.so: undefined reference to `boost::detail::thread_data_base::~thread_data_base()'
/opt/ros/fuerte/stacks/serial_communication/cereal_port/lib/libcereal_port.so: undefined reference to `boost::thread::join()'
/opt/ros/fuerte/stacks/serial_communication/cereal_port/lib/libcereal_port.so: undefined reference to `boost::thread::~thread()'
/opt/ros/fuerte/stacks/serial_communication/cereal_port/lib/libcereal_port.so: undefined reference to `typeinfo for boost::detail::thread_data_base'
/opt/ros/fuerte/stacks/serial_communication/cereal_port/lib/libcereal_port.so: undefined reference to `boost::thread::start_thread()'
collect2: ld returned 1 exit status
make[3]: *** [../bin/novatel] Error 1
make[3]: Leaving directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
make[2]: *** [CMakeFiles/novatel.dir/all] Error 2
make[2]: Leaving directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/home/am3p-pc2/fuerte_workspace/sandbox/novatel_oem628_driver/build'
-------------------------------------------------------------------------------}
[ rosmake ] Output from build of package novatel_oem628_driver written to:
[ rosmake ]    /home/am3p-pc2/.ros/rosmake/rosmake_output-20131115-142740/novatel_oem628_driver/build_output.log
[rosmake-5] Finished <<< novatel_oem628_driver [FAIL] [ 0.59 seconds ]                                                                                                   
[ rosmake ] Halting due to failure in package novatel_oem628_driver. 
[ rosmake ] Waiting for other threads to complete.                                                 
[ rosmake ] Results:                                                                                                                                                     
[ rosmake ] Built 4 packages with 1 failures.                                                                                                                            
[ rosmake ] Summary output to directory

I apologize for the giant blocks of text in these terminal outputs. The copy/paste hasn't been 100% user friendly. Thanks in advance for your time; I know this is a long post!

Originally posted by Andrew Capodieci on ROS Answers with karma: 16 on 2013-11-15
Post score: 0

A:

To answer my own question, I had to edit the CMakeLists.txt file for the cereal_port library itself, and rebuild it. I added the following lines to the cereal_port CMakeLists.txt:
rosbuild_add_boost_directories()
rosbuild_add_library(cereal_port src/CerealPort.cpp)
rosbuild_link_boost(cereal_port thread)

I must not have been using any of the functions in the cereal_port library that depended on boost in the first rosnode I wrote that used cereal_port. I'm not sure why a ROS package I installed using rosdep install wouldn't have the proper dependencies linked correctly.

Originally posted by Andrew Capodieci with karma: 16 on 2013-11-15
This answer was ACCEPTED on the original site
Post score: 0

