Q:

Rosserial_python on samd21

Hi, I am using a "modified" version of rosserial_arduino so that it works with samd21 chip. I can send/receive topics and services successfully using the terminal, but when I try to receive a topic from a ros package, it doesn't work!
To be more exact, the steps I am doing are.....

Upload a simple subscriber and a publisher to my samd21 chip.
Connect to it using rosserial_python (this step is successful)
publish a topic from the terminal using rostopic pub .......
the samd21 chip listen to the topic and relays it back (using its publisher)
listen to the published topic using rostopic echo...
The mentioned procedure works fine, I am trying it currently with std_msgs/Bool

However, when I try to publish the a topic from a rosnode (my custom package), rosserial_python gives me multiple errors:
Mismatched protocol version in packet: lost sync or rosserial_python is from different ros release than the rosserial client
Protocol version of client is Rev 0 (rosserial 0.4 and earlier), expected Rev 1 (rosserial 0.5+)
wrong checksum for topic id and msg
wrong checksum for topic id and msg

And the errors keep on repeating (not always in the same order).
Any idea what is causing this? I have the same versions of rosserial_python and rosserial_arduino: 0.7.7

Originally posted by Capt_Crunch on ROS Answers with karma: 26 on 2019-07-17
Post score: 0

A:

I think I have found the solution, I added sleep() inside the loop after spinOnce() and it seems to do the trick. The weird thing is that it works fine without the sleep with normal AVR arduinos, but not with the zero (samd21) ones. I will update my answer if I find the root of the problem.

Originally posted by Capt_Crunch with karma: 26 on 2019-07-17
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by howardcochran on 2019-08-29:
Where did you get a SAMD21-compatible rosserial library?  Looking for one myself.
Comment by fsado on 2021-10-28:
Hi... I am also looking for a SAMD21-compatible rosserial library. Would you mind to share the link here.
Comment by Capt_Crunch on 2021-11-01:
Hi. It has been a while since the post, so I don't remember exactly the steps. From what I recall, you have to generate the "ros_lib" folder first, then adjust the "ArduinoHardware.h" file for SAMD21, that should work. You can find the modifications I made on this link:
https://github.com/MWahbahCC/ros_lib.git
Comment by BrianS on 2022-07-29:
Thanks so much Capt_Crunch! This worked for me. This should be part of ROS. I found it very frustrating that I could load a ROS program into my MKRZero thru the Arduino IDE but no other ROS nodes could communicate with it.

