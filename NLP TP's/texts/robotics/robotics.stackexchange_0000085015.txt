Q:

how do you assign cell voltage to BatteryState

I'm trying to send cell voltage information using ROS on an arduino, but I get an empty array as output. Do I need to set the size of the array somehow?
edited added voltage length and pointer to array of cell voltages, now the example works as expected
#include <ros.h>
#include <sensor_msgs/BatteryState.h>

ros::NodeHandle nh;

sensor_msgs::BatteryState battery_state;

int number_of_cells = 2;
float cell_1_voltage = 12.2;
float cell_2_voltage = 12.3;
float * cell_voltage = new float[number_of_cells]

ros::Publisher battery_state_publisher("battery_state", &battery_state);

void setup()
{
   nh.initNode();
   nh.advertise(battery_state_publisher);

   battery_state.cell_voltage_length = number_of_cells;
}

void loop()
{
   cell_voltage[0] = cell_1_voltage;
   cell_voltage[1] = cell_2_voltage;

   battery_state.cell_voltage = cell_voltage;

   battery_state_publisher.publish(&battery_state);
   nh.spinOnce();
}

http://docs.ros.org/api/sensor_msgs/html/msg/BatteryState.html

Originally posted by waspinator on ROS Answers with karma: 122 on 2018-01-29
Post score: 0

A:

Do I need to set the size of the array somehow?

Yes. See wiki/rosserial/Overview/Limitations - Arrays:

to send an array message, we have to set the length and pointer. [..]

Originally posted by gvdhoorn with karma: 86574 on 2018-01-29
This answer was ACCEPTED on the original site
Post score: 1

