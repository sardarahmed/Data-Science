Q:

publisher not publishing on topic

im trying to publish a message on a topic once but it never publishes the data at all. This is the code
in main
ros::init(argc, argv, "keeper_env");
   ros::NodeHandle n;
   ros::Publisher chatter_pub = n.advertise<std_msgs::Empty>("toggle_led", 1000);
   std_msgs::Empty msg;
   chatter_pub.publish(msg);

even putting it in a finite while loop dosent work
int i=0;
        ros::Rate rat(20);
    while(i<10)
    {   
        chatter_pub.publish(msg);
        ros::spinOnce();
        i++;
                rat.sleep();
    }

but if i put it in an infitite loop then it publishes the data.
while(ros::ok())
    {   
        chatter_pub.publish(msg);
        ros::spinOnce();
        
    }

If i put it in a if condition in that infinite loop then it still dosent publish. i dont want it to be called infintely. i just need it once. can someone please help me
int i=0;
while(ros::ok())
    {   

        if(i==0)
        {   
            printf("Doses it go iun here \n");
            chatter_pub.publish(msg);
            i++;
        }
        }

Originally posted by vivek rk on ROS Answers with karma: 56 on 2013-06-23
Post score: 2

A:

@Philip is right. The publisher need some time to connect to the subscribers. Your finite loop is just to short for that. I'm not sure what you expect from you condition case in the infinite loop as that is never true.
The proper solution to your problem is to use pub.getNumSubscribers() and wait until that is > 0. Then publish.

Originally posted by dornhege with karma: 31395 on 2013-06-24
This answer was ACCEPTED on the original site
Post score: 10

Original comments
Comment by Philip on 2013-06-24:
Ah, thanks for the hint about getNumSubscribers! I wasn't aware of that :-)
Comment by aschaefer on 2018-12-05:
In case you run into this issue with rospy: The corresponding function is called get_num_connections().

