Q:

Convert CvImagePtr* (CvImage) channel to IplImage

Hi,
I have extracted an Image message using cv_bridge as this:
cv_bridge::CvImagePtr cv_ptr;
cv_ptr = cv_bridge::toCvCopy(msg, enc::MONO8);

and i could convert it to an IplImage using:
IplImage *image2 = NULL;
allocateit( &image2, frame_size, IPL_DEPTH_8U, 1 );
image2->imageData = (char *) cv_ptr->image.data;

where allocateit is a function to allocate space.
My problem comes when I want to read a color image as this:
cv_bridge::CvImagePtr cv_ptr;
cv_ptr = cv_bridge::toCvCopy(msg, enc::BGR8);
IplImage *image2 = NULL;
allocateit( &image2, frame_size, IPL_DEPTH_8U, 1 );

and want to copy one channel of *cv_ptr to the image to the IplImage *image2. I have tried:
image2->imageData = (char *) cv_ptr->image.data;

but it crashes,
cv::cvtColor(cv_ptr->image.data,image2->imageData,CV_RGB2GRAY);

but does not compile,
int from_to[] = {0,0};
cv::mixChannels(&(cv_ptr->image.data),1,image2,1, from_to,1);

does not compile either.
What would you recommend me to do?
Thanks!

Originally posted by cduguet on ROS Answers with karma: 187 on 2012-09-05
Post score: 0

A:

I know I should use cv::Mat, in fact I want to use it. But specifically in this problem I cannot use it. (see: http://tech.dir.groups.yahoo.com/group/OpenCV/message/81826).
Anyway I found a (not elegant) way  to convert it :
                for(int ko=0; ko< frame_size.width*frame_size.height ; ko++)
{
        image2->imageData[ko] = (char) cv_ptr->image.data[ko*3];
}

Originally posted by cduguet with karma: 187 on 2012-09-11
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by karthik on 2013-11-05:
what is frame_size?

