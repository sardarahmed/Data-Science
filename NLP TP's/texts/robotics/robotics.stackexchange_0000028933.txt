Q:

Is it possible to create an action server in a Gazebo plugin?

I'm talking about ROS2 and GazeboROS here, but the question can extend to ROS1.
An excerpt of pseudo code would be
void MyPlugin::Load(gazebo::physics::ModelPtr model, sdf::ElementPtr sdf)
{
    ros_node_ = gazebo_ros::Node::Get(sdf);

    auto my_action_server = rclcpp_action::create_server<MyAction>(
        ros_node_->get_node_base_interface(),
        ros_node_->get_node_clock_interface(),
        ros_node_->get_node_logging_interface(),
        ros_node_->get_node_waitables_interface(),
        "my_command",
        std::bind(&MyPlugin::handle_action_goal, this, std::placeholders::_1, std::placeholders::_2),
        std::bind(&MyPlugin::handle_action_cancel, this, std::placeholders::_1),
        std::bind(&MyPlugin::handle_action_accepted, this, std::placeholders::_1));
}

My current finding seems to suggest that it is not possible to do so - Gazebo simply doesn't load this plugin if the action server is there.

Originally posted by 546568303@qq.com on Gazebo Answers with karma: 1 on 2020-03-12
Post score: 0

Original comments
Comment by chapulina on 2020-03-12:
I can't see why not. What do you mean it doesn't load the plugin? Do you see any error messages in verbose mode?
Comment by 546568303@qq.com on 2020-03-13:
@chapulina It simply doesn't. I can comment out the action server definition lines and see the plugin loaded and prints, but as long as these lines exist the plugin doesn't load and even debug message at the beginning of MyPlugin::Load() would not print.
Comment by 546568303@qq.com on 2020-03-13:
@chapulina Pushed a minimal example onto Github: https://github.com/AlanSixth/gazebo_ros_action_tutorial
Comment by 546568303@qq.com on 2020-03-13:
@chapulina Oh I think I just fixed the problem. The reason was that I didn't add rclcpp_action as the dependency in CMakeLists.txt and somehow that caused the plugin loading to fail silently. Thanks a lot for helping though.
Comment by chapulina on 2020-03-13:
Glad you could work it out! Feel free to add that as an answer and accept it so it can help others in the future.

A:

It is possible. I have provided a minimal example here: https://github.com/AlanSixth/gazebo_ros_action_tutorial
I had a problem before where the plugin containing an action server wouldn't load but I fixed the problem in the end. The reason was that I didn't add rclcpp_action as the dependency in CMakeLists.txt and somehow that caused the plugin loading to fail silently.

Originally posted by 546568303@qq.com with karma: 1 on 2020-03-15
This answer was ACCEPTED on the original site
Post score: 0

