Q:

ROS communication works only in one direction

Hi,
I'm using ROS Kinetic and I have a strange issue.
I want to run one node in a Docker container on my pc and one node on a RaspberryPi.
The problem is that if I publish messages from the pc, no message is received on the Raspberry.
Interestingly if I publish from the Raspberry I receive messages on the pc.
I tried to run the ROS master both on the pc as well as on the Raspberry.
In the .bashrc file of both devices I have the following lines
  export ROS_MASTER_URI=http://masterhost:11311
  export ROS_HOSTNAME=localhost

Where localhost is the ip address of the specific device and  masterhost is equal to the localhost of the device running the master.
Do you know why this could happen?

Originally posted by alsora on ROS Answers with karma: 1322 on 2018-10-12
Post score: 0

A:

The pc and the raspberry shouldn't have the same configuration. They have to have the same ROS_MASTER_URI but their ROS_HOSTNAME (or ROS_IP) should be their own.
You should have in the .bashrc:

On the pc :

export ROS_MASTER_URI=http://PC_IP_ADDRESS:11311
export ROS_HOSTNAME=PC_IP_ADDRESS

On the rapsberry :

export ROS_MASTER_URI=http://PC_IP_ADDRESS:11311
export ROS_HOSTNAME=RASPBERRY_IP_ADDRESS
See #q272065 for a much more detailled answer.

Originally posted by Delb with karma: 3907 on 2018-10-12
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by gvdhoorn on 2018-10-12:
Note that a complicating factor here could be the Docker setup. Docker by default uses NAT (ie: masquerading), so it's not always as straightforward as setting ROS_IP and ROS_MASTER_URI to get things to work.
Comment by Delb on 2018-10-12:
Does the masqueradidng change the ROS_MASTER_URI ? If not, is it possible to replacePC_IP_ADDRESS for the ROS_MASTER_URI by RASPBERRY_IP_ADDRESS to prevent the issue ?
Comment by gvdhoorn on 2018-10-12:
Docker creates a "virtual network" by default, so depending on where you run your master you'll have to update the ROS_MASTER_URI yes (and most likely the routing configuration of the involved hosts). But the more difficult issue is that NAT will "hide" nodes running inside your container.
Comment by alsora on 2018-10-12:
@Delb the ROS_HOSTNAME is different across devices, It was not clear from my question.
Comment by alsora on 2018-10-12:
@gvdhoorn You are right, the error is due to the Docker setup.
I'm running the container with the --privileged and --net=host flags.
From ifconfig inside Docker, I see the docker and wlan interfaces. I am using the wlan inet address in the exported env variables

