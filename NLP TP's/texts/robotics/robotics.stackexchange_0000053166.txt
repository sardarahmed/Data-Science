Q:

git-bloom-release fails with svn upstream repo

Upon releasing through git-bloom-release with svn upstream repo, I get this error. Is there anything wrong? I'm only testing locally here.
$ git-bloom-release --version
0.4.4
$ mkdir -p ~/tmp/samplepkg-release
$ cd tmp/samplepkg-release
$ (mkdir -p /tmp/git; cd /tmp/git/; rm -fr foo.git; mkdir foo.git; cd foo.git ; git --bare init)
$ git init
$ git-bloom-config new groovy
:
  (type following information
    uri -> https://rtm-ros-robotics.googlecode.com/svn/trunk/rtmros_common/rtctree
    vcs -> svn
    release tag -> :{none}
$ git remote add origin file:///tmp/git/foo.git  # dummy remote release repo
$ git push -u origin master
$ git-bloom-release -d groovy
track_branches(['bloom', 'master'], None)
Tracking branches: []
Checking out to master
Requested checkout reference is the same as the current branch
track_branches(['bloom'], None)
Tracking branches: []
Checking out to master
Requested checkout reference is the same as the current branch
/home/rosuser/data/Dropbox/pg/rtm-ros/tmp/samplepkg-release:$ git ls-tree bloom:CONTENT_MOVED_TO_MASTER_BRANCH
/home/rosuser/data/Dropbox/pg/rtm-ros/tmp/samplepkg-release:$ git show bloom:CONTENT_MOVED_TO_MASTER_BRANCH
track_branches(['bloom'], None)
Tracking branches: []
Checking out to master
Requested checkout reference is the same as the current branch
/home/rosuser/data/Dropbox/pg/rtm-ros/tmp/samplepkg-release:$ git ls-tree bloom:bloom.conf
/home/rosuser/data/Dropbox/pg/rtm-ros/tmp/samplepkg-release:$ git show bloom:bloom.conf
track_branches(None, None)
Tracking branches: []
Checking out to master
Requested checkout reference is the same as the current branch
+++ Cloning working copy for safety
/home/rosuser/data/Dropbox/pg/rtm-ros/tmp/samplepkg-release:$ git clone file:///home/rosuser/data/Dropbox/pg/rtm-ros/tmp/samplepkg-release /tmp/tmpO7GWX6/clone
track_branches(None, /tmp/tmpO7GWX6/clone)
Tracking branches: []
Checking out to master
Requested checkout reference is the same as the current branch
Processing release track settings for 'groovy'
Checking upstream devel branch for package.xml(s)
A    /tmp/tmpAVQZDI/upstream/manifest.xml
A    /tmp/tmpAVQZDI/upstream/catkin.cmake
A    /tmp/tmpAVQZDI/upstream/package.xml
A    /tmp/tmpAVQZDI/upstream/CMakeLists.txt
A    /tmp/tmpAVQZDI/upstream/Makefile
A    /tmp/tmpAVQZDI/upstream/rtctree-3.0.0.zip.md5sum
Checked out revision 4811.
Looking for packages in '/tmp/tmpAVQZDI/upstream'... found 'rtctree'.
track_branches(['master'], None)
fatal: Not a git repository (or any of the parent directories): .git
Traceback (most recent call last):
  File "/usr/bin/git-bloom-release", line 9, in <module>
    load_entry_point('bloom==0.4.4', 'console_scripts', 'git-bloom-release')()
  File "/usr/lib/pymodules/python2.7/bloom/commands/git/release.py", line 334, in main
    args.unsafe)
  File "/usr/lib/pymodules/python2.7/bloom/commands/git/release.py", line 244, in execute_track
    settings = process_track_settings(track_dict, release_inc)
  File "/usr/lib/pymodules/python2.7/bloom/commands/git/release.py", line 189, in process_track_settings
    track_dict['ros_distro'])
  File "/usr/lib/pymodules/python2.7/bloom/commands/git/release.py", line 146, in find_version_from_upstream
    meta = get_upstream_meta(upstream_repo.get_path(), ros_distro)
  File "/usr/lib/pymodules/python2.7/bloom/commands/git/release.py", line 121, in get_upstream_meta
    name, version, packages = get_package_data(current_branch, quiet=False)
  File "/usr/lib/pymodules/python2.7/bloom/packages.py", line 92, in get_package_data
    ignored_packages = get_ignored_packages()
  File "/usr/lib/pymodules/python2.7/bloom/packages.py", line 64, in get_ignored_packages
    data = show(BLOOM_CONFIG_BRANCH, '{0}.ignored'.format(prefix)) or ''
  File "/usr/lib/pymodules/python2.7/bloom/git.py", line 202, in show
    dirs = ls_tree(reference, path, directory)
  File "/usr/lib/pymodules/python2.7/bloom/git.py", line 162, in ls_tree
    track_branches(reference, directory=directory)
  File "/usr/lib/pymodules/python2.7/bloom/git.py", line 640, in track_branches
    current_branch = get_current_branch(directory)
  File "/usr/lib/pymodules/python2.7/bloom/git.py", line 613, in get_current_branch
    output = check_output(cmd, shell=True, cwd=directory)
  File "/usr/lib/pymodules/python2.7/bloom/util.py", line 309, in check_output
    raise CalledProcessError(p.returncode, cmd)
CalledProcessError: Command 'git branch --no-color' returned non-zero exit status 128

Originally posted by 130s on ROS Answers with karma: 10937 on 2013-07-30
Post score: 0

A:

This is a bug, please open a ticket on the issue tracker for bloom.
https://github.com/ros-infrastructure/bloom
EDIT:
I fixed it here:
https://github.com/ros-infrastructure/bloom/commit/83bed53f59278113f4065f30b25c0eb48f45d86c

Originally posted by William with karma: 17335 on 2013-07-30
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by 130s on 2013-07-30:
Worked with the svn repos I use. Thanks for very quick fix.

