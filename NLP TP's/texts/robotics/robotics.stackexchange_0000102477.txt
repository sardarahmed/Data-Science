Q:

rosserial_xbee in noetic

I am doing the rosserial_ xbee tutorial link text
I followed the steps of the tutorial and at the moment of executing: rosrun rosserial_xbee xbee_network.py /dev/ttyUSB0 1 2
it gives me the following result:
RosSerial Xbee Network  
Contacting Xbees :  [b'\x00\x01', b'\x00\x02']
[INFO] [1664829162.053484]: Requesting topics...
[INFO] [1664829164.359676]: Requesting topics...
Exception in thread Thread-9:
Traceback (most recent call last):
Exception in thread Thread-10:
File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
Traceback (most recent call last):
File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
self.run()
File "/usr/lib/python3.8/threading.py", line 870, in run
self.run()
File "/usr/lib/python3.8/threading.py", line 870, in run
self._target(*self._args, **self._kwargs)
File "/home/martintg/catkin_et/src/rosserial/rosserial_python/src/rosserial_python/SerialClient.py", line 788, in processWriteQueue
self._target(*self._args, **self._kwargs)
File "/home/martintg/catkin_et/src/rosserial/rosserial_python/src/rosserial_python/SerialClient.py", line 788, in processWriteQueue
self._write(data)
File "/home/martintg/catkin_et/src/rosserial/rosserial_python/src/rosserial_python/SerialClient.py", line 749, in _write
self._write(data)
File "/home/martintg/catkin_et/src/rosserial/rosserial_python/src/rosserial_python/SerialClient.py", line 749, in _write
self.port.write(data)
File "/home/martintg/catkin_et/src/rosserial/rosserial_xbee/scripts/xbee_network.py", line 83, in write
self.port.write(data)
File "/home/martintg/catkin_et/src/rosserial/rosserial_xbee/scripts/xbee_network.py", line 83, in write
self.xbee.send('tx', frame_id='0', options="\x01", dest_addr=self.id,data=data)
File "/home/martintg/catkin_et/src/rosserial/rosserial_xbee/src/xbee/base.py", line 375, in send
self.xbee.send('tx', frame_id='0', options="\x01", dest_addr=self.id,data=data)
File "/home/martintg/catkin_et/src/rosserial/rosserial_xbee/src/xbee/base.py", line 375, in send
self._write(self._build_command(cmd, **kwargs))
File "/home/martintg/catkin_et/src/rosserial/rosserial_xbee/src/xbee/base.py", line 196, in _build_command
self._write(self._build_command(cmd, **kwargs))
File "/home/martintg/catkin_et/src/rosserial/rosserial_xbee/src/xbee/base.py", line 196, in _build_command
packet += data
TypeError: can only concatenate str (not "bytes") to str
packet += data
TypeError: can only concatenate str (not "bytes") to str

I am using ubuntu 20.04 and ROS Noetic.
If i run the command git log -1 in the directory /home/martintg/catkin_et/src/rosserial
commit c169ae2173dcfda7cee567d64beae45198459400 (HEAD -> noetic-devel, origin/noetic-devel, 
   origin/HEAD)
   Author: Amal Pavithran <amalpavithranmp@gmail.com>
   Date:   Wed Jun 16 20:04:19 2021 +0530

Add optional private parameter config to Python server (#562)

 * Made tcp_port a local parameter

The tcp_port parameter being a global parameter prevents the launch of multiple serial nodes on different port numbers  using a launch file

 * Added Fallback & Modified fork_server parameter

 * Removed unnecessary defaults & added comments

Originally posted by MartinTG90 on ROS Answers with karma: 3 on 2022-10-03
Post score: 0

Original comments
Comment by Mike Scheutzow on 2022-10-12:
Please edit your description and show us the output of:
cd /home/martintg/catkin_et/src/rosserial
git log -1

Comment by Mike Scheutzow on 2022-10-12:
You are using the correct git commit for noetic, so my conclusion is that the rosserial update from melodic to noetic was never completed. Sorry for the bad news. You should open an issue at the github repo.
If you need something working today, I think your only path is use melodic & ubuntu 18. To avoid reloading the OS, I see that some people run an ubuntu 18 docker container in ubuntu 20, but I have no experience with that.
Comment by MartinTG90 on 2022-10-12:
If that is what you had read, the entire rosserial package is not functional in ros-noetic. Thanks, see the option to make the docker container with ubuntu 18
Comment by Mike Scheutzow on 2022-10-22:
Could you describe what kind of xbee client (the remote one across the wireless link) you're using? Is the rosserial code already written/tested for that client, or is that something you will do in the future?
Comment by MartinTG90 on 2022-10-22:
I am following the tutorial in this link.
http://wiki.ros.org/rosserial_xbee/Tutorials/Example%20Network
Comment by MartinTG90 on 2022-10-24:
I wanted to use the rosserial package for Xbee modules, because I wanted an autonomous robot to collect information about an object (position) and send it to a database (pc with xbee module)

A:

This TypeError happens if you try to run python2 code in python3. It is a hint that you are running the wrong source code for the package. You need to do a git checkout of the source code for noetic. In this package, that git branch is named noetic-devel.
The underlying issue here is that as of Oct 2022 the rosserial_xbee package has not been updated for python3, so it doesn't work in noetic. Additionally, the rosserial maintaniners have accepted other changes into the git repo which break it further.

Originally posted by Mike Scheutzow with karma: 4903 on 2022-10-05
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by MartinTG90 on 2022-10-11:
If I downloaded and clone the git from the correct source that corresponds to the noetic-devel branch. I still noticed that it is because of the pyhton version. When I configure the Xbee modules, if I have python 3 active, the command does not work: rosrun rosserial_xbee setup_xbee.py -C /dev/ttyUSB0 0 , but if I activate pyhton 2, the command works and the Xbee module is configured correctly. I don't know if it is the rosserial package that is not compatible with pyhton3 or with Ros Noetic. I can't find a solution.
Comment by Mike Scheutzow on 2022-10-15:
I had a few hours free, so I have tried to fix the python3 issues in this package. The unit tests now pass in noetic, but I have no real hardware to test against. Please clone and build my version and let me know if it works. Also before building please remove the old build and devel directories, like I show below.
cd catkin_ws/src
rm -rf rosserial
git clone https://github.com/mjs973/rosserial.git
cd ..
rm -rf build devel
catkin_make

For noetic, your /usr/bin/python must execute python 3.8.10.
Comment by MartinTG90 on 2022-10-18:
Do the steps you mention and clone the git you gave me and execute the corresponding commands. The version of pyhton that is running is 3.8.10. First run the command to configure the xbee which is the command: rosrun rosserial_xbee setup_xbee.py -C /dev/ttyUSB0 0 and as a result it was the following.
~$ rosrun rosserial_xbee setup_xbee.py -C /dev/ttyUSB0 0
  Connected to the XBee
  Traceback (most recent call last):
  File "/home/martintg/rosserial_ws/src/rosserial/rosserial_xbee/scripts/setup_xbee.py", line 138, in 
  <module>
   if setAT(port, 'RE'): #reset the xbee
   File "/home/martintg/rosserial_ws/src/rosserial/rosserial_xbee/scripts/setup_xbee.py", line 73, in setAT
   send(port, b'AT'+cmd.encode('iso-8859-1'))
   File "/home/martintg/rosserial_ws/src/rosserial/rosserial_xbee/scripts/setup_xbee.py", line 67, in send
   for c in cmd+'\r':
   TypeError: can't concat str to bytes

Comment by MartinTG90 on 2022-10-18:
After executing the command: rosrun rosserial_xbee xbee_network.py /dev/ttyUSB0 1 2 and I got the following result.
~$ rosrun rosserial_xbee xbee_network.py /dev/ttyUSB0 1 
  File "/home/martintg/rosserial_ws/src/rosserial/rosserial_xbee/scripts/xbee_network.py", line 93
  def inWaiting(self):
                     ^
  TabError: inconsistent use of tabs and spaces in indentation

Comment by Mike Scheutzow on 2022-10-19:
I fixed these issues. Please try your test again after updating:
cd ~/rosserial_ws/src/rosserial
git pull
cd ../..
catkin_make

Comment by MartinTG90 on 2022-10-19:
Update and it gives me the following result.
martintg@martintg-GA-78LMT-S2PT:~$ rosrun rosserial_xbee xbee_network.py /dev/ttyUSB0 1 
RosSerial Xbee Network
Contacting Xbees :  ['\x00\x01']
[INFO] [1666197493.890136]: Requesting topics...
Exception in thread Thread-8:
Traceback (most recent call last):
File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
 self.run()
File "/usr/lib/python3.8/threading.py", line 870, in run
 self._target(*self._args, **self._kwargs)
File "/home/martintg/rosserial_ws/src/rosserial/rosserial_python/src/rosserial_python/SerialClient.py", line 
788, in processWriteQueue
 self._write(data)
 File "/home/martintg/rosserial_ws/src/rosserial/rosserial_python/src/rosserial_python/SerialClient.py", line 
 749, in _write
 self.port.write(data)

Comment by MartinTG90 on 2022-10-19:
continuous result
File "/home/martintg/rosserial_ws/src/rosserial/rosserial_xbee/scripts/xbee_network.py", line 80, in write
self.xbee.send('tx', frame_id='0', options="\x01", dest_addr=self.id,data=data)
File "/home/martintg/rosserial_ws/src/rosserial/rosserial_xbee/src/xbee/base.py", line 376, in send
self._write(self._build_command(cmd, **kwargs))
File "/home/martintg/rosserial_ws/src/rosserial/rosserial_xbee/src/xbee/base.py", line 197, in _build_command
  packet += data
TypeError: can only concatenate str (not "bytes") to str

Comment by Mike Scheutzow on 2022-10-20:
I've been looking for some way to test this xbee_network myself, but have not yet found a way. Are you aware of any simulation or software model for a zigbee device?
I have fixed the errors you posted. Please do a git pull and catkin_make when you have a chance.
Comment by MartinTG90 on 2022-10-20:
I don't know of any Xbee's simulation software.
I did the update of the git and I get.
Comment by MartinTG90 on 2022-10-20:
Result 1/3:
martintg@martintg-GA-78LMT-S2PT:~$ rosrun rosserial_xbee xbee_network.py /dev/ttyUSB0 1 
 RosSerial Xbee Network
 Contacting Xbees :  ['\x00\x01']
 [INFO] [1666308059.140872]: Requesting topics...
 [WARN] [1666308059.971973]: Last read step: syncflag
 [WARN] [1666308059.974920]: Run loop error: Serial Port read failure: 'str' object cannot be interpreted as 
 an integer
 Exception in thread Thread-7:
 Traceback (most recent call last):
 File "/home/martintg/rosserial_ws/src/rosserial/rosserial_python/src/rosserial_python/SerialClient.py", line 
 437, in tryRead
 result.extend(received)
TypeError: 'str' object cannot be interpreted as an integer

Comment by MartinTG90 on 2022-10-20:
Result 2/3
During handling of the above exception, another exception occurred:

Traceback (most recent call last):
File "/home/martintg/rosserial_ws/src/rosserial/rosserial_python/src/rosserial_python/SerialClient.py", line 
482, in run
 flag[0] = self.tryRead(1)
File "/home/martintg/rosserial_ws/src/rosserial/rosserial_python/src/rosserial_python/SerialClient.py", line 
445, in tryRead
 raise IOError("Serial Port read failure: %s" % e)
OSError: Serial Port read failure: 'str' object cannot be interpreted as an integer

Comment by MartinTG90 on 2022-10-20:
Result 3/3
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
 self.run()
File "/usr/lib/python3.8/threading.py", line 870, in run
 self._target(*self._args, **self._kwargs)
File "/home/martintg/rosserial_ws/src/rosserial/rosserial_python/src/rosserial_python/SerialClient.py", line 
555, in run
 self.port.flushOutput()
AttributeError: 'FakeSerial' object has no attribute 'flushOutput'

