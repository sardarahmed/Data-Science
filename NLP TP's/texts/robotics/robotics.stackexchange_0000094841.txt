Q:

imm_ukf_pda_track error

Hi!
I' trying to perform tracking with autoware (version 1.12.0) and the lgsvl simulator (version 20.01).
I have the point cloud and euclidian cluster running well. Then, I proceed running the roslaunch lidar_tracker imm_ukf_pda_tracker.launch. However I got no output under the /detection/object_tracker/* topics.
Also, running the lidar_tracker imm_ukf_pda_tracker.launch results in lots of erros as below:
process[ukf_track_relay_01-3]: started with pid [1461]
[ERROR] [1582548650.221744610]: Lookup would require extrapolation into the past.  Requested time 1582548276.277444864 but the earliest data is at time 1582548649.225498201, when looking up transform from frame [velodyne] to frame [world]
[ INFO] [1582548650.221785276]: Could not find coordiante transformation
[ERROR] [1582548651.222754904]: Lookup would require extrapolation into the past.  Requested time 1582548276.987444224 but the earliest data is at time 1582548649.225498201, when looking up transform from frame [velodyne] to frame [world]
[ INFO] [1582548651.222778187]: Could not find coordiante transformation
[ERROR] [1582548652.228415645]: Lookup would require extrapolation into the past.  Requested time 1582548277.687443456 but the earliest data is at time 1582548649.225498201, when looking up transform from frame [velodyne] to frame [world]
[ INFO] [1582548652.228460558]: Could not find coordiante transformation
[ERROR] [1582548653.230826125]: Lookup would require extrapolation into the past.  Requested time 1582548278.567442688 but the earliest data is at time 1582548649.225498201, when looking up transform from frame [velodyne] to frame [world]
[ INFO] [1582548653.231090351]: Could not find coordiante transformation
[ERROR] [1582548654.241142147]: Lookup would require extrapolation into the past.  Requested time 1582548279.437441792 but the earliest data is at time 1582548649.225498201, when looking up transform from frame [velodyne] to frame [world]
[ INFO] [1582548654.241166545]: Could not find coordiante transformation

And so on..
I had run rosrun tf view_frames during the execution to get the /tf structure, and got the following:

Don't kow why the /ndt_matching most recent transform is so old. Can that be a problem?
If I check the active nodes/topics with rqt, the ndt_matching still appears as a publisher into the /tf topic:

Can someone please help to understand why this error occurs? Am I missing something?
Thank you very much.

Update I
I restarted everything from scratch. This time I initialized the euclidian_cluster and the imm_ukf_pda modules before using the estimate 2D pose (required for the ndt_algorithm to work with lgsvl since the gps coordinates are from outside japan). For this reason, naturally, I got the following error:
[ERROR] [1582640012.503829801]: Could not find a connection between 'world' and 'velodyne' because they are not part of the same tree.Tf has two or more unconnected trees.

Then when I placed the estimation pose, the ndt_algorithm could find itself, create the link between [world] and [velodyne], and I saw the tracking working in RViz for a few seconds. Some boxes appeared around cars and trees with the velocity/speed aside (I think that was the goal, right?).
However, after a few seconds the same error comeback
[ERROR] [1582640028.598171054]: Lookup would require extrapolation into the past.  Requested time 1582640001.163042816 but the earliest data is at time 1582640018.607235113, when looking up transform from frame [velodyne] to frame [world].

But now I cannot reproduce it. So apparently I have some timing issue here, but unfortunately I'm not experienced to understand why that happen. Is there a proper order to run the modules I'm not aware of?
Once again, thank you very much.
Update II
Ok. So now I can reproduce the weird behavior from Update I. If I setup the RViz and the lgsvl, pose the car in the correct place and get ndt_matching working, then re-start LGSVL simulator, the tf between [velodyne] and [world] starts working .
I assess that through the rosrun tf tf_echo velodyne world command, which starts echo-ing the apropriate transformation. In the meantime, I can also run the euclidian_cluster and imm_ukf_pda_track modules and see them on the scree. As in the image above:

However a few seconds later the tf stops working (rosrun tf tf_echo velodyne world displays the 'Lookup would require extrapolation into the past' error). As a consequence the tracking also stops working.
I'm suspecting there might be some timing issues between the timestamp from data generated by LGSVL and autoware. If anyone had faced something like this, please let me know!
Thanks!
Update III
Checking rosrun tf tf_monitor map base_link it's possible to see that:
RESULTS: for map to base_link
Chain is: map -> base_link
Net delay     avg = 19.1867: max = 19.3867

As time goes by the 'max' value only increases, so I think base_link is not being updated by ndt_matching as it should.
Also, map -> base_link tf works and base_link -> velodyne tf also works. But their 'last time' timestamp differ significantly. I tried to asses that in the image below.

So, is there a way to sync them? Or to make map -> base_link delay to decrease?
Thank you.

Originally posted by pedroexe on ROS Answers with karma: 50 on 2020-02-24
Post score: 0

Original comments
Comment by pedroexe on 2020-02-25:
I add an update that might help you to help me. Thanks.

A:

I solved the problem as explained in the following github issue at the LGSVL repo https://github.com/lgsvl/simulator/issues/653.
Basically the rosbridge was delaying the messages from LGSVL's lidar to /points_raw topic. Changing the vehicle configuration in LGSVL solved the problem.

Originally posted by pedroexe with karma: 50 on 2020-02-28
This answer was ACCEPTED on the original site
Post score: 0

