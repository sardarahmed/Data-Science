Q:

SIGILL, Illegal instruction in libpcl_common.so.1.5.1 from costmap_2d

Since our latest ros fuerte update in ubuntu precise, our navigation crashes.
After investigating the issue, we found out that the problem is the costmap_2d node, which crahses with SIGILL, which mean that an illegal assembler instruction was called.
We furhter investigated this, and found out, that it's a AVX instruction call in Eigen, called from libpcl in libpcl_common.so.1.5.1
Our ros is running on an intel atom, which does not support avx, so we can't use it anymore.
We tried to build our own version without avx, but failed to find out how to build our own deb to replace the existing one.
The avx instructions shouldn't be in there at all, as many CPUs don't support it.
The problems started with the ros update on 2nd May.

Originally posted by BtbN on ROS Answers with karma: 61 on 2013-05-10
Post score: 2

A:

I managed to hack-fix this for now.
All i did was just rebuilding pcl from ros-gbp/pcl-fuerte-release.git on github(debian/fuerte/precise/pcl branch) on the machine it's running on and then simply replacing the libpcl files in /opt/ros/fuerte/lib with the ones i built.
Not a clean fix as it interfers with the package manager, but it works for now and i hope that the next update fixes it.
It looks like cmake checks for the SSE and other cpu capabilitys when it's configuring. So if the buildservers are capable of avx and other extensions, that'd explain how the instructions got in there.

Originally posted by BtbN with karma: 61 on 2013-05-10
This answer was ACCEPTED on the original site
Post score: 4

Original comments
Comment by joq on 2013-05-10:
Clearly, the build farm should not produce binaries that only work on its particular hardware.
Comment by jarvisschultz on 2013-05-12:
This also cleared up the issue for me. While a bit hacky, works until the build farm produces a working release.
Comment by martimorta on 2013-05-14:
This hack worked for me too
Comment by LEinig on 2013-05-16:
This hack also fixes my problem.
Comment by joq on 2013-05-17:
This "fix" will disappear the next time you upgrade this package. You should avoid upgrading your packages until it is really fixed in the repo.
Comment by da-na on 2013-05-28:
How did you get the sources? I tried git clone https://github.com.ros-gbp/pcl-fuerte.release.git but there was nothing to compile in the downloaded folder (pcl-fuerte-release)
Comment by BtbN on 2013-05-28:
It's in the debian/fuerte/precise/pcl branch.
Comment by martimorta on 2013-05-28:
try git clone -b fuerte-devel https://github.com/ros-perception/perception_pcl.git
or download the tar.gz
Comment by LEinig on 2013-06-06:
Did anyone experience this issue being fixed with the latest pcl update?
Comment by joq on 2013-06-06:
Yes, several people reported it working now. The issue has been closed, if it fails for you, please comment and re-open: https://github.com/ros-perception/perception_pcl/issues/10

