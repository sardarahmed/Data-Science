Q:

Error while running obstacle avoidance script for turtlebot3 in ROS2

Hello, I am trying to run an obstacle avoidance script and test it in gazebo simulation using turtlebot 3 in ROS2 but I am getting the following error - [WARN] [1667317780.806097773] [obstacle_avoidance]: New publisher discovered on topic '/scan', offering incompatible QoS. No messages will be received from it. Last incompatible policy:RELIABILITY
Please help me in solving this issue, thank you.
Here is the code I have written -
import rclpy 
from rclpy.node import Node 
from sensor_msgs.msg import LaserScan 
from geometry_msgs.msg import Twist
    
    distToObstacle = 1
    
    class ObstacleAvoidance(Node):
        def __init__(self):
            super().__init__('obstacle_avoidance')
            self.sub = self.create_subscription(LaserScan, '/scan', self.obstacle_callback, 10)
            self.pub = self.create_publisher(Twist, '/cmd_vel', 10)
    
        def obstacle_callback(self, msg):
            self.get_logger().info('The distance to obstacle is %s ' % msg.ranges[300])
    
            move = Twist()
    
            if msg.ranges[300] > distToObstacle:
                move.linear.x = 0.5
                move.angular.z = 0.0
    
            if msg.ranges[300] <= distToObstacle:
                move.linear.x = 0.5
                move.angular.z = 1.5 
          
            self.pub.publish(move)
    
    def main(args=None):
    
        rclpy.init(args=args)
    
        obstacle_avoidance = ObstacleAvoidance()
    
        rclpy.spin(obstacle_avoidance)
    
        obstacle_avoidance.destroy_node()
    
        rclpy.shutdown()
    
    if __name__ == '__main__':
        main()

Originally posted by Robo_guy on ROS Answers with karma: 115 on 2022-11-01
Post score: 0

Original comments
Comment by Davies Ogunsina on 2022-11-01:
can  you please paste your node to debug .
Comment by Robo_guy on 2022-11-01:
Hi @Davies Ogunsina, I have updated my question with the code I have written.

A:

You need to change the QoS policies of the scan topic in RViz.

Originally posted by nils_iseke with karma: 76 on 2022-11-02
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by Robo_guy on 2022-11-02:
Ok thank you @nils_iseke, I was actually simulating in gazebo and not rviz and also doing this using The Construct Platform, although while going through the turtlebot3 tutorial files I came across one script where they have imported QoS and assigned value to it as can be seen here - https://github.com/ROBOTIS-GIT/turtlebot3/blob/ros2/turtlebot3_example/turtlebot3_example/turtlebot3_obstacle_detection/turtlebot3_obstacle_detection.py
After doing this in my code, it works fine. I guess I had to import QoS in the code and also make the changes told by you in rviz2 to get it working properly, thanks for your answer.

