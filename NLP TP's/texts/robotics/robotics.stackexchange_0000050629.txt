Q:

Stageros: how to programmatically set the pose of a simulated robot

Hello,
I want to know if it is possible to programmatically set the pose of a robot in stageros. Back when we used player/stage it was possible using the simulation proxy.
NOTE: my question is the same as this one but it has not been answered yet (altough the author marked it as solved - it isnt)

Originally posted by Victor_ocv2 on ROS Answers with karma: 483 on 2013-04-24
Post score: 2

Original comments
Comment by gustavo.velascoh on 2013-04-26:
Have you seen this another question http://answers.ros.org/question/12384/change-simulator-stage-model-configurations-in-runtime/ ?
Comment by Victor_ocv2 on 2013-04-26:
it sounds promising, I will take a close look at it and I will be back here in some days, thank you!
Comment by gustavo.velascoh on 2013-04-26:
Ok.. I'm looking for a way for doing so too... see you.
Comment by Victor_ocv2 on 2013-04-26:
I have modified the stage driver to allow the reposition of the robots using a topic. Check my answer.

A:

I have modified the stageros.cpp file to make it subscribe to the topic "pose" which receives geometry_msgs/Pose2D and then sets the robot's pose to the desired one. The following are the lines that I had to add to stageros.cpp:
#include <geometry_msgs/Pose2D.h>

#define POSE "pose" 

std::vector<ros::Subscriber> pose_subs_;

void
StageNode::poseReceived(int idx, const boost::shared_ptr<geometry_msgs::Pose2D const>& msg)
{
  boost::mutex::scoped_lock lock(msg_lock);
    Stg::Pose pose;
    pose.x = msg->x;
    pose.y = msg->y;
    pose.z =0;
    pose.a = msg->theta;
    this->positionmodels[idx]->SetPose(pose);
}

pose_subs_.push_back(n_.subscribe<geometry_msgs::Pose2D>(mapName(POSE,r), 10, boost::bind(&StageNode::poseReceived, this, r, _1)));

Originally posted by Victor_ocv2 with karma: 483 on 2013-04-26
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by gustavo.velascoh on 2013-04-26:
This is for one robot, isnÂ´t it?
Comment by Victor_ocv2 on 2013-04-26:
It is programmed exactly as the cmd_vel subscriber, so if cmd_vel subscriber is for one robot, this one aswell
Comment by kleinma on 2016-11-11:
I adapted your code slightly and submitted a pull request. It works well for multiple robots, just as cmd_vel. The one change I made was to call the topic cmd_pose to signify intent (write vs. read). The pull request can be found here: https://github.com/ros-simulation/stage_ros/pull/39
Comment by kleinma on 2016-11-11:
Whoops. It looks like a pull request already exists for this. https://github.com/ros-simulation/stage_ros/pull/27
The work is the add_pose_sub branch of the main repository.

