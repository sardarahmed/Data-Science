Q:

Ar_pose doesn't recognize tag in tum_simulator. Please help

Hello,
I would like to use ar_pose with image from ardrone camera. I don't have real quadrotor, I am using tum_simulator with Gazebo.
My problem is that ar_pose doesn't recognize tags in simulation, so I have few questions:
screens:
Gazebo and ar_tag which I add image description http://snag.gy/vYzFi.jpg

Should I do camera calibration? (I don't have real cam, I am using cam which is in tum_simulator)
What parameters should be set in ar_pose like: marker marker_width? (I am using tags in simulation)
Why ar_pose doesn't recognize this tag?

EDIT:
what I have done?
I have add two lines to launch file which is responsible for running Gazebo + tum_simulator + ardrone_autonomy
<remap from="/ardrone/camera_info" to="/camera/camera_info"/>
<remap from="/ardrone/image_raw" to="/camera/image_raw"/>

so when I launch this files I have above topics remapped:
http://pastebin.com/vv0UpGRp
next I launch ar_pose:
<launch>

  <node pkg="rviz" type="rviz" name="rviz" 
    args="-d $(find ar_pose)/launch/live_single.rviz"/>
  <node pkg="tf" type="static_transform_publisher" name="world_to_cam" 
    args="0 0 0.5 -1.57 0 -1.57 world camera 10" />

 
  <node name="ar_pose" pkg="ar_pose" type="ar_single" respawn="false"
    output="screen">
    <param name="marker_pattern" type="string"
      value="$(find ar_pose)/data/4x4/4x4_19.patt"/>
    <param name="marker_width" type="double" value="200"/>
    <param name="marker_center_x" type="double" value="0.0"/>
    <param name="marker_center_y" type="double" value="0.0"/>
    <param name="threshold" type="int" value="100"/>
    <param name="use_history" type="bool" value="true"/>
 
  </node>
</launch>

RESULTS:
screen from rviz (simulation) image description http://snag.gy/vLwJj.jpg
(screen1) image description http://snag.gy/bdjWd.jpg
Problem is that there is warming NO IMAGE RECEIVED and it is true. Preview from camera using 'CAMERA' gives black window, preview should be done with 'IMAGE'.
AR_POSE uses this 'camera style' preview, no 'image style'.
How to solve this problem?
(screen2) image description http://snag.gy/PBK0v.jpg
info from marker section:
basic_shapes/1
For frame [ardrone_base_frontcam]: No transform to fixed frame [camera]. TF error: [Could not find a connection between 'camera' and 'ardrone_base_frontcam' because they are not part of the same tree.Tf has two or more unconnected trees.]
(screen3) image description http://snag.gy/zxhrW.jpg
EDIT:
it started working!
I change fixed frame to ar_marker and it seems to be working! :)
but it gives me message in terminal:
[ERROR] [1417704617.003409185, 3461.051000000]: Ignoring transform for child_frame_id "ar_marker" from authority "unknown_publisher" because of a nan value in the transform (0.609564 -0.180967 -3.568543) (-nan -nan -nan -nan)
[ERROR] [1417704622.185442670, 3463.722000000]: Ignoring transform for child_frame_id "ar_marker" from authority "unknown_publisher" because of a nan value in the transform (0.984986 -0.604149 -2.678788) (nan nan nan nan)
[ERROR] [1417704623.374384366, 3464.377000000]: Ignoring transform for child_frame_id "ar_marker" from authority "unknown_publisher" because of a nan value in the transform (0.590453 -0.226787 -2.891703) (nan nan nan nan)

(screen4) image description http://snag.gy/vOyiq.jpg

Originally posted by green96 on ROS Answers with karma: 115 on 2014-11-29
Post score: 2

Original comments
Comment by l0g1x on 2014-12-02:
Cześć, używasz ar_sys czy ar_pose ?
Comment by green96 on 2014-12-02:
Cześć :)
wolałbym pisać po ang ponieważ jest większe prawdop. że ktoś jeszcze może mi pomóc.
I am using ar_pose from this localisation: https://github.com/xqms/ar_tools/tree/catkin
do you have any idea?
Comment by l0g1x on 2014-12-02:
nie ma sprawy. And i tried to use ar_pose but it was a little difficult to setup and it seems as if maintenance hasnt been done in a while . Not sure what changes where made on the fork you are using though. Have you looked at ar_sys? Just started to set it up myself
Comment by green96 on 2014-12-04:
I haven't heard about this package before. You are using real camera or camera in gazebo simulator? Everything works fine?
Some time ago I found this repository: http://wiki.ros.org/ar_track_alvar
I have calibrated ar_pose to my cam in laptop so I would rather don't change repository.

A:

I believe you've hit on the problem in #2: there needs to be a white border around the marker in order for it to be detected.

Originally posted by Dan Lazewatsky with karma: 9115 on 2014-12-01
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by l0g1x on 2014-12-02:
Agreed. This would cause a issue
Comment by green96 on 2014-12-04:
I have added white borders to this tag, changed way of remapping and changed fixed frame.
It works, I am a little bit surprised. Could you look at the error which I pasted at the bottom of the post?

