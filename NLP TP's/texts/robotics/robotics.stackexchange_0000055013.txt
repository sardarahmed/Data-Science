Q:

Building ros on OSX 10.9, orocos_kdl

Hi all,
I am trying to build ros (hydro) on OSX 10.9. I had it working on 10.8, but since the update to 10.9 I can't get it to compile. orocos_kdl is giving me the following error:
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../lib/c++/v1/utility:221:9: error: field has incomplete type 'KDL::TreeElement'

It says that a number of times and also :
/opt/ros/hydro/src/orocos_kdl/src/tree.cpp:39:21: error: no viable conversion from 'pair<basic_string<[3 * ...]>, [...]>' to 'const pair<basic_string<[3 * ...]>, [...]>'

Any solution to this?

Originally posted by Hansg91 on ROS Answers with karma: 1909 on 2013-10-24
Post score: 0

Original comments
Comment by Artem on 2013-10-24:
I have lots of problems rebuilding hydro too. One hint, try to run brew install for all necessary libraries and programs. I basically had to almost rebuild everything. The problem now is how to build vtk and pcl.
Comment by Hansg91 on 2013-10-24:
Did you run brew upgrade ? Or did you remove stuff from brew and reinstalled them?
Comment by William on 2013-10-24:
I think you need to relink everything, I haven't updated yet, but I have heard that libc++ is now the default rather than libstdc++, which is likely to cause problems (I have not confirmed that). If you run into specific compile errors like with KDL, I would suggest filing tickets directly against them.
Comment by William on 2013-10-24:
That's re-linkedit, not brew link.
Comment by Hansg91 on 2013-10-24:
What do you mean relink everything? I mean I understand, but how do I do that?
Comment by William on 2013-10-24:
I think the easiest way is to uninstall and reinstall.
Comment by Hansg91 on 2013-10-24:
I was afraid you'd say that :(, I will give it a shot
Comment by Artem on 2013-10-24:
William is right about libstdc++, that was the issue. I did brew uninstall and then brew install for most of the packages. William have you updated hombrew pcl? As far as I remember  your formula was pulling binaries? Now it has to be compiled :(
Comment by William on 2013-10-24:
@Art the binary for pcl in Homebrew should be specific for mountain lion, you'll have to build it from source, which should be possible with the --build-from-source option to brew. I'll try to get a new bottle as soon as possible.
Comment by Hansg91 on 2013-10-24:
I am now also stuck at compiling PCL through brew. It seems to need some functions in vtk which do not exist. Is there perhaps a version mismatch? ps. I had to disable some python cmake settings for vtk for it to compile and had to enable VTK_USE_SYSTEM_TIFF.
Comment by Hansg91 on 2013-10-24:
Seems pcl1.7 was not ready for vtk6: https://github.com/PointCloudLibrary/pcl/issues/199
Comment by Artem on 2013-11-11:
I built fully functional PCL after applying a few patches. The source files can be found here https://github.com/Lenskiy/pcl
Comment by Bruno Normande on 2013-11-18:
I Already have the PCL installed, with vtk5. What packages should I reinstall to get orocos_kdl working? @William
Comment by William on 2013-11-22:
@Bruno Normande Not sure, I still have not upgraded to 10.9  myself.

A:

I had several issues compiling pcl with vtk 6.
I have not succeeded yet, but here is what I changed to solve some of the issues:
To resolve the compilation issues follows this [migration guide].(http://www.vtk.org/Wiki/VTK/VTK_6_Migration_Guide)
To resolve the linking errors add all vtk libraries to
CMakeLists.txt
in section set(VTK_IO_TARGET_LINK_LIBRARIES ... )
If I'm building released 6.0 using brew install vtk, I am getting this (see solution below)
... 
duplicate symbol ___sincospif in:
    CMakeFiles/vtktiff.dir/tif_aux.c.o
    CMakeFiles/vtktiff.dir/tif_color.c.o
duplicate symbol ___sincospi in:
    CMakeFiles/vtktiff.dir/tif_aux.c.o
    CMakeFiles/vtktiff.dir/tif_color.c.o
duplicate symbol ___sputc in:
    CMakeFiles/vtktiff.dir/tif_aux.c.o
    CMakeFiles/vtktiff.dir/tif_extension.c.o
duplicate symbol ___sputc in:
    CMakeFiles/vtktiff.dir/tif_aux.c.o
    CMakeFiles/vtktiff.dir/tif_unix.c.o
ld: 91 duplicate symbols for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make[2]: *** [lib/libvtktiff-6.0.1.dylib] Error 1
make[1]: *** [ThirdParty/tiff/vtktiff/CMakeFiles/vtktiff.dir/all] Error 2

If you know how to resolve this please let me know.
*EDITED
The best solution to build VTK and PCL is to go back to VTK ver 5.10.
Simply do
1) cd /usr/local/Library/Taps/homebrew-science/
2) brew versions vtk
3) git checkout 27a4327 vtk.rb
4) brew uninstall vtk && brew install vtk

Originally posted by Artem with karma: 709 on 2013-10-24
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Hansg91 on 2013-10-24:
You can fix this by installing libtiff (brew install libtiff) and then setting the -DVTK_USE_SYSTEM_TIFF=ON option for vtk.
Comment by Artem on 2013-10-25:
Thanks it worked. Now back to building PCL.  I am going to create a new question.
Comment by Bruno Normande on 2013-11-18:
I have both VTK5 and PCL installed already, but I'm still blocked in this orocos_kdl error
Comment by Hansg91 on 2013-11-18:
What orocos error exactly? Regarding some TreeElement type?
Comment by Bruno Normande on 2013-11-19:
Yes, the exactly same error that was reported.
Comment by Hansg91 on 2013-11-19:
Not sure if a proper fix is available by now, but what you need to do for libc++ is to make TreeElement a pointer and change some things to work with pointers instead. To save you the trouble, you can use my modified version: https://dl.dropboxusercontent.com/u/40610835/orocos_kdl.zip

