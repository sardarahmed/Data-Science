Q:

How to configure Flake8 with colcon test

When creating a package Ros2 automatically generates these tests: test_copyright.py, test_flake8.py, test_pep257.py. Running colcon test invokes these tests and that's fine if I'd be able to configure flake8 and pep257. According to the (somewhat scarce) documentation you can add a configuration file ~/.config/flake8 with for instance:
[flake8]
extend-ignore = E501

Or you can add configurations to a Ros2 package's setup.cfg file with for instance:
[flake8]
extend-ignore = E501

However, both options don't seem to work. Does anyone have any ideas how to configure these tools when running with colcon test? Thanks in advance!

A:

Adapting test_flake8.py like underneath reads a flake8.ini file in the Ros workspace folder. Perhaps there's a cleaner way to find the ini file, but at least this works.
@pytest.mark.flake8
@pytest.mark.linter
def test_flake8():
    # Find flake8.ini in Ros workspace folder
    config_path = Path(__file__).resolve().parent.parent.parent.parent / 'flake8.ini'
    rc, errors = main_with_errors(argv=['--config', str(config_path)])
    assert rc == 0, \
        f'Found {len(errors):d} code style errors / warnings:\n' + '\n'.join(errors)

