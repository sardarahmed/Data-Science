Q:

pcl_to_octree cannot compile. Octomap bug?

Hello,
I am trying to compile the package next_best_view which depends on pcl_to_octree.
Pcl_to_octree's compilation fails due to an inner octomap function.
From the line
/opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/OcTreeBase.hxx:484: error: no matching function for call to ‘octomap::OcTreeBase<octomap::OcTreeNodePCL>::genCoordFromKey(short unsigned int&, double&) const’

of my build output, it seems that the error is due to a cast double->float cast problem.
As the function calling genCoordFromKey is in a /opt/ros directory, I'm starting to think I might have found a bug in octomap itself.
Could someone tell me if I am correct? Or am I plainly wrong?
Thanks in advance
Raph

here is the compilation log:
[rosmake-0] Starting >>> pcl_to_octree [ make ]                                                                                                              
[ rosmake ] Last 40 linesl_to_octree: 5.3 sec ]                                                                                   [ 1 Active 43/44 Complete ]
{-------------------------------------------------------------------------------
  -- Build files have been written to: /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build
  cd build && make -l2
  make[1]: Entering directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  make[2]: Entering directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  make[3]: Entering directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  make[3]: Leaving directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  [  0%] Built target rospack_genmsg_libexe
  make[3]: Entering directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  make[3]: Leaving directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  [  0%] Built target rosbuild_precompile
  make[3]: Entering directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  make[3]: Leaving directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  make[3]: Entering directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  [ 14%] Building CXX object CMakeFiles/octree_pcl.dir/src/pcl_to_octree/octree/OcTreePCL.o
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp: In member function ‘unsigned int octomap::OcTreePCL::memoryUsage() const’:
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp:73: warning: ‘void octomap::OcTreeBase<NODE>::getLeafNodes(std::list<std::pair<octomath::Vector3, double>, std::allocator<std::pair<octomath::Vector3, double> > >&, unsigned int) const [with NODE = octomap::OcTreeNodePCL]’ is deprecated (declared at /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/OcTreeBase.hxx:550)
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp: In member function ‘void octomap::OcTreePCL::insertScanUniform(const octomap::ScanNode&, double)’:
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp:224: warning: ‘double octomath::Vector3::norm2() const’ is deprecated (declared at /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/math/Vector3.h:272)
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp:238: warning: ‘octomath::Vector3 octomath::Vector3::unit() const’ is deprecated (declared at /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/math/Vector3.h:289)
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp:251: warning: ‘void octomap::OcTreeBase<NODE>::getLeafNodes(std::list<std::pair<octomath::Vector3, double>, std::allocator<std::pair<octomath::Vector3, double> > >&, unsigned int) const [with NODE = octomap::CountingOcTreeNode]’ is deprecated (declared at /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/OcTreeBase.hxx:550)
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp:254: warning: ‘void octomap::OcTreeBase<NODE>::getLeafNodes(std::list<std::pair<octomath::Vector3, double>, std::allocator<std::pair<octomath::Vector3, double> > >&, unsigned int) const [with NODE = octomap::CountingOcTreeNode]’ is deprecated (declared at /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/OcTreeBase.hxx:550)
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp: In member function ‘octomap::OcTreeNodePCL* octomap::OcTreePCL::getOcTreeNodePCL(octomap::point3d) const’:
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp:323: warning: comparison between signed and unsigned integer expressions
  In file included from /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/OcTreeBase.h:314,
                   from /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/OccupancyOcTreeBase.h:46,
                   from /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/include/pcl_to_octree/octree/OcTreePCL.h:3,
                   from /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp:11:
  /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/OcTreeBase.hxx: In member function ‘bool octomap::OcTreeBase<NODE>::computeRay(const octomap::point3d&, const octomap::point3d&, std::vector<octomath::Vector3, std::allocator<octomath::Vector3> >&) const [with NODE = octomap::OcTreeNodePCL]’:
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp:228:   instantiated from here
  /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/OcTreeBase.hxx:473: warning: comparison is always true due to limited range of data type
  /home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/src/pcl_to_octree/octree/OcTreePCL.cpp:228:   instantiated from here
  /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/OcTreeBase.hxx:484: error: no matching function for call to ‘octomap::OcTreeBase<octomap::OcTreeNodePCL>::genCoordFromKey(short unsigned int&, double&) const’
  /opt/ros/diamondback/stacks/octomap_mapping/octomap/octomap/include/octomap/OcTreeBase.hxx:126: note: candidates are: bool octomap::OcTreeBase<NODE>::genCoordFromKey(const short unsigned int&, float&) const [with NODE = octomap::OcTreeNodePCL]
  make[3]: *** [CMakeFiles/octree_pcl.dir/src/pcl_to_octree/octree/OcTreePCL.o] Error 1
  make[3]: Leaving directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  make[2]: *** [CMakeFiles/octree_pcl.dir/all] Error 2
  make[2]: Leaving directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
  make[1]: *** [all] Error 2
  make[1]: Leaving directory `/home/raph/rosnodes/ROBOT/mojo_dependencies/tum_mapping/pcl_to_octree/build'
-------------------------------------------------------------------------------}

Originally posted by raphael favier on ROS Answers with karma: 1382 on 2011-05-02
Post score: 0

Original comments
Comment by raphael favier on 2011-05-02:
Thanks Dejan. I can wait a bit more if you need ;)
Comment by dejanpan on 2011-05-02:
Raph, give me a couple of hours and I'll fix this. D.

A:

Hey Raphael, run "git pull --rebase" and the fixes shall be there and compile against ros-diamondback-octomap-mapping. I still get some deprecation warning which I will fix after talking to Armin or Kai.
cheers, D.

Originally posted by dejanpan with karma: 1420 on 2011-05-02
This answer was ACCEPTED on the original site
Post score: 0

