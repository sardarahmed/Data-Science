Q:

sudo can't find rospy

We are trying to run a publisher/subscriber on a raspberry pi.
The talker captures keyboard input and the listener takes the key presses and controls LEDs connected to the RasPi pins.
Everything seems to be working fine except for one annoying error.
The listener needs to be run using sudo so it can control the pins.(More info here: https://www.raspberrypi.org/forums/viewtopic.php?f=29&t=22515)
But when I run the listener using sudo, I receive the error "no module named rospy". Rospy works fine when I run the listener without root.
the two commands I'm running are:
python listener2.py
sudo python listener2.py
Is there something else I should be running instead of sudo python?
Thanks!

Originally posted by twigs on ROS Answers with karma: 3 on 2015-11-17
Post score: 0

Original comments
Comment by gvdhoorn on 2015-11-18:
Related: Rosrun as super user.

A:

The issue is almost certainly related to the fact that when you run sudo python listener2.py you are running the "python listener2.py" as a different user. When you source the setup.bash files that are either in your base install, or in a workspace, you are setting up a bunch of environment variables. One of the environment variables that you are modifying is the PYTHONPATH that Python uses to find modules to import. You can see this by opening a new terminal that has not "sourced" any setup.bash files, and run echo $PYTHONPATH. Then run something like source /opt/ros/indigo/setup.bash or source ~/catkin_ws/setup.bash and re-run echo $PYTHONPATH.
If you must run your node using sudo (my guess is there is a way around this... see @DanLazewatsky's answer), then you need to make sure that your environment for the root user is setup correctly. A simple way to do this would be a script that "wraps" the command you are actually trying to run. E.g. see the following bash script:
#!/bin/bash
sudo su
source /opt/ros/indigo/setup.bash
rosrun <PACKAGE> listener2.py

You could also work on editing your sudoers file to preserve relevant environment variables (e.g. PYTHONPATH).

Originally posted by jarvisschultz with karma: 9031 on 2015-11-18
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by gvdhoorn on 2015-11-18:
Really, just don't run anything as root. In almost all cases it's just a matter of permissions, which can almost always be granted to individual users and / or groups. If you must use sudo (but really, don't, ever), invoking it as sudo -H .. is probably the easiest way.
Comment by jarvisschultz on 2015-11-18:
@gvdhoorn is absolutely correct... avoid requiring sudo!

