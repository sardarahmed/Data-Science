Q:

read raw_image compressed uint8[] data

Hello everybody!
I'm trying to read the datas of the "sensor_msgs/CompressedImage" message in a c++ program. Therefore I want to read the uint8[] data array. While using the callback function, nothing is happening (e.g. using ROS_INFO, when there is activity).
When I'm watching the /image_raw/compressed topic, the data array is infinit. That's why I can't predefine an arraysize.
Is there any possibility to get the data into a c++ code to read it separatly?
Thanks
   // ROS ///////////////////////////////////////////
 ros::init(argc, argv, "talker_camera_eye");
ROS_INFO("%s", "start");
    ros::NodeHandle n;
   ros::Subscriber translation_sub = n.subscribe("wc_backdrive/camera_eye/image_raw/compressed", 1000, translateCallback);
ros::Publisher translation_pub = n.advertise<sensor_msgs::CompressedImage>("compressed_image", 1000);
  while (ros::ok())
  { 
translation_pub.publish(testmsg);
ros::spinOnce();
  }
  return 0;
}

//
void translateCallback(const sensor_msgs::CompressedImage::ConstPtr& msg)
{testmsg.data =msg->data;
//perturbedmsg.data = testmsg.data;
ROS_INFO("%s", msg->data.size());ROS_INFO( "test");
for (int i=0; i<msg->data.size();i++){
ROS_INFO( "test");
}

Originally posted by Rosewood on ROS Answers with karma: 43 on 2015-07-29
Post score: 0

Original comments
Comment by cyborg-x1 on 2015-07-29:
You should probably post the code of your node, at least the one of the subscriber setup and the callback.

A:

Very classic problem:
 while (ros::ok())
  { 
translation_pub.publish(testmsg);
 ros::spinOnce(); ///<<< here, btw, spin does the callbacks!
  }
  //ros::spin(); //That is wrong for that purpose ... you need ros::spinOnce above....
  return 0; 

Also try to delete build and devel in your workspace and build it again. Sometimes it also helps, when everything is rebuild.

Originally posted by cyborg-x1 with karma: 1376 on 2015-07-30
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Rosewood on 2015-07-30:
Thanks cyborg,
but he's still not sending data. When I do rostopic echo/image_raw/compressed, the output is data: [255, 216, 255, 224, 0, 16, .... (never ending story) and there is no rosout "test"
Comment by cyborg-x1 on 2015-07-30:
Have you checked for your subscribed topic?
rostopic echo /compressed_image

Of course your output topic will be sending always.
Maybe you should consider adding ros::Rate for a setable publish rate
Also check for image transport subcriber/publisher
Comment by cyborg-x1 on 2015-07-30:
What does rqt_graph say, is it connected?
Comment by Rosewood on 2015-07-30:
The subscribed topic is image_raw/compressed and the output is the data array (see above). The data of my output topic is empty. Rqt says, that my talker node has subscribed for the topic. I think the problem is, that UInt8[] data is a stream.
Comment by cyborg-x1 on 2015-07-30:
No "test" (from your subscriber?) would either mean you still do not receive messages or if
you're starting with launchfiles and forgot to add attribute output="screen" to your node or added output="log" instead. Btw ROS_INFO("test") should work as well, why the "%s"?
Comment by Rosewood on 2015-07-30:
According to rqt and rosnode info the node has subscribed. I'm starting with rosrun. How would you normally get data from image_raw/compressed, respectively from the UINt8[].  And ignore the "%s"..copied from another command :), but thanks for the hint.
Comment by cyborg-x1 on 2015-07-30:
Can you post your current code with the changes for ros::spinOnce?
Comment by cyborg-x1 on 2015-07-30:
Btw. for the image topics it is definitely recommended to use ImageTransport -> http://wiki.ros.org/image_transport
Comment by cyborg-x1 on 2015-07-30:
What you also should try once, is to delete build and devel in your workspace and build it again. Sometimes it also helps, sometimes.
Comment by cyborg-x1 on 2015-07-30:
Does the callback end after ROS_INFO("test") ?
Comment by Rosewood on 2015-07-31:
First of all: it worked after deleting the build and devel folders. Thank you so much! I've tried to get an image on my android teleop app, but it's not working atm. So far, I don't understand the basic topics in image_transport. Could you give an example? It sounds nice.
Comment by cyborg-x1 on 2015-07-31:
If you go down on that page, there is actually an example. Well its that you always can subscribe the image no matter what kind of image transport it is (compressed or not). Just read the page it describes why and where and so on...
Comment by cyborg-x1 on 2015-07-31:
Oh and to work with images in OpenCV you need this: http://wiki.ros.org/cv_bridge
Comment by Rosewood on 2015-08-18:
I have another question. I can view the image of my topic compressed_image/compressed on rviz, but not on android teleop. The teleop subscribes to compressed_image. What can I do to make it runnable for android?

