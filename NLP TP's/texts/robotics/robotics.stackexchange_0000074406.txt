Q:

From 3D to 2D - where to start?

I need to convert some 3D-maps made with rgbdslam/rtabmap-slam into 2D gridmaps, but really don't know where to start. Can someone please answer me some question to get this done?
1.) rgbdslam: can save octomaps over GUI but the file extension of saved files is pcd instead of bt/ot. Why?
2.) read a lot about saving maps while processing with "rosrun map_server map_saver -f filename". Tried that while rgbdslam/rtabmap where running - response is always: "waiting for map". Do I have to install octomap_server into the same workspace as both slams? And if thats the solution, will I finally have a 2D gridmap by running this command?
As you can see on my questions, I'm a newbie. I know this question has been asked and answered multiple times before though i was not able to make it. I would really appreciate it if someone could help me out.
THANK YOU

Originally posted by FTUB on ROS Answers with karma: 3 on 2016-06-08
Post score: 0

Original comments
Comment by matlabbe on 2016-06-08:
rtabmap has proj_map output topic, which is the 3D point cloud projected on the ground: rosrun map_server map_saver map:=/rtabmap/proj_map
Comment by FTUB on 2016-06-08:
Thanks for your reply! Unfortunately still "waiting for map"... rtabmap is running and recording, both are "sourced" from the same setup files.

A:

That's a bug, I thought I already fixed. The workaround is easy though: Just change the extension to .ot in the save dialog.

octomap_server has some capability to downproject the map. See the description of the map topic on its wiki page. Should be easy to subscribe to this topic and save the map. Maybe there is even an existing node for that.

Originally posted by Felix Endres with karma: 6468 on 2016-06-08
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by FTUB on 2016-06-08:
Thanks for the fast reply Felix! Thats exactly my problem, how do I subscribe to a (/the map) topic? I've read this a bunch of times before but haven't found a detailed explanation yet. Do you mind to tell me how to continue with this (or the keywords to look for in ros tutorials)?
Comment by Felix Endres on 2016-06-08:
I recommend you to read the tutorials 6, 10, and 11 or 12. Anything more specific depends on how you want to use the map.
Comment by FTUB on 2016-06-13:
Ok, done. map_saver subscribes now from topic /projected_map, octomap_server provides the data, rqt_graph looks good. But it seems octomap_server doesn't subscribe from rgbdslam: I remapped topic with , but when I press ...
Comment by FTUB on 2016-06-13:
... "send model" in gui, terminal responds with: "no Subscribers, sending of clouds cancelled". rqt_graph only shows one arrow with "tf" headline and that is not a
topic, right? what do I miss?
Comment by Felix Endres on 2016-06-14:
The remap seems correct. Could you post the rqt_graph image? Have you had success saving to file, when specifiying the extension .ot?
Comment by FTUB on 2016-06-14:
rqt-graph: http://imgur.com/iiiA59y
saving octomap with .ot extension works fine. We firstly started rgbdslam+octomap_server+map_saver, recorded an octomap, send model. After sending the model, this error message occurs (from octomap_server): ...
Comment by FTUB on 2016-06-14:
... " MessageFilter [target=/map ]: Dropped 100.00% of messages so far. Please turn the [ros.octomap_server.message_notifier] rosconsole logger to DEBUG for more information."
Comment by Felix Endres on 2016-06-14:
Hm, I don't see where you would have done something wrong. Actually rgbdslam should send the transformations with the clouds, but maybe they are too old for the octomap server to use? I never had this problem though...
Comment by Felix Endres on 2016-06-14:
An alternative workflow, if you are mapping offline, would be to load the saved octomap file on startup of the octomap_server. You just need to add an arg="mapfile.ot" attribute in the node tag in octomap_mapping.launch.
Comment by FTUB on 2016-06-15:
I figured out saving the file as octomap over gui doesn't work: the mentioned workaround works with an octomap downloaded from uni freiburg, but fails when loading a processed octomap from rgbdslam. The error message is:
Comment by FTUB on 2016-06-15:
... [ERROR] [1465988735.566811374]: Could not read OcTree in file, currently there are no other types supported in .ot.
...[ERROR] [1465988735.566877078]: Could not open file /home/ubuntu/rgbdslam_catkin_ws/testmap.ot
Comment by FTUB on 2016-06-15:
I downloaded rgbdslam_v2 from indigo branch, if that makes any difference ...
Comment by Felix Endres on 2016-06-15:
That's because it's a color octomap. Octovis handles them by default, but the octomap server doesn't. You can easily build it from source and activate a define to get it working.
Comment by Felix Endres on 2016-06-15:
Otherwise you'd mostly need to change all occurrences of ColorOcTree to OcTree in rgbdslam's corresponding header  and cpp file.
Comment by FTUB on 2016-06-27:
Thank you very much for your effort, Felix! Now everything works fine.

