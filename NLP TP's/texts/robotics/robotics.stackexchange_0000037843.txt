Q:

laser_assembler not gathering clouds

I've been trying to use laser_assembler package to gather every single cloud that is publish by another node. For this, I've created a client node to define the service needed from the laser_assembler package(included in launch file). However, I still couldn't be able to have the clouds gathered.
The client code:
    void AssemblerClient::useAssembler(const sensor_msgs::LaserScanConstPtr& scan_ptr)
    {
      ROS_INFO("Assembler service is being used");
      ros::service::waitForService("assemble_scans");
      ros::ServiceClient client = n.serviceClient<AssembleScans>("assemble_scans");
      AssembleScans srv;
      srv.request.begin = ros::Time(0);
      srv.request.end   = ros::Time::now();
      if (client.call(srv))
        ROS_INFO("Got cloud with %u points\n", srv.response.cloud.points.size());
      else
        ROS_INFO("Service call failed\n");
    }

In the launch file:
<node type="point_cloud_assembler" pkg="laser_assembler" name="my_assembler">
  <remap from="cloud" to="cloud"/>
  <param name="max_clouds" type="int" value="4000" />
  <param name="fixed_frame" type="string" value="world" />
</node>

<node pkg="pcd_bot" type="assembler_client_node" name="assembler_client_node">
</node>

Am I missing something?
Thanks in advance.
EDIT
No error at all I receive but in the rviz, I even cannot choose/tick for "assemble_scans" topic of type PointCloud.
I've added the following 2 lines at the bottom of the above code snippet(but still doesn't work):
gathered_cloud = srv.response.cloud;
gathered_cloud_publisher_.publish(gathered_cloud);

Originally posted by alfa_80 on ROS Answers with karma: 1053 on 2012-02-13
Post score: 2

Original comments
Comment by DimitriProsser on 2012-02-13:
What is the error exactly?'
Comment by DimitriProsser on 2012-02-13:
What is the error exactly?
Comment by alfa_80 on 2012-02-13:
No error at all but in the rxconsole I receive this info "Got cloud with 0 points" and in the rviz of course, it displays only one scan line. In the rviz, I even cannot choose/tick for "assemble_scans" topic.
Comment by alfa_80 on 2012-02-13:
@DimitriProsser: Do I need to subscribe explicitly to the "assemble_scans" topic that has been provided by laser_assembler package?
Comment by alfa_80 on 2012-02-13:
Supposedly, will the laser_assembler publish a topic on "assemble_scans"? When I rostopic list, I didn't see the "assemble_scans" listed.
Comment by arebgun on 2012-02-13:
@alfa_80 assemble_scans is not a topic it's a service, and you can't subscribe to it to see the assembled cloud. In your code you correctly printing out the cloud size, you can choose to publish this cloud on some topic. But it looks like the resulting cloud has 0 points, so there's some other issue
Comment by arebgun on 2012-02-13:
For example, pr2_laser_snapshotter (which uses the assemble_scans service) publishes assembled clouds when the tilting laser does a full up-down sweep.
Comment by alfa_80 on 2012-02-13:
@arebgun & @DimitriProsser: At the end, I got this  in the rxconsole "Got cloud with 89280 points
", It just needs a little bit time to get that. But then, why I cannot choose "assemble_scans" in rviz of type PointCloud? Any idea on how to resolve this?
Comment by alfa_80 on 2012-02-13:
@arebgun: As you said, "you can choose to publish this cloud on some topic..." Do you mean, I've to publish it? But then, where is the assembled cloud gathered? How do I access this?
Comment by arebgun on 2012-02-13:
Yes, you have to publish it yourself. Right after successful call to assemble_scans service, you can publish the cloud that you get back, the same cloud that you are printing the size of (stored in srv.response.cloud).
Comment by DimitriProsser on 2012-02-13:
Did adding the publisher fix the issue?
Comment by alfa_80 on 2012-02-13:
It's fixed for the thing to be ticked/choosen in the rviz but still not fixed for getting the assembled gathered cloud over time..
Comment by jojonmarijon on 2022-11-16:
Hi, I'm curious if there is a way to debug why my point cloud stays 0, I've been waiting for a while but seems like it never actually add anything

A:

The reason that you are not seeing any data published in Rviz is that laser_assembler does not publish the resulting compiled cloud. In your assembler client, you must perform the publishing yourself. You can obtain the resulting cloud from srv.response.cloud and then publish it with a standard publisher. This will allow you to visualize in Rviz.

Originally posted by DimitriProsser with karma: 11163 on 2012-02-13
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by alfa_80 on 2012-02-13:
I've added 2 lines of code as my update above. I can now tick to "gathered_cloud", but, only one static scan line appears in the rviz.
Comment by DimitriProsser on 2012-02-13:
Does the laser scanner move? If it doesn't, all the scans will overlap and it will look like a single scan.
Comment by alfa_80 on 2012-02-13:
Yes, the laser scanner is moving around. I don't think they overlap at the moment.
Comment by DimitriProsser on 2012-02-13:
Is the transform also moving? Also, is the "cloud" topic in the same frame as the moving sensor?
Comment by alfa_80 on 2012-02-13:
Yes, the transform is moving. The cloud(in fact, it's only one scan line) is static while the base_link and laser are moving.
Comment by DimitriProsser on 2012-02-13:
The cloud data is in the form of (x, y, z) with respect to a certain frame. If that frame is not moving, the cloud will not move.
Comment by alfa_80 on 2012-02-13:
It somehow works when I change the fixed_frame value for the laser_assembler parameter in the launch file, however, the cloud is not linearly gathered. I think it could be the problem with TF.
Comment by alfa_80 on 2012-02-13:
Should the cloud be moving? It's too difficult then, to see every good changes/addition in the cloud frame over time. And, we don't need to define cloud frame right?
Comment by DimitriProsser on 2012-02-14:
The cloud must have a frame to reference. If you have a tilting scanner (like the pr2 for example), and you assemble the cloud with respect to base_link, you will see a 3D profile of the room. The cloud's position in the world doesn't normally change, but it depends on your application.
Comment by alfa_80 on 2012-02-14:
Thanks anyway..

