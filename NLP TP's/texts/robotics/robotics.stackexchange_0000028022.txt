Q:

ConnectDeleteEntity event doesn't work in World Plugin

Hello everybody,
I want to make a world plugin with events callback, everything work perfectly except the ConnectDeleteEntity event.
With the following code, when we create a model, we get a "Add" message (the function "OnAddEntity" is called) but when remove a model (for example, by selecting a model and pressing the Delete Key, or with the menu), the function "OnDeleteEntity" is not called.
    namespace gazebo{
        struct PluginGazebo : public WorldPlugin {      
            //----------------------------------
            event::ConnectionPtr DeleteEntityConnection;
            event::ConnectionPtr AddEntityConnection;
            //----------------------------------
            void OnDeleteEntity(const std::string str){
                std::cerr << "Delete " << str << std::endl;
            }
            //----------------------------------
            void OnAddEntity(const std::string str){
                std::cerr << "Add " << str << std::endl;
            }
            //----------------------------------
                virtual void Load(physics::WorldPtr _world, sdf::ElementPtr _sdf){
                //--
                    this->DeleteEntityConnection = event::Events::ConnectDeleteEntity(boost::bind(&PluginGazebo::OnDeleteEntity, this, _1)); 
                    this->AddEntityConnection = event::Events::ConnectAddEntity(boost::bind(&PluginGazebo::OnAddEntity, this, _1)); 
                }
        };

        GZ_REGISTER_WORLD_PLUGIN(PluginGazebo)
    }

When OnDeleteEntity should be called ?
Thanks.

Originally posted by Benoit on Gazebo Answers with karma: 3 on 2017-01-31
Post score: 0

A:

It looks like the deleteEntity event is never being fired by Gazebo, which is a bug. I ticketed an issue here.
A workaround for now would be to subscribe to the ~/request topic and check if _msg->request() == "entity_delete", see an example here.

Originally posted by chapulina with karma: 7504 on 2017-01-31
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Benoit on 2017-02-01:
Your workaround works perpectly ! Thanks a lot.

