Q:

Best way to save ROS 2 topic messages to text file in Python callback?

I would like to save a ROS 2 topic message into a text file in a Python callback.
I can use a csv.DictWriter if I first convert the message into a dictionary. Is there a better way of converting a message into a dictionary rather than iterating over msg._fields_and_field_types? I cannot use vars() since the message does not have a dict attribute and uses slots instead. Is it safe to rely on _fields_and_field_types in future ROS distributions or is it considered private and it is not reliable to access outside the class?
Is there a better way of saving messages to a text file in a Python callback? Thanks!
def _callback(self, msg):
    msg_dict = {field: getattr(msg, field) for field in msg._fields_and_field_types}
    self.csv_dict_writer.writerow(msg_dict)

Originally posted by peterpolidoro on ROS Answers with karma: 49 on 2020-02-05
Post score: 0

A:

The package rosidl_runtime_py provides some utilities for converting messages
Some of them may be useful for your use case:

message_to_ordereddict https://github.com/ros2/rosidl_runtime_py/blob/22cd67c09d948a7a67615fee410c8c22d036fdb5/rosidl_runtime_py/convert.py#L155-LL156
message_to_csv: https://github.com/ros2/rosidl_runtime_py/blob/22cd67c09d948a7a67615fee410c8c22d036fdb5/rosidl_runtime_py/convert.py#L97

Is it safe to rely on _fields_and_field_types in future ROS distributions or is it considered private and it is not reliable to access outside the class?

My understanding is that these are considered private and thus discouraged for use outside the class.

Originally posted by marguedas with karma: 3606 on 2020-02-05
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by peterpolidoro on 2020-02-05:
Oh perfect, that is much better than converting it myself. That looks like a fantastic package, thank you so much!

