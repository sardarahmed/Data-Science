Q:

Compiling ROS Kinetec from source fails when building image_proc

I'm using an Arch machine and trying to compile ROS desktop full from source. The build fails when image_proc is trying to link executable.
Here is the error log:
[ 23%] Built target image_proc_gencfg
[ 84%] Built target image_proc
[ 92%] Linking CXX executable /home/alphayed/ROS/ros_catkin_ws/devel_isolated/image_proc/lib/image_proc/image_proc
/home/alphayed/ROS/ros_catkin_ws/install_isolated/lib/libopencv_viz3.so.3.1.0: undefined reference to `vtkSTLReader::New()'
/home/alphayed/ROS/ros_catkin_ws/install_isolated/lib/libopencv_viz3.so.3.1.0: undefined reference to `vtkOBJReader::New()'
collect2: error: ld returned 1 exit status
make[2]: *** [CMakeFiles/image_proc_exe.dir/build.make:219: /home/alphayed/ROS/ros_catkin_ws/devel_isolated/image_proc/lib/image_proc/image_proc] Error 1
make[1]: *** [CMakeFiles/Makefile2:68: CMakeFiles/image_proc_exe.dir/all] Error 2
make: *** [Makefile:139: all] Error 2

I think the problem is related to opencv3. I removed it from the system and recompiled it from source but that didn't solve the issue. Can you please help?

Originally posted by alphayed on ROS Answers with karma: 3 on 2016-12-27
Post score: 0

A:

modify opencv3/cmake/OpenCVDetectVTK.cmake, for every find_package(VTK QUIET COMPONENTS ... add an entry vtkIOGeometry
This works for me

Originally posted by ZOU Lu with karma: 143 on 2017-01-08
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by alphayed on 2017-01-09:
Thank you, that worked. Can you please explain what this fix does if you don't mind?
Comment by ZOU Lu on 2017-01-09:
I suppose vtk has changed its structure in the new version, e.g. move vtkOBJReader into a sub library vtkIOGeometry, so you have to tell cmake to find vtkIOGeometry if you want to use that class.
Arch always uses the newest, that's why you'll encounter such issue earlier than others.
Comment by ZOU Lu on 2017-01-09:
BTW, I hate vtk, they love to change things, always like playing a solo
Comment by alphayed on 2017-01-09:
I hear you vtk has been causing me lots of issues during this build.

