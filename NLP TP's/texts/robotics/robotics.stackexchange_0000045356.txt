Q:

PCLVisualizer within a ROS node does not respond

Dear all,
I want to visualize my pointcloud data and some objects within a ROS node. The node receives the data via a ROS Topic. The problem I have is how to integrate the viewer properly. In the main class I am using a member variable for the viewer and one thread which should update the view.
boost::shared_ptr<boost::thread> visualizer_thread_;
boost::shared_ptr<pcl::visualization::PCLVisualizer> viewer_;

In the constructor of my class (basically a segmentation class) I initialize the viewer and start the thread to do the update.
 viewer_= boost::make_shared<pcl::visualization::PCLVisualizer>("Cylinder Viewer");
 visualizer_thread_.reset(new boost::thread(boost::bind(&CylinderSegmentation::visualize,this)));

In the visualization thread I do basically an spin operation on the view
/** Visualizer Thread for the objects
*
*/
void visualize(){
   ros::Rate r(40);
   viewer_->setBackgroundColor(10.5,0.5,1.0);
   viewer_->addCoordinateSystem(1.0);     
   while (!viewer_->wasStopped()){
      viewer_->spinOnce();
      r.sleep();
   }     
   std::cout<<"Stopped the Viewer"<<std::endl;
 }

When I close the viewer window, I receive the message "Stopped the Viewer" but the window does not close. I cannot even add something to the window to be shown. Is there something wrong I do about the usage of the PCLViewer?
Cheers,
Markus

Originally posted by Markus Eich on ROS Answers with karma: 202 on 2012-10-30
Post score: 3

A:

Hi Markus,
I had the same problem. I solved it by creating the visualizer in my thread function, e.g. your visualize(). Would be interesting to know the reason of this problem.
Cheers,
Christian

Originally posted by christiank with karma: 113 on 2012-11-21
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by vkee on 2016-06-30:
Could you post an example? I'm dealing with the same issue. Thanks!
Comment by jtim on 2017-01-23:
@vkee did you get it working?
Comment by vkee on 2017-01-23:
@jtim Yes I did. I modified https://github.com/dirkholz/pcl_online_viewer.
Comment by jtim on 2017-01-23:
Thanks found another way quite simple http://stackoverflow.com/a/41814275/2076775

