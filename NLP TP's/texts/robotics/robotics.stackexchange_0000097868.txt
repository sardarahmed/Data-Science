Q:

stopping rosbag record from script

I have a python subprocess that starts recording a topic through rosbag:
    self.ros_bag_recorder = subprocess.Popen(['rosbag', 'record', '-O',
                                             os.path.expanduser('~/some_address),
                                             '/the_topic'],
                                            env=self.venv,
                                            stdout=subprocess.PIPE,  
                                            stderr=sys.stderr
                                             ) 

which normally I would have executed in a terminal and after pressing ctrl+c the recording was stopped ( the bag file from .bag.active would have changed to .bag).
However now that I have started it through suprocess and want to also stop it with an script rather than terminal, commands such as followings haven't worked:
    self.ros_bag_recorder.send_signal(signal.SIGTERM)

or
    self.ros_bag_recorder.send_signal(signal.SIGKILL)

or
    self.ros_bag_recorder.send_signal(signal.SIGINT)

Does anyone know a way to stop the recording similar to when we just press ctrl+c in terminal?

Originally posted by azerila on ROS Answers with karma: 25 on 2020-12-17
Post score: 0

A:

As answered to another similar question (https://answers.ros.org/question/286871/how-record-rosbag-with-python/), you can kill it by running this:
for proc in psutil.process_iter():
    if "record" in proc.name() and set(command[2:]).issubset(proc.cmdline()):
        proc.send_signal(subprocess.signal.SIGINT)

self.ros_bag_recorder.send_signal(subprocess.signal.SIGINT)

Originally posted by gstavrinos with karma: 641 on 2020-12-17
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by azerila on 2020-12-17:
is 'command' the same as the command that was used as input to Popen?
Comment by gstavrinos on 2020-12-17:
Yes, exactly.

