Q:

royale-ros: errors when linking with royale SDK libraries

I am trying to build the ROS package royale-ros.
I installed the most recent royale SDK as described here as a debian package.
When I try to build the package with catkin_make as described here, I get the following errors while linking:
dominik@ubuntu:~/catkin_ws/royale$ catkin_make 
Base path: /home/dominik/catkin_ws/royale
Source space: /home/dominik/catkin_ws/royale/src
Build space: /home/dominik/catkin_ws/royale/build
Devel space: /home/dominik/catkin_ws/royale/devel
Install space: /home/dominik/catkin_ws/royale/install
####
#### Running command: "make cmake_check_build_system" in "/home/dominik/catkin_ws/royale/build"
####
####
#### Running command: "make -j1 -l1" in "/home/dominik/catkin_ws/royale/build"
####
[  0%] Built target _royale_ros_generate_messages_check_deps_Config
[  0%] Built target std_msgs_generate_messages_cpp
[  0%] Built target _royale_ros_generate_messages_check_deps_Stop
[  0%] Built target _royale_ros_generate_messages_check_deps_SetExposureTime
[  0%] Built target _royale_ros_generate_messages_check_deps_Dump
[  0%] Built target _royale_ros_generate_messages_check_deps_Start
[  0%] Built target _royale_ros_generate_messages_check_deps_ExposureTimes
[  4%] Generating C++ code from royale_ros/ExposureTimes.msg
[  8%] Generating C++ code from royale_ros/SetExposureTime.msg
[ 12%] Generating C++ code from royale_ros/Start.srv
[ 16%] Generating C++ code from royale_ros/Config.srv
[ 20%] Generating C++ code from royale_ros/Dump.srv
[ 25%] Generating C++ code from royale_ros/Stop.srv
[ 25%] Built target royale_ros_generate_messages_cpp
Scanning dependencies of target config
[ 29%] Building CXX object royale/CMakeFiles/config.dir/src/config.cpp.o
Linking CXX executable /home/dominik/catkin_ws/royale/devel/lib/royale_ros/config
[ 29%] Built target config
Scanning dependencies of target dump
[ 33%] Building CXX object royale/CMakeFiles/dump.dir/src/dump.cpp.o
Linking CXX executable /home/dominik/catkin_ws/royale/devel/lib/royale_ros/dump
[ 33%] Built target dump
Linking CXX executable /home/dominik/catkin_ws/royale/devel/lib/royale_ros/lscam
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `VTT for std::__cxx11::basic_stringstream<char, std::char_traits<char>, std::allocator<char> >@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::logic_error::logic_error(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_assign(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::logic_error::logic_error(std::logic_error const&)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::reserve(unsigned long)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::length_error::length_error(char const*)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::out_of_range::out_of_range(char const*)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::resize(unsigned long, char)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `vtable for std::__cxx11::basic_ostringstream<char, std::char_traits<char>, std::allocator<char> >@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libspectre3.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_erase(unsigned long, unsigned long)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::logic_error::logic_error(char const*)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::invalid_argument::invalid_argument(char const*)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__throw_out_of_range_fmt(char const*, ...)@GLIBCXX_3.4.20'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_append(char const*, unsigned long)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_stringstream<char, std::char_traits<char>, std::allocator<char> >::~basic_stringstream()@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::runtime_error::runtime_error(char const*)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libspectre3.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_construct(unsigned long, char)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::logic_error::logic_error(std::logic_error const&)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libspectre3.so: undefined reference to `__cxa_throw_bad_array_new_length@CXXABI_1.3.8'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::runtime_error::runtime_error(std::runtime_error const&)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `vtable for std::__cxx11::basic_stringstream<char, std::char_traits<char>, std::allocator<char> >@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `vtable for std::__cxx11::basic_stringbuf<char, std::char_traits<char>, std::allocator<char> >@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_create(unsigned long&, unsigned long)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::basic_istream<char, std::char_traits<char> >& std::getline<char, std::char_traits<char>, std::allocator<char> >(std::basic_istream<char, std::char_traits<char> >&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, char)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_stringbuf<char, std::char_traits<char>, std::allocator<char> >::_M_sync(char*, unsigned long, unsigned long)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_stringstream<char, std::char_traits<char>, std::allocator<char> >::basic_stringstream(std::_Ios_Openmode)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::basic_istream<char, std::char_traits<char> >& std::operator>><char, std::char_traits<char>, std::allocator<char> >(std::basic_istream<char, std::char_traits<char> >&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_ostringstream<char, std::char_traits<char>, std::allocator<char> >::~basic_ostringstream()@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `vtable for std::__cxx11::basic_istringstream<char, std::char_traits<char>, std::allocator<char> >@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::compare(char const*) const@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_stringbuf<char, std::char_traits<char>, std::allocator<char> >::str() const@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::swap(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)())@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `VTT for std::__cxx11::basic_ostringstream<char, std::char_traits<char>, std::allocator<char> >@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_istringstream<char, std::char_traits<char>, std::allocator<char> >::~basic_istringstream()@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `VTT for std::__cxx11::basic_istringstream<char, std::char_traits<char>, std::allocator<char> >@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::~basic_string()@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_replace(unsigned long, unsigned long, char const*, unsigned long)@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libspectre3.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::compare(unsigned long, unsigned long, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::find(char const*, unsigned long, unsigned long) const@GLIBCXX_3.4.21'
/opt/libroyale-3.12.0.44-LINUX-x86-64Bit/bin/libroyale.so: undefined reference to `std::runtime_error::runtime_error(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&)@GLIBCXX_3.4.21'
collect2: error: ld returned 1 exit status
make[2]: *** [/home/dominik/catkin_ws/royale/devel/lib/royale_ros/lscam] Error 1
make[1]: *** [royale/CMakeFiles/lscam.dir/all] Error 2
make: *** [all] Error 2
Invoking "make -j1 -l1" failed

How can I fix this error? Is it an error caused by royale or do I have the wrong version of GLIBCXX_3.4.21 installed?
apt-show-versions libstdc++6 shows the following:
libstdc++6:amd64/trusty 7.2.0-1ubuntu1~14.04 uptodate
strings /usr/lib/x86_64-linux-gnu/libstdc++.so.6 | grep GLIBCXX contains GLIBCXX_3.4.21:
GLIBCXX_3.4
GLIBCXX_3.4.1
GLIBCXX_3.4.2
[...]
GLIBCXX_3.4.20
GLIBCXX_3.4.21
GLIBCXX_3.4.22
GLIBCXX_3.4.23
GLIBCXX_3.4.24
GLIBCXX_DEBUG_MESSAGE_LENGTH

I'm using Ubuntu 14.04 on a virtual machine with freshly installed ROS Indigo.
GCC --version is gcc (Ubuntu 4.8.4-2ubuntu1~14.04.3) 4.8.4.
I have been researching the whole day and can't find a solution. I think I don't have enough knowledge about C++, make and ROS to find the solution myself. Any help would be very appreciated!

Originally posted by thedomdom on ROS Answers with karma: 1 on 2018-02-16
Post score: 0

Original comments
Comment by gvdhoorn on 2018-02-16:
Is this a cross-post of lovepark/royale-ros#2?
Comment by thedomdom on 2018-02-16:
Yes, it is a cross-post. I'm a little bit frustrated tbh.
The problem is, that they can't really help me.
Furthermore, I get a similar (also GLIBCXX_3.4.21 related error), when I try to use this library: https://github.com/code-iai/pico_flexx_driver.
So you think that it is a royale error?
Comment by gvdhoorn on 2018-02-17:
Btw: this situation (with your cross-post on the royale-ros issue tracker and one here) is exactly why cross-posts are frowned upon: both me (and by extension the ROS Answers community) and the royale-ros devs are now suggestion possible solutions, without knowing this from one another.
Comment by gvdhoorn on 2018-02-17:
I was about to try and see whether I could quickly check what is going wrong with the royale-ros pkgs with the 3.11 SDK, but, apart from the fact that I don't appear to be able to access the SDK, I also just read that a royale-ros dev is going to do the exact same thing. I realise that ..
Comment by gvdhoorn on 2018-02-17:
.. from your perspective having multiple people try and troubleshoot your issue looks like a good thing, but in reality it's essentially just duplicated (and wasted) effort for me and the royale-ros dev.

A:

This could be an incompatibility between the libraries provided by the SDK (libroyale-3.12.0.44-LINUX-x86-64Bit) and the objects output by the compiler on your own system. I would think the developers of the package should be able to help you best.

Edit:

Furthermore, I get a similar (also GLIBCXX_3.4.21 related error), when I try to use this library: https://github.com/code-iai/pico_flexx_driver.

That last pkg seems to depend on the same Royale SDK, so seeing the same errors doesn't surprise me.
You write you run Ubuntu 14.04, did you install any additional/upgraded compilers/libstdc++ pkgs?
Do you know whether the SDK is supposed to be compatible?
Can you check a clean Docker container?

Edit2:

So I tried to use royale-ros and with the royale version 3.11 but unfortunately it did not work.
The error was  ld: cannot find -lroyale [..]

That sounds like a linker (search) path error.

even if I installed royale with dpkg.

that doesn't really make it special, so I'm not surprised.

Originally posted by gvdhoorn with karma: 86574 on 2018-02-16
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by thedomdom on 2018-02-16:
Yes, I upgraded libstdc++6. apt-show-versions libstdc++6 showed the following (but did not work either):
libstdc++6:amd64/trusty 4.8.4-2ubuntu1~14.04.3 upgradeable to 7.2.0-1ubuntu1~14.04
Apart from that, I did not install or upgrade any compiler.
Comment by thedomdom on 2018-02-16:
Yes, the SDK should be compatible to Ubuntu 14.04. At least the pmd developers write in their  README.md that this Royale version has been tested on Ubuntu 14.04 and Ubuntu 16.04.
EDIT: You are right, the 3.12 version is not compatible to Ubuntu 14.04. I looked in the readme of version 3.11.
Comment by gvdhoorn on 2018-02-16:
Using the 3.11 version it does work? Could be a C++11 vs C++03 ABI problem.
Comment by thedomdom on 2018-02-17:
So I tried to use royale-ros and with the royale version 3.11 but unfortunately it did not work.
The error was  ld: cannot find -lroyale even if I installed royale with dpkg.
I also tried out pico_flexx_driver with 3.11 but there was another error.
Comment by thedomdom on 2018-02-17:
I am now just using the sampleROS driver from the 3.11 royale SDK and it works fine (I an see the point cloud in rviz).

