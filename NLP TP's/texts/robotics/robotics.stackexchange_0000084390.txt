Q:

How do I generate a dynamic config module that depends on a message defined in the same package?

The CMakeLists.txt looks like this:
add_message_files(DIRECTORY msg FILES SensorLevels.msg)
generate_messages()
generate_dynamic_reconfigure_options(cfg/Camera1394.cfg)
catkin_package(CATKIN_DEPENDS dynamic_reconfigure message_runtime etc...)

The build fails the first time, like this:
Errors     << camera1394:make /home/joq/ros/ws/logs/camera1394/build.make.009.log                
Traceback (most recent call last):
  File "/home/joq/ros/ws/src/camera1394/cfg/Camera1394.cfg", line 37, in <module>
    from camera1394.msg import SensorLevels
ImportError: No module named msg
make[2]: *** [/home/joq/ros/ws/devel/.private/camera1394/include/camera1394/Camera1394Config.h] Error 1
make[1]: *** [CMakeFiles/camera1394_gencfg.dir/all] Error 2

Running the build again succeeds. Somehow, I need to force gencfg to wait on message generation.

Originally posted by joq on ROS Answers with karma: 25443 on 2017-12-22
Post score: 1

A:

You will need to add an explicit dependency in CMake between the two steps to ensure that the message generation happens before the .cfg file is being invoked.
dynamic_reconfigure uses the OUTPUT signature a add_custom_command which is not a CMake target and can therefore not easily be dependent on. I think generate_dynamic_reconfigure_options would need to support an optional parameter to pass the expected header file <somewhere>/include/camera1394/Camera1394Config.h here: https://github.com/ros/dynamic_reconfigure/blob/17e1d4bf6a538d2def097a7f70b139ccd41e9f78/cmake/dynamic_reconfigure-macros.cmake#L58

Originally posted by Dirk Thomas with karma: 16276 on 2017-12-22
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by joq on 2017-12-23:
Thanks, Dirk. I suspected that was the case, but wanted to ask before giving up on that approach.

