Q:

REP 120: not clear about odom and base_footprint

Hi,
I have question, on odom and base_footprint, especially when the robot is falling down or 4-legged walking in  REP 120.
I assume that humanoid robot did not know about the current waist position, but can estimate orientation from IMU sensors.

does odom correspond to the sensor based orientation and world reference based position of the waist?
does base_footprint respect the sensor based orientation and model based calculation of the height of the waist?

if it is ok, the question is

how do you estimate the position of the odom, from the walking controllers? does that include any sensor data?
does base_footprint does not reflect any sensor data? what's happens if the robot falling down or 4-legged walking mode?

Originally posted by Kei Okada on ROS Answers with karma: 1186 on 2013-10-27
Post score: 3

A:

Dear Okasa-san,
as for mobile robots, every frames on top of base_link are actively relying on the localization / SLAM node and therefore the result you will obtain will depend in these particular cases will depend on how it behaves.
In my case, I use robot_pose_ekf (on HRP2) so that I both combine the integration of the command and the IMU data. The odom is published by this node like on PR2.
For base_footprint, I use the point defined as the center of the robot soles center. If you walk on non-flat floor, of course you have to project this point at the right height depending on your perception. This is not an issue on flat-floor although.
This definition works fine for any number of legs.
If the robot is falling then of course the "footprint" is not really a footprint anymore but it is still defined (mathematically speaking). As for the odom frame, by changing the covariance matrices appropriately you can only integrate the IMU data when you fall to get an estimate of your position.
P.S. FYI the robot_pose_ekf node input is an odometry message sent by the robot controller (hrpsys in my case).

Originally posted by Thomas with karma: 4478 on 2013-10-27
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by Kei Okada on 2013-10-28:
Thanks, so what is the tf structure ?
map -> odom -> robot_pose_ekl -> base_link -> base_footprint?
Comment by Kei Okada on 2013-10-28:
Another question is that , the orientation of the the robot is not precisely equal to (0 0 1), as there are elastic material on the sole and ankle, also mechanical backlash, in that case, does 'base_footprint' orientation is (0 0 1)? or it should correspond to real orientation of the robot?
Comment by Thomas on 2013-10-28:
The frame hiearchy is here:
http://www.ros.org/reps/rep-0120.html#id17 and http://www.ros.org/reps/rep-0105.html#relationship-between-frames
I.e.
map -> odom -> base_link -> base_footprint
You would observe a different behavior on PR2 but PR2 does not follow REP 105 unfornately.
Comment by Thomas on 2013-10-28:
The base_footprint rotational part is undefined in the current state of the REP. IMHO this is not the best frame to express contacts so I would keep the rotational part to identity if I were you. That does not prevent you to add additional tf frames to express contact points position.

