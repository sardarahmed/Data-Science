Q:

ROS Answers SE migration: rostest on pr2

Is it possible to use rostest on the PR2?
I'm running them fine in simulation with pr2_gazebo. When I run on the real PR2 (of course without pr2_gazebo) I see:
[FATAL] [1405106407.155258687]: Could not load the xml from parameter server: robot_description
[ERROR] [1405106407.155347537]: Could not load robot model. Are you sure the robot model is on the parameter server?
My guess is it has something to do with the ROS IP address changing that rostest does, but I'm not sure. Many thanks for any help.
Basic info:

Ubuntu 12.04
ROS Groovy
rosbuild
python

Originally posted by mbforbes on ROS Answers with karma: 70 on 2014-07-11
Post score: 1

A:

rostest is specifically designed not to interfere with a running ROS system, and to be stateless. To achieve this, it runs its own roscore on a different port. There is currently no way to turn off this feature.
What this means is that your test files must do everything to set up the parameters, environment and any simulation or robot that your test needs in order to run.
I suspect that your original test had an include for the PR2 launch file, and you simply removed that when trying to run it on a real robot. This approach fails, because your nodes will now be running on a separate roscore, without a robot to talk to at all.
Instead, I recommend setting up three launch/rostest files:

A core test which includes the nodes you're testing, and your test nodes
A simulation rostest file which sets up the simulation by including the appropriate PR2 gazebo launch files, and then includes your core test file (#1)
An optional PR2 rostest file which includes the PR2 launch file (the one normally run by robot start), and your core test file (#1)

Your simulation test is then simply invoking rostest #2
If you want to run your tests on a real robot, you have a few choices:

Start the robot normally, and use roslaunch to run your core test file (#1). This will run all of the regular nodes in that file, but not the test nodes
Stop the robot, and use rostest to run your PR2 rostest file (#3). This file will then start all of the PR2 processes, and along with your nodes and tests, run them, and produce a test result.

Originally posted by ahendrix with karma: 47576 on 2014-07-11
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by mbforbes on 2014-08-10:
Thanks for the thorough answer! I think #3 was the key insight that helped me.

