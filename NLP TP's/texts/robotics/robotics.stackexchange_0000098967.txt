Q:

rtabmap icp_odometry.cpp:453::callbackCloud() fatal error

Hello everyone,
I get a strange error that I did not get before, I formated my laptop and rebuilt rtabmap and now I get this error while i play the same bagfile with the same parameters.
[FATAL] (2021-05-01 17:59:54.099) icp_odometry.cpp:453::callbackCloud() Condition (pointCloudMsg->data.size() == pointCloudMsg->row_steppointCloudMsg->height) not met! [data=288222 row_step=0 height=1]
terminate called after throwing an instance of 'UException'
what():  [FATAL] (2021-05-01 17:59:54.099) icp_odometry.cpp:453::callbackCloud() Condition (pointCloudMsg->data.size() == pointCloudMsg->row_steppointCloudMsg->height) not met! [data=288222 row_step=0 height=1]
This is the error and the pointcloud2 was recorded from a rosbag record command and the topic was comming from the velodyne pointcloud package, any ideas??

Originally posted by Ifx13 on ROS Answers with karma: 54 on 2021-05-01
Post score: 0

Original comments
Comment by miura on 2021-05-01:
Is there a package that you did not install when you rebuilt? Are there any other errors that occurred before the error in question, such as a node not being found and not starting?
Comment by Ifx13 on 2021-05-01:
This is a fatal error occurred for the same reason, explaining what actually changed.
http://official-rtab-map-forum.67519.x6.nabble.com/Condition-scan3dMsg-data-size-scan3dMsg-row-step-scan3dMsg-height-not-met-td7852.html
Comment by miura on 2021-05-01:
I'm glad you were able to find the cause. For those who will follow, it would be good to include it in your answer and check it for resolution.

A:

For everyone experiencing something similar with me here is the cause and the suggested solutions!
http://official-rtab-map-forum.206.s1.nabble.com/Condition-scan3dMsg-data-size-scan3dMsg-row-step-scan3dMsg-height-not-met-td7852.html

Originally posted by Ifx13 with karma: 54 on 2021-05-02
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by jtoobias on 2021-05-06:
I looked at the solutions but what did you do to fix it? Change the Velodyne code? If so how so that it still works, or Did you change the RTABmap code?
Any help will be greatly appreciated as I don't want to choose the wrong method.
Comment by Ifx13 on 2021-05-07:
If you've built from source, you will find at catkin_ws/src/rtabmap_ros/src the scripts that are mentioned. If you look at this link you will find what's new. All I did was to comment out the assertions at the MsgConversion.cpp and at nodelets/icp_odometry.cpp and then recompile.
But this is an issue of how the data are recorded. I noticed at the github page of velodyne that there was mentioned an issue for the row step and a fix was made but I renewed the package and the row_step was still 0.
Comment by matlabbe on 2021-05-12:
I made a pull request: https://github.com/ros-drivers/velodyne/pull/404
A workaround with current binaries is to set organize_cloud:=true when launching the velodyne launch file.

