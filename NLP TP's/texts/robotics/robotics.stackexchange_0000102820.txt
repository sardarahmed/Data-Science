Q:

Very Confusing Float64MultiArray Error

I get rospy.exceptions.ROSSerializationException: field data[] must be float type in terminal
When I rostopic echo a topic recieving Float64MultiArray message. This is a snippet of my python code:
M = Float64MultiArray()
Tab=np.zeros((11521,10))
Values in Tab are manipulated,some are int, some are float.
M.data=(Tab.astype(float)).tolist()
pub.publish(M)

I don't get it, M.data is of type float. is Tab too big?

Originally posted by distro on ROS Answers with karma: 167 on 2022-12-15
Post score: 0

Original comments
Comment by AlessioParmeggiani on 2022-12-15:
Did you try creating the array by setting explicitly the type: Tab=np.zeros((11521,10),dtype=np.float64)?
Comment by distro on 2022-12-15:
@AlessioParmeggiani This still gives the same error

A:

The .tolist() call is not doing what you think it is. If you want to flatten a 2d np.ndarray to a 1d list, use the ravel() method of ndarray.
M.data = Tab.astype(float).ravel()

For a good discussion, see:
https://stackoverflow.com/questions/22021939/numpy-reshaping-an-array-to-1-d

Originally posted by Mike Scheutzow with karma: 4903 on 2022-12-18
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by distro on 2022-12-18:
@Mike Scheutzow This flattens all elements to a list like [x y z d]. I want to publish this [ [x y],[z d] ]. Maybe it's not possible?
Comment by ljaniec on 2022-12-18:
You can easily adapt it in a few lines though, why is it a problem? Flatten it to 1D list, then create a 2D list with np.reshape
Comment by distro on 2022-12-18:
@ljaniec "facepalm" thanks! I'll try that
Comment by Mike Scheutzow on 2022-12-19:
I want to publish this [ [x y],[z d] ]
No, that is not possible with this message. From the message definition: data must be a 1d array of float64.
Comment by ljaniec on 2022-12-19:
Good note, the ROS message definition matters here. This transformation should be in the subscriber callback if wanted.

