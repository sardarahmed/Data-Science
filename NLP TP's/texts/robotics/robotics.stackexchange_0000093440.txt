Q:

My balls are in a perpetual motion in gazebo

Hi, I am trying to modelize a robot for testing in gazebo, but I get trouble whith him staying still.
The simplifiate version i use is compose of a square base (base_link), two balls (with 3 degrees of liberty, for stability), and two wheels (With motors, for movement).
I changed a lot, but the main problem I encounter is that the balls move by herself (in some configuration they made the robot shake or move. In the current one they just roll-on herself (and maybe do crazy thinks when I try to turn ) ). I don't understand where that could come exactly and what to do to fix it. (The current model is not based on anything real, so I could have messed up the values of mass and inertia )
(I'm new on the forum and i don't know if I should past all my codes or not :/ )
There the xacro file I use :
<?xml version="1.0"?>

    
    
    
    
    
    
    
    
        
    
        
       
    
        
    
    
      
        /robot
      
    
    
    
                 
    
    
    
    
        
        
        
    
    
        
            
        
    <link name="wheel_${name}_link">
        <inertial>
            <xacro:origin_base />
            <mass value="${wheel_mass}" />
             <inertia ixx="1.1175580e-05" ixy="-4.2369783e-11" ixz="-5.9381719e-09" iyy="1.1192413e-05" iyz="-1.4400107e-11" izz="2.0712558e-05" />
        </inertial>

        <collision>
            <xacro:origin_base />
            <geometry>
                <cylinder radius="${wheel_radius}" length="${wheel_length}"/>
            </geometry>
        </collision>
          <visual>
              <xacro:origin_base />
              <geometry>
                    <cylinder radius="${wheel_radius}" length="${wheel_length}"/>
              </geometry>
              <material name="green"/>
          </visual>
      </link>
    
      <joint name="wheel_${name}_join" type="continuous">
          <parent link="base_link"/>
          <child link="wheel_${name}_link"/>
          <xacro:origin_wheel />
          <limit lower="-0.2" upper="0.2" effort="100" velocity="100"/>
          <axis xyz="0 0 1"/>
      </joint>
    
    
    <gazebo reference="wheel_${name}_link">
    <mu1>0.1</mu1>
    <mu2>0.1</mu2>
    <kp>500000.0</kp>
    <kd>10.0</kd>
    <minDepth>0.001</minDepth>
    <maxVel>0.1</maxVel>
    <fdir1>1 0 0</fdir1>
    <material>Gazebo/FlatBlack</material>
      </gazebo>
  </xacro:macro>
 
    <!-- BASE -->

    <link name="base_link">
        <inertial>
          <xacro:origin_base />
          <mass value="${mass_base}" />
          <inertia ixx="2.2124416e-03" ixy="-1.2294101e-05" ixz="3.4938785e-05" iyy="2.1193702e-03" iyz="-5.0120904e-06" izz="2.0064271e-03" />
      </inertial>
      <collision>
          <xacro:origin_base />
          <geometry>
                        <box size="${size_base} ${size_base} ${height_base/2}"/>
                </geometry>
      </collision>
      <visual>
        <xacro:origin_base />
            <geometry>
                    <box size="${size_base} ${size_base} ${height_base/2}"/>
            </geometry>
      </visual>
    </link>

    <gazebo reference="base_link">
         <!-- <kp>100000.0</kp>
          <kd>100000.0</kd>
          <mu1>10.0</mu1>
          <mu2>10.0</mu2>-->
          <material>Gazebo/DarkGrey</material>
    </gazebo>

    <xacro:wheel rpy="1.57 0.0 0.0" xyz="0.0 ${half_size_base} 0" name="right" />
<xacro:wheel rpy="1.57 0.0 0.0" xyz="0.0 -${half_size_base} 0" name="left" />

<!-- SPHERE -->

 

<xacro:sphere_ xyz="${half_size_base} 0 ${-wheel_radius/2}" name="avant"/>
<xacro:sphere_ xyz="${-half_size_base} 0 ${-wheel_radius/2}" name="arriere"/>
    <xacro:macro name="sphere_" params="name xyz">
  <xacro:macro name="origin_sphere">
    <origin rpy="0 0 0" xyz="${xyz}"/>
  </xacro:macro>
  <link name="sphere_link_${name}">
        <inertial>
          <xacro:origin_base/>
          <mass value="${boule_mass}"/>
          <inertia ixx="0.0002835" ixy="0.0" ixz="0.0" iyy="0.0002835" iyz="0.0" izz="0.000324"/>
        </inertial>
            <collision>
            <xacro:origin_base />
                <geometry>
                  <sphere radius="${boule_size}"/>
                </geometry>
            </collision>
            <visual>
              <xacro:origin_base />
              <geometry>
                <sphere radius="${boule_size}"/>
              </geometry>
              <material name="blue"/>
            </visual>
      </link>
    <gazebo reference="sphere_link_${name}">
    <kp>10e20</kp>
    <kd>1.0</kd>
    <mu1>0.1</mu1>
    <mu2>0.0</mu2>
    <maxContacts>1</maxContacts>
    <maxVel>0.0</maxVel>
    <min_depth>0.001</min_depth>
    </gazebo>
     
  
  
  <xacro:macro name="junta_model" params="name parent child">
          <joint name="${name}_joint_y" type="continuous">
              <xacro:origin_sphere />
              <parent link="${parent}"/>
              <child link="${name}_junta1"/>
              <axis xyz="0 1 0" />
          </joint>

          <link name="${name}_junta1">
              <inertial>
                <mass value="0.025" />
                <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4" />
              </inertial>
          </link>

          <joint name="${name}_joint_z" type="continuous">
              <parent link="${name}_junta1"/>
              <child link="${name}_junta2"/>
              <axis xyz="0 0 1" />
          </joint>

          <link name="${name}_junta2">
              <inertial>
                <mass value="0.025" />
                <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4" />
              </inertial>  
          </link>

          <joint name="${name}_joint_x" type="continuous">
              <parent link="${name}_junta2"/>
              <child link="${name}_junta3"/>
              <axis xyz="1 0 0" />
          </joint>

          <link name="${name}_junta3">
              <inertial>
                <mass value="0.025" />
                <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4" />
              </inertial>  
          </link>

          <joint name="${name}_jointfixed" type="fixed">
         
              <parent link="${name}_junta3"/>
              <child link="${child}"/>
          </joint>
      </xacro:macro>
      
      <xacro:junta_model name="sphere_${name}" parent="base_link" child="sphere_link_${name}"/>
    </xacro:macro>

<transmission name="wheel_right">
 <type>transmission_interface/SimpleTransmission</type>
  <joint name="wheel_right_join">
        <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="motor_right_wheel">
        <hardwareInterface>EffortJointInterface</hardwareInterface>
        <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="wheel_left">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="wheel_left_join">
        <hardwareInterface>EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor_left_wheel">
        <hardwareInterface>EffortJointInterface</hardwareInterface>
        <mechanicalReduction>1</mechanicalReduction>
    </actuator>
</transmission>

<gazebo>
  <plugin name="turtlebot3_burger_controller" filename="libgazebo_ros_diff_drive.so">
    <commandTopic>cmd_vel</commandTopic>
    <odometryTopic>odom</odometryTopic>
    <odometryFrame>odom</odometryFrame>
    <odometrySource>world</odometrySource>
    <publishOdomTF>true</publishOdomTF>
    <robotBaseFrame>base_footprint</robotBaseFrame>
    <publishWheelTF>false</publishWheelTF>
    <publishTf>true</publishTf>
    <publishWheelJointState>true</publishWheelJointState>
    <legacyMode>false</legacyMode>
    <updateRate>30</updateRate>
    <leftJoint>wheel_left_join</leftJoint>
    <rightJoint>wheel_right_join</rightJoint>
    <wheelSeparation>1.0</wheelSeparation>
    <wheelDiameter>0.10</wheelDiameter>
    <wheelAcceleration>1</wheelAcceleration>
    <wheelTorque>10</wheelTorque>
    <rosDebugLevel>na</rosDebugLevel>
  </plugin>
</gazebo>

<gazebo>
  <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
    <robotNamespace>/robot</robotNamespace>
  </plugin>
</gazebo>

Thanks for your help :)

Originally posted by Jérémy_Synergize on ROS Answers with karma: 26 on 2019-10-01
Post score: 0

A:

I add  to the joints, and that solve it.

Originally posted by Jérémy_Synergize with karma: 26 on 2019-10-10
This answer was ACCEPTED on the original site
Post score: 1

