Q:

Systemd roslaunch

I've recently migrated my ROS project to Ubuntu 16.04LTS and ROS kinetic since I was having stability issues with Ubuntu 14.04LTS. Unfortunately this means I can't use robot upstart anymore to run my roslaunch file at startup (afaik).
I've made an attempt at using systemd (based on this guide) to run a bash script which runs roslaunch at startup but I'm stuck trying to get everything to work.
my systemd file: (chmod 664)

[Unit]
Description=start runslam
After=mysql.service
[Service]
ExecStart=/usr/local/bin/runslam.sh
KillMode=process
[Install]
WantedBy=default.target

my bash script: (chmod +x)

#!/bin/bash
roslaunch runslam slam.launch

Just running the bash script from the terminal starts up roscore and my project runs fine but when running:

$ sudo systemctl start runslam.service
>
> $ systemctl status runslam.service

I get the following output:

â— runslam.service - start runslam
Loaded: loaded
(/etc/systemd/system/runslam.service;
enabled; vendor preset: enabled)
Active: failed (Result: exit-code)
since Thu 2016-10-06 11:36:29 AEST; 7s
ago   Process: 3746
ExecStart=/usr/local/bin/runslam.sh
(code=exited, status=127)  Main PID:
3746 (code=exited, status=127)
Oct 06 11:36:29 ausdroid-sbc-flt1 systemd[1]: Started start runslam.

Oct 06 11:36:29 ausdroid-sbc-flt1 runslam.sh[3746]: /usr/local/bin/runslam.sh: line 3: roslaunch: command not found

Oct 06 11:36:29 ausdroid-sbc-flt1 systemd[1]: runslam.service: Main process exited,> code=exited, status=127/n/a

Oct 06 11:36:29 ausdroid-sbc-flt1 systemd[1]:  runslam.service: Unit entered failed  state.

Oct 06 11:36:29 ausdroid-sbc-flt1 systemd[1]: runslam.service: Failed with result 'exit-code'.

I think "roslaunch: command not found" means that the ROS environment needs to be somehow specified in the systemd file does anyone know how to do this? Thanks.

Originally posted by Andre_Preller_3000 on ROS Answers with karma: 48 on 2016-10-05
Post score: 1

Original comments
Comment by Rufus on 2020-03-19:
Note it may be advisable to use KillSignal=2 as roslaunch seems to respond to SIGINT instead of the default SIGTERM

A:

I have not used systemd myself for this task, but I've used the following method in a fairly similar situation to wrap roslaunch.
Change /usr/local/bin/runslam.sh to:
#!/usr/bin/env bash
bash -c "source /path/to/catkin_ws/devel/setup.bash && roslaunch runslam slam.launch"

Originally posted by Mani with karma: 1704 on 2016-10-06
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by Andre_Preller_3000 on 2016-10-06:
Brilliant! Thankyou Mani that did it :)
And just for the sake of completeness, since posting I made the following changes to the systemd file:

"After=network.target"

*got rid of the KillMode line
*Added "Restart=on-abort" under [Unit]
Comment by Mani on 2016-10-06:
You are welcome. I am glad it worked. One thing you can do is to post your full solution online (i.e. as a Github gist) and provide a link in your question for future reference.
Comment by calvertdw on 2017-04-05:
You sir are a boss. Thanks!

