Q:

Problem with roslaunch on rc.local startup

Hello,
I tried launching some nodes on startup via rc.local, but I have the following errors on some of the startups:
[   45.809342] rc.local[661]: RLException: ERROR: could not contact master [http://localhost:11311]                                
[   45.821666] rc.local[661]: The traceback for the exception was written to the log file                                                     
[   45.844191] rc.local[661]: ... logging to /root/.ros/log/3b1cabe6-64e9-11e9-8f36-74e1828a3ed5/roslaunch-arm-945.log                        
[   45.845040] rc.local[661]: Checking log directory for disk usage. This may take awhile.                                                    
[   45.845630] rc.local[661]: Press Ctrl-C to interrupt                                                                                       
[   45.846329] rc.local[661]: Done checking log file disk usage. Usage is <1GB.                                                               
[   45.846840] rc.local[661]: 2;/home/tucer/catkin_ws/src/electronicload/launch/launcher.launch                                               
[   45.847310] rc.local[661]: started roslaunch server http://arm:45779/                                                                      
[   45.847892] rc.local[661]: SUMMARY                                                                                                         
[   45.860883] rc.local[661]: ========                                                                                                        
[   45.864314] rc.local[661]: PARAMETERS                                                                                                      
[   45.865892] rc.local[661]:  * /rosdistro: melodic                                                                                          
[   45.868293] rc.local[661]:  * /rosversion: 1.14.3                                                                                          
[   45.876385] rc.local[661]: NODES                                                                                                           
[   45.877925] rc.local[661]:   /                                                                                                             
[   45.880247] rc.local[661]:     LCD (electronicload/LCD.py)                                                                                 
[   45.882944] rc.local[661]:     controller (electronicload/controller.py)                                                                   
[   45.888258] rc.local[661]:     logger_to_file (electronicload/logger_to_file.py)                                                           
[   45.892181] rc.local[661]:     sensors (electronicload/sensors.py)                                                                         
[   45.893536] rc.local[661]:     shutdown (electronicload/shutdown.py)                                                                       
[   45.894667] rc.local[661]: auto-starting new master                                                                                        
[   45.900240] rc.local[661]: process[master]: started with pid [1175]                                                                        
[   46.031643] rc.local[661]: Traceback (most recent call last):                                                                              
[   46.036751] rc.local[661]:   File "/opt/ros/melodic/bin/rosmaster", line 35, in <module>                                                   
[   46.039083] rc.local[661]:     rosmaster.rosmaster_main()                                                                                  
[   46.040722] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rosmaster/main.py", line 84, in rosmaster_main             
[   46.045008] rc.local[661]:     configure_logging()                                                                                         
[   46.048811] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rosmaster/main.py", line 58, in configure_logging          
[   46.051817] rc.local[661]:     _log_filename = rosgraph.roslogging.configure_logging('rosmaster', logging.DEBUG, filename=filename)        
[   46.057809] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rosgraph/roslogging.py", line 185, in configure_logging    
[   46.063184] rc.local[661]:     logging.config.fileConfig(config_file, disable_existing_loggers=False)                                      
[   46.070380] rc.local[661]:   File "/usr/lib/python2.7/logging/config.py", line 85, in fileConfig                                           
[   46.074387] rc.local[661]:     handlers = _install_handlers(cp, formatters)                                                                
[   46.075661] rc.local[661]:   File "/usr/lib/python2.7/logging/config.py", line 163, in _install_handlers                                   
[   46.081225] rc.local[661]:     h = klass(*args)                                                                                            
[   46.082611] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rosgraph/roslogging.py", line 230, in __init__             
[   46.083944] rc.local[661]:     from rospy.rostime import get_time, is_wallclock                                                            
[   46.085346] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rospy/__init__.py", line 49, in <module>                   
[   46.088288] rc.local[661]:     from .client import spin, myargv, init_node, \                                                              
[   46.089780] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rospy/client.py", line 60, in <module>                     
[   46.092281] rc.local[661]:     import rospy.impl.init                                                                                      
[   46.096286] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rospy/impl/init.py", line 54, in <module>                  
[   46.097914] rc.local[661]:     from .tcpros import init_tcpros                                                                             
[   46.099095] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rospy/impl/tcpros.py", line 45, in <module>                
[   46.103889] rc.local[661]:     import rospy.impl.tcpros_service                                                                            
[   46.105827] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rospy/impl/tcpros_service.py", line 51, in <module>        
[   46.108284] rc.local[661]:     from rospy.service import _Service, ServiceException                                                        
[   46.112301] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rospy/service.py", line 45, in <module>                    
[   46.113780] rc.local[661]:     from rospy.impl.registration import set_service_manager, Registration, get_registration_listeners           
[   46.114943] rc.local[661]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rospy/impl/registration.py", line 35, in <module>          
[   46.118278] rc.local[661]:     """Internal use: handles maintaining registrations with master via internal listener APIs"""                
[   46.119717] rc.local[661]: KeyboardInterrupt                                                                                               
[   47.226949] rc.local[661]: [master] killing on exit

These error does not appear to happen when I reboot, only when I poweroff/shutdown and since the echo commands on rc.local work, I figured the problem is roslaunch specific.
Here's my rc.local file:
#! /bin/bash
bash /home/tucer/startup.bash&
exit 0

and the startup.bash file:
#! /bin/bash
echo "The penguin took off..."

source /opt/ros/melodic/setup.bash
source /home/tucer/catkin_ws/devel/setup.bash
echo "...the penguin sourced both bash files for ros with his penguin nades..."
roslaunch electronicload launcher.launch
echo "...the penguin landed safely."

All ros commands work when the system has fully booted, rc.local works as intended when executed after boot with command:
sudo /etc/rc.local start

It only doesn't work when from powered off state, it boots (reminder it works when it reboots). My setup is beaglebone black with Ubuntu 18.04.2 image supplied by
elinux .
EDIT: After some extra tests it turns out this problem occurs only when I have an Ethernet cable connecting the BeagleBone to a laptop (currently running Ubuntu 18.04.2 LTS). Any thoughts on that matter? Having an Ethernet connection still does not create any problems with running roslaunch AFTER boot up.
EDIT2: Following Delb's suggestion the startup.bash file changed to:
#! /bin/bash
export ROS_MASTER_URI="http://localhost:11311/"
export ROS_HOSTNAME="localhost"

echo "The penguin took off..."

source /opt/ros/melodic/setup.bash
source /home/tucer/catkin_ws/devel/setup.bash
echo "...the penguin sourced both bash files for ros with his penguin nades..."
roslaunch electronicload launcher.launch
echo "...the penguin landed safely."

I also tried using a fixed IP that is being used in the connection between laptop-beaglebone, but since the set up connection is "shared-to-other-computers" from the ubuntu laptop, this ip can only be obtained when the connection establishes (making it non-existent when the connection is absent). In that case the startup.bash was:
#! /bin/bash
export ROS_MASTER_URI="http://10.42.0.164:11311/"
export ROS_HOSTNAME="10.42.0.164"

echo "The penguin took off..."

source /opt/ros/melodic/setup.bash
source /home/tucer/catkin_ws/devel/setup.bash
echo "...the penguin sourced both bash files for ros with his penguin nades..."
roslaunch electronicload launcher.launch
echo "...the penguin landed safely."

In both cases, even though MASTER and HOSTNAME used the same IP, errors still occurred (mentioning the localhost startup.bash version errors):
[   45.794378] rc.local[697]: RLException: ERROR: could not contact master [http://localhost:11311/]                               
[   45.801929] rc.local[697]: The traceback for the exception was written to the log file                                                     
[   45.829992] rc.local[697]: ... logging to /root/.ros/log/bb6138b2-6cbe-11e9-ba8e-74e1828a3ed5/roslaunch-arm-948.log                        
[   45.830816] rc.local[697]: Checking log directory for disk usage. This may take awhile.                                                    
[   45.831640] rc.local[697]: Press Ctrl-C to interrupt                                                                                       
[   45.833944] rc.local[697]: Done checking log file disk usage. Usage is <1GB.                                                               
[   45.840285] rc.local[697]: 2;/home/tucer/catkin_ws/src/electronicload/launch/launcher.launch                                               
[   45.844272] rc.local[697]: started roslaunch server http://localhost:41159/                                                                
[   45.848198] rc.local[697]: SUMMARY                                                                                                         
[   45.850096] rc.local[697]: ========                                                                                                        
[   45.856200] rc.local[697]: PARAMETERS                                                                                                      
[   45.858119] rc.local[697]:  * /rosdistro: melodic                                                                                          
[   45.864191] rc.local[697]:  * /rosversion: 1.14.3                                                                                          
[   45.868300] rc.local[697]: NODES                                                                                                           
[   45.869775] rc.local[697]:   /                                                                                                             
[   45.876248] rc.local[697]:     LCD (electronicload/LCD.py)                                                                                 
[   45.877776] rc.local[697]:     controller (electronicload/controller.py)                                                                   
[   45.880181] rc.local[697]:     logger_to_file (electronicload/logger_to_file.py)                                                           
[   45.882618] rc.local[697]:     sensors (electronicload/sensors.py)                                                                         
[   45.885431] rc.local[697]:     shutdown (electronicload/shutdown.py)                                                                       
[   45.888739] rc.local[697]: auto-starting new master                                                                                        
[   45.900295] rc.local[697]: process[master]: started with pid [1190]                                                                        
[   45.991327] rc.local[697]: Traceback (most recent call last):                                                                              
[   45.996615] rc.local[697]:   File "/opt/ros/melodic/bin/rosmaster", line 35, in <module>                                                   
[   45.999477] rc.local[697]:     rosmaster.rosmaster_main()                                                                                  
[   46.002388] rc.local[697]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rosmaster/main.py", line 84, in rosmaster_main             
[   46.009036] rc.local[697]:     configure_logging()                                                                                         
[   46.013041] rc.local[697]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rosmaster/main.py", line 58, in configure_logging          
[   46.020393] rc.local[697]:     _log_filename = rosgraph.roslogging.configure_logging('rosmaster', logging.DEBUG, filename=filename)        
[   46.022597] rc.local[697]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rosgraph/roslogging.py", line 185, in configure_logging    
[   46.026729] rc.local[697]:     logging.config.fileConfig(config_file, disable_existing_loggers=False)                                      
[   46.037566] rc.local[697]:   File "/usr/lib/python2.7/logging/config.py", line 85, in fileConfig                                           
[   46.038724] rc.local[697]:     handlers = _install_handlers(cp, formatters)                                                                
[   46.039760] rc.local[697]:   File "/usr/lib/python2.7/logging/config.py", line 163, in _install_handlers                                   
[   46.041525] rc.local[697]:     h = klass(*args)                                                                                            
[   46.044332] rc.local[697]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rosgraph/roslogging.py", line 230, in __init__             
[   46.052325] rc.local[697]:     from rospy.rostime import get_time, is_wallclock                                                            
[   46.053851] rc.local[697]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rospy/__init__.py", line 49, in <module>                   
[   46.056647] rc.local[697]:     from .client import spin, myargv, init_node, \                                                              
[   46.059883] rc.local[697]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/rospy/client.py", line 52, in <module>                     
[   46.068330] rc.local[697]:     import roslib                                                                                               
[   46.072202] rc.local[697]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/roslib/__init__.py", line 54, in <module>                  
[   46.073679] rc.local[697]:     import roslib.stacks                                                                                        
[   46.076234] rc.local[697]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/roslib/stacks.py", line 46, in <module>                    
[   46.077548] rc.local[697]:     import roslib.packages                                                                                      
[   46.080188] rc.local[697]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/roslib/packages.py", line 49, in <module>                  
[   46.088201] rc.local[697]:     from catkin.find_in_workspaces import find_in_workspaces as catkin_find                                     
[   46.092295] rc.local[697]:   File "/opt/ros/melodic/lib/python2.7/dist-packages/catkin/find_in_workspaces.py", line 36, in <module>        
[   46.093890] rc.local[697]:     from catkin_pkg.packages import find_packages                                                               
[   46.096299] rc.local[697]:   File "/usr/lib/python2.7/dist-packages/catkin_pkg/packages.py", line 38, in <module>                          
[   46.104211] rc.local[697]:     from .package import _get_package_xml                                                                       
[   46.105809] rc.local[697]:   File "/usr/lib/python2.7/dist-packages/catkin_pkg/package.py", line 43, in <module>                           
[   46.106964] rc.local[697]:     from catkin_pkg.condition import evaluate_condition                                                         
[   46.112210] rc.local[697]:   File "/usr/lib/python2.7/dist-packages/catkin_pkg/condition.py", line 17, in <module>                         
[   46.116278] rc.local[697]:     import pyparsing                                                                                            
[   46.117832] rc.local[697]:   File "/usr/lib/python2.7/dist-packages/pyparsing.py", line 5344, in <module>                                  
[   46.118993] rc.local[697]:     commonHTMLEntity = Regex('&(?P<entity>' + '|'.join(_htmlEntityMap.keys()) +");").setName("common HTML entity
")                                                                                                                                            
[   46.125052] rc.local[697]:   File "/usr/lib/python2.7/dist-packages/pyparsing.py", line 2770, in __init__                                  
[   46.128187] rc.local[697]:     self.re = re.compile(self.pattern, self.flags)                                                              
[   46.132269] rc.local[697]:   File "/usr/lib/python2.7/re.py", line 194, in compile                                                         
[   46.136213] rc.local[697]:     return _compile(pattern, flags)                                                                             
[   46.137679] rc.local[697]:   File "/usr/lib/python2.7/re.py", line 249, in _compile                                                        
[   46.144218] rc.local[697]:     p = sre_compile.compile(pattern, flags)                                                                     
[   46.148298] rc.local[697]:   File "/usr/lib/python2.7/sre_compile.py", line 595, in compile                                                
[   46.149888] rc.local[697]:     groupindex, indexgroup                                                                                      
[   46.151047] rc.local[697]: KeyboardInterrupt                                                                                               
[   47.091950] rc.local[697]: [master] killing on exit

Everything still works when running them AFTER boot up.
Everything still works when the beaglebone boots WITHOUT the Ethernet connection.

Originally posted by Jason C. on ROS Answers with karma: 16 on 2019-04-22
Post score: 0

Original comments
Comment by Delb on 2019-05-02:
Do you have other options than using rclocal ? If so #q290599 might help you launch nodes on startup (but not using rclocal).
Comment by Jason C. on 2019-05-03:
@Delb I tried systemd service but had the same results. I found a way around, if you are interested you can check the answers!

A:

Since I could not find a clear solution to the issue, with Delb's help I tweaked around the setup.bash script and found out that the roscore that is being automatically called from roslaunch may be the source of the problem. Using the --wait parameter on roslaunch, I can raise my own roscore and then run all the nodes needed. This is my new startup.bash file:
#! /bin/bash
##########################
##   scipt starts here  ##
##########################

export ROS_MASTER_URI="http://localhost:11311/"
export ROS_HOSTNAME="localhost"

echo "The penguin took off..."

source /opt/ros/melodic/setup.bash
source /home/tucer/catkin_ws/devel/setup.bash
echo "...the penguin sourced both bash files for ros with his penguin nades..."
roscore&
roslaunch --wait electronicload launcher.launch

echo "...the penguin landed safely."

EDIT: typo.

Originally posted by Jason C. with karma: 16 on 2019-05-03
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Delb on 2019-05-03:
Glad you solved your issue !

