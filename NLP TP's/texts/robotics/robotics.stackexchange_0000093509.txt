Q:

Something like rosbag but it keeps a rolling buffer and saves a file only when you want to

Is there any existing tool that will record a bag file but instead of continuing to record would instead discard any data past some set time threshold (so if the threshold is 1 hour, at any given point it has the data up to one hour before the current time). Ideally this would allow one to call a service to save this data into a proper bagfile which can be then used for deeper investigation.
The usecase in mind is situations where some extraordinary event has happened to a robot (e.g. massive localization failure) and a bag file of data leading up to the event would be useful for fixing whatever bug may have caused the problem. I have thoughts about how something like this could be made but want to check if maybe something already exists.

Originally posted by Jari on ROS Answers with karma: 112 on 2019-10-08
Post score: 2

A:

For ROS 1, there is a pull request adding a rosbag snapshot command that sounds like it does what you'd like. Maybe it will take less time to pick it up than to start from scratch?
https://github.com/ros/ros_comm/pull/1414

Originally posted by sloretz with karma: 3061 on 2019-10-08
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Jari on 2019-10-08:
Thank you!
Comment by gvdhoorn on 2019-10-09:
The snapshot command is good, but personally I've been eying something like strands-project/mongodb_store#245 (MongoDB with a "capped collection", which would essentially be a "rolling buffer").
Comment by jeremya on 2019-10-12:
There is also the --split and --max-splits option for rosbag record. I usually set the split to 1m and the max splits to 2 or 3. This has the effect of saving the last 2-3 minutes of topics. Recording to a tmpfs partition removes the disk I/O performance hit. I also found record_ros to programmatically start and stop rosbag recordings. You can modify record_ros to provide more options such as split and max_splits.

