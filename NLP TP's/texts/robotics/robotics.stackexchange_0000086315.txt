Q:

How to view the state of joints in rviz after using ros_control?

After I used ros_control, I could clearly observe the joint state change in gazebo. Then how to observe the corresponding changes of joints' states in rviz?

Originally posted by stefanvan on ROS Answers with karma: 23 on 2018-04-03
Post score: 1

A:

Assuming your controller YAML file includes a joint_state_controller/JointStateController plugin, then the joint states should be available over a standard /robot_name/joint_states topic (carrying a message of type sensor_msgs/JointState). This combined with a /robot_descriptionparameter and a robot_state_publisher node should be all that is required to view the simulated pose of the robot in rviz.
Note that this is covered in detail in the ros_control Gazebo Tutorial. Notice they have they joint_state_controller/JointStateController in the YAML file, they start the robot_state_publisher in the rrbot_control.launch file, and they load the URDF onto the parameter server in the rrbot_world.launch file. Finally, note there is a section called "Connect Rviz to Gazebo Simulation" that details how to setup rviz.

Originally posted by jarvisschultz with karma: 9031 on 2018-04-03
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by stefanvan on 2018-04-05:
@jarvisschultz  When was the /robot_name/joint_states topic created?
Comment by jarvisschultz on 2018-04-05:
Even though, IMO, this is a terrible name, that's what the joint_state_controller/JointStateController plugin does. See the description on its official wiki page: http://wiki.ros.org/joint_state_controller
Comment by stefanvan on 2018-04-05:
Sir, the wiki just shows some information about joint_state_controller/JointStateController.
Comment by stefanvan on 2018-04-05:
I installed the RRbot mentioned on this page. During the process of using RRbot, I observed the current topic list via rostopic list and found out that there was a /joint_states topic after starting robot_state_publisher node
Comment by stefanvan on 2018-04-05:
or joint_state_publisher node. When I launched rrbot_world.launch, rrbot_control.launch and rrbot_rviz.launch simultaneously, there was a /joint_states topic and a /rrbot/joint_states topic due to the use of a <remap> tag in rrbot_control.launch.
Comment by stefanvan on 2018-04-05:
I uploaded a picture in the content of the question. The content of the picture is the graph of what's going on in the system, which is obtained by rqt_graph. I am now confused about the meaning of /joint_states and /rrbot/joint_states.
Comment by jarvisschultz on 2018-04-05:
The first line on the linked wiki page under Package summary says "Controller to publish joint states."
Comment by jarvisschultz on 2018-04-05:
I'm confused as to what your actual question is. With a joint_state_controller/JointStateController plugin loaded, Gazebo should publish joint states information (the name of this topic is remappable). The robot_state_publisher needs to subscribe to that joint state info, and be able to read...
Comment by jarvisschultz on 2018-04-05:
... a robot_description parameter (containing a copy of a URDF) in order to publish tf data that allows the robot to be visualized in rviz. The actual names of the topics don't matter as long as the topic coming from Gazebo matches the topic that the robot_state_publisher needs.
Comment by jarvisschultz on 2018-04-05:
You likely don't need a joint_state_publisher at all because Gazebo is publishing the joint states. It could be useful, for example, if information for only a subset of joints is produced by Gazebo.
Comment by stefanvan on 2018-04-06:
The display of the model in rviz will be incorrect without joint_state_publisher. Now that I have imitated the launch file in the RRBot package, I can observe changes of joints in rviz (by command rostopic pub -1 /MY_ROBOT/joint1_position_controller/command std_msgs/Float64 "data: 1.5").
Comment by stefanvan on 2018-04-06:
Before asking this question, I changed the joints state of my robot through commands, but the changes can only be observed in gazebo, but not in rviz. After a period of time, I imitated the launch file in RRbot, and the changes can be seen in rviz
Comment by stefanvan on 2018-04-06:
After that I wanna figure out what's going on, but the namespace seems to confuse me. Are /joint_states and /rrbot/joint_states the same topic but have different names? Or are they two different topics? This is actually what my question is.
Comment by jarvisschultz on 2018-04-06:
Likely, the /joint_states topic is only showing up because you started a joint_state_publisher and it, by default, subscribes to that topic. Based on the rqt_graph shot you posted it looks like Gazebo is properly publishing /rrbot/joint_states and that the robot_state_publisher is...
Comment by jarvisschultz on 2018-04-06:
... properly subscribed to that topic. Tools like rostopic info are incredibly useful for you to debug these things.

