Q:

Systemd+roslaunch fails with Turtlebot

Hi,
I am setting up a TurtleBot2i right now. I want to launch everything regarding ROS on startup and try to realize it with systemd.
I am at the point where my .sh-script works as long it contains:
 #!/usr/bin/env bash
bash -c "source /home/turtlebot/.bashrc && source /opt/ros/kinetic/setup.bash && source /home/turtlebot/catkin_ws/devel/setup.bash && roslaunch astra_launch astra.launch" 

This basically only launches the astra camera and works fine with:
 sudo systemctl start ROSdaemon.service

Whenever I replace the launchfile with the actual command for the full robot:
 roslaunch turtlebot2i_bringup turtlebot2i_basic.launch

The systemctl exits with:
 ExecStart=/home/turtlebot/startup.sh (code=exited, status=1/FAILURE)

Any suggestions on why my system crashes?
Cheers

Originally posted by chris93 on ROS Answers with karma: 26 on 2019-10-09
Post score: 0

Original comments
Comment by rreignier on 2019-10-09:
You should be able to get more logs with journalctl -u ROSdaemon.service.
With systemd, I usually directly use the roslaunch command in the service file with:
ExecStart=/home/turtlebot/catkin_ws/devel/env.sh roslaunch turtlebot2i_bringup turtlebot2i_basic.launch

Comment by chris93 on 2019-10-10:
Actually journalctl showed me a great hint - I will check on that now. Thanks already!

A:

Okay so here was the problem:
The launchfile of the turtlebot2i uses the keyword "env" as well as "optenv", which work fine when the environment is set to the correct values. Unfortunately that is not the case, when starting with systemd, some of the values have not been set and some with a different value. This leads to a wrong path for the urdf, which is non-existing and therefore leads to a failing launch.
On top the replacement of the shell script with the line rreignier suggested works fine and is much prettier!
Cheers

Originally posted by chris93 with karma: 26 on 2019-10-10
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by chris93 on 2019-10-10:
Unfortunately I cannot accept my own answer yet, because I have not enough points.

