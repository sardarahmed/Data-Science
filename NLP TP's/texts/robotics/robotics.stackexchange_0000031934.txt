Q:

Cannot play AVI files with Diamondback Debian OpenCV

I can't seem to play AVI files using the latest ROS OpenCV Debian packages under Diamondback and Ubuntu 10.04.  Is anyone else able to do this?  I am wondering if the Debian packages were compiled without ffmpeg support?  Googling around, I found a few sites that recommended first converting the original video like this:
$ mencoder original.avi -ovc raw -vf format=i420 -o out.avi
which I have done.  I have then tried both Python and C++ programs to play the out.avi file, but neither produces any image.  Here is the C++ source I tried just now:
/**
 * How to Play AVI Files with OpenCV
 *
 * Author  Nash
 * License GPL
 * Website http://nashruddin.com
 */

#include <stdio.h>
#include "cv.h"
#include "highgui.h"

int main( int argc, char** argv )
{
    IplImage  *frame;
    int       key;

    /* supply the AVI file to play */
    assert( argc == 2 );

    /* load the AVI file */
    CvCapture *capture = cvCaptureFromAVI( argv[1] );

    /* always check */
    if( !capture ) return 1;

    int fps = ( int )cvGetCaptureProperty( capture, CV_CAP_PROP_FPS );

    /* display video */
    cvNamedWindow( "video", 0 );

    while( key != 'q' ) {
        /* get a frame */
        frame = cvQueryFrame( capture );

        /* always check */
        if( !frame ) break;

        /* display frame */
        cvShowImage( "video", frame );

        /* quit if user press 'q' */
        //key = cvWaitKey( 1000 / fps );
        key = cvWaitKey( 50 );
    }

    /* free memory */
    cvReleaseCapture( &capture );
    cvDestroyWindow( "video" );

    return 0;
}

Originally posted by Pi Robot on ROS Answers with karma: 4046 on 2011-05-30
Post score: 0

A:

Someone in the lab ran into this as well. Apparently the binary distribution of vision_opencv does not come with ffmped support. I haven't tested this, but they told me to download it from source, and change the following line in the Makefile:
-D WITH_FFMPEG=OFF \

Then recompile.
Hope this helps

Originally posted by Ivan Dryanovski with karma: 4954 on 2011-05-30
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Pi Robot on 2011-05-30:
Thanks Ivan--that did the trick.  Support for ffmpeg seems to have been turned off deliberately as I found here: https://code.ros.org/trac/ros-pkg/changeset/15321.  I submitted a new ticket (https://code.ros.org/trac/ros-pkg/ticket/4980) to see if it can be turned back on.
--patrick
Comment by yuky on 2014-05-25:
Hi
My ROS vervion is hydro, and I cannot find the makefile. Could you tell me where is the Opencv's Makefile?
Thanks

