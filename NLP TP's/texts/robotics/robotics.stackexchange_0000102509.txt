Q:

ROS2 How to check if a publisher is connected?

I noticed that creating a publicher does not guarantee an instant connection to the ros2-network. Therefore, sending instant messages immediately after the creation of the node leads to the loss. Does the ROS2 API have c++ tools to check a publisher's current network connectivity?
OS: Ubuntu 20.04
Distro: ROS2 Foxy
Here is the simple publisher I use to test this issue
#include "rclcpp/rclcpp.hpp"
#include "std_msgs/msg/bool.hpp"

class Pub : public rclcpp::Node {
 public:
  Pub() : Node("pub") {
    publisher_ = this->create_publisher<std_msgs::msg::Bool>("test", 10);
  }
  ~Pub() = default;

  void Execute() {
    auto msg = std_msgs::msg::Bool();
    msg.set__data(true);
    publisher_->publish(msg);
    RCLCPP_INFO(this->get_logger(), "Set bool");
  }

 private:
  rclcpp::Publisher<std_msgs::msg::Bool>::SharedPtr publisher_;
};

int main(int argc, char* argv[]) {
  rclcpp::init(argc, argv);
  Pub node;
  node.Execute();
  rclcpp::shutdown();
  return 0;
}

Originally posted by Mr_Leonard on ROS Answers with karma: 5 on 2022-10-10
Post score: 0

A:

You can use
The function get_subscription_count()
https://docs.ros2.org/dashing/api/rclcpp/classrclcpp_1_1PublisherBase.html

Originally posted by duck-development with karma: 1999 on 2022-10-11
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Mr_Leonard on 2022-10-12:
Yes, but if the subscriber is created after the publisher has been created, then the publisher will be in a waiting state until the subscriber connects. In my case, I want to create a publisher, send a message, and make sure the message is received. I could set up qos, but it's useless if I send a message immediately after creating the publisher
Comment by duck-development on 2022-10-12:
They you may use mqtt with the retain flag set. Because in the dds system there is no server storing the message for you, compared to the mqtt broker.
What is wrong to wait until someone is listening to the tho topic.

