Q:

Crash after Gazebo update!

Hi all,
I was running the default versions of ROS kinetic and Gazebo 7 that can be installed on Ubuntu 16.04, but I was experiencing an annoying problem: I could not run together gazebo and RViz, because as soon as I was launching RViz, gazebo crashed.
A friend of mine told me that uploading to gazebo 7.14.0 solved the problem.
So I run these commands:
sudo apt remove gazebo7*
sudo sh -c 'echo "deb http://packages.osrfoundation.org/gazebo/ubuntu-stable `lsb_release -cs` main" > /etc/apt/sources.list.d/gazebo-stable.list'
wget http://packages.osrfoundation.org/gazebo.key -O - | sudo apt-key add -
sudo apt update 
sudo apt install gazebo7*
sudo apt install ros-kinetic-gazebo-*
sudo apt install libgazebo7-dev 

the gazebo package is now at version 7.14.0, but if I try to launch this file:
https://github.com/schizzz8/lucrezio_simulation_environments/blob/master/launch/empty_world_with_apartment_and_robot.launch
It segfaults:
dede@dede-P35V2:~$ roslaunch lucrezio_simulation_environments empty_world_with_apartment_and_robot.launch 
... logging to /home/dede/.ros/log/edc35106-14e8-11e9-85ef-f816547d9e84/roslaunch-dede-P35V2-24677.log
Checking log directory for disk usage. This may take awhile.
Press Ctrl-C to interrupt
Done checking log file disk usage. Usage is <1GB.

xacro: Traditional processing is deprecated. Switch to --inorder processing!
To check for compatibility of your document, use option --check-order.
For more infos, see http://wiki.ros.org/xacro#Processing_Order
xacro.py is deprecated; please use xacro instead
started roslaunch server http://dede-P35V2:43529/

SUMMARY
========

PARAMETERS
 * /lucrezio/angular/z/has_acceleration_limits: True
 * /lucrezio/angular/z/has_velocity_limits: True
 * /lucrezio/angular/z/max_acceleration: 6.0
 * /lucrezio/angular/z/max_velocity: 2.0
 * /lucrezio/base_frame_id: base_footprint
 * /lucrezio/left_wheel: left_wheel_joint
 * /lucrezio/linear/x/has_acceleration_limits: True
 * /lucrezio/linear/x/has_velocity_limits: True
 * /lucrezio/linear/x/max_acceleration: 1.0
 * /lucrezio/linear/x/max_velocity: 0.7
 * /lucrezio/pose_covariance_diagonal: [0.001, 0.001, 0....
 * /lucrezio/publish_rate: 50
 * /lucrezio/right_wheel: right_wheel_joint
 * /lucrezio/twist_covariance_diagonal: [0.001, 0.001, 0....
 * /lucrezio/type: diff_drive_contro...
 * /lucrezio/wheel_separation: 0.2
 * /object_groups/livingroom: ['sink', 'burner_...
 * /objects/burner_stove/model: burner_stove
 * /objects/burner_stove/model_type: sdf
 * /objects/burner_stove/orientation: [0.0, 0.0, 0]
 * /objects/burner_stove/position: [2.868422, 2.2050...
 * /objects/cabinet_ikea_malm_big/model: cabinet_ikea_malm...
 * /objects/cabinet_ikea_malm_big/model_type: sdf
 * /objects/cabinet_ikea_malm_big/orientation: [0.0, 0.0, -3.14]
 * /objects/cabinet_ikea_malm_big/position: [-2.338829, 2.341...
 * /objects/chair_ikea_borje/model: chair_ikea_borje
 * /objects/chair_ikea_borje/model_type: sdf
 * /objects/chair_ikea_borje/orientation: [0.0, 0.0, 0.0]
 * /objects/chair_ikea_borje/position: [1.96993, 0.0, 0.0]
 * /objects/couch/model: couch
 * /objects/couch/model_type: sdf
 * /objects/couch/orientation: [0.0, 0.0, -1.57]
 * /objects/couch/position: [-1.171137, -0.05...
 * /objects/milk/model: milk
 * /objects/milk/model_type: sdf
 * /objects/milk/orientation: [0.0, 0.0, 0.0]
 * /objects/milk/position: [1.970516, -1.276...
 * /objects/salt/model: salt
 * /objects/salt/model_type: sdf
 * /objects/salt/orientation: [0.0, 0.0, 0.0]
 * /objects/salt/position: [-2.48682, 2.2044...
 * /objects/sink/model: sink
 * /objects/sink/model_type: sdf
 * /objects/sink/orientation: [0.0, 0.0, 0]
 * /objects/sink/position: [1.5323, 2.204468...
 * /objects/table_ikea_bjursta/model: table_ikea_bjursta
 * /objects/table_ikea_bjursta/model_type: sdf
 * /objects/table_ikea_bjursta/orientation: [0.0, 0.0, 0.0]
 * /objects/table_ikea_bjursta/position: [1.77236080355, -...
 * /objects/table_tv/model: table_tv
 * /objects/table_tv/model_type: sdf
 * /objects/table_tv/orientation: [0.0, 0.0, -1.57]
 * /objects/table_tv/position: [-3.507171, 0.0, 0]
 * /objects/tomato_sauce/model: tomato_sauce
 * /objects/tomato_sauce/model_type: sdf
 * /objects/tomato_sauce/orientation: [0.0, 0.0, 0.0]
 * /objects/tomato_sauce/position: [-2.14387, 2.3826...
 * /objects/tv_samsung/model: tv_samsung
 * /objects/tv_samsung/model_type: sdf
 * /objects/tv_samsung/orientation: [0.0, 0.0, 1.57]
 * /objects/tv_samsung/position: [-3.431988, 0.0, ...
 * /objects/zwieback/model: zwieback
 * /objects/zwieback/model_type: sdf
 * /objects/zwieback/orientation: [0.0, 0.0, 0.0]
 * /objects/zwieback/position: [1.64601, -1.0366...
 * /robot_description: <?xml version="1....
 * /rosdistro: kinetic
 * /rosversion: 1.12.7
 * /use_sim_time: True

NODES
  /
    base_footprint_broadcaster (tf/static_transform_publisher)
    camera_link_broadcaster (tf/static_transform_publisher)
    gazebo (gazebo_ros/gzserver)
    gazebo_gui (gazebo_ros/gzclient)
    joint_state_publisher (joint_state_publisher/joint_state_publisher)
    lucrezio_controller_spawner (controller_manager/spawner)
    robot_state_publisher (robot_state_publisher/robot_state_publisher)
    spawn_objects (lucrezio_simulation_environments/spawn_object.py)
    spawn_sdf (gazebo_ros/spawn_model)
    urdf_spawner (gazebo_ros/spawn_model)

auto-starting new master
process[master]: started with pid [24691]
ROS_MASTER_URI=http://localhost:11311

setting /run_id to edc35106-14e8-11e9-85ef-f816547d9e84
process[rosout-1]: started with pid [24704]
started core service [/rosout]
process[gazebo-2]: started with pid [24728]
process[gazebo_gui-3]: started with pid [24733]
process[spawn_sdf-4]: started with pid [24738]
process[spawn_objects-5]: started with pid [24739]
process[urdf_spawner-6]: started with pid [24740]
process[camera_link_broadcaster-7]: started with pid [24741]
process[base_footprint_broadcaster-8]: started with pid [24742]
process[joint_state_publisher-9]: started with pid [24761]
process[robot_state_publisher-10]: started with pid [24769]
process[lucrezio_controller_spawner-11]: started with pid [24774]
[ INFO] [1547132627.937226771]: Finished loading Gazebo ROS API Plugin.
[ INFO] [1547132627.939418337]: waitForService: Service [/gazebo/set_physics_properties] has not been advertised, waiting...
[ INFO] [1547132627.982693599]: Finished loading Gazebo ROS API Plugin.
[ INFO] [1547132627.991528749]: waitForService: Service [/gazebo/set_physics_properties] has not been advertised, waiting...
SpawnModel script started
[INFO] [1547132628.286389, 0.000000]: Loading model XML from ros parameter
[INFO] [1547132628.288997, 0.000000]: Waiting for service /gazebo/spawn_urdf_model
[ INFO] [1547132629.036426546, 0.023000000]: waitForService: Service [/gazebo/set_physics_properties] is now available.
[ INFO] [1547132629.060751296, 0.046000000]: Physics dynamic reconfigure ready.
Segmentation fault
[gazebo-2] process has died [pid 24728, exit code 139, cmd /opt/ros/kinetic/lib/gazebo_ros/gzserver -e ode worlds/empty.world __name:=gazebo __log:=/home/dede/.ros/log/edc35106-14e8-11e9-85ef-f816547d9e84/gazebo-2.log].
log file: /home/dede/.ros/log/edc35106-14e8-11e9-85ef-f816547d9e84/gazebo-2*.log
[spawn_sdf-4] process has finished cleanly
log file: /home/dede/.ros/log/edc35106-14e8-11e9-85ef-f816547d9e84/spawn_sdf-4*.log
^C[lucrezio_controller_spawner-11] killing on exit
[robot_state_publisher-10] killing on exit
[joint_state_publisher-9] killing on exit
[base_footprint_broadcaster-8] killing on exit
[camera_link_broadcaster-7] killing on exit
[urdf_spawner-6] killing on exit
[spawn_objects-5] killing on exit
[gazebo_gui-3] killing on exit
[ERROR] [1547132634.218291, 0.152000]: Service /gazebo/get_world_properties not available.
Traceback (most recent call last):
  File "/opt/ros/kinetic/lib/gazebo_ros/spawn_model", line 313, in <module>
    sm.callSpawnService()
  File "/opt/ros/kinetic/lib/gazebo_ros/spawn_model", line 271, in callSpawnService
    initial_pose, self.reference_frame, self.gazebo_namespace)
  File "/opt/ros/kinetic/lib/python2.7/dist-packages/gazebo_ros/gazebo_interface.py", line 28, in spawn_urdf_model_client
    rospy.wait_for_service(gazebo_namespace+'/spawn_urdf_model')
  File "/opt/ros/kinetic/lib/python2.7/dist-packages/rospy/impl/tcpros_service.py", line 159, in wait_for_service
    raise ROSInterruptException("rospy shutdown")
rospy.exceptions.ROSInterruptException: rospy shutdown
^C^C^C[WARN] [1547132634.713073, 0.152000]: Controller Spawner couldn't find the expected controller_manager ROS interface.
^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C[gazebo_gui-3] escalating to SIGTERM
[rosout-1] killing on exit
[master] killing on exit
shutting down processing monitor...
... shutting down processing monitor complete
done
dede@dede-P35V2:~$ 

do you have any idea of what is causing this behavior?
Thanks.

EDIT
after reomving the old gazebo, apt complains about packages that are no more required:
Reading package lists... Done
Building dependency tree       
Reading state information... Done
gazebo7-plugin-base is already the newest version (7.14.0-1~xenial).
The following packages were automatically installed and are no longer required:
  libmuparser-dev libspnav-dev libvlc-dev paraview-doc python-mechanize redis-server redis-tools ros-kinetic-astra-camera ros-kinetic-astra-launch ros-kinetic-canopen-402
  ros-kinetic-canopen-chain-node ros-kinetic-canopen-master ros-kinetic-canopen-motor-node ros-kinetic-capabilities ros-kinetic-cob-android-msgs
  ros-kinetic-cob-android-script-server ros-kinetic-cob-base-drive-chain ros-kinetic-cob-base-velocity-smoother ros-kinetic-cob-bms-driver ros-kinetic-cob-calibration-data
  ros-kinetic-cob-cam3d-throttle ros-kinetic-cob-canopen-motor ros-kinetic-cob-collision-monitor ros-kinetic-cob-collision-velocity-filter ros-kinetic-cob-command-gui
  ros-kinetic-cob-control-mode-adapter ros-kinetic-cob-control-msgs ros-kinetic-cob-dashboard ros-kinetic-cob-default-env-config ros-kinetic-cob-default-robot-behavior
  ros-kinetic-cob-default-robot-config ros-kinetic-cob-docker-control ros-kinetic-cob-footprint-observer ros-kinetic-cob-frame-tracker ros-kinetic-cob-generic-can
  ros-kinetic-cob-hand-bridge ros-kinetic-cob-helper-tools ros-kinetic-cob-image-flip ros-kinetic-cob-light ros-kinetic-cob-linear-nav ros-kinetic-cob-mimic
  ros-kinetic-cob-monitoring ros-kinetic-cob-moveit-config ros-kinetic-cob-msgs ros-kinetic-cob-obstacle-distance ros-kinetic-cob-omni-drive-controller
  ros-kinetic-cob-perception-msgs ros-kinetic-cob-phidget-em-state ros-kinetic-cob-phidget-power-state ros-kinetic-cob-phidgets ros-kinetic-cob-reflector-referencing
  ros-kinetic-cob-relayboard ros-kinetic-cob-safety-controller ros-kinetic-cob-scan-unifier ros-kinetic-cob-script-server ros-kinetic-cob-sick-lms1xx
  ros-kinetic-cob-sick-s300 ros-kinetic-cob-sound ros-kinetic-cob-srvs ros-kinetic-cob-teleop ros-kinetic-cob-trajectory-controller ros-kinetic-cob-twist-controller
  ros-kinetic-cob-undercarriage-ctrl ros-kinetic-cob-utilities ros-kinetic-cob-voltage-control ros-kinetic-create-description ros-kinetic-create-driver
  ros-kinetic-create-node ros-kinetic-depthimage-to-laserscan ros-kinetic-ecl-build ros-kinetic-ecl-command-line ros-kinetic-ecl-concepts ros-kinetic-ecl-config
  ros-kinetic-ecl-containers ros-kinetic-ecl-converters ros-kinetic-ecl-devices ros-kinetic-ecl-eigen ros-kinetic-ecl-errors ros-kinetic-ecl-exceptions
  ros-kinetic-ecl-formatters ros-kinetic-ecl-geometry ros-kinetic-ecl-license ros-kinetic-ecl-linear-algebra ros-kinetic-ecl-math ros-kinetic-ecl-mobile-robot
  ros-kinetic-ecl-mpl ros-kinetic-ecl-sigslots ros-kinetic-ecl-streams ros-kinetic-ecl-threads ros-kinetic-ecl-time ros-kinetic-ecl-time-lite ros-kinetic-ecl-type-traits
  ros-kinetic-ecl-utilities ros-kinetic-freenect-camera ros-kinetic-freenect-launch ros-kinetic-gateway-msgs ros-kinetic-kobuki-auto-docking ros-kinetic-kobuki-bumper2pc
  ros-kinetic-kobuki-capabilities ros-kinetic-kobuki-description ros-kinetic-kobuki-dock-drive ros-kinetic-kobuki-driver ros-kinetic-kobuki-ftdi ros-kinetic-kobuki-keyop
  ros-kinetic-kobuki-msgs ros-kinetic-kobuki-node ros-kinetic-kobuki-random-walker ros-kinetic-kobuki-rapps ros-kinetic-kobuki-safety-controller
  ros-kinetic-laptop-battery-monitor ros-kinetic-libfreenect ros-kinetic-libntcan ros-kinetic-libpcan ros-kinetic-libphidgets ros-kinetic-librealsense
  ros-kinetic-realsense-camera ros-kinetic-rocon-app-manager ros-kinetic-rocon-app-manager-msgs ros-kinetic-rocon-app-utilities ros-kinetic-rocon-apps
  ros-kinetic-rocon-bubble-icons ros-kinetic-rocon-console ros-kinetic-rocon-ebnf ros-kinetic-rocon-gateway ros-kinetic-rocon-gateway-utils ros-kinetic-rocon-hub
  ros-kinetic-rocon-hub-client ros-kinetic-rocon-icons ros-kinetic-rocon-interaction-msgs ros-kinetic-rocon-interactions ros-kinetic-rocon-master-info
  ros-kinetic-rocon-python-comms ros-kinetic-rocon-python-redis ros-kinetic-rocon-python-utils ros-kinetic-rocon-python-wifi ros-kinetic-rocon-semantic-version
  ros-kinetic-rocon-service-pair-msgs ros-kinetic-rocon-std-msgs ros-kinetic-rocon-uri ros-kinetic-rosserial-msgs ros-kinetic-rosserial-python ros-kinetic-rosserial-server
  ros-kinetic-rplidar-ros ros-kinetic-schunk-libm5api ros-kinetic-schunk-powercube-chain ros-kinetic-sick-visionary-t-driver ros-kinetic-socketcan-interface
  ros-kinetic-sophus ros-kinetic-spacenav-node ros-kinetic-std-capabilities ros-kinetic-turtlebot-bringup ros-kinetic-turtlebot-capabilities
  ros-kinetic-turtlebot-description ros-kinetic-turtlebot-navigation ros-kinetic-unique-id ros-kinetic-ur-description ros-kinetic-ur-driver ros-kinetic-ur-msgs
  ros-kinetic-usb-cam ros-kinetic-uuid-msgs ros-kinetic-yocs-cmd-vel-mux ros-kinetic-yocs-controllers ros-kinetic-yocs-velocity-smoother ros-kinetic-zeroconf-avahi
  ros-kinetic-zeroconf-msgs ttf-liberation v4l-utils
Use 'sudo apt autoremove' to remove them.
0 upgraded, 0 newly installed, 0 to remove and 501 not upgraded.
dede@dede-P35V2:~$ 

how can I fix that?

Originally posted by schizzz8 on ROS Answers with karma: 183 on 2019-01-10
Post score: 0

Original comments
Comment by gvdhoorn on 2019-01-10:\

do you have any idea of what is causing this behavior?

you most likely need to install all available updates to all ROS pkgs. The new Gazebo pkgs are not necessarily ABI compatible with the ones already on your system. Typical symptoms are "weird" SEGFAULTs and other crashes.
Comment by schizzz8 on 2019-01-10:
I run "sudo apt install ros-kinetic-desktop-full" but the problem is not gone...
Comment by gvdhoorn on 2019-01-10:
That will most likely not install upgrades.
Try and see what the output of sudo apt update && sudo apt upgrade is.

A:

0 upgraded, 0 newly installed, 0 to remove and 501 not upgraded.

you have 500+ outstanding updates to your packages. You might want to fix that before trying to diagnose the SEGFAULT.

Originally posted by gvdhoorn with karma: 86574 on 2019-01-10
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by schizzz8 on 2019-01-10:
Thanks for your patience. Upgrading the packages solved the problem!!!

