Q:

ImportError: dynamic module does not define module export function (PyInit__tf2)

When I tried to do tutorial of tf, I got an error as follw.
And same error is occurred when I tried to do the tutorial of tf2.
How can I fix the problem?
Thanks
Traceback (most recent call last):
  File "/home/bjh/catkin_ws/src/learning_tf2/nodes/static_turtle_tf2_broadcaster.py", line 8, in <module>
    import tf
  File "/home/bjh/catkin_ws/devel/lib/python2.7/dist-packages/tf/__init__.py", line 35, in <module>
    exec(__fh.read())
  File "<string>", line 30, in <module>
  File "/home/bjh/catkin_ws/devel/lib/python2.7/dist-packages/tf2_ros/__init__.py", line 35, in <module>
    exec(__fh.read())
  File "<string>", line 38, in <module>
  File "/home/bjh/catkin_ws/devel/lib/python2.7/dist-packages/tf2_py/__init__.py", line 35, in <module>
    exec(__fh.read())
  File "<string>", line 38, in <module>
ImportError: dynamic module does not define module export function (PyInit__tf2)

Originally posted by joonhyup on ROS Answers with karma: 71 on 2019-06-19
Post score: 7

A:

Issue is because tf2_ros was compiled for python2. Detailed discussion here.
To recompile for python3 (melodic):
Install some prerequisites to use Python3 with ROS.
sudo apt update
sudo apt install python3-catkin-pkg-modules python3-rospkg-modules python3-empy

Prepare catkin workspace
mkdir -p ~/catkin_ws/src; cd ~/catkin_ws
catkin_make
source devel/setup.bash
wstool init
wstool set -y src/geometry2 --git https://github.com/ros/geometry2 -v 0.6.5
wstool up
rosdep install --from-paths src --ignore-src -y -r

Finally compile for Python 3
catkin_make --cmake-args \
            -DCMAKE_BUILD_TYPE=Release \
            -DPYTHON_EXECUTABLE=/usr/bin/python3 \
            -DPYTHON_INCLUDE_DIR=/usr/include/python3.6m \
            -DPYTHON_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.6m.so

Do not forget to always source your workspace!

Originally posted by r7vme with karma: 286 on 2019-06-19
This answer was ACCEPTED on the original site
Post score: 26

Original comments
Comment by joonhyup on 2019-06-20:
I am very appreciate for your help!
It is done!
Comment by r7vme on 2019-06-20:
Good to hear! @joonhyup can you please accept answer if it helped?
Comment by Carls on 2020-03-26:
If your platform is not x86_64, don't forget to change to -DPYTHON_LIBRARY=/usr/lib/YOUR_ARCH_NAME-linux-gnu/libpython3.6m.so
Comment by Carls on 2020-03-26:
Also, I've got to install numpy by sudo apt-get install python3-numpy
Comment by DJ on 2020-04-26:
Hi. I just resolved the PyInit_tf2 error and now I am facing the PyInit_PyKDL error. I tried to do the same way for resolving PyInit_tf2 but it fails when executing wstool up. I would like to know is there any way to resolve the PyInit_PyKDL? Thanks.
Comment by azerila on 2020-05-20:
how about if we're using catkin build
Comment by jester on 2020-07-30:
libpython3.6m.so does not exist ... it works despite of it
Comment by dendrarij on 2020-08-04:
@azerila, catkin build --cmake-args 
-DCMAKE_BUILD_TYPE=Release 
-DPYTHON_EXECUTABLE=/usr/bin/python3 
-DPYTHON_INCLUDE_DIR=/usr/include/python3.6m 
-DPYTHON_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.6m.so
Comment by Qilos on 2020-12-26:
Hello, I tried this but when importing tf i get following error:
import tf
File "/opt/ros/kinetic/lib/python2.7/dist-packages/tf/init.py", line 29, in 
from listener import Transformer, TransformListener, TransformerROS
ImportError: No module named 'listener'
Comment by mobiiin on 2021-02-22:
this istruction messed up my ros. now my roscore doesnt run and i guess it disables the library path to dynamic libraries. ubuntu 16 and kinetic ros
if ur case is exacly like me. i sokved it by adding following to the last line of bashrc
source /opt/ros/kinetic/setup.bash

Comment by yanjunyang on 2021-03-08:
Hi @r7vme, I also met the same problem and I compiled it using catkin build. I'm using Ubuntu18.04 and ROS Melodic. The result shows all packages are successfully compiled. After I source the workspace, I still get the same error. Would you mind give me more help and what details I need to provide>
Comment by apprentice_user on 2021-06-23:
the error disappeared when I followed the instructions. but now i get a different error
ConnectionRefusedError: [Errno 111] Connection refused

how can Ä± correct this error
Comment by Mike Scheutzow on 2021-07-07:
This question is tagged "kinetic", so this user should be using Ubuntu 16. In kinetic, ros uses python2. Why are all of you sending him/her down this path with python3?

