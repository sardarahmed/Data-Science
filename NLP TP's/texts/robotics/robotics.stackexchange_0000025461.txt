Q:

gzsdf convert segfaults, print works fine

I've been trying lately to get Gazebo 1.3 working through the simulator_gazebo stack trunk on Fuerte.  Things have been going pretty good, but I've gotten snagged at the last part, where I need to spawn my models.  The converter doesn't seem to work quite right, and it segfaults when trying to convert simple URDF files.
The URDF File I'm trying now:
<robot name="simple_box">
  <link name="world"/>
  <joint name="my_box_joint" type="continuous" >
    <!-- axis is in the parent link frame coordintates -->
    <axis xyz="0 1 0" />
    <parent link="world" />
    <child link="my_box" />
    <!-- initial pose of my_box joint/link in the parent frame coordiantes -->
    <origin xyz="0 0 2" rpy="0 0 0" />
  </joint>
  <link name="my_box">
    <inertial>
      <mass value="1.0" />
      <!-- center of mass (com) is defined w.r.t. link local coordinate system -->
      <origin xyz="1 0 0" /> 
      <inertia  ixx="1.0" ixy="0.0"  ixz="0.0"  iyy="100.0"  iyz="0.0"  izz="1.0" />
    </inertial>
    <visual>
      <!-- visual origin is defined w.r.t. link local coordinate system -->
      <origin xyz="1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.05 0.05 0.10" />
      </geometry>
    </visual>
    <collision>
      <!-- collision origin is defined w.r.t. link local coordinate system -->
      <origin xyz="1 0 0" rpy="0 0 0 " />
      <geometry>
        <box size="0.05 0.05 0.10" />
      </geometry>
    </collision>
  </link>
  <gazebo reference="my_box">
    <material>Gazebo/Blue</material>
    <turnGravityOff>false</turnGravityOff>
  </gazebo>
</robot>

(I got it from the gazebo_worlds package in ROS)
When I run $ROS_ROOT/simulator_gazebo/gazebo/gazebo/bin/gzsdf print simple_box.urdf, I get the SDF translation out:
Warning [parser.cc:382] SDF has no <sdf> element in file[/home/jamuraa/ros/simulator_gazebo/gazebo_worlds/objects/simple_box.urdf]
Warning [parser.cc:291] parse from urdf file [/home/jamuraa/ros/simulator_gazebo/gazebo_worlds/objects/simple_box.urdf].
<sdf version='1.3'>
  <model name='simple_box'>
    <link name='my_box'>
      <pose>0.000000 0.000000 2.000000 0.000000 -0.000000 0.000000</pose>
      <inertial>
        <pose>1.000000 0.000000 0.000000 0.000000 -0.000000 0.000000</pose>
        <mass>1.000000</mass>
        <inertia>
          <ixx>1.000000</ixx>
          <ixy>0.000000</ixy>
          <ixz>0.000000</ixz>
          <iyy>100.000000</iyy>
          <iyz>0.000000</iyz>
          <izz>1.000000</izz>
        </inertia>
      </inertial>
      <collision name='my_box_geom'>
        <pose>1.000000 0.000000 0.000000 0.000000 -0.000000 0.000000</pose>
        <geometry>
          <box>
            <size>0.050000 0.050000 0.100000</size>
          </box>
        </geometry>
        <surface>
          <contact>
            <ode/>
          </contact>
          <friction>
            <ode/>
          </friction>
        </surface>
      </collision>
      <visual name='my_box_visual'>
        <pose>1.000000 0.000000 0.000000 0.000000 -0.000000 0.000000</pose>
        <geometry>
          <box>
            <size>0.050000 0.050000 0.100000</size>
          </box>
        </geometry>
        <material/>
      </visual>
      <gravity>1</gravity>
      <velocity_decay>
        <linear>0.000000</linear>
        <angular>0.000000</angular>
      </velocity_decay>
      <self_collide>0</self_collide>
    </link>
    <joint name='my_box_joint' type='revolute'>
      <child>my_box</child>
      <parent>world</parent>
      <axis>
        <xyz>0.000000 1.000000 0.000000</xyz>
        <limit>
          <lower>-10000000000000000.000000</lower>
          <upper>10000000000000000.000000</upper>
        </limit>
        <dynamics/>
      </axis>
    </joint>
  </model>
</sdf>

However, when I run the converter $ROS_ROOT/simulator_gazebo/gazebo/gazebo/bin/gzsdf convert simple_box.urdf then I get a segmentation fault.
(gdb) run convert simple_box.urdf
Starting program: /home/jamuraa/ros/simulator_gazebo/gazebo/gazebo/bin/gzsdf convert simple_box.urdf
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
[New Thread 0x7fffe8127700 (LWP 9867)]
Program received signal SIGSEGV, Segmentation fault. 0x00007ffff7bd29fa in TiXmlAttributeSet::Find(char const*) const () from /usr/lib/libtinyxml.so.2.6.2 (gdb) bt
#0  0x00007ffff7bd29fa in TiXmlAttributeSet::Find(char const*) const () from /usr/lib/libtinyxml.so.2.6.2
#1  0x00007ffff7bd2c7d in TiXmlElement::Attribute(char const*) const () from /usr/lib/libtinyxml.so.2.6.2
#2  0x00007ffff7951d65 in sdf::Converter::Convert (_doc=0x7fffffffd210, _toVersion=...,
_quiet=true)
    at /home/jamuraa/ros/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/sdf/interface/Converter.cc:42
#3  0x000000000040617c in main (argc=3, argv=0x7fffffffd3f8)
    at /home/jamuraa/ros/simulator_gazebo/gazebo/build/gazebo-hg/tools/gzsdf.cc:122 (gdb) f 2
#2  0x00007ffff7951d65 in sdf::Converter::Convert (_doc=0x7fffffffd210, _toVersion=...,
_quiet=true)
    at /home/jamuraa/ros/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/sdf/interface/Converter.cc:42 42      if (!elem->Attribute("version")) (gdb) p elem $1 = (TiXmlElement *) 0x0 (gdb) p _doc $2 = (TiXmlDocument *) 0x7fffffffd210

Originally posted by jamuraa on Gazebo Answers with karma: 1 on 2012-12-05
Post score: 0

A:

Hi,
don't forget to source setup.bash, ~/path/gazebo$ source setup.bash
On the older version of Gazebo ~ 1.0 I have been using these commands to switch a model from urdf to sdf.
rosrun gazebo urdf2model -f yourmodel.urdf -o oldgazeboformat.xml (changes the urdf to gazebo model)
then
gzsdf print oldgazeboformat.xml > yourmodel.sdf (from gazebo model to sdf)
Cheers,
Andrei

Originally posted by AndreiHaidu with karma: 2108 on 2012-12-06
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by jamuraa on 2012-12-06:
In the newer version of this stack (for Gazebo 1.3) there is no urdf2model.  I assume we are meant to use gzsdf since it seems to handle URDF to sdf (the print of the urdf works fine at least)

