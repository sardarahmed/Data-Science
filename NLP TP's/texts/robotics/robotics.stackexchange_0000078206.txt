Q:

Astra Orbec camera in ROS problems

Hi!
Been trying to get the Astra Orbec camera to work with ROS in OS Ubuntu Indigo 14.04 LTS to work however without results.
This is what I got so far;

The device seems to be seen by the computer;

running lsusb gives the following:
Bus 002 Device 006: ID 05ac:8404 Apple, Inc. Internal Memory Card Reader
Bus 002 Device 005: ID 05ac:024d Apple, Inc. Internal Keyboard/Trackpad (MacBook Air) (ISO)
Bus 002 Device 009: ID 05ac:821f Apple, Inc. Built-in Bluetooth 2.0+EDR HCI
Bus 002 Device 004: ID 0a5c:4500 Broadcom Corp. BCM2046B1 USB 2.0 Hub (part of BCM2046 Bluetooth)
Bus 002 Device 003: ID 0424:2513 Standard Microsystems Corp. 2.0 Hub
Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 003: ID 05ac:8510 Apple, Inc. FaceTime HD Camera (Built-in)
Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 004 Device 002: ID 0781:5581 SanDisk Corp. Ultra
Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 003 Device 004: ID 0b95:1790 ASIX Electronics Corp. AX88179 Gigabit Ethernet
Bus 003 Device 008: ID 2bc5:0401
Bus 003 Device 003: ID 0409:0058 NEC Corp. HighSpeed Hub
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub

while running lsusb -v gives this:
Bus 003 Device 008: ID 2bc5:0401
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass            0 (Defined at Interface level)
  bDeviceSubClass         0 
  bDeviceProtocol         0 
  bMaxPacketSize0        64
  idVendor           0x2bc5 
  idProduct          0x0401 
  bcdDevice            0.01
  iManufacturer           1 ORBBEC
  iProduct                2 ASTRA
  iSerial                 0 
  bNumConfigurations      1
  Configuration Descriptor:
    bLength                 9
    bDescriptorType         2
    wTotalLength           32
    bNumInterfaces          1
    bConfigurationValue     1
    iConfiguration          0 
    bmAttributes         0x80
      (Bus Powered)
    MaxPower              500mA
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        0
      bAlternateSetting       0
      bNumEndpoints           2
      bInterfaceClass       255 Vendor Specific Class
      bInterfaceSubClass      0 
      bInterfaceProtocol      0 
      iInterface              3 ORBBEC Depth Sensor
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x81  EP 1 IN
        bmAttributes            2
          Transfer Type            Bulk
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0200  1x 512 bytes
        bInterval               1
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x82  EP 2 IN
        bmAttributes            2
          Transfer Type            Bulk
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0200  1x 512 bytes
        bInterval               1
Device Qualifier (for other device speed):
  bLength                10
  bDescriptorType         6
  bcdUSB               2.00
  bDeviceClass            0 (Defined at Interface level)
  bDeviceSubClass         0 
  bDeviceProtocol         0 
  bMaxPacketSize0        64
  bNumConfigurations      0
Device Status:     0x0000
  (Bus Powered)

I went to this webpage orbbec3d.com/develop and downloaded the file with the button text Doownload OpenNI 2 for Linux
Extracted the file 2-Linux.zip and followed the instructions given in the Readme file.
So no worries so far, however when trying to run the step 3 in the readme file,the code fails. (the file readme file is the following);
1,goto catkin workshop dir and compiler astra_camera
$ catkin_make --pkg astra_camera

note: astra driver provide two work method, normal and
 filter. with filter driver, get better quality depth 
data but need high-performance platform , like pc.
 if you work in the ARM, suggest to use normal method. 
 you can use -DFILTER=ON / OFF to change the method.

$ catkin_make --pkg astra_camera -DFILTER=OFF

2,create astra udev rule
$ roscd astra_camera && ./scripts/create_udev_rules

3,run astra_camera
use astra 
$ roslaunch astra_launch astra.launch
use astra pro (uvc rgb )
$ roslaunch astra_launch astrapro.launch

4,you can use rviz or image_view to verify driver

about firmware upgrade
1, only for Astra and Astra S. /**********important*********/
2, run on x86, x64, arm, arm64 platform, and depend on 
zip/unzip, awk, tail, md5sum

On step 3 it cannot run the following code roslaunch astra_launch astra.launch
When tapping the tab button it cannot find the astra_launch.launch file and the only thing it can find is the following: roslaunch astra_camera
After some digging I found out that there is no launch file however there is one folder at Orbecs github where there is a launch file, orbbec/ros_astra_launch. Uncertain how to exactly incorporate the launch file in the already created catkin workspace I simply added the folder launch into the folder src in the catkin_ws folder and skipping the two other files
CMakeLists and package.xml
Went to catkin_ws folder in the terminal and ran the code catkin_make --pkg astra_launch
It builds all the way, and when tapping the tab button the launch file is recognized but I am unsuccessful with getting the image or anything at all from the camera, the output is the following that I get;
kenan@kenan-MacBookAir:~/catkin_ws$ roslaunch astra_launch astra.launch 
... logging to /home/kenan/.ros/log/b119246e-d41d-11e6-bc93-705681c03dbb/roslaunch-kenan-MacBookAir-4466.log
Checking log directory for disk usage. This may take awhile.
Press Ctrl-C to interrupt
Done checking log file disk usage. Usage is <1GB.

started roslaunch server http://kenan-MacBookAir:42985/

SUMMARY
========

PARAMETERS
 * /camera/camera_nodelet_manager/num_worker_threads: 4
 * /camera/depth_rectify_depth/interpolation: 0
 * /camera/driver/auto_exposure: True
 * /camera/driver/auto_white_balance: True
 * /camera/driver/bootorder: 0
 * /camera/driver/color_depth_synchronization: False
 * /camera/driver/depth_camera_info_url: 
 * /camera/driver/depth_frame_id: camera_depth_opti...
 * /camera/driver/depth_registration: False
 * /camera/driver/device_id: #1
 * /camera/driver/devnums: 1
 * /camera/driver/rgb_camera_info_url: 
 * /camera/driver/rgb_frame_id: camera_rgb_optica...
 * /rosdistro: indigo
 * /rosversion: 1.11.20

NODES
  /camera/
    camera_nodelet_manager (nodelet/nodelet)
    depth_metric (nodelet/nodelet)
    depth_metric_rect (nodelet/nodelet)
    depth_points (nodelet/nodelet)
    depth_rectify_depth (nodelet/nodelet)
    depth_registered_sw_metric_rect (nodelet/nodelet)
    driver (nodelet/nodelet)
    points_xyzrgb_sw_registered (nodelet/nodelet)
    register_depth_rgb (nodelet/nodelet)
    rgb_rectify_color (nodelet/nodelet)
  /
    camera_base_link (tf/static_transform_publisher)
    camera_base_link1 (tf/static_transform_publisher)
    camera_base_link2 (tf/static_transform_publisher)
    camera_base_link3 (tf/static_transform_publisher)

auto-starting new master
process[master]: started with pid [4478]
ROS_MASTER_URI=http://localhost:11311

setting /run_id to b119246e-d41d-11e6-bc93-705681c03dbb
process[rosout-1]: started with pid [4491]
started core service [/rosout]
process[camera/camera_nodelet_manager-2]: started with pid [4494]
process[camera/driver-3]: started with pid [4495]
process[camera/rgb_rectify_color-4]: started with pid [4496]
process[camera/depth_rectify_depth-5]: started with pid [4497]
process[camera/depth_metric_rect-6]: started with pid [4498]
process[camera/depth_metric-7]: started with pid [4499]
process[camera/depth_points-8]: started with pid [4500]
process[camera/register_depth_rgb-9]: started with pid [4501]
process[camera/points_xyzrgb_sw_registered-10]: started with pid [4502]
process[camera/depth_registered_sw_metric_rect-11]: started with pid [4503]
process[camera_base_link-12]: started with pid [4504]
process[camera_base_link1-13]: started with pid [4505]
process[camera_base_link2-14]: started with pid [4506]
process[camera_base_link3-15]: started with pid [4507]
[ INFO] [1483713468.270806046]: Initializing nodelet with 4 worker threads.
[ERROR] [1483713469.291714078]: Failed to load nodelet [/camera/driver] of type [astra_camera/AstraDriverNodelet] even after refreshing the cache: According to the loaded plugin descriptions the class astra_camera/AstraDriverNodelet with base class type nodelet::Nodelet does not exist. Declared types are  depth_image_proc/convert_metric depth_image_proc/crop_foremost depth_image_proc/disparity depth_image_proc/point_cloud_xyz depth_image_proc/point_cloud_xyz_radial depth_image_proc/point_cloud_xyzi depth_image_proc/point_cloud_xyzi_radial depth_image_proc/point_cloud_xyzrgb depth_image_proc/register image_proc/crop_decimate image_proc/crop_nonZero image_proc/debayer image_proc/rectify image_rotate/image_rotate image_view/disparity image_view/image nodelet_tutorial_math/Plus pcl/BAGReader pcl/BoundaryEstimation pcl/ConvexHull2D pcl/CropBox pcl/EuclideanClusterExtraction pcl/ExtractIndices pcl/ExtractPolygonalPrismData pcl/FPFHEstimation pcl/FPFHEstimationOMP pcl/MomentInvariantsEstimation pcl/MovingLeastSquares pcl/NodeletDEMUX pcl/NodeletMUX pcl/NormalEstimation pcl/NormalEstimationOMP pcl/NormalEstimationTBB pcl/PCDReader pcl/PCDWriter pcl/PFHEstimation pcl/PassThrough pcl/PointCloudConcatenateDataSynchronizer pcl/PointCloudConcatenateFieldsSynchronizer pcl/PrincipalCurvaturesEstimation pcl/ProjectInliers pcl/RadiusOutlierRemoval pcl/SACSegmentation pcl/SACSegmentationFromNormals pcl/SHOTEstimation pcl/SHOTEstimationOMP pcl/SegmentDifferences pcl/StatisticalOutlierRemoval pcl/VFHEstimation pcl/VoxelGrid pointcloud_to_laserscan/pointcloud_to_laserscan_nodelet stereo_image_proc/disparity stereo_image_proc/point_cloud2
[ERROR] [1483713469.291827811]: The error before refreshing the cache was: According to the loaded plugin descriptions the class astra_camera/AstraDriverNodelet with base class type nodelet::Nodelet does not exist. Declared types are  depth_image_proc/convert_metric depth_image_proc/crop_foremost depth_image_proc/disparity depth_image_proc/point_cloud_xyz depth_image_proc/point_cloud_xyz_radial depth_image_proc/point_cloud_xyzi depth_image_proc/point_cloud_xyzi_radial depth_image_proc/point_cloud_xyzrgb depth_image_proc/register image_proc/crop_decimate image_proc/crop_nonZero image_proc/debayer image_proc/rectify image_rotate/image_rotate image_view/disparity image_view/image nodelet_tutorial_math/Plus pcl/BAGReader pcl/BoundaryEstimation pcl/ConvexHull2D pcl/CropBox pcl/EuclideanClusterExtraction pcl/ExtractIndices pcl/ExtractPolygonalPrismData pcl/FPFHEstimation pcl/FPFHEstimationOMP pcl/MomentInvariantsEstimation pcl/MovingLeastSquares pcl/NodeletDEMUX pcl/NodeletMUX pcl/NormalEstimation pcl/NormalEstimationOMP pcl/NormalEstimationTBB pcl/PCDReader pcl/PCDWriter pcl/PFHEstimation pcl/PassThrough pcl/PointCloudConcatenateDataSynchronizer pcl/PointCloudConcatenateFieldsSynchronizer pcl/PrincipalCurvaturesEstimation pcl/ProjectInliers pcl/RadiusOutlierRemoval pcl/SACSegmentation pcl/SACSegmentationFromNormals pcl/SHOTEstimation pcl/SHOTEstimationOMP pcl/SegmentDifferences pcl/StatisticalOutlierRemoval pcl/VFHEstimation pcl/VoxelGrid pointcloud_to_laserscan/pointcloud_to_laserscan_nodelet stereo_image_proc/disparity stereo_image_proc/point_cloud2
[FATAL] [1483713469.292021982]: Failed to load nodelet '/camera/driver` of type `astra_camera/AstraDriverNodelet` to manager `camera_nodelet_manager'
[camera/driver-3] process has died [pid 4495, exit code 255, cmd /opt/ros/indigo/lib/nodelet/nodelet load astra_camera/AstraDriverNodelet camera_nodelet_manager ir:=ir rgb:=rgb depth:=depth depth_registered:=depth_registered rgb/image:=rgb/image_raw depth/image:=depth_registered/image_raw __name:=driver __log:=/home/kenan/.ros/log/b119246e-d41d-11e6-bc93-705681c03dbb/camera-driver-3.log].
log file: /home/kenan/.ros/log/b119246e-d41d-11e6-bc93-705681c03dbb/camera-driver-3*.log

Would apprichiate all the help I can get.
Best regards

Originally posted by LTHstudent2017 on ROS Answers with karma: 21 on 2017-01-06
Post score: 2

A:

You don't need to download any software from the orbbec website. The "official" software provided by Orbbec directly is generally very low quality. You can instead simply download these two packages via apt-get: ros-indigo-astra-camera and ros-indigo-astra-launch. Then roslaunch astra_launch astra.launch and you're done. :)

Originally posted by Martin GÃ¼nther with karma: 11816 on 2017-01-23
This answer was ACCEPTED on the original site
Post score: 1

