Q:

Inserting into a Rosbag

Is there any way to add to a message to a rosbag at the beginning? I know you can append to a rosbag, but I want the message at the beginning.
Inserting all the other messages in afterward screws up the timing.

Originally posted by David Lu on ROS Answers with karma: 10932 on 2012-05-04
Post score: 1

A:

I think rosbag Cookbook can do what you want. http://www.ros.org/wiki/rosbag/Cookbook
By section 1.2 of that link you do the following
import rosbag

with rosbag.Bag('input.bag', 'a') as bag:
    from std_msgs.msg import String
    metadata = String(data='my metadata')

    for _, _, t in bag.read_messages():
        break
    bag.write('/metadata', metadata, t - roslib.rostime.Duration(0, 1))

Of course this does require post processing the data which may not be desirable.

Originally posted by Dustin with karma: 328 on 2012-05-05
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by tik0 on 2016-08-29:
bag.write appends to a bagfile, but your code gets the emit time of the first message and substracts one usec, so that the metadata is the first message being emitted which results in a mess. To get a proper bag you'll need to add subprocess.Popen(['rosbag', 'fix', 'input.bag', 'output.bag'])

