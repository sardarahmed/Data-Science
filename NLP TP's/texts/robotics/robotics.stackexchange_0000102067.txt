Q:

ROS Fanuc connectivity is not working

Dear all,
My question concerns about specific details needed so that we can see movements that occur inside ROS/MoveIt/Rviz also in the simulated robot inside Roboguide.
Briefly, I use Ubuntu 18.04.2 LTS bionic and ros-melodic. I have ROS/Moveit respositories for fanuc.
On Windows side, I have installed Roboguide. I have followed this link and this link to make necessary configurations inside Roboguide on the virtual controller. When creating the work-cell, I chose fanuc cr7ial robot model.
On Linux side, specifically, I used fanuc_cr7ial_moveit_config repo.
On the TP, I have started the ROS TPE program. The following message appears:
34161     RSTA Waiting for ROS state prox
34161     RREL Waiting for ROS traj relay

then I run the following on a terminal in ROS pc.
roslaunch fanuc_cr7ial_moveit_config moveit_planning_execution.launch robot_ip:=192.168.0.10 use_bswap:=false

I do not see any message appearing on TP and although no fault / error appears on TP, but there is no communication.
If I jog the robotic arm within Roboguide,  I do not see the respective arm in RViz being moved. Also, If I plan and execute something on ROS side, I do not see it on Roboguide.
Please, what can be the cause of this problem.
thanks,
Zahid
Edit
Following suggestions posted by @gvdhoorn,
roslaunch --screen fanuc_cr7ial_moveit_config moveit_planning_execution.launch robot_ip:=192.168.0.10 use_bswap:=false sim:=false

the screen output was the following.
process[joint_state-1]: started with pid [12635]
[ INFO] [1657117743.881851298]: Added message handler for message type: 0
process[motion_streaming_interface-2]: started with pid [12636]
[ INFO] [1657117743.883528553]: Robot state connecting to IP address: '192.168.0.10:11002'
/home/zahid/catkin_ws/devel/lib/fanuc_driver/robot_state: symbol lookup error: /home/zahid/catkin_ws/devel/lib/libindustrial_robot_client.so: undefined symbol: _ZN16industrial_utils5param13getJointNamesENSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES6_RSt6vectorIS6_SaIS6_EE
process[joint_trajectory_action-3]: started with pid [12643]
[ INFO] [1657117743.890495378]: Joint Trajectory Interface connecting to IP address: '192.168.0.10:11000'
/home/zahid/catkin_ws/devel/lib/fanuc_driver/motion_streaming_interface: symbol lookup error: /home/zahid/catkin_ws/devel/lib/libindustrial_robot_client.so: undefined symbol: _ZN16industrial_utils5param13getJointNamesENSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES6_RSt6vectorIS6_SaIS6_EE
process[robot_state_publisher-4]: started with pid [12648]
[ INFO] [1657117743.902072233]: Adding joint_1 to list parameter
[ INFO] [1657117743.902644332]: Adding joint_2 to list parameter
[ INFO] [1657117743.902685828]: Adding joint_3 to list parameter
[ INFO] [1657117743.902716902]: Adding joint_4 to list parameter
[ INFO] [1657117743.902752660]: Adding joint_5 to list parameter
[ INFO] [1657117743.902768290]: Adding joint_6 to list parameter
[ INFO] [1657117743.902854863]: Found user-specified joint names in 'controller_joint_names': [joint_1, joint_2, joint_3, joint_4, joint_5, joint_6]
[ INFO] [1657117743.902900481]: Filtered joint names to 6 joints
process[move_group-5]: started with pid [12654]
[joint_state-1] process has died [pid 12635, exit code 127, cmd /home/zahid/catkin_ws/devel/lib/fanuc_driver/robot_state __name:=joint_state __log:=/home/zahid/.ros/log/1f9cd900-fcfc-11ec-b71a-34e12da72407/joint_state-1.log].
log file: /home/zahid/.ros/log/1f9cd900-fcfc-11ec-b71a-34e12da72407/joint_state-1*.log
process[rviz_zahid_Strix_GL504GM_GL504GM_12595_5571255664066723439-6]: started with pid [12661]
[motion_streaming_interface-2] process has died [pid 12636, exit code 127, cmd /home/zahid/catkin_ws/devel/lib/fanuc_driver/motion_streaming_interface __name:=motion_streaming_interface __log:=/home/zahid/.ros/log/1f9cd900-fcfc-11ec-b71a-34e12da72407/motion_streaming_interface-2.log].
log file: /home/zahid/.ros/log/1f9cd900-fcfc-11ec-b71a-34e12da72407/motion_streaming_interface-2*.log
[ INFO] [1657117743.941869753]: Loading robot model 'fanuc_cr7ial'...
[ INFO] [1657117743.957972704]: rviz version 1.13.23
[ INFO] [1657117743.958032796]: compiled against Qt version 5.9.5
[ INFO] [1657117743.958046271]: compiled against OGRE version 1.9.0 (Ghadamon)
[ INFO] [1657117743.961113858]: Forcing OpenGl version 0.
[ WARN] [1657117743.970367120]: Kinematics solver doesn't support #attempts anymore, but only a timeout.
Please remove the parameter '/robot_description_kinematics/manipulator/kinematics_solver_attempts' from your configuration.
[ WARN] [1657117743.976498202]: IK plugin for group 'manipulator' relies on deprecated API. Please implement initialize(RobotModel, ...).
[ INFO] [1657117743.978530072]: IK Using joint link_1 -2.9671 2.9671
[ INFO] [1657117743.978554796]: IK Using joint link_2 -1.15192 1.74533
[ INFO] [1657117743.978568258]: IK Using joint link_3 -0.802851 3.10669
[ INFO] [1657117743.978579662]: IK Using joint link_4 -3.3161 3.3161
[ INFO] [1657117743.978590476]: IK Using joint link_5 -2.0944 2.0944
[ INFO] [1657117743.978603837]: IK Using joint link_6 -6.2832 6.2832
[ INFO] [1657117743.978620491]: Looking in common namespaces for param name: manipulator/position_only_ik
[ INFO] [1657117743.979484455]: Looking in common namespaces for param name: manipulator/solve_type
[ INFO] [1657117743.980444204]: Using solve type Distance
[ INFO] [1657117743.993523291]: Publishing maintained planning scene on 'monitored_planning_scene'
[ INFO] [1657117743.994934858]: MoveGroup debug mode is OFF
Starting planning scene monitors...
[ INFO] [1657117743.994958327]: Starting planning scene monitor
[ INFO] [1657117743.996308272]: Listening to '/planning_scene'
[ INFO] [1657117743.996335004]: Starting world geometry update monitor for collision objects, attached objects, octomap updates.
[ INFO] [1657117743.998852244]: Listening to '/collision_object'
[ INFO] [1657117744.000396300]: Listening to '/planning_scene_world' for planning scene world geometry
[ERROR] [1657117744.000993167]: No sensor plugin specified for octomap updater 0; ignoring.
[ERROR] [1657117744.001009371]: No sensor plugin specified for octomap updater 1; ignoring.
[ INFO] [1657117744.004882048]: Listening to '/attached_collision_object' for attached collision objects
Planning scene monitors started.
[ INFO] [1657117744.023713749]: Initializing OMPL interface using ROS parameters
[ INFO] [1657117744.036754677]: Using planning interface 'OMPL'
[ INFO] [1657117744.040351507]: Param 'default_workspace_bounds' was not set. Using default value: 10
[ INFO] [1657117744.040798324]: Param 'start_state_max_bounds_error' was set to 0.1
[ INFO] [1657117744.040999076]: Param 'start_state_max_dt' was not set. Using default value: 0.5
[ INFO] [1657117744.041357349]: Param 'start_state_max_dt' was not set. Using default value: 0.5
[ INFO] [1657117744.041584809]: Param 'jiggle_fraction' was set to 0.05
[ INFO] [1657117744.041786016]: Param 'max_sampling_attempts' was not set. Using default value: 100
[ INFO] [1657117744.041825492]: Using planning request adapter 'Add Time Parameterization'
[ INFO] [1657117744.041839416]: Using planning request adapter 'Fix Workspace Bounds'
[ INFO] [1657117744.041857371]: Using planning request adapter 'Fix Start State Bounds'
[ INFO] [1657117744.041871620]: Using planning request adapter 'Fix Start State In Collision'
[ INFO] [1657117744.041882575]: Using planning request adapter 'Fix Start State Path Constraints'
[ INFO] [1657117744.302137777]: Added FollowJointTrajectory controller for 
[ INFO] [1657117744.302262144]: Returned 1 controllers in list
[ INFO] [1657117744.303230222]: Stereo is NOT SUPPORTED
[ INFO] [1657117744.303300037]: OpenGL device: NVIDIA GeForce GTX 1060/PCIe/SSE2
[ INFO] [1657117744.303351314]: OpenGl version: 4,6 (GLSL 4,6).
[ INFO] [1657117744.309852687]: Trajectory execution is managing controllers
Loading 'move_group/ApplyPlanningSceneService'...
Loading 'move_group/ClearOctomapService'...
Loading 'move_group/MoveGroupCartesianPathService'...
Loading 'move_group/MoveGroupExecuteTrajectoryAction'...
Loading 'move_group/MoveGroupGetPlanningSceneService'...
Loading 'move_group/MoveGroupKinematicsService'...
Loading 'move_group/MoveGroupMoveAction'...
Loading 'move_group/MoveGroupPickPlaceAction'...
Loading 'move_group/MoveGroupPlanService'...
Loading 'move_group/MoveGroupQueryPlannersService'...
Loading 'move_group/MoveGroupStateValidationService'...
[ INFO] [1657117744.348616851]: 

********************************************************
* MoveGroup using: 
*     - ApplyPlanningSceneService
*     - ClearOctomapService
*     - CartesianPathService
*     - ExecuteTrajectoryAction
*     - GetPlanningSceneService
*     - KinematicsService
*     - MoveAction
*     - PickPlaceAction
*     - MotionPlanService
*     - QueryPlannersService
*     - StateValidationService
********************************************************

[ INFO] [1657117744.348665816]: MoveGroup context using planning plugin ompl_interface/OMPLPlanner
[ INFO] [1657117744.348682776]: MoveGroup context initialization complete

You can start planning now!

[ WARN] [1657117744.906641943]: Trajectory state not received for 1.000000 seconds
[ INFO] [1657117747.551888941]: Loading robot model 'fanuc_cr7ial'...
[ WARN] [1657117747.564847086]: Kinematics solver doesn't support #attempts anymore, but only a timeout.
Please remove the parameter '/rviz_zahid_Strix_GL504GM_GL504GM_12595_5571255664066723439/manipulator/kinematics_solver_attempts' from your configuration.
[ WARN] [1657117747.569227653]: IK plugin for group 'manipulator' relies on deprecated API. Please implement initialize(RobotModel, ...).
[ INFO] [1657117747.571421467]: IK Using joint link_1 -2.9671 2.9671
[ INFO] [1657117747.571447996]: IK Using joint link_2 -1.15192 1.74533
[ INFO] [1657117747.571457550]: IK Using joint link_3 -0.802851 3.10669
[ INFO] [1657117747.571464953]: IK Using joint link_4 -3.3161 3.3161
[ INFO] [1657117747.571474109]: IK Using joint link_5 -2.0944 2.0944
[ INFO] [1657117747.571481899]: IK Using joint link_6 -6.2832 6.2832
[ INFO] [1657117747.571499370]: Looking in common namespaces for param name: manipulator/position_only_ik
[ INFO] [1657117747.572508959]: Looking in common namespaces for param name: manipulator/solve_type
[ INFO] [1657117747.573307485]: Using solve type Distance
[ INFO] [1657117747.612519147]: Starting planning scene monitor
[ INFO] [1657117747.614312931]: Listening to '/move_group/monitored_planning_scene'
[ INFO] [1657117747.636875644]: Constructing new MoveGroup connection for group 'manipulator' in namespace ''
[ INFO] [1657117748.821589655]: Ready to take commands for planning group manipulator.
[ INFO] [1657117748.821723952]: Looking around: no
[ INFO] [1657117748.821783505]: Replanning: no

thanks,

Originally posted by zahid990170 on ROS Answers with karma: 135 on 2022-07-04
Post score: 0

A:

then I run the following on a terminal in ROS pc.
roslaunch fanuc_cr7ial_moveit_config moveit_planning_execution.launch robot_ip:=192.168.0.10 use_bswap:=false

I do not see any message appearing on TP and although no fault / error appears on TP, but there is no communication.
If I jog the robotic arm within Roboguide, I do not see the respective arm in RViz being moved. Also, If I plan and execute something on ROS side, I do not see it on Roboguide.

From the command line you show, this is expected, as you're not specifying sim:=false, which tells moveit_planning_execution.launch to use the real driver to connect to a real / Roboguide simulated controller.
For the driver, Roboguide is "a real controller", as Roboguide runs the same controller software and the same Karel and TP programs as a real R-30iB(+) (which you likely use with a real CR-7iA/L).
This is explained in Running the ROS-Industrial driver programs on your Fanuc robot, section 3. Outline, bullets 3 and 4.
Treat Roboguide as a real controller, but know it requires use_bswap:=false, as Roboguide is a little-endian program (in contrast to a real controller, which is big-endian).
Having written all of this, I'd suggest to use fanuc_driver_exp instead of fanuc_driver. It won't be very much better in terms of motion performance, but it's a bit nicer in terms of structure and network robustness. It will also know how to deal with e-stops.

Edit:

[joint_state-1] process has died [pid 12635, exit code 127, cmd /home/zahid/catkin_ws/devel/lib/fanuc_driver/robot_state __name:=joint_state __log:=/home/zahid/.ros/log/1f9cd900-fcfc-11ec-b71a-34e12da72407/joint_state-1.log].

log file: /home/zahid/.ros/log/1f9cd900-fcfc-11ec-b71a-34e12da72407/joint_state-1*.log
process[rviz_zahid_Strix_GL504GM_GL504GM_12595_5571255664066723439-6]: started with pid [12661]
[motion_streaming_interface-2] process has died [pid 12636, exit code 127, cmd /home/zahid/catkin_ws/devel/lib/fanuc_driver/motion_streaming_interface __name:=motion_streaming_interface __log:=/home/zahid/.ros/log/1f9cd900-fcfc-11ec-b71a-34e12da72407/motion_streaming_interface-2.log].
log file: /home/zahid/.ros/log/1f9cd900-fcfc-11ec-b71a-34e12da72407/motion_streaming_interface-2*.log

as you can see from these two lines, both driver nodes exit due to symbol resolution problems.
So the ROS nodes are not running, which means there is no connection. It would be expected to not see RViz follow the robot, and not being able the command the robot in Roboguide as the driver is essentially not active.

I used catkin build now, and I have edited my original post with complete output. Now, I do not have the connection.

Did you rm -rf /home/zahid/catkin_ws/devel /home/zahid/catkin_ws/build /home/zahid/catkin_ws/install before rebuilding with catkin build? The error message seems to indicate something is wrong with the libraries (symbols are missing). I'm a little confused as to how that would happen, as it all works OK on the test system(s) I have, and "nothing has changed" afaik.

Originally posted by gvdhoorn with karma: 86574 on 2022-07-04
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by zahid990170 on 2022-07-05:
thanks @gvdhoorn, I've tried with passing sim:=false option to the launch script, but, still no message (connection acknowledgment)  appears on TP screen, and subsequently no communication. Could there be firewall issues, I can ping the computer where Roboguide is installed.
Comment by gvdhoorn on 2022-07-05:\

Could there be firewall issues

yes, could be.
Check to make sure external hosts are allowed to connect to tcp://:11000 and tcp://:11002.
Easiest check would be to disable the firewall completely -- temporarily -- and see whether things start working.
If not, it's not the firewall.
And make sure to use the IP address of the PC which is running Roboguide, not whatever IP address the controller has inside Roboguide (but I believe you are already doing that).
Finally: run your .launch file like this:
roslaunch --screen fanuc_cr7ial_moveit_config moveit_planning_execution.launch robot_ip:=192.168.0.10 use_bswap:=false sim:=false

That should print more information to the terminal.
You should see some confirmation of connection, or errors / warnings in case it couldn't connect.
Comment by zahid990170 on 2022-07-06:
thanks @gvdhoorn, yes, it printed the following
[ INFO] [1657115166.352950658]: Added message handler for message type: 0
[ INFO] [1657115166.357077653]: Robot state connecting to IP address: '192.168.0.10:11002'
[ INFO] [1657115166.357114876]: Joint Trajectory Interface connecting to IP address: '192.168.0.10:11000'
/home/zahid/catkin_ws/devel/lib/fanuc_driver/robot_state: symbol lookup error: /home/zahid/catkin_ws/devel/lib/libindustrial_robot_client.so: undefined symbol: _ZN16industrial_utils5param13getJointNamesENSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES6_RSt6vectorIS6_SaIS6_EE
/home/zahid/catkin_ws/devel/lib/fanuc_driver/motion_streaming_interface: symbol lookup error: /home/zahid/catkin_ws/devel/lib/libindustrial_robot_client.so: undefined symbol: _ZN16industrial_utils5param13getJointNamesENSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES6_RSt6vectorIS6_SaIS6_EE

thanks,
Comment by gvdhoorn on 2022-07-06:
You should not see any errors or warnings, so what you copy-paste here is not good.
I would suggest to first fix that, because it is blocking you from connecting to the controller.
Comment by gvdhoorn on 2022-07-06:
Please copy the complete output from your roslaunch --screen ... command and paste it as an edit into your original question text. Use the edit button/link to edit it. Do not post it here as a comment.
Comment by gvdhoorn on 2022-07-06:
Do not mix catkin_tools (ie: catkin build) with catkin_make. Choose one and stick to it.
I'd recommend removing build, devel and install (if you have it), and then rebuilding your workspace.
And without the previously requested output, I cannot help you.
Comment by zahid990170 on 2022-07-06:
I used catkin build now, and I have edited my original post with complete output. Now, I do not have the connection.

