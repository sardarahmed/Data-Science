Q:

Obtaining nav_msgs/Odometry from a laser_scan (eg. with laser_scan_matcher)

Is it possible to obtain nav_msgs/Odometry message expressed in base_link basing on laser measurements with any existing package? I'd like to feed it to base_local_planner in the future, and laser measurements is all I have to estimate odometry.
E.g. the laser_scan_matcher package publishes a base_link->odom tf and an equivalent message geometry_msgs/Pose2D expressed in odom frame. As laser_scan_matcher's outcome is of a cumulative nature, I'm guessing twist (velocity) information is calculated internally as first. So maybe, with some tweaking, it would be possible to make it publish nav_msgs/Odometry expressed in base_link, too?
Or is there another way of solving this issue?

Originally posted by tom on ROS Answers with karma: 1079 on 2011-12-30
Post score: 4

A:

It looks like the scan matcher isn't measuring velocity directly, but it is computing the delta in the laser position, which you could combine with the time between laser scans to produce a rough estimate of velocity, subject to jitter in your laser frequency and any errors in the scan matching.
Since laser_scan_matcher doesn't publish stamped poses, you'll have to modify laser_scan_matcher directly to compute this output.
LaserScan has a timestamp in the message header that you can use to compute the time between scans.

Originally posted by ahendrix with karma: 47576 on 2011-12-31
This answer was ACCEPTED on the original site
Post score: 5

Original comments
Comment by Cav on 2012-01-30:
awesome, thank you!
Comment by tom on 2012-01-29:
Here you are, hope it's the working version :). http://pastebin.com/Nd4ekeuj http://pastebin.com/WgBpiaqH
Comment by Cav on 2012-01-24:
@tom: Could you publish your changes somewhere? I'd like to use it, too.
Comment by tom on 2012-01-04:
Thanks, that's exactly what I did.
Comment by mpai227 on 2015-07-08:
just came upon this thread. @tom - your code was very helpful, thanks a lot!. There were a few bugs which I fixed and it worked fine. If someone needs the code do leave a message I will be happy to share!
Comment by lisayoung on 2015-07-22:
@mpai227 Can you share your code please? I want to get the odometry msg from laser_scan_matcher. Thank you!
Comment by TomSon on 2015-09-21:
@mpai227 Yes can you share it, that's for me a fondamental piece of code. It should be an optionnal param of laser_scan_matcher :)
Comment by Clack on 2016-07-09:
@mpai227 Many thanks to your code!
Comment by femitof on 2020-02-26:
HI @mpai227 I tried using the code, but it throws these errors when i catkin_make:
laser_scan_matcher_node.cpp:(.text+0x1f9): undefined reference to scan_tools::LaserScanMatcher::~LaserScanMatcher()' laser_scan_matcher_node.cpp:(.text+0x34c): undefined reference to scan_tools::LaserScanMatcher::~LaserScanMatcher()'
laser_scan_matcher_node.cpp:(.text+0x374): undefined reference to scan_tools::LaserScanMatcher::~LaserScanMatcher()' laser_scan_matcher_node.cpp:(.text+0x388): undefined reference to scan_tools::LaserScanMatcher::~LaserScanMatcher()'
collect2: error: ld returned 1 exit status
scan_tools/laser_scan_matcher/CMakeFiles/laser_scan_matcher_node.dir/build.make:312: recipe for target '/home/femi/catkin_ws/devel/lib/laser_scan_matcher/laser_scan_matcher_node' failed
Comment by femitof on 2020-02-26:
@Tomson did the code work for you? If yes can you share please

