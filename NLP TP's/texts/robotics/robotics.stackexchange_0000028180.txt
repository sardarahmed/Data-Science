Q:

Find ground height in Gazebo WorldPlugin

Hi,
In a Gazebo WorldPlugin, I would like to know the ground position below a point. Sadly it seems that it can't have access to rendering::Scene which offers such methods.
Is there another methods to do so accessible from a WorldPlugin ?

Originally posted by NoWiS on Gazebo Answers with karma: 1 on 2017-06-14
Post score: 0

A:

Basically, you can access the HeightmapShape, and use it to compute the height :
// Get the HeightmapShape
physics::ModelPtr model = parent->GetModel( "heightmap" );
physics::HeightmapShape* hm = dynamic_cast<physics::HeightmapShape*>( model->GetLink("link")->GetCollision("collision")->GetShape().get() );        

// The HeightmapShape does not work with the same coordinate system, so get some data:
math::Vector3 size = hm->GetSize(); 
math::Vector2i vc = hm->GetVertexCount();
double ss = static_cast<double>( hm->GetSubSampling() );

// And finally get your z from your x and y:
double z = hm->GetHeight( (x + size.x/2)/size.x*vc.x - 1, (y + size.y/2)/size.y*vc.y - 1);

Be careful, this example

makes no safety checks
suppose the heightmap orgin is 0,0,0

Originally posted by NoWiS with karma: 1 on 2017-06-22
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by tahsinkose on 2019-05-30:
I'm not sure whether it works for Heightmaps produced with images, but I tested this with a DEM file and it didn't work. Also the formula does not involve subsampling. Is something missing?

