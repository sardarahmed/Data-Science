Q:

Gazebo dead slow on 8x2.7GHz cpu with a NVidia GT650m gpu

To simulate our robots super fast, hopefully near real time, I ordered a laptop with an 8-core Intel i7-3830QM CPU and a NVidia GT 650m GPU, but with a Intel HD4000 gpu on the motherboard too. I heard NVidia is reasonably well supported under linux nowadays, so NVidia instead of ATi.
I installed a fresh Ubuntu 10.04 Lucid, and not all was well:
Long story short, Gazebo runs dead slow this laptop, at 0.01x realtime and 7-8 fps.
Also, the Z-buffer is messed up, showing some further surfaces in front of nearer surfaces.
Any clues on how to fix this, maybe where to get newer drivers for this card under linux etc?
RViz segfaults directly, but that's something for a different question, I guess.
EDIT: I did try the latest (the day before yesterday) NVidia drivers for this GPU but that lets gnome run in low graphics mode.
EDIT2:
Running lshw gives this:

pci:0
desc: PCI bridge
*- display UNCLAIMED
desc: VGA controller
vendor: nVidia
display,
desc: VGA controller
vendor: Intel
version: 09

Originally posted by Loy on ROS Answers with karma: 141 on 2012-06-13
Post score: 1

Original comments
Comment by Rydel on 2012-06-13:
network bottleneck?
Comment by Loy on 2012-06-13:
Its not the network, as Gazebo only runs locally and not with ros nodes over a network in this setup for now.

A:

Does that laptop have Optimus? Did you check that the nvidia card is actually running and not the intel card is used?
If the intel card is running you should switch to the nvidia card, if that is possible.

Originally posted by dornhege with karma: 31395 on 2012-06-13
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Loy on 2012-06-13:
Yep, it has Optimus, with a sticker promising great battery life and great performance. I don't care for the battery life and the performance isn't that great, to say the least.
Comment by Loy on 2012-06-13:
How do I check if the NVidia-card is being used? EDIT: added lshw output to original question
Comment by fmarques on 2012-06-13:
you have to install bumblebee or ironhide, and before running anything you want to render with nvidia you have to put optirun. Like this optirun roslaunch ....
Comment by Loy on 2012-06-14:
Thanks, I'll try this ASAP.
Comment by John Hoare on 2012-06-14:
Some laptops allow you to turn off Optimus, allowing you to only use the nvidia card. I had terrible luck & stability problems using bumblebee/ironhide, and had a much better experience using a laptop that allowed me to turn off the optimus stuff.
Comment by Loy on 2012-06-14:
We tried that already, but even the advanced settings aren't so advanced. There is nothing useful there.
Comment by fmarques on 2012-06-15:
Have you been able to run gazebo normally already? My laptop is i7 2620 and with a nvidia gt550m and I can run gazebo with optirun but I had alot a problems but it's possible.
Comment by Loy on 2012-06-17:
Yes, I have been able to, but using the onboard Intel HD4000, which is supported under ubuntu 11.10. I havent had the time to try bumblebee, I'm leaving for RoboCup in Mexico tomorrow, lots of other prepping.
Good to hear it is actually possible. That laptop is now a quadboot, with a working 10.04, a broken one, 11.10 that works and a 12.04 to try some stuff too.

