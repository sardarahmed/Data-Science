Q:

error: ‘bag’ does not name a type

I have added rosbag dependencies in cmakefile.txt and package.xml and included essential ros headers but still catkin_make shows errors ( this not name a type that not name a type). Please help i really dont understand whats going wrong.
i have copied file from this ros tutorial : (http://wiki.ros.org/rosbag/Code%20API)

Make Error :
 error: ‘bag’ does not name a type
 bag.open("~/bagfiles/2016-12-20-18-18-30.bag", rosbag::bagmode::Read);
 ^
/home/mandeep/catkin_ws/src/proto1/proto1_moveit/src/rosplay.cpp:11:1: error: ‘topics’ does not name a type
 topics.push_back(std::string("chatter"));
 ^
/home/mandeep/catkin_ws/src/proto1/proto1_moveit/src/rosplay.cpp:12:1: error: ‘topics’ does not name a type
 topics.push_back(std::string("numbers"));
 ^
/home/mandeep/catkin_ws/src/proto1/proto1_moveit/src/rosplay.cpp:16:2: error: expected unqualified-id before ‘if’
 foreach(rosbag::MessageInstance const m, view)
  ^
/home/mandeep/catkin_ws/src/proto1/proto1_moveit/src/rosplay.cpp:16:44: error: expected unqualified-id before ‘else’
 foreach(rosbag::MessageInstance const m, view)
                                            ^
/home/mandeep/catkin_ws/src/proto1/proto1_moveit/src/rosplay.cpp:16:897: error: expected unqualified-id before ‘else’
 foreach(rosbag::MessageInstance const m, view)

rosplay.cpp
#include <rosbag/bag.h>
#include <rosbag/view.h>

#include <boost/foreach.hpp>
#define foreach BOOST_FOREACH

rosbag::Bag bag;
bag.open("~/bagfiles/2016-12-20-18-18-30.bag", rosbag::bagmode::Read);

std::vector<std::string> topics;
topics.push_back(std::string("chatter"));
topics.push_back(std::string("numbers"));

rosbag::View view(bag, rosbag::TopicQuery(topics));

foreach(rosbag::MessageInstance const m, view)
{
    std_msgs::String::ConstPtr s = m.instantiate<std_msgs::String>();
    if (s != NULL)
        ASSERT_EQ(s->data, std::string("foo"));

    std_msgs::Int32::ConstPtr i = m.instantiate<std_msgs::Int32>();
    if (i != NULL)
        ASSERT_EQ(i->data, 42);
}

bag.close();

There goes my Cmakefiles.txt : Highlighted part added for rosplay.cpp
cmake_minimum_required(VERSION 2.8.3)
project(proto1_moveit)

set(CMAKE_MODULE_PATH ${CMAKE_CURRENT_LIST_DIR}/cmake-modules)  ####CHANGE
set(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)  ####CHANGE
set(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/lib)  ####CHANGE

find_package(catkin REQUIRED COMPONENTS
             moveit_core
             moveit_ros_planning
             moveit_ros_planning_interface
             pluginlib
             rosbag
             cmake_modules
             geometric_shapes
             joint_trajectory_controller
             joint_trajectory_action
             moveit_simple_controller_manager
             industrial_robot_simulator
             actionlib
             actionlib_msgs
             control_msgs
             trajectory_msgs
             moveit_msgs
             shape_msgs
             chef_arm_kinematics
)

find_package(MySqlClient REQUIRED) ###CHANGE

find_package(Boost REQUIRED system filesystem date_time thread)

find_package(Eigen REQUIRED)
include_directories(SYSTEM ${Boost_INCLUDE_DIR} ${EIGEN_INCLUDE_DIRS} ${catkin_INCLUDE_DIRS})

include_directories(${MYSQL_INCLUDE_DIRS}) ###CHANGE

catkin_package(
  INCLUDE_DIRS 
    include
  LIBRARIES 
    ik_utils_proto
    pick_proto
    place_proto
    dispense_proto
    stir_proto
  CATKIN_DEPENDS 
    rosbag
    moveit_core
    moveit_ros_planning_interface
    interactive_markers
    std_msgs
    actionlib_msgs
    shape_msgs
    chef_arm_kinematics
)

add_definitions(${MYSQL_DEFINITIONS}) ##CHANGE

add_library(pick_proto src/pick_proto.cpp) 
target_link_libraries(pick_proto ${catkin_LIBRARIES} ${Boost_LIBRARIES} ${MYSQL_LIBRARIES}) ###CHANGE
install(TARGETS pick_proto
  ARCHIVE DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
  LIBRARY DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
  RUNTIME DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
)
add_library(place_proto src/place_proto.cpp) 
target_link_libraries(place_proto ${catkin_LIBRARIES} ${Boost_LIBRARIES} ${MYSQL_LIBRARIES}) ###CHANGE
install(TARGETS place_proto
  ARCHIVE DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
  LIBRARY DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
  RUNTIME DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
)
add_library(dispense_proto src/dispense_proto.cpp) 
target_link_libraries(dispense_proto ${catkin_LIBRARIES} ${Boost_LIBRARIES} ${MYSQL_LIBRARIES}) ###CHANGE
install(TARGETS dispense_proto
  ARCHIVE DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
  LIBRARY DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
  RUNTIME DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
)
add_library(stir_proto src/stir_proto.cpp) 
target_link_libraries(stir_proto ${catkin_LIBRARIES} ${Boost_LIBRARIES} ${MYSQL_LIBRARIES}) ###CHANGE
install(TARGETS stir_proto
  ARCHIVE DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
  LIBRARY DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
  RUNTIME DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
)
add_executable(environment_proto src/environment_proto.cpp)
target_link_libraries(environment_proto ${catkin_LIBRARIES} ${Boost_LIBRARIES} ${MYSQL_LIBRARIES}) ###CHANGE
install(TARGETS environment_proto DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION})

**add_executable(rosplay src/rosplay.cpp)
target_link_libraries(rosplay ${catkin_LIBRARIES} ${Boost_LIBRARIES}) 
install(TARGETS rosplay DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION})**

install(DIRECTORY launch DESTINATION ${CATKIN_PACKAGE_SHARE_DESTINATION})
install(DIRECTORY config DESTINATION ${CATKIN_PACKAGE_SHARE_DESTINATION})

and there goes my package.xml
<package>

  <name>proto1_moveit</name>
  <version>0.2.0</version>
  <description>
     An automatically generated package with all the configuration and launch files for using the description with the MoveIt Motion Planning Framework
  </description>
  <author email="assistant@moveit.ros.org">MoveIt Setup Assistant</author>
  <maintainer email="assistant@moveit.ros.org">MoveIt Setup Assistant</maintainer>

  <license>BSD</license>

  <url type="website">http://moveit.ros.org/</url>
  <url type="bugtracker">https://github.com/ros-planning/moveit_setup_assistant/issues</url>
  <url type="repository">https://github.com/ros-planning/moveit_setup_assistant</url>

  <run_depend>moveit_core</run_depend>
  <run_depend>moveit_ros_planning</run_depend>
  <run_depend>moveit_ros_planning_interface</run_depend>
  <run_depend>pluginlib</run_depend>
  <run_depend>cmake_modules</run_depend>
  <run_depend>geometric_shapes</run_depend>
  <run_depend>interactive_markers</run_depend>
  <run_depend>moveit_ros_move_group</run_depend>
  <run_depend>moveit_planners_ompl</run_depend>
  <run_depend>moveit_ros_visualization</run_depend>
  <run_depend>joint_state_publisher</run_depend>
  <run_depend>robot_state_publisher</run_depend>
  <run_depend>xacro</run_depend>
  <run_depend>moveit_simple_controller_manager</run_depend>
  <run_depend>joint_trajectory_controller</run_depend>
  <run_depend>industrial_robot_simulator</run_depend>
  <run_depend>actionlib</run_depend>
  <run_depend>trajectory_msgs</run_depend>
  <run_depend>control_msgs</run_depend>
  <run_depend>joint_trajectory_action</run_depend>
  <run_depend>std_msgs</run_depend>
  <run_depend>actionlib_msgs</run_depend>
  <run_depend>shape_msgs</run_depend>
  <run_depend>chef_arm_kinematics</run_depend>
  <run_depend>rosbag</run_depend>

  <build_depend>shape_msgs</build_depend>
  <build_depend>pluginlib</build_depend>
  <build_depend>moveit_core</build_depend>
  <build_depend>moveit_ros_planning_interface</build_depend>
  <build_depend>moveit_ros_perception</build_depend>
  <build_depend>interactive_markers</build_depend>
  <build_depend>cmake_modules</build_depend>
  <build_depend>geometric_shapes</build_depend>
  <build_depend>moveit_simple_controller_manager</build_depend>
  <build_depend>joint_trajectory_controller</build_depend>
  <build_depend>bot_arm</build_depend>
  <build_depend>actionlib</build_depend>
  <build_depend>trajectory_msgs</build_depend>
  <build_depend>control_msgs</build_depend>
  <build_depend>joint_trajectory_action</build_depend>
  <build_depend>std_msgs</build_depend>
  <build_depend>actionlib_msgs</build_depend>
  <build_depend>chef_arm_kinematics</build_depend>
  <build_depend>rosbag</build_depend>

  <buildtool_depend>catkin</buildtool_depend>
    <export>
    <cpp lflags="-lmysqlclient"/>
  </export>
</package>

Originally posted by Mandeep Singh on ROS Answers with karma: 36 on 2016-12-20
Post score: 0

Original comments
Comment by gvdhoorn on 2016-12-20:
Please include your CMakeLists.txt and package.xml and an example of the kind of errors you are getting.
We cannot help you without the proper information.
Comment by Mandeep Singh on 2016-12-21:
I have added more info please help me.

A:

I have solved the problem :
the cpp file given on ros tutorial is not ready for direct usage (f).
We need to include it in int main()
and include a few more libraries like
#include <std_msgs/String.h>
#include <std_msgs/Int32.h>
and
remove ASSERT_EQ as it will further give error.
rosplay.cpp
#include <ros/ros.h>
#include <rosbag/view.h>

#include <gtest/gtest.h>
#include <std_msgs/String.h>
#include <std_msgs/Int32.h>
#include <boost/foreach.hpp>

#define foreach BOOST_FOREACH

int main (int argc, char** argv)
{
    ros::init (argc, argv, "bag_it");
    rosbag::Bag bag;
    bag.open("~/bagfiles/2016-12-20-18-18-30.bag", rosbag::bagmode::Read);

    std::vector<std::string> topics;
    topics.push_back(std::string("chatter"));
    topics.push_back(std::string("numbers"));

    rosbag::View view(bag, rosbag::TopicQuery(topics));

    foreach(rosbag::MessageInstance const m, view)
    {
        std_msgs::String::ConstPtr s = m.instantiate<std_msgs::String>();
        if (s != NULL)
            std::cout << s->data << std::endl;

        std_msgs::Int32::ConstPtr i = m.instantiate<std_msgs::Int32>();
        if (i != NULL)
            std::cout << i->data << std::endl;
    }

    bag.close();
    return (0);
}

Originally posted by Mandeep Singh with karma: 36 on 2016-12-21
This answer was ACCEPTED on the original site
Post score: 2

