Q:

the map produced by gmapping was a mess

I was trying to use gmapping to build a map, I've checked the odometry it was accurate.But the map was like this:

I also tried hector mapping,(with odometry and without odometry both),and the map was good.I'd like to find out what's wrong with gmapping?
the bag file can be downloaded link text

Originally posted by Kent on ROS Answers with karma: 140 on 2013-01-13
Post score: 2

Original comments
Comment by Gav on 2013-01-13:
Try the troubleshooting under section 2.2 here : http://ros.org/wiki/navigation/Tutorials/Navigation%20Tuning%20Guide
and make sure your odometry looks good.
Comment by Ben_S on 2013-01-14:
Could you provide a bag file of a short drive-around containing only the laser, odometry and tf information?
Comment by Kent on 2013-01-14:
yep, u can download the bag at http://l3.yunpan.cn/lk/QvjJE3xNW7ABY
Comment by Zuhair95 on 2022-06-17:
Dear Kent,
Can you please tell me how did you check the odometry accuracy ?
thanks.

A:

I think the problem lies in your rotated laser scanner. You have turned the frame of the scanner 90 degrees clockwise around the z-axis and changed the min_ and max_angle of your laserscan message so that the center is still pointing forward.
I am just trying if i am able to fix gmapping to work under that conditions, but i am not sure, if i will succeed.
Is there any reason for that rotated laserframe? I would suggest changing your laserscan driver (btw: which model and driver do you use?) to have the x-axis pointing forward and having the range readings symmetrical to the left and right of the zero yaw-angle.

Edit: I found the real problem: Your scanner reports a field of view of 270 degrees and an angle increment of 0.5 degrees (like you mentioned). So you would expect about 540 rays per scan. But in reality there are 1081 readings in each message! So gmapping tries matching a 540 degrees field of view...
There must be something wrong with your laser driver. The first 540 readings are correct, but there are another 540 zero-readings in each laserscan message.

Originally posted by Ben_S with karma: 2510 on 2013-01-14
This answer was ACCEPTED on the original site
Post score: 4

Original comments
Comment by Kent on 2013-01-14:
Sorry, I didn't quite catch ya. I m using SICK LMS100 laser range finder, with 270 degree laser coverage and resolution of 0.5 degree. I checked the laser dots shown in the rviz, they fit the environment quite well after I turn the scanner frame 90 degree clockwise about the z-axis.
Comment by Ben_S on 2013-01-14:
Yes, thats because your scanner returns this values in the message: "angle_min: -0.785398185253 angle_max: 3.92699074745" But GMapping assumes that a laser scan is centered around the x-axis of the laser-frame. Thats why its messed up. Could you post your sick-driver launch file?
Comment by Kent on 2013-01-14:
Thanks. But the x axis of the laser frame coincides with the 0 degree. Should I modify the laser driver code? Or is there any short-cuts?
Comment by Kent on 2013-01-14:
my launch file is like this:

Comment by Ben_S on 2013-01-14:
I found the real problem: Your scanner reports a field of view of 270 degrees and an angle increment of 0.5 degrees (like you mentioned). But in reality there are 1081 readings in each message! So gmapping tries matching a 540 degrees field of view...
Comment by Kent on 2013-01-14:
U mean that the laser driver publish 1081 laser data (with correct laser data and a lot of zeros in it)in each msg? But I've also tried using this laser driver in hector mapping, everythings seemed fine
Comment by Ben_S on 2013-01-14:
GMapping is a little messy with the angles. The underlying routines dont know anything about min- and max-angles. They calculate them solely by the number of readings and the reported angle increment. This isnt very robust... (And it assumes the centered scans like i already mentioned)
Comment by Kent on 2013-01-14:
So the x axis of the laser frame should coincides with the x axis of the base frame, the laser data should starts at 90 degree, and the number of the laser data should be fixed by delete that redundant zeros?
Comment by Eric Perko on 2013-01-14:
The x-axis of the laser frame should be "forwards" on the laser scanner. Use TF to describe the transform to your base frame. The laser data should be output however the scanner outputs it (usually centered about the +x-axis, with FOV/2 readings to the left and FOV/2 readings to the right).
Comment by Eric Perko on 2013-01-14:
And you should only have (FOV / increment)+1 readings in each message. For example, for a 180 degree scanner with 1 degree increments, you would have 181 readings. For your scanner, 541 readings is what I would expect.
Comment by Eric Perko on 2013-01-14:
Also... how is your laser configured? Is it configured to output multiple returns (i.e. multi-echo)?
Comment by Ben_S on 2013-01-14:
Discarding the zeros, there are exactly 541 readings (as one would expect). So i guess there are no problems with multi-echos.
Comment by Kent on 2013-01-14:
solved! I rewrote the ang_max and ang_min in the laser driver to make the x axis of the laser driver pointing forward.Everything is ok! Thanks guys~

