Q:

RVIZ error - tf contained unnormalized quaternion

Hi all,
Hopefully this is a quick fix that I'm too tired to see. I have a node broadcasting a transformation from a global frame 'gps' to a local frame 'ant' from the information in an odometry message,
void localClass::baseCallback(const nav_msgs::Odometry::ConstPtr& msg) {
static tf::TransformBroadcaster br;
tf::Transform transformBase;
tf::Quaternion qBase;

qBase.setRPY(0,0,0);

transformBase.setOrigin(tf::Vector3(msg->pose.pose.position.x,msg->pose.pose.position.y,msg->pose.pose.position.z));

transformBase.setRotation(qBase);

br.sendTransform(tf::StampedTransform(transformBase, msg->header.stamp, "gps", "ant"));

The tfMessage looks like this,
---
transforms: 
  - 
    header: 
      seq: 0
      stamp: 
        secs: 1502926197
        nsecs: 819865990
      frame_id: gps
    child_frame_id: ant
    transform: 
      translation: 
        x: 8.434
        y: 115.857
        z: 1.022
      rotation: 
        x: 0.0
        y: 0.0
        z: 0.0
        w: 1.0
---

However, RVIZ seems to have an issue with this super simple transformation. The error message is,

Message contained unnormalized
quaternion (squares of values don't
add to 1)

but a 0,0,0,1 quaternion is normalized.
I suspect that this is not a simple fix but I would appreciate any suggestions or recommendations.
Thanks.

Originally posted by Tyrone Nowell on ROS Answers with karma: 48 on 2017-10-11
Post score: 0

A:

Try running roswtf. It should print a message with the offending transform parent and child frame_id.
http://wiki.ros.org/roswtf
https://github.com/ros/geometry/blob/indigo-devel/tf/src/tf/tfwtf.py#L134

Originally posted by kmhallen with karma: 1416 on 2017-10-11
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Tyrone Nowell on 2017-10-26:
Thanks, roswtf helped. The problem seemed to be an issue with the 'tf' package. I reinstalled it and it came right.

