Q:

Heading estimation with GPS heading

I'm tuning a kalman filter for position estimation of an outdoor robot, and I'm seeing significant compass interference which is producing significant errors in the final position estimate.
My other sensors are: 3-axis gyro, 3-axis accel, GPS and a wheel speed sensor.
I'm considering an approach where I estimate heading based mostly on GPS heading while my vehicle is moving, instead of relying heavily on the compass for heading.
Has anyone else tried this, either with one of the existing ROS kalman filter nodes or with a custom filter?

Originally posted by ahendrix on ROS Answers with karma: 47576 on 2015-06-18
Post score: 1

A:

I haven't tried that exactly, but I have worked with multiple source of heading information using robot_localization. You'd have to make sure your GPS driver (or some other node) converts your GPS heading data into a PoseWithCovarianceStamped message. You may also want to either stop sending GPS-sourced heading messages when the vehicle is at rest, or dynamically modify the covariances of the heading sensors based on your current state (moving, turning, resting, etc.). I'd also suggest turning relative mode on for both heading sources.
What is causing the compass interference? Is it distortions from the metal and electronics on board your robot, or is it due to external sources?

Originally posted by Tom Moore with karma: 13689 on 2015-06-18
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by ahendrix on 2015-06-18:
OK, I'll give that a try. My compass error is coming from external sources, so there isn't much I can do about it. (I've already calibrated out the hard-iron interference from my chassis)
Comment by M@t on 2016-08-08:
For reference, I calculate the heading from sequential GPS position measurements (and use a rolling average so it's only valid in straight lines), and use this to check the IMU heading. Compared to GPS, my IMU (built into the CR Jackal) will naturally drift by 3-7 degrees.
Comment by ahendrix on 2016-08-08:
I have a GPS which provides heading directly as part of the GPRMC message.
Comment by tomy983 on 2022-11-13:
Hi ahendrix, I have the same problem as yours. My imu works quite well most of the times, but in a area where I test my robot the magnetometer goes crazy, also causing crashes. I have mounted a ZED-F9P, which can output an heading and its precision. When the robot is stationary, the heading is not updated and the precision goes to 180 degrees... So this part is kind of sorted... How did you go about the direction of movement? I mean, it's probably all good until driving straight ahead or smooth turns, but what about backwards maneuvers?

