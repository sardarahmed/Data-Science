Q:

Openni Gazebo Plugin stepsize for depth images (bug?)

In the current Fuerte distribution of the libgazebo_ros openni plugin for Gazebo, it seems to be impossible to obtain both the RGB as well as the depth image information. If I look in the code of gazebo_plugins/src/gazebo_ros_openni_kinect.cpp, it seems that on line 381 the stepsize for the sensor_msg/image is not set correctly. It is set to 1, whereas to my opinion it should be set to the number of rows times the type (in the case of a float times 4), to obtain the correct number of bytes.
Is someone familiar with this problem? And does anybody know how to fix this nicely?
Cheers,
Rob
PS: both the PR2 and Turtlebot models also seem to have erronous or non-existing depth images
PS2: our forked source code for the plugin can be found at https://amigo.wtb.tue.nl/svn/amigo/code/tue-ros-pkg/trunk/tue_simulator/amigo_simulation_controllers/src/kinect_controller_fuerte.cpp (for fuerte, including coloured pointcloud) and https://amigo.wtb.tue.nl/svn/amigo/code/tue-ros-pkg/trunk/tue_simulator/amigo_simulation_controllers/src/kinect_controller_electric.cpp (for electric, with grayscale pointcloud). A URDF configuration file can be found at https://amigo.wtb.tue.nl/svn/amigo/code/tue-ros-pkg/trunk/tue_robot_models/amigo_robot_model/description/gazebo/gazebo.urdf.xacro, where one should pay attention to the 'base_kinect' and 'openni_camera' gazebo references.

Originally posted by Rob Janssen on ROS Answers with karma: 96 on 2012-10-11
Post score: 3

A:

This bug has been ticketed #5596. A patch is attached to the ticket.

Originally posted by piyushk with karma: 2871 on 2013-01-04
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by ZdenekM on 2013-01-04:
Is it going to be repaired even in ROS Electric? There is exactly the same issue with depth map. And moreover there is also issue with simulated point cloud where max. depth is not limited properly.
Comment by piyushk on 2013-01-04:
One of the stack maintainers will be able to comment on this. I would be surprised if this bugfix will be applied to the last Electric release, as that is pretty dated. I would recommend checking out gazebo_plugins and applying this patch locally. You might have to tweak it a bit to get it to work.
Comment by hsu on 2013-01-04:
@ZdenekM given most of us have moved on to ubuntu precise, the patch will not be applied in electric.
Comment by ncr7 on 2013-01-16:
I've just tried the patch on my ubuntu 12.04 precise setup and haven't had any luck with getting it to work.  I'm having the same issue as jamuraa, exact same image displayed in weird matrix.  It looks like the depth image is correct, but it just keeps replicating itself.
Comment by piyushk on 2013-01-17:
@ncr7: I am using this patch on simulator-gazebo 1.7.6 in ROS groovy. Could you comment on what version of ROS/simulator_gazebo you are using.
Comment by ncr7 on 2013-01-21:
I'm using ROS Fuerte, and from the manifest.xml file in gazebo, it looks like Fuerte is using gazebo 1.0.2
Comment by piyushk on 2013-01-22:
Did the patch get rejected in Fuerte? Fuerte is running simulator_gazebo 1.6.16, and it would be unlikely that it will work out of the box. You'll have to modify it by hand to get it to work.
Comment by ncr7 on 2013-01-22:
I was able to run a make on the gazebo_plug-in package without any errors after applying the patch... not sure what else I would need to modify by hand.
Comment by piyushk on 2013-01-22:
@ncr7: I am afraid I am at a loss. I'm not sure why it would not work.

