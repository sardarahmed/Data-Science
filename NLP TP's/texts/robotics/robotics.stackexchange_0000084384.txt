Q:

reading VelodyneScan from bagfile - offline

I am trying to read a bagfile  containing multiple velodyne data.
I want to do this  preferably without rosbag play  as sometimes from my prev experience due to computation issues it may skip reading a node and lose than info.
so now, I have a rosbag file, containing VelodyneScan msgs from a v64 topic
I am using python2.
from past few hours googling and figuring out on my own,  i understand that it contains a main header and then subheader and data in perhaps uint32 format.
Lets say i read a message - msg
for topic, msg, t in bag.read_messages()
msg.header is:
seq: 6309
stamp:
secs: 1513822001
nsecs: 291831017
frame_id: velodyne
msg.packets is a list
len = 579
type( msg.packets[0]) = < class 'tmpbWvooI._velodyne_msgs__VelodynePacket'>
Thus there are 579 such packets. One way i could read the data is to go through one by one and append a np.arr with the data i am reading.
Even if i do that, how do i get X Y Z data from it? will it always be X1 Y1 Z1  X2 Y2 Z2  and so on? my first packet doesnt even have 3x numbers.. but that could be because it saved the remaining in following packets.
But there should be a prebuild method to do this right?
How can I read the data from a VelodyneScan in python (using ros and cv2) WITHOUT using rosbag play to listen to a different node.

Originally posted by icywhite on ROS Answers with karma: 1 on 2017-12-22
Post score: 0

A:

Hi @icywhite!
I think that your question involves many steps. You will probably have to:

Read the velodyne_msgs/VelodyneScan messages from a bag file
Convert those velodyne_msgs/VelodyneScan messages to sensor_msgs/PointCloud2
Read X, Y, Z values from PointCloud

You probably could extract X Y Z directly from the velodyne_msgs/VelodyneScan, but I'm not sure how to do that, then let's see by converting to PontoCloud2.

Reading a bag file

To read from a bag file we can follow http://wiki.ros.org/rosbag/Code%20API that has the following example:
import rosbag
bag = rosbag.Bag('test.bag')
for topic, msg, t in bag.read_messages(topics=['chatter', 'numbers']):
    print msg
bag.close()

In the example above, the topics chatter and numbers are being read from the test.bag file.

Converting velodyne_msgs/VelodyneScan messages to sensor_msgs/PointCloud2

To convert Velodyne messages to PointCloud, you can take a look at the velodyne_pointcloud package.
Or if you want to convert manually by yourself, you can take a look on the function processScan that converts velodyne_msgs::VelodyneScan to PointCloud.

Read XYZ from PointCloud2

To read XYZ from PointClouds, you could use the example below that is shown in another question:
import sensor_msgs.point_cloud2
...
for point in sensor_msgs.point_cloud2.read_points(msg, skip_nans=True):
            pt_x = point[0]
            pt_y = point[1]
            pt_z = point[2]

Cheers.

Originally posted by Ruben Alves with karma: 1038 on 2017-12-22
This answer was ACCEPTED on the original site
Post score: 2

