Q:

How to compile openni_ros with SSE2 only support?

Hello,
I have the latest Debian Diamondback packages installed on an older laptop (Sony Vaio VGN-TX750P) which makes a nice light brain for an iRobot Create.  I am having trouble getting a Kinect to work with the openni_ros stack.  I understand the Debian packages are compiled for SSE3 support and this laptop has only SSE2.  So I downloaded the openni_ros source from https://kforge.ros.org/openni/openni_ros and ran a "rosmake --rosdep-install".  The build completed without errors, but when trying to run "roslaunch openni_camera openni_node.launch" in debug mode, the node is dying with an "Illegal Instruction" error which I have come to learn usually means the package is still assuming SSE3 support.
Does anyone know how to tell the build process for openni_ros to only expect SSE2?
Thanks!
patrick

Originally posted by Pi Robot on ROS Answers with karma: 4046 on 2011-03-10
Post score: 2

A:

You'll have to modify at least the CMakeLists.txt file in the openni_camera package.
See the line
add_definitions (-Wno-missing-field-initializers -O4 -DNDEBUG -mfpmath=sse -msse4 -fopenmp)

You'll have to remove at least the -msse4 flag (and replace it with -msse2? Not 100% sure about that).
Also... not sure what is up with -O4... Pretty sure it doesn't do anything more than -O3 (which is often advised against anyways as it contains sometimes unstable optimizations).

Originally posted by Eric Perko with karma: 8406 on 2011-03-10
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by tom on 2011-03-14:
I issued a new ticket #4870 https://code.ros.org/trac/ros-pkg/ticket/4870 for openni_camera in module ni (there is no openni_kinect module in Trac yet). Please check if my description is good enough and maybe correct/enhance it. Cheers.
Comment by Eric Perko on 2011-03-11:
@tom: Probably just not being used. I suggest you file a bug ticket (after a quick check for any duplicate tickets) for any packages you find not using such macros (though I'm not sure if there is one to detect SSE4, which openni_camera is using). Something like http://goo.gl/qxxfC could be useful.
Comment by tom on 2011-03-11:
Sounds nice, I'll try it out. Now, I've seen in $ROS_ROOT/core/rosbuild/public.cmake there is a HAS_SSE3_EXTENSIONS macro, which is being used in some packages. Why not use it in openni_camera as well? Same could go to PCL.
Comment by Pi Robot on 2011-03-10:
Brilliant!  That did the trick.  I used -msse2 instead of -msse4 and -O3 instead of -O4 and now openni_node.launch fires up perfectly.  Many thanks!

