Q:

bullet_migration: electric and fuerte compatibility

Hello,
I'm trying to upgrade a project from Electric to Fuerte while still maintaining Electric compatibility (some systems will be on Electric for a while). I ran into an issue with tf and bullet. In the following code section, I need R defined as a btMatrix3x3 in Electric, but a tf::Matrix3x3 in Fuerte. Is there any way to have one set of code that will satisfy both? I would like to stay with the recommended Fuerte form, but I need it to work in both versions.
//world_to_camera is a tf::StampedTransform
//Electric version
btMatrix3x3 R;
R.setRotation(world_to_camera.inverse().getRotation());

Edit: In Electric, the error comes at tf::Matrix3x3 (Matrix3x3 is not a member of tf). In Fuerte, the error is at R.setRotation (no matching function call btMatrix3x3::setRotation(tf::Quaternion, can't convert tf::Quaternion to btQuaternion.) I tried putting .toBt() after .getRotation() in the migration guide, but I got the error Class tf::Quaternion has no member toBt.
I tried to follow the bullet_migration guide. The sed script doesn't work because it breaks in Electric. I'm sorry if this answer is obvious somewhere. Thanks for the help.

Originally posted by bwasserm on ROS Answers with karma: 23 on 2012-08-07
Post score: 1

A:

You can switch between fuerte and electric with the following code:
#if ROS_VERSION_MINIMUM(1,8,0)
  tf::Matrix3x3 R;      
#else
  btMatrix3x3 R;
#endif

R.setRotation(world_to_camera.inverse().getRotation());

Originally posted by AHornung with karma: 5904 on 2012-08-07
This answer was ACCEPTED on the original site
Post score: 5

Original comments
Comment by Lorenz on 2012-08-07:
Alternatively, if you have many occurrences of btMatrix3x3, you can put a typedef in a header file that defines tf::Matrix3x3 for older ros versions.
Comment by bwasserm on 2012-08-08:
Thanks, that worked. Except you got the types backwards, but I got the idea of what you meant.
Comment by AHornung on 2012-08-08:
Ah right - I'll edit that. You should also consider what Lorenz wrote, in case you have multiple occurrences.
Comment by bwasserm on 2012-08-08:
Cool. And I would, but for some reason its only the one definition that causes problems. It is probably the right way to go though.

