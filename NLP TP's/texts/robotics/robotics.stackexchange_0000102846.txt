Q:

smac lattice planner for differential robot

env: ros2 humble on ubuntu 22.04
I am trying to use smac lattice planner for my differential/rectangular robot. I noticed that when the robot arrives near goal, it parks as a vehicle and it does not rotate on goal. in nav2 documentation it says that the planner is suitable for differential non-circular robot. How can I make the robot rotate on goal ? here is the screen and config:

planner_server:
  ros__parameters:
    expected_planner_frequency: 20.0
    use_sim_time: False
    planner_plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_smac_planner/SmacPlannerLattice"
      allow_unknown: true  
      tolerance: 0.05
      max_iterations: 1000000         
      max_on_approach_iterations: 1000  
      max_planning_time: 5.0          
      analytic_expansion_ratio: 3.5 
      analytic_expansion_max_length: 4.0 
      reverse_penalty: 1.0 
      change_penalty: 0.05 
      non_straight_penalty: 1.05
      cost_penalty: 2.0
      rotation_penalty: 1.0               
      retrospective_penalty: 0.015
      lattice_filepath: "path_to_file/output.json" 
      lookup_table_size: 20.0  
      cache_obstacle_heuristic: true
      allow_reverse_expansion: true
      smooth_path: False

and for the primitive config:
{
    "motion_model": "diff",
    "turning_radius": 1.0,
    "grid_resolution": 0.05,
    "stopping_threshold": 5,
    "num_of_headings": 16
}

Originally posted by Youssef_Lah on ROS Answers with karma: 195 on 2022-12-21
Post score: 0

Original comments
Comment by Mike Scheutzow on 2022-12-24:
You don't seem to be distinguishing between a Planner and a Controller. Do you think the problem is that the Planner is not generating the pose you want, or that the Controller is not executing it?
Comment by Youssef_Lah on 2022-12-28:
the controller is following the exact path (as expected), but the generated path from the planner is not suitable for differential robot since differential robots can rotate in place, but if you see the screenshot, the robot will park as a vehicle to meet the requested orientation.

A:

"turning_radius" would be the first suspect I would check out. Right now it is set to 1 meter, which is consistent with the radius of the "turn maneuver" towards the end of the path you posted.
Have you tried to set the turning radius parameter to 0? (Which I assume it should enable "in place turn" for your differential robot)

Originally posted by Martin Peris with karma: 5625 on 2022-12-22
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Youssef_Lah on 2022-12-28:
when I set it to 0, the robot arrive to goal and stops, it does not rotate to meet the desired orientation.
Comment by Martin Peris on 2023-01-19:
You should checkout this https://github.com/ros-planning/navigation2/tree/main/nav2_smac_planner/lattice_primitives and make sure that your minimum control set contains in-place rotations. Another thing I would try is to lower the rotation_penalty to maybe 0.1 or 0.01 even, and see what happens
Comment by Youssef_Lah on 2023-01-26:
the minimum turning_radius value that I can set to generate the lattice file is 0.08, else the script got division by zero error, so I set it to 0.08 and I lowered the rotation_penalty and it worked. Thank you Martin.

