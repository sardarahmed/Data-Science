Q:

how to specify yaw-offset and magnetic declination radiance in robot_localization package?

hi
I want to know the meaning of yaw-offset! I want to use robot-localization pkg and I need to identify yaw-offset and magnetic declination radiance, I have checked robot-localization ros wiki, but I cannot understand what does the parameter w (omega), mean in the following formula:
http://docs.ros.org/en/melodic/api/robot_localization/html/integrating_gps.html
yaw-imu=−ω−offsetyaw+θ
θ=yaw-imu+ω+offsetyaw

jwould you please guide me, how can i specify yaw-offset and magnetic declination radiance. The IMU model is gx5-25
which provides orientation in quaternion format, angular acceleration and linear velocity.
@Tom Moore , would you please help me to find the correct solution?
Kind Regards

Originally posted by Delbina on ROS Answers with karma: 109 on 2021-12-06
Post score: 0

Original comments
Comment by Delbina on 2021-12-14:
Does anybody have any idea about this question?
Comment by Delbina on 2022-01-06:
@tom Moore
Would you please help me to find the answer of this question?
Comment by Delbina on 2022-01-07:
I found out that magnetic declination radiance can be calculated from: https://www.ngdc.noaa.gov/geomag/calculators/magcalc.shtml
But what about YAW-OFFSET, I really need to know how to calculate/ specify that!?
Do we need to calculate these two parameters for each new environment that we want to do the test?
thanks
Comment by Delbina on 2022-01-14:
in the robot-loccalization ros wiki, it is mentioned that if IMU faces east, the heading should report 0. How can i find out that the heading shows 0?? Should I use any other tools? or from the imu output, i can identify? Would you please help me to find the solution?
Comment by Sid05 on 2022-05-06:
Hi,
I have a followup question, didn't know if I can post it here but just to avoid confusion, I made a separate question, would really appreciate if I could get some guidance

A:

Your IMU probably reads 0 at magnetic north. But we need a heading reference that aligns with the UTM grid, where +X points east, and +Y points north. That means we need our heading from the IMU to read 0 when the robot is facing east. So we have two parameters (technically we have 3, but one, the UTM meridian convergence, is accounted for automatically in the code):

If we adjust for magnetic declination (using the magnetic_declination_radians parameter), we can get the IMU data to read 0 at true north, rather than magnetic north. But that means we have a heading of 0 when we face north, but we need it to be 0 when we face east, so...
...we need to adjust for that 90 degrees (pi/2 radians). That's what yaw_offset is for.

Here's where it gets used:
https://github.com/cra-ros-pkg/robot_localization/blob/0fe3097f58b4c7f7645aba20e0e675468182e707/src/navsat_transform.cpp#L286
Here's an example. In this case, we'll imagine our IMU is in Boston, MA, USA. Here's where an IMU would read 0:

But we need it to be 0 when facing east. So when it's facing magnetic north, we'd want the data from it to read
pi/2 + magnetic_declination_radians

So we need to add pi/2 + magnetic_declination_radians to every IMU reading before we can use it. In other words, yaw_offset here (and in most applications) would be pi/2.

Originally posted by Tom Moore with karma: 13689 on 2022-01-14
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by Delbina on 2022-01-14:
Thanks a lot for responding to this question @tom Moore

from which parameter from the IMU output, I can specify that it reads 0 when facing east!? orientation? angular_velocity? or linear_acceleration? OR all these outputs?

about the value that magnetic-declination radiance shows: (0° 39' E  ± 0° 23' ), should I consider just 0° 39' E ?  should i ignore ± 0° 23'??

Comment by Tom Moore on 2022-01-14:
You're interested in orientation, but you need to convert it to Euler angles first (ROS uses quaternions), and then you want the yaw angle.
Comment by Sid05 on 2022-05-20:
Hi,
Just wondering if it the yaw-offset should be -(pi/2) i.e -1.57 considering a  clockwise rotation from north to east ?
And from the convention, it mentions
By the right hand rule, the yaw component of orientation increases as the child frame rotates counter-clockwise, and for geographic poses, yaw is zero when pointing east.

Comment by Tom Moore on 2022-05-23:
The offset is the value you add to the reading to get the "correct" value. In the example above, if the IMU was aligned with magnetic north, then it would read 0 without any correction, but the REP says that 0 radians faces east, so we would want the IMU to read pi/2 + declination radians. So we have to add that to it.
Comment by Sid05 on 2022-05-24:
Thanks @Tom Moore
I have been trying to resolve issue with dual_ekf and navsat_transform for GPS based navigation in one of my other questions and its been weeks now. I would really appreciate if you could guide me there as well
Comment by Tom Moore on 2022-05-24:
Yes, I can only work on this package in my spare time (we don't use it at Locus), and my spare time is extremely limited. I'll get to your question as soon as I can.

