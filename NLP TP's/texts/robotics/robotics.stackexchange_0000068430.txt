Q:

cv_bridge/OpenCV segmentation fault

Hi,
I'm getting a segmentation fault whenever I'm trying to convert an image from subscribed topic to:
cv_bridge::CvImageConstPtr cv_ptr = cv_bridge::toCvCopy(image)

while this works:
cv_bridge::toCvShare(image)

I'm getting the same error when I call later:
cv::Mat newImage = cv_ptr->image.clone();

I'm using ROS Indigo, Ubuntu 14.04 and opencv 2.4.8 . I've checked my code on another computer with the same ROS/Ubuntu/OpenCV versions and it works fine...

Originally posted by prokto on ROS Answers with karma: 1 on 2015-07-03
Post score: 0

A:

Hi, it may be because the image is empty.
Before sending the image, you should check if it is not empty, and recheck its size before using it.
This callback works for me (Ubuntu 16.04, ROS kinetic, OpenCV 3) :
cv::Mat cameraFeed;
// Callback function. Serves to receive images from ROS camera's images topic
void imageCallback(const sensor_msgs::ImageConstPtr& msg)
{
    try
    {
        cameraFeed = cv_bridge::toCvCopy(msg, sensor_msgs::image_encodings::BGR8)->image;
    }
    catch (cv_bridge::Exception& e)
    {
        ROS_ERROR("Could not convert from '%s' to 'bgr8'.", msg->encoding.c_str());
        return;
    }
    cv::waitKey(1);
}

Originally posted by roach with karma: 116 on 2016-08-18
This answer was ACCEPTED on the original site
Post score: 1

