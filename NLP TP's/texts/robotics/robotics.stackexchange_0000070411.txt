Q:

RViz segfaults on startup

RViz crashes in 60% of the startsups with a segfault. I tried the RViz and TF2 versions from debians and from source.
Also I tried with and without a config file.
Seems like the segfaults originates from somewhere out of a dedicated transform listener thread.
Where could I search more deeper for a solution? Any hints are welcome.
Here are two different stacktraces:
Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x7fffd6e5b700 (LWP 13142)]
0x00007ffff459cfc0 in boost::signals2::detail::signal0_impl<void, boost::signals2::optional_last_value<void>, int, std::less<int>, boost::function<void ()>, boost::function<void (boost::signals2::connection const&)>, boost::signals2::mutex>::nolock_cleanup_connections_from(bool, std::_List_iterator<boost::shared_ptr<boost::signals2::detail::connection_body<std::pair<boost::signals2::detail::slot_meta_group, boost::optional<int> >, boost::signals2::slot0<void, boost::function<void ()> >, boost::signals2::mutex> > > const&, unsigned int) const () from /opt/ros/indigo/lib/libroscpp.so
(gdb) bt
#0 0x00007ffff459cfc0 in boost::signals2::detail::signal0_impl<void, boost::signals2::optional_last_value<void>, int, std::less<int>, boost::function<void ()>, boost::function<void (boost::signals2::connection const&)>, boost::signals2::mutex>::nolock_cleanup_connections_from(bool, std::_List_iterator<boost::shared_ptr<boost::signals2::detail::connection_body<std::pair<boost::signals2::detail::slot_meta_group, boost::optional<int> >, boost::signals2::slot0<void, boost::function<void ()> >, boost::signals2::mutex> > > const&, unsigned int) const () from /opt/ros/indigo/lib/libroscpp.so
#1 0x00007ffff459e89b in boost::signals2::detail::signal0_impl<void, boost::signals2::optional_last_value<void>, int, std::less<int>, boost::function<void ()>, boost::function<void (boost::signals2::connection const&)>, boost::signals2::mutex>::operator()() () from /opt/ros/indigo/lib/libroscpp.so
#2 0x00007fffef27efb2 in boost::signals2::signal0<void, boost::signals2::optional_last_value<void>, int, std::less<int>, boost::function<void ()>, boost::function<void (boost::signals2::connection const&)>, boost::signals2::mutex>::operator()() (this=0x1f093c0) at /usr/include/boost/signals2/detail/signal_template.hpp:695
#3 0x00007fffef276776 in tf2::BufferCore::testTransformableRequests (this=0x1f09250)
at /home/iki/rviz_ws/src/geometry_experimental/tf2/src/buffer_core.cpp:1376
#4 0x00007fffef272d25 in tf2::BufferCore::setTransform (this=0x1f09250, transform_in=..., authority=..., 
is_static=false) at /home/iki/rviz_ws/src/geometry_experimental/tf2/src/buffer_core.cpp:265
#5 0x00007fffef5bbb6b in tf2_ros::TransformListener::subscription_callback_impl (this=0x1f09490, msg_evt=..., 
is_static=false) at /home/iki/rviz_ws/src/geometry_experimental/tf2_ros/src/transform_listener.cpp:119
#6 0x00007fffef5bb95c in tf2_ros::TransformListener::subscription_callback (this=0x1f09490, msg_evt=...)
at /home/iki/rviz_ws/src/geometry_experimental/tf2_ros/src/transform_listener.cpp:95
#7 0x00007fffef5c41c8 in boost::_mfi::mf1<void, tf2_ros::TransformListener, ros::MessageEvent<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>::operator() (this=0x1f099f8, p=0x1f09490, a1=...)
at /usr/include/boost/bind/mem_fn_template.hpp:165
#8 0x00007fffef5c367f in boost::_bi::list2<boost::_bi::value<tf2_ros::TransformListener*>, boost::arg<1> >::operator()<boost::_mfi::mf1<void, tf2_ros::TransformListener, ros::MessageEvent<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>, boost::_bi::list1<boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> const&> > (this=0x1f09a08, 
f=..., a=...) at /usr/include/boost/bind/bind.hpp:313
#9 0x00007fffef5c2b2e in boost::_bi::bind_t<void, boost::_mfi::mf1<void, tf2_ros::TransformListener, ros::MessageEvent<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>, boost::_bi::list2<boost::_bi::value<tf2_ros::TransformListener*>, boost::arg<1> > >::operator()<boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> > (this=0x1f099f8, 
a1=...) at /usr/include/boost/bind/bind_template.hpp:47
#10 0x00007fffef5c1eaf in boost::detail::function::void_function_obj_invoker1<boost::_bi::bind_t<void, boost::_mfi::mf1<void, tf2_ros::TransformListener, ros::MessageEvent<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>, boost::_bi::list2<boost::_bi::value<tf2_ros::TransformListener*>, boost::arg<1> > >, void, boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>::invoke (function_obj_ptr=..., a0=...)
at /usr/include/boost/function/function_template.hpp:153
#11 0x00007fffef5c4417 in boost::function1<void, boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> cons
t&>::operator() (this=0x1f099f0, a0=...) at /usr/include/boost/function/function_template.hpp:767
#12 0x00007fffef5c3862 in boost::detail::function::void_function_obj_invoker1<boost::function<void (boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> const&)>, void, boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> >::invoke(boost::detail::function::function_buffer&, boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const>) (function_obj_ptr=..., a0=...) at /usr/include/boost/function/function_template.hpp:153
#13 0x00007fffef5c6274 in boost::function1<void, boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> >::operator() (this=0x1f09e18, a0=...) at /usr/include/boost/function/function_template.hpp:767
#14 0x00007fffef5c5a70 in ros::SubscriptionCallbackHelperT<boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> const&, void>::call (this=0x1f09e10, params=...) at /opt/ros/indigo/include/ros/subscription_callback_helper.h:144
#15 0x00007ffff45ee9c5 in ros::SubscriptionQueue::call() () from /opt/ros/indigo/lib/libroscpp.so
#16 0x00007ffff45ac777 in ros::CallbackQueue::callOneCB(ros::CallbackQueue::TLS*) ()
from /opt/ros/indigo/lib/libroscpp.so
#17 0x00007ffff45ad583 in ros::CallbackQueue::callAvailable(ros::WallDuration) () from /opt/ros/indigo/lib/libroscpp.so
#18 0x00007fffef5bd1b5 in tf2_ros::TransformListener::dedicatedListenerThread (this=0x1f09490)
at /home/iki/rviz_ws/src/geometry_experimental/tf2_ros/include/tf2_ros/transform_listener.h:80
#19 0x00007fffef5c67e3 in boost::_mfi::mf0<void, tf2_ros::TransformListener>::operator() (this=0x1f0ce48, p=0x1f09490)
at /usr/include/boost/bind/mem_fn_template.hpp:49
#20 0x00007fffef5c6560 in boost::_bi::list1<boost::_bi::value<tf2_ros::TransformListener*> >::operator()<boost::_mfi::mf0<void, tf2_ros::TransformListener>, boost::_bi::list0> (this=0x1f0ce58, f=..., a=...)
at /usr/include/boost/bind/bind.hpp:253
#21 0x00007fffef5c5de1 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, tf2_ros::TransformListener>, boost::_bi::list1<boost::_bi::value<tf2_ros::TransformListener*> > >::operator() (this=0x1f0ce48)
at /usr/include/boost/bind/bind_template.hpp:20
#22 0x00007fffef5c56e6 in boost::detail::thread_data<boost::_bi::bind_t<void, boost::_mfi::mf0<void, tf2_ros::TransformListener>, boost::_bi::list1<boost::_bi::value<tf2_ros::TransformListener*> > > >::run (this=0x1f0cc90)
at /usr/include/boost/thread/detail/thread.hpp:117
#23 0x00007ffff5968a4a in ?? () from /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.54.0
#24 0x00007ffff5747182 in start_thread (arg=0x7fffd6e5b700) at pthread_create.c:312
#25 0x00007ffff62f547d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x7fffd6e5b700 (LWP 24806)]
0x00007fffef28a441 in boost::unordered::detail::table<boost::unordered::detail::map<std::allocator<std::pair<std::string const, unsigned int> >, std::string, unsigned int, boost::hash<std::string>, std::equal_to<std::string> > >::begin (
this=0x1ff7e98, bucket_index=0) at /usr/include/boost/unordered/detail/table.hpp:257
257 return prev ? iterator(prev->next_) : iterator();
(gdb) bt
#0 0x00007fffef28a441 in boost::unordered::detail::table<boost::unordered::detail::map<std::allocator<std::pair<std::string const, unsigned int> >, std::string, unsigned int, boost::hash<std::string>, std::equal_to<std::string> > >::begin (
this=0x1ff7e98, bucket_index=0) at /usr/include/boost/unordered/detail/table.hpp:257
#1 0x00007fffef286600 in boost::unordered::detail::table_impl<boost::unordered::detail::map<std::allocator<std::pair<std::string const, unsigned int> >, std::string, unsigned int, boost::hash<std::string>, std::equal_to<std::string> > >::find_node_impl<std::string, std::equal_to<std::string> > (this=0x1ff7e98, key_hash=15803753784477690464, k=..., eq=...)
at /usr/include/boost/unordered/detail/unique.hpp:236
#2 0x00007fffef2828a9 in boost::unordered::detail::table<boost::unordered::detail::map<std::allocator<std::pair<std::string const, unsigned int> >, std::string, unsigned int, boost::hash<std::string>, std::equal_to<std::string> > >::find_node
(this=0x1ff7e98, k=...) at /usr/include/boost/unordered/detail/table.hpp:782
#3 0x00007fffef27df19 in boost::unordered::unordered_map<std::string, unsigned int, boost::hash<std::string>, std::equal_to<std::string>, std::allocator<std::pair<std::string const, unsigned int> > >::find (this=0x1ff7e98, k=...)
at /usr/include/boost/unordered/unordered_map.hpp:1208
#4 0x00007fffef273d03 in tf2::BufferCore::lookupOrInsertFrameNumber (this=0x1ff7e50, frameid_str=...)
at /home/iki/rviz_ws/src/geometry_experimental/tf2/src/buffer_core.cpp:817
#5 0x00007fffef272b03 in tf2::BufferCore::setTransform (this=0x1ff7e50, transform_in=..., authority=..., 
is_static=false) at /home/iki/rviz_ws/src/geometry_experimental/tf2/src/buffer_core.cpp:249
#6 0x00007fffef5bbb6b in tf2_ros::TransformListener::subscription_callback_impl (this=0x1ff8090, msg_evt=..., 
is_static=false) at /home/iki/rviz_ws/src/geometry_experimental/tf2_ros/src/transform_listener.cpp:119
#7 0x00007fffef5bb95c in tf2_ros::TransformListener::subscription_callback (this=0x1ff8090, msg_evt=...)
at /home/iki/rviz_ws/src/geometry_experimental/tf2_ros/src/transform_listener.cpp:95
#8 0x00007fffef5c41c8 in boost::_mfi::mf1<void, tf2_ros::TransformListener, ros::MessageEvent<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>::operator() (this=0x1ff84c8, p=0x1ff8090, a1=...)
at /usr/include/boost/bind/mem_fn_template.hpp:165
#9 0x00007fffef5c367f in boost::_bi::list2<boost::_bi::value<tf2_ros::TransformListener*>, boost::arg<1> >::operator()<boost::_mfi::mf1<void, tf2_ros::TransformListener, ros::MessageEvent<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>, boost::_bi::list1<boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> const&> > (this=0x1ff84d8, 
f=..., a=...) at /usr/include/boost/bind/bind.hpp:313
#10 0x00007fffef5c2b2e in boost::_bi::bind_t<void, boost::_mfi::mf1<void, tf2_ros::TransformListener, ros::MessageEvent<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>, boost::_bi::list2<boost::_bi::value<tf2_ros::TransformListener*>, boost::arg<1> > >::operator()<boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> > (this=0x1ff84c8, 
a1=...) at /usr/include/boost/bind/bind_template.hpp:47
#11 0x00007fffef5c1eaf in boost::detail::function::void_function_obj_invoker1<boost::_bi::bind_t<void, boost::_mfi::mf1<void, tf2_ros::TransformListener, ros::MessageEvent<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>, boost::_bi::list2<boost::_bi::value<tf2_ros::TransformListener*>, boost::arg<1> > >, void, boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>::invoke (function_obj_ptr=..., a0=...)
at /usr/include/boost/function/function_template.hpp:153
#12 0x00007fffef5c4417 in boost::function1<void, boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> const&>::operator() (this=0x1ff84c0, a0=...) at /usr/include/boost/function/function_template.hpp:767
#13 0x00007fffef5c3862 in boost::detail::function::void_function_obj_invoker1<boost::function<void (boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> const&)>, void, boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> >::invoke(boost::detail::function::function_buffer&, boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const>) (function_obj_ptr=..., a0=...) at /usr/include/boost/function/function_template.hpp:153
#14 0x00007fffef5c6274 in boost::function1<void, boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> >::operator() (this=0x1ff88e8, a0=...) at /usr/include/boost/function/function_template.hpp:767
#15 0x00007fffef5c5a70 in ros::SubscriptionCallbackHelperT<boost::shared_ptr<tf2_msgs::TFMessage_<std::allocator<void> > const> const&, void>::call (this=0x1ff88e0, params=...) at /opt/ros/indigo/include/ros/subscription_callback_helper.h:144
#16 0x00007ffff45ee9c5 in ros::SubscriptionQueue::call() () from /opt/ros/indigo/lib/libroscpp.so
#17 0x00007ffff45ac777 in ros::CallbackQueue::callOneCB(ros::CallbackQueue::TLS*) ()
from /opt/ros/indigo/lib/libroscpp.so
#18 0x00007ffff45ad583 in ros::CallbackQueue::callAvailable(ros::WallDuration) () from /opt/ros/indigo/lib/libroscpp.so
#19 0x00007fffef5bd1b5 in tf2_ros::TransformListener::dedicatedListenerThread (this=0x1ff8090)
at /home/iki/rviz_ws/src/geometry_experimental/tf2_ros/include/tf2_ros/transform_listener.h:80
#20 0x00007fffef5c67e3 in boost::_mfi::mf0<void, tf2_ros::TransformListener>::operator() (this=0x1e68048, p=0x1ff8090)
at /usr/include/boost/bind/mem_fn_template.hpp:49
#21 0x00007fffef5c6560 in boost::_bi::list1<boost::_bi::value<tf2_ros::TransformListener*> >::operator()<boost::_mfi::mf0<void, tf2_ros::TransformListener>, boost::_bi::list0> (this=0x1e68058, f=..., a=...)
at /usr/include/boost/bind/bind.hpp:253
#22 0x00007fffef5c5de1 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, tf2_ros::TransformListener>, boost::_bi::list1<boost::_bi::value<tf2_ros::TransformListener*> > >::operator() (this=0x1e68048)
at /usr/include/boost/bind/bind_template.hpp:20
#23 0x00007fffef5c56e6 in boost::detail::thread_data<boost::_bi::bind_t<void, boost::_mfi::mf0<void, tf2_ros::TransformListener>, boost::_bi::list1<boost::_bi::value<tf2_ros::TransformListener*> > > >::run (this=0x1e67e90)
at /usr/include/boost/thread/detail/thread.hpp:117
#24 0x00007ffff5968a4a in ?? () from /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.54.0
#25 0x00007ffff5747182 in start_thread (arg=0x7fffd6e5b700) at pthread_create.c:312
#26 0x00007ffff62f547d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Originally posted by BennyRe on ROS Answers with karma: 2949 on 2015-11-16
Post score: 0

Original comments
Comment by tfoote on 2015-11-16:
These tracebacks are very different parts of code, both of which are heavily used by almost every user. As such I would guess that there is something overwriting their memory space. I'd suggest trying out a memory debugging tool to see if they can catch anything.
Comment by William on 2015-11-16:
Are you running inside of rqt or are you using any custom rviz plugins?
Comment by BennyRe on 2015-11-17:
@william No I run it with rosrun rviz rviz and no custom plugins. I deleted the ~/.rviz folder to eliminate config problems but this didn't help. So our RViz crashes with default config and with our MoveIt! config. Now I'll try the memory tools.

A:

So we managed to get rid of this problem.
We think that this problem started back when I updated some of the ros core packages (roscpp, roscpp-core, rosmaster and some more).
Today we made a copy of our hard-drive and sudo apt-get upgradeed. Now everything is fine.
Seems like there was an incompatibility between an old and an new package.

Originally posted by BennyRe with karma: 2949 on 2015-11-18
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by gvdhoorn on 2015-11-18:
Yes, it is not really recommended to update only parts of a deb based ROS install. The current buildfarm setup does not guarantee binary compatibility between releases, and mix-and-matching pkgs can then result in really difficult to locate/debug issues, such as this SEGFAULT.
Comment by William on 2015-11-18:
I'd recommend using sudo apt-get dist-upgrade to try and avoid this problem.

