Q:

g_object_unref: assertion 'G_IS_OBJECT (object)' failed Attempt to unlock mutex that was not locked

Hello evryone, i am following this tutorial to create my image subscriber link text, using image_transport, however, i meet this problem when i run my subscriber.

(view:19049): GLib-GObject-CRITICAL
**: 22:58:39.962: g_object_unref: assertion 'G_IS_OBJECT (object)'
failed Attempt to unlock mutex that
was not locked Aborted (core dumped)
This is my source code:

#include <ros/ros.h>
#include <image_transport/image_transport.h>
#include <opencv2/highgui/highgui.hpp>
#include <cv_bridge/cv_bridge.h>

void imageCallback(const sensor_msgs::ImageConstPtr& msg)
{
  try
      {
    cv::imshow("view", cv_bridge::toCvShare(msg, "bgr8")->image);
    cv::waitKey(30);
  }
  catch (cv_bridge::Exception& e)
  {
    ROS_ERROR("Could not convert from '%s' to 'bgr8'.", msg->encoding.c_str());
  }
}

int main(int argc, char **argv)
{
  ros::init(argc, argv, "image_listener");
  ros::NodeHandle nh;
  cv::namedWindow("view");
  cv::startWindowThread();
  image_transport::ImageTransport it(nh);
  image_transport::Subscriber sub = it.subscribe("camera/image", 1, imageCallback);
  
  ros::spin();
  cv::waitKey(0);

  cv::destroyWindow("view"); 
}

Can you help me to solve this ?
Thanks in advances!

Originally posted by N.N.Huy on ROS Answers with karma: 32 on 2020-04-25
Post score: 0

A:

Hello i fixed the error. The source code in the website couldn't run.

Instead of using cv::startWindowThread();, we should use waitKey();
They forget to add the size parameter in cv::namedWindow("view"); too. => cv::namedWindow("view", CV_WINDOW_AUTOSIZE);

Originally posted by N.N.Huy with karma: 32 on 2020-04-26
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by DJ on 2020-06-12:
Hi, I got the same issue after using the waitkey(). It gave an error stating Assertion 'G_IS_OBJECT (object)' failed. I found that the waitkey(0) causes that error. I am using lidar_camera_calibration ROS for my lidar camera calibration. Would like to get some help. Thanks.
Comment by N.N.Huy on 2020-06-22:
Actually, i am just a beginner and i don't have many experiences in this. You could make a new topic to ask someone with more insight than me could help :) !
Comment by iad-AR on 2021-02-13:
@DJ, you replaced cv::startWindowThread() by cv::waitkey(0) ? you should use cv::waitkey(1) instead.
I had the same issue and I found some info on the stackoverflow link bellow. Basically the number between the parenthesis cv::waitkey is a time in millisecond for the program to wait. And if set to 0, then it wait forever (until you press a key).
https://stackoverflow.com/questions/5217519/what-does-opencvs-cvwaitkey-function-do

