Q:

Missing dependency when building Debian package on the buildfarm

I am currently experiencing the following problem, albeit having opencv2 as a dependency of my package, when making a release with Bloom dpkg-shlibdeps fails with the following error:
dh_shlibdeps: warning: ignored unknown options in DH_OPTIONS
LD_LIBRARY_PATH=/usr/lib/i386-linux-gnu/libfakeroot:/usr/lib64/libfakeroot:/usr/lib32/libfakeroot:/tmp/buildd/ros-groovy-visp-2.6.2-1quantal-20130213-0723/debian/ros-groovy-visp//opt/ros/groovy/lib/
    dpkg-shlibdeps -Tdebian/ros-groovy-visp.substvars debian/ros-groovy-visp/opt/ros/groovy/share/visp/demo/wireframe-simulator/servoSimu4Points debian/ros-groovy-visp/opt/ros/groovy/share/visp/demo/wireframe-simulator/servoSimuSphere debian/ros-groovy-visp/opt/ros/groovy/share/visp/demo/wireframe-simulator/servoSimuCylinder debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2
dpkg-shlibdeps: error: couldn't find library libopencv_calib3d.so.2.4 needed by debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2 (ELF format: 'elf32-i386'; RPATH: '')
dpkg-shlibdeps: error: couldn't find library libopencv_core.so.2.4 needed by debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2 (ELF format: 'elf32-i386'; RPATH: '')
dpkg-shlibdeps: error: couldn't find library libopencv_features2d.so.2.4 needed by debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2 (ELF format: 'elf32-i386'; RPATH: '')
dpkg-shlibdeps: error: couldn't find library libopencv_highgui.so.2.4 needed by debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2 (ELF format: 'elf32-i386'; RPATH: '')
dpkg-shlibdeps: error: couldn't find library libopencv_imgproc.so.2.4 needed by debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2 (ELF format: 'elf32-i386'; RPATH: '')
dpkg-shlibdeps: error: couldn't find library libopencv_legacy.so.2.4 needed by debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2 (ELF format: 'elf32-i386'; RPATH: '')
dpkg-shlibdeps: error: couldn't find library libopencv_nonfree.so.2.4 needed by debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2 (ELF format: 'elf32-i386'; RPATH: '')
dpkg-shlibdeps: error: couldn't find library libopencv_video.so.2.4 needed by debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2 (ELF format: 'elf32-i386'; RPATH: '')
dpkg-shlibdeps: warning: package could avoid a useless dependency if debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2 was not linked against libgmodule-2.0.so.0 (it uses none of the library's symbols)
dpkg-shlibdeps: error: cannot continue due to the errors listed above
Note: libraries are not searched in other binary packages that do not have any shlibs or symbols file.
To help dpkg-shlibdeps find private libraries, you might need to set LD_LIBRARY_PATH.
dh_shlibdeps: dpkg-shlibdeps -Tdebian/ros-groovy-visp.substvars debian/ros-groovy-visp/opt/ros/groovy/share/visp/demo/wireframe-simulator/servoSimu4Points debian/ros-groovy-visp/opt/ros/groovy/share/visp/demo/wireframe-simulator/servoSimuSphere debian/ros-groovy-visp/opt/ros/groovy/share/visp/demo/wireframe-simulator/servoSimuCylinder debian/ros-groovy-visp/opt/ros/groovy/lib/libvisp-2.so.2.6.2 returned exit code 2
make[1]: *** [override_dh_shlibdeps] Error 2

It seems to me that the OpenCV dependency is not pulled correctly.
See the job here and the Bloom release repository here.
I have opencv2 both as build_depend and run_depend. However the ros-groovy-opencv2 package does not pull the OpenCV packages currently so I am a bit lost.
Should I open a pull request to add a key for the OpenCV "system packages"... or is there some kind of problem with the ros-groovy-opencv2 package?

Originally posted by Thomas on ROS Answers with karma: 4478 on 2013-02-12
Post score: 1

A:

interesting, visp is the first 3rd party depending on a 3rd party only. So you found a bug :)
https://github.com/ros-infrastructure/bloom/issues/87
I'll fix it for OpenCV for now. Thx !

Originally posted by Vincent Rabaud with karma: 1111 on 2013-02-15
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by Thomas on 2013-02-17:
Thanks for taking time to look at this! Should I add a runtime_depend on catkin for my package also?
Comment by WilliamWoodall on 2013-02-18:
@Thomas, yes. The rationale is that catkin provides the setup.*sh files at run time and your library is not findable without first sourcing them, so you actually should run depend on catkin. ROS packages inherit this from one of the core ROS dependencies.
Comment by Vincent Rabaud on 2013-02-27:
ok, took me longer but it's finally released (had to wait for the new bloom). BTW, that bug is the one that REP 136 solves.
Comment by Thomas on 2013-02-27:
Just seen it. Awesome! Also merged pull request from Julius Kammerl. Thanks again.
Comment by Jose Luis Blanco on 2018-05-06:
@Vincent-rabaud @WilliamWoodall I recently found an almost identical issue, please let me know if the bug you mention may still be the cause? https://answers.ros.org/question/290505/jenkins-error-dpkg-shlibdeps-cant-find-libs-building-non-catkin-pkg/  Thanks

