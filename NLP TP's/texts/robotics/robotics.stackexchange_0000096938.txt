Q:

How to connect lidar detected object to map frame with Open Planner?

This is in velodyne frame and I select packages below:

ray_ground_filter
lidar_euclidean_cluster_detect
wf_simulator
twist_filter

This is in world frame and I select packages below:

op_global_planner
wf_simulator(with gnss localization)
twist_filter

How can those two show together?##
Beacuse I want to use op_local_planner to avoid obstacle.##
But I dont't know how to mix them together and implement normal op planner's plan with wf_simulator.

autoware version:1.14
operating system:Ubuntu18.04
Ros version:melodic

Originally posted by fantasyplus on ROS Answers with karma: 17 on 2020-08-26
Post score: 0

Original comments
Comment by fantasyplus on 2020-08-26:
@Hatem Hi,can you help me with that problem?May be easy for you:)

A:

Hello fantasyplus,
Unfortunately because you are using Autoware 1.14 this will not work out of the box.
you need to check the frames and topic names.
One simple solution is to set output frame in euclidean cluster node to "map", and use lidar_kf_contour_tracker.
If you are willing to use Autoware 1.13 , then you can switch to repository from https://gitlab.com/hatem-darweesh-autoware.ai
openplanner.1.13 branch
Then everything should work out of the box.

Originally posted by Hatem with karma: 443 on 2020-08-26
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by fantasyplus on 2020-08-27:
Thanks.
Btw,Why Op Flag doesn't show with open planner?It can show with dp_planner which is old version.
I want to simulate a obstacle on the global path,but when I push Publish Point,rviz will crash.
Comment by Hatem on 2020-08-27:
can you elaborate, I didn't get what you are trying to do.
Comment by fantasyplus on 2020-08-27:
I want to set a simulated obstacle on the global path to check the open planner's obstacle avoidance.
Normal way is publish point,but my rviz will break down,I.search Google find autoware has an Op Flag also has an obstacle function.
I tried  dp planner and the Op Flag shows as an obstacle,then the wf_simualtor bypass the Op Flag when using pure_pursuit , but when I tried op planner,the Op Flag didn't show as an obstacle when I clicked mouse.
Anyway,I just want to verify op planner's obstacle avoidance,do you have a better ideaï¼ŸI have a real car and can implement lidar detection with euclidean cluster and kf_contor_track.
Comment by Hatem on 2020-08-27:
dp planner is the old version,
please use OpenPlanent 1.5 (op_global_planner, op_local_planner)
you will find everything you need in this tutorial
you can setup a simulated vehicle (set its velocity to 0 if you want it to work as static obstacle)
in the autoware 1.3, 1.14 only one op_car_simulator is shown in the runtime manage, but you can still run other op_car_simulator from the command line.
if you want to just insert one point by mouse,
I fixed the issue of rviz crashing by using 2D Nav Goal. but this solution is available only in my fork which I mentioned in my answer.
Comment by fantasyplus on 2020-08-27:
thank you.I changed frame and topic name,the wf_simulator can avoid the op_car_simulator.
But when I run my rosbag,op_motion_predictor doesn't show the topic"/predicted_trajectories_rviz".
the error info is "scale.y and scale.z of LINE_LIST or LINE_STRIP are ignored.
Points should not be empty for specified marker type.
At least two points are required for a LINE_STRIP marker".
Looks like predictor sends empty predicted information,so the evaluator doesn't consider it as a trajectory_cost.
Do you know why? This is the final step so I can connect all subsyetem together to let my real car move:(
Here is my bag. https://drive.google.com/file/d/1D9xx9HhDBFbs2_S2SIl7M899RSCHMxHv/view?usp=sharing
Comment by fantasyplus on 2020-08-27:
I find my problem....just click off enable openplanner perception simulation
Comment by Hatem on 2020-08-28:
glad that you get it to work
Comment by fisc8617 on 2021-03-18:
@Hatem We are also attempting to get the lidar detected objects to be avoided when using OpenPlanner. We are currently using the 1.13 branch that you have created. We can see the detected objects on the map but wf_simulator/pure_pursuit seem to just ignore them. We are using kf_contour_track and have turned off enable openplanner perception simulation. We are using the range_vision_fusion node for sensor fusion as well. What would you suggest for us to try?
Comment by Hatem on 2021-03-19:
Hello,
The most important thing to make sure that, op_trajectory_evaluator can receive the detected objects topic.
1- check if kf_contour_track can receive the detected objects topic.
2- check if kf_contour_track can publish the tracked objects , and these objects are in the "map" frame. (open planner uses the "map" frame)
3- if kf_contour_track receive the data but doesn't publish any objects , disable the filtering options in the launch file
4- check that op_motion_predictor can receive the detected objects topic.
Regards,
Comment by fisc8617 on 2021-03-22:
@Hatem Thank you for the response. We are not sure how to check if kf_contour_track is receiving tracked_objects or how to get them into the map frame. Would you be able to give us some steps to figure that out? Thanks again.
Comment by Hatem on 2021-03-23:
Can you send me email,
maybe we can have a quick meeting.
Comment by vivekgouravs on 2021-06-01:
Hello Hatem,
I am also facing similar issue as above, I am not able to detect obstacles from gazebo environment using LiDar.
It would be helpful if tutorial or steps were given regarding conversion of a tracked object to map frame.
Thanks in advance,
Regards,
Vivek Gourav S

