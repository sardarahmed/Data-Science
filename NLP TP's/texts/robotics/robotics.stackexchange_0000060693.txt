Q:

Convert /tf to nav_msgs/Odometry

Hi,
I want to use robot_pose_ekf to receive data from a IMU and a visual odometry source. This last one only publishes a /tf between to frames and I want to get the geometry_msgs/PoseWithCovariance from it.
Is there a proper way of converting a /tf to a nav_msgs/Odometry message?
Thanks in advance!

EDIT:
Thanks all for the answers! I'm going to take a comment in a single answer. I'm using a Asus Xtion Pro Live with rgbdslam_v2 package. This last one publishes /tf between a fixed_frame and a choosen frame from us at a 10hz rate. I need this to be an odom type of message to insert it in robot_pose_ekf.
I don't really know if I'm using the right package for the purpose, but I lost a serious amount of time porting it to an ARM platform (an Odroid) and I didn't want to abandoned this one just because it doesn't give me odometry out-of-the-box. Besides, changing to, for example, to ccny-rgbd-tools will probably mean a great amount of work again to get it ported to ARM.
So can anyone point me out how can I get a proper convertion from tf to Odometry. I'm not really a hardcoder so point out some parts of code in the ccny_rgbd_tools visual_odometry.cpp would be good.
Thanks again!

Originally posted by TSC on ROS Answers with karma: 210 on 2014-07-08
Post score: 2

Original comments
Comment by sai on 2014-07-08:
The answer which was written by me gives the sample code from ccny_rgbd_tools's visual_odometry.cpp
Comment by dornhege on 2014-07-08:
In this case, follow the sample code. You probably want to set the covariance to something hard coded, when you put it into the EKF.
Comment by TSC on 2014-07-09:
@dornhege can you please point me some code sample to hard code a good covariance matrix? I'm following the dirty fix in: http://answers.ros.org/question/66489/combine-visual-odometry-data-from-ccny_rgbd-with-encodersimu/
But it doesn't seem to be good in my case (since I will have 6DOF motion).
Tkx
Comment by dornhege on 2014-07-09:
I'm not sure how you want to do more than a simple hack if you don't have the data.
Comment by TSC on 2014-07-09:
Maybe a normal distribution for each matrix value?
Comment by dornhege on 2014-07-09:
That's what this hack gives you.
Comment by TSC on 2014-07-09:
0.2 , 0.2 , 999999 , 999999 , 999999 , 0.2 doesn't seem Gaussian but ok. Anyway, giving that I need a 6DOF motion, give a 0.2 instead of 999999 to other values seams reasonable right?
Comment by dornhege on 2014-07-09:
Those are variances under the assumption that a diagonal matrix is correct.

A:

Have a look at poseTFToMsg
http://mirror.umd.edu/roswiki/doc/diamondback/api/tf/html/c++/namespacetf.html#a4a85fbf875a029e296806075b862d321
http://mirror.umd.edu/roswiki/doc/diamondback/api/tf/html/c++/namespacetf.html
Sample code block from here
https://github.com/ccny-ros-pkg/ccny_rgbd_tools/blob/master/ccny_rgbd/src/apps/visual_odometry.cpp#L360
This code below converts a TF msg to a odometry msg, you can find example for pose msg also in the link above
             void VisualOdometry::publishOdom(const std_msgs::Header& header)
          {
                OdomMsg odom;
                odom.header.stamp = header.stamp;
                odom.header.frame_id = fixed_frame_;
                 tf::poseTFToMsg(f2b_, odom.pose.pose);
                  odom_publisher_.publish(odom);
          }

Originally posted by sai with karma: 1935 on 2014-07-08
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by TSC on 2014-07-08:
I will check this. Probably have to adapt graph_manager.cpp in rgbdslam src folder to get this kind of message. Thanks!
Comment by sai on 2014-07-08:
I do not think there is need to look at graph_manager.cpp. In the above visual_odometry.cpp, you can find another function called 'publishTf' that actually converts the estimated transformation to a TF and also to odom msg, pose msg etc. I think completely going through the visual_odometry.cpp and its header file where f2b_ is defined should help you a lot.

