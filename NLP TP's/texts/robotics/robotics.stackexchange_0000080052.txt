Q:

How to display the function of latch?

I want to show the function of latch in publisher. According to the description of the latch: "When a connection is latched, the last message published is saved and automatically sent to any future subscribers that connect." So I write a small program to show the function of latch.
Below is my code, I just did a modification slightly according to the ROS tutorials.
#include "ros/ros.h"
#include "std_msgs/String.h"
#include <sstream>
int main(int argc, char **argv)
{
    ros::init(argc, argv, "talker");

    ros::NodeHandle n;

    ros::Publisher chatter_pub = n.advertise<std_msgs::String>("chatter", 1000, true);

    ros::Rate loop_rate(100);

    int count = 0;
    while(chatter_pub.getNumSubscribers() == 0)
        loop_rate.sleep();

    std_msgs::String msg;
    std::stringstream ss;
    ss << "hello world " << count;
    msg.data = ss.str();

    ROS_INFO("%s", msg.data.c_str());

    chatter_pub.publish(msg);
}

But when I run the subscribers, it doesn't show me the last message published.
Do you know why?

Originally posted by fengxi on ROS Answers with karma: 3 on 2017-04-05
Post score: 0

A:

Your program terminates after your call to publish. This means that the message is probably not even send once as .publish does not block until the message was serialized and transmitted. Add a ros::spin(); afterwards to keep your program running.

Originally posted by NEngelhard with karma: 3519 on 2017-04-06
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by fengxi on 2017-04-06:
Yes, you are right. When I add ros::spin(), everything is worked as I expected. Thank you very much.

