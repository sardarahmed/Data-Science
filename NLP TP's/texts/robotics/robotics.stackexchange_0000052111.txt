Q:

Fails to compile rviz on Gentoo

Hello,
I'm trying to install ros groovy on my gentoo system. I more or less followed the instructions on the tutorial and solver the dependencies problems so far.
But now I face a problem that is apparently not related to external libraries while compiling rviz:

[ 26%] Building CXX object src/rviz/CMakeFiles/rviz.dir/ogre_helpers/ogre_render_queue_clearer.cpp.o
/home/fox/ros_catkin_ws/src/rviz/src/rviz/ogre_helpers/line.cpp: In constructor 'rviz::Line::Line(Ogre::SceneManager*, Ogre::SceneNode*)':
/home/fox/ros_catkin_ws/src/rviz/src/rviz/ogre_helpers/line.cpp:54:10: error: **'uint32_t' does not name a type**
/home/fox/ros_catkin_ws/src/rviz/src/rviz/ogre_helpers/line.cpp:56:27: error: 'count' was not declared in this scope
/home/fox/ros_catkin_ws/src/rviz/src/rviz/ogre_helpers/line.cpp:56:27: note: suggested alternative:
/usr/lib/gcc/x86_64-pc-linux-gnu/4.6.3/include/g++-v4/bits/stl_algo.h:4582:5: note:   'std::count'
make[2]:  [src/rviz/CMakeFiles/rviz.dir/ogre_helpers/line.cpp.o] Error 1
make[2]:  Waiting for unfinished jobs....
make[1]:  [src/rviz/CMakeFiles/rviz.dir/all] Error 2
make: [all] Error 2
Traceback (most recent call last):
  File "./src/catkin/bin/../python/catkin/builder.py", line 717, in build_workspace_isolated
    number=index + 1, of=len(ordered_packages)
  File "./src/catkin/bin/../python/catkin/builder.py", line 497, in build_package
    install, force_cmake, quiet, last_env, cmake_args, make_args + catkin_make_args
  File "./src/catkin/bin/../python/catkin/builder.py", line 353, in build_catkin_package
    run_command(make_cmd, build_dir, quiet)
  File "./src/catkin/bin/../python/catkin/builder.py", line 198, in run_command
    raise subprocess.CalledProcessError(proc.returncode, ' '.join(cmd))
CalledProcessError: Command '/home/fox/ros_catkin_ws/devel_isolated/robot_state_publisher/env.sh make -j4 -l4' returned non-zero exit status 2
<== Failed to process package 'rviz': 
  Command '/home/fox/ros_catkin_ws/devel_isolated/robot_state_publisher/env.sh make -j4 -l4' returned non-zero exit status 2

Reproduce this error by running:
==> /home/fox/ros_catkin_ws/devel_isolated/robot_state_publisher/env.sh make -j4 -l4

Command failed, exiting.

Here the problem is uint32_t is not defined. I solved this problem by adding #include <boost/cstdint.hpp> in the file line.cpp. I'm not sure if that's the good way to go but it does the trick for this file but I encounter an other problem:
[ 14%] Building CXX object src/rviz/CMakeFiles/rviz.dir/time_panel.cpp.o
In file included from /home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_manager.h:38:0,
                 from /home/fox/ros_catkin_ws/src/rviz/src/rviz/selection_panel.cpp:33:
/home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_handler.h:169:25: error: **field 'interactive_object_' has incomplete type**
make[2]:  [src/rviz/CMakeFiles/rviz.dir/selection_panel.cpp.o] Error 1
make[2]:  Waiting for unfinished jobs....
In file included from /home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_manager.h:38:0,
                 from /home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_handler.cpp:39:
/home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_handler.h:169:25: error: field 'interactive_object_' has incomplete type
/home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_handler.cpp: In member function 'virtual void rviz::SelectionHandler::setInteractiveObject(rviz::InteractiveObjectWPtr)':
/home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_handler.cpp:253:6: error: **'object' has incomplete type**
/usr/include/boost-1_49/boost/smart_ptr/shared_ptr.hpp:58:25: error: declaration of 'rviz::InteractiveObjectWPtr {aka struct boost::weak_ptr<rviz::InteractiveObject>}'
/home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_handler.cpp:255:3: error: 'interactive_object_' was not declared in this scope
/home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_handler.cpp: In member function 'virtual rviz::InteractiveObjectWPtr rviz::SelectionHandler::getInteractiveObject()':
/home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_handler.cpp:258:62: error: return type 'rviz::InteractiveObjectWPtr {aka struct boost::weak_ptr<rviz::InteractiveObject>}' is incomplete
/home/fox/ros_catkin_ws/src/rviz/src/rviz/selection/selection_handler.cpp:260:10: error: 'interactive_object_' was not declared in this scope
make[2]: [src/rviz/CMakeFiles/rviz.dir/selection/selection_handler.cpp.o] Error 1
make[1]:  [src/rviz/CMakeFiles/rviz.dir/all] Error 2
make:  [all] Error 2
Traceback (most recent call last):
  File "./src/catkin/bin/../python/catkin/builder.py", line 717, in build_workspace_isolated
    number=index + 1, of=len(ordered_packages)
  File "./src/catkin/bin/../python/catkin/builder.py", line 497, in build_package
    install, force_cmake, quiet, last_env, cmake_args, make_args + catkin_make_args
  File "./src/catkin/bin/../python/catkin/builder.py", line 353, in build_catkin_package
    run_command(make_cmd, build_dir, quiet)
  File "./src/catkin/bin/../python/catkin/builder.py", line 198, in run_command
    raise subprocess.CalledProcessError(proc.returncode, ' '.join(cmd))
CalledProcessError: Command '/home/fox/ros_catkin_ws/devel_isolated/robot_state_publisher/env.sh make -j4 -l4' returned non-zero exit status 2
<== Failed to process package 'rviz': 
  Command '/home/fox/ros_catkin_ws/devel_isolated/robot_state_publisher/env.sh make -j4 -l4' returned non-zero exit status 2

Reproduce this error by running:
==> /home/fox/ros_catkin_ws/devel_isolated/robot_state_publisher/env.sh make -j4 -l4

Command failed, exiting.

Then the other problem is the definition of different variables (interactive_object_ , object)that have the type InteractiveObjectWPtr defined in interactive_object.h. All the definitions using InteractiveObjectWPtr give problems I think based on "has incomplete type". I've checked the source files but I can't see what could cause it.
What  could be causing this problem? How do I continue.
Thanks

Originally posted by focs on ROS Answers with karma: 46 on 2013-06-19
Post score: 0

A:

Apart from the file  line.cpp I had to edit three more files. To sumup:
line.cpp: add #include <boost/cstdint.hpp>
interactive_object.h: add #include <boost/weak_ptr.hpp>
interactive_marker.h: add #include <boost/thread.hpp>
map_display.h: add #include <boost/thread/mutex.hpp>

After this changes rviz compiled ok. Should I submit the bug somewhere?

Originally posted by focs with karma: 46 on 2013-06-19
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by dgossow on 2013-06-19:
Most of the bugs have just been fixed in https://github.com/ros-visualization/rviz/pull/648
Comment by dgossow on 2013-06-19:
I'll take care of the line.cpp fix. Thanks for reporting this.

