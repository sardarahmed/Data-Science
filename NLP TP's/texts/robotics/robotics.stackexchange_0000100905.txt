Q:

Example of ROS2 C++ blocking action request

I'm looking for a C++ example of a blocking action request. Basically I seek the C++ version of this Python answer:  https://answers.ros.org/question/377269/a-less-asyncronous-way-of-using-ros2-action-clients/?answer=377584#post-id-377584
In other words, I want to do something like this:
my_action_client_->async_send_goal(my_request, send_goal_options);

// block until complete here

Originally posted by AndyZe on ROS Answers with karma: 2331 on 2021-12-28
Post score: 2

Original comments
Comment by osilva on 2021-12-28:
Hi @AndyZe, here you can find the C++ version of the Fibonnaci example shown in the previous answer. https://github.com/ros2/demos/tree/foxy/action_tutorials/action_tutorials_cpp/src  Hope that's what you are looking for
Comment by AndyZe on 2021-12-28:
Yep, thanks. It doesn't block until the action finishes, though.
    this->client_ptr_->async_send_goal(goal_msg, send_goal_options);
  }

Comment by AndyZe on 2021-12-28:
I suspect the answer is to use async_get_result() but the syntax is a little tricky. I wish there were an example.
Comment by osilva on 2021-12-28:
There is a little bit of information in the source code
/// Asynchronously get the result for an active goal.
  /**
   * \throws exceptions::UnknownGoalHandleError If the goal unknown or already reached a terminal
   *   state.
   * \param[in] goal_handle The goal handle for which to get the result.
   * \param[in] result_callback Optional callback that is called when the result is received.
   * \return A future that is set to the goal result when the goal is finished.
   */
  std::shared_future<WrappedResult>
  async_get_result(
    typename GoalHandle::SharedPtr goal_handle,
    ResultCallback result_callback = nullptr)

A:

  auto goal_handle = my_action_client_->async_send_goal(request, send_goal_options);

  auto result = my_action_client_->async_get_result(goal_handle.get());

  if (result.get().code == rclcpp_action::ResultCode::SUCCEEDED)
  {
    return true;
  }

Originally posted by AndyZe with karma: 2331 on 2021-12-28
This answer was ACCEPTED on the original site
Post score: 0

