Q:

Robot localization: Odom tf is far offset from Map tf

Hello all,
Recently, I am using the robot-localization package to fuse all my sensors and does the localization for my robot.
And as I was testing the localization result outdoors, I found something strange in rviz2.
In this test, I made the robot move in a rectangular shape.
In rviz2: The red arrow represents odometry topic on /odom/local; the green arrow represents odometry topic on /odom/global
At first, the Odom tf and the Map tf is close to each other, as shown in picture 1.
However, during the rectangular movement, the Odom tf began to move away from the Map tf, as show in picture 2,3
In the end, I moved the robot back to where it started. Although both /odom/local and /odom/global (the red and green arrow) indicate that the robot is back to where it began (the origin in the map frame). But the Map tf and the Odom tf are far apart from each other.
Thus, I wonder if this is something expected?
And if that is expected, does this mean that I have my robot-localization configured properly? In the end, both /odom/local and /odom/global indicate that my robot is only about 0.5 meters away from where it begins, which is acceptable to my requirement.
image 1

image 2

image 3

image 4

Originally posted by sdu568 on ROS Answers with karma: 45 on 2023-07-17
Post score: 0

A:

Yes, this is expected. As the odometry of your robot drifts (see this answer for more details: https://answers.ros.org/question/188882/why-can-the-odom-frame-drift/?answer=188887#post-id-188887) the robot-localization package starts to compensate for the drift and therefore "map" and "odom" frames will diverge.
If the final position error is acceptable for your application, then I would say your robot localization is configured properly, although there is always room for improvement.

Originally posted by Martin Peris with karma: 5625 on 2023-07-19
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by sdu568 on 2023-07-19:
Thanks for the clear explanation!

