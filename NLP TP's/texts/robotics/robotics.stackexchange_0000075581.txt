Q:

How to generate different random cmd_vel messages?

Hello everyone,
I'm trying to have two (or several) robots receiving a random cmd_vel message. I was expecting that each robot would present a different velocity (I'm using Gazebo) but instead what I get is that every robot has the same velocity (however random, it is still the same for each one)
publisher pubvel  is below as well as my launch file where I launch both the robot model and the publisher within the same namespace. One namespace for each robot.
    #include "ros/ros.h"
    #include "std_msgs/String.h"
    #include <geometry_msgs/Twist.h>
    #include <stdlib.h>
    
    
    int main(int argc, char **argv)
    {
    // Initialize the ROS system and become a node .
    
      ros::init(argc, argv, "publish_velocity");
    
      ros::NodeHandle nh;
    
    // Create a publisher object .
      ros::Publisher publisher = nh.advertise<geometry_msgs::Twist>("cmd_vel", 1000);
    
    // Loop at 2Hz until the node i s shut down.
      ros::Rate rate(2); 

    while (ros::ok())
      {
       //srand(time(0));
    
            geometry_msgs::Twist msg;
    
            msg.linear.x=double(rand())/double(RAND_MAX);
            msg.angular.z=double(rand())/double(RAND_MAX)-1;
            publisher.publish(msg);
    
            ROS_INFO_STREAM("Sending random velocity command:"<<" linear="<<msg.linear.x<<" angular=" <<msg.angular.z);
    
            rate.sleep();
      }  
      return 0;
}

<param name="tf_prefix" value="robot1_tf" />

<include file="$(find random_vel)/launch_files/one_robot.launch" >

    <arg name="init_pose" value="-x 0 -y 2 -z 0" />

    <arg name="robot_name"  value="Robot1" />

    <arg name="namespace_arg" value="robot1"/>

</include>

<node pkg="random_vel" type="pubvel" name="pubvel" output="screen" />

<param name="tf_prefix" value="robot2_tf" />

<include file="$(find random_vel)/launch_files/one_robot.launch" >

<arg name="init_pose" value="-x 0 -y -2 -z 0" />

<arg name="robot_name"  value="Robot2" />

<arg name="namespace_arg" value="robot2"/>

</include>

Thank you very much in advance,
Hugo

Originally posted by Hugo Sardinha on ROS Answers with karma: 28 on 2016-08-01
Post score: 0

Original comments
Comment by spmaniato on 2016-08-01:
Run rostopic list to see what topics are being published/subscribed to. Then rostopic info <topic> to check whether your robots are accidentally subscribing to the same /cmd_vel topic.
Comment by Hugo Sardinha on 2016-08-01:
Thank you very much for your comment but everything seems to be fine, from the rostopic list i get both /robot1/cmd_vel and /robot2/cmd_vel. and from rostopic info i get both publishers /robot1/pubvel and /robot2/pubvel. Naturally, rqt_graph also shows this. I still get the same cmd_vel for each...

A:

The problem is that you do not properly initalize the random number generator with a seed. See e.g. http://www.cplusplus.com/reference/cstdlib/srand/ for an explanation.
You do have the srand call in there already, but commented out. Thus, this program will always produce the same "random" values.
Depending on how you start the pubvel node, you should probably initialize them differently. See e.g. this stackoverflow discussion on how to initialize it differently.
Or you could use the Boost Random Library which afaik doesn't have this problems.

Originally posted by mgruhler with karma: 12390 on 2016-08-02
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by Hugo Sardinha on 2016-08-02:
Thank you very much mig. the stackoverflow discussion was where I found the answer to my problem. The reason why I had srand commented was because when it wasn't it still didn't work. I had to both have it outside the while loop and initialize it  like suggested in the discussion.
Thank you!

