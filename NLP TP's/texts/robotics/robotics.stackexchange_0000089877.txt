Q:

cv_bridge.core.CvBridgeError: [8UC1] is not a color format. but [bgr8] is

Hi all!
I have a bag file recorded with the IR sensor of a realsense SR300 camera.
I am trying to convert it in a video with bag2video.py file, but it turns out this result:
cv_bridge.core.CvBridgeError: [8UC1] is not a color format. but [bgr8] is. The conversion does not make sense

I've found the problem and I've understood it, but actually I don't know how to solve it!!
Please can you help me??

Originally posted by alessiadele on ROS Answers with karma: 3 on 2018-12-18
Post score: 0

Original comments
Comment by PeteBlackerThe3rd on 2018-12-18:
Are you trying to encode a color video format? I suspect you'll need to specify the video as greyscale to get this to work.
Comment by alessiadele on 2018-12-18:
I used all the three different parameters for "--encode" (rgb8, bgr8, mono8), but the program always gives me the same error.
I don't know how to specify the video as greyscale!

A:

I've just had a quick look at the source code for this and it seems the encoding option is not implemented. It's actually hard coded to use bgr8 and ignores whatever you specify as the encoding!
Since It's a python file you could dig in and change the hard coded encoding format yourself or get it to use the encoding value correctly.
Hope this helps.
Update:
You'll need to change line 53 which is currently:
img = np.asarray(bridge.imgmsg_to_cv2(msg, 'bgr8'))

so that the encoding you want to use is in the inverted commas instead such as
img = np.asarray(bridge.imgmsg_to_cv2(msg, 'mono8'))

Originally posted by PeteBlackerThe3rd with karma: 9529 on 2018-12-18
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by alessiadele on 2018-12-18:
Yes, unfortunately I am not a programmer, so I don't know how to change the code, or wich line I should add in the python file!
Comment by PeteBlackerThe3rd on 2018-12-18:
I've added some instructions for you.
Comment by alessiadele on 2018-12-18:
Thank you very much!
I've followed your instructions, but now the error is:
cv_bridge.core.CvBridgeError: [8UC1] is not a color format. but [mono8] is.
I am trying to read and understand something more about 8UC1, ROS images and OpenCV images, but it's a little bit complicated, you're right!
Comment by PeteBlackerThe3rd on 2018-12-18:
according to the documentation for imgmsg_to_cv2 you can give it an encoding of passthrough and it will not try and change it. This might be worth a go.
Comment by alessiadele on 2018-12-18:
Thank you Pete!!
I've solved (in part) the problem modifying the line that you said to me in this way:
img = np.asarray(bridge.imgmsg_to_cv2(msg, '8UC1'))

Now the program does convert the bag file in a video, but it doesn't save any file, it just shows me it!
Thank you very much!! :D
Comment by PeteBlackerThe3rd on 2018-12-18:
Great. Can you accept my answer by clicking the tick next to it. This way other users can see that a solution was found.

