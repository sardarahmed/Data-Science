Q:

Was Lagrange aware of Hamiltonian mechanics?

In the book "The Road to Reality", Penrose claims that Joseph Lagrange was aware of Hamiltonian mechanics. Is there any evidence that this statement is true?

A:

Yes, he was, at least in a particular example. Near the end of his life, in 1808-09, Lagrange studied perturbative dynamics of a planet on an elliptic orbit, and derived what came to be called Hamiltonian equations for it in Second mémoire sur la théorie de la variation des constantes arbitraires dans les problèmes de mécanique, dans lequel on simplifie l'application des formules générales à ces problèmes (1809). A modern discussion with details can be found in Weinstein's Symplectic Geometry:

"The first symplectic manifold
  was introduced by Lagrange [LAI] in 1808. In studying the motion of the
  planets under the influence of their mutual gravitational interaction, he took
  as a starting point the elliptical motion of a single planet around the sun.
  (Actually, the focus of the ellipse is the center of the mass of the sun-planet
  system, but we will ignore this point here.) This ellipse was then considered to
  "drift" under the disturbing influence of the other planets. The drift was
  described by a system of differential equations, and Lagrange sought to put
  these equations in the simplest possible form. 

Lagrange described the motion by six elements (real functions) $a_i$, introduced what is now called Lagrange brackets for them, and was able to write the equations in the form 
$\frac{da_i}{dt}=\sum_j b_{ij}\frac{\partial\Phi}{\partial a_j}$, where $b_{ij}$ was antisymmetric. "At the time of Lagrange, this advance was of
advantage largely because it shortened by a factor of six some rather
complicated computations". The $\Phi$ was what Lagrange "called the disturbing
function, which depends on the perturbing forces but is independent of the
choice of elements". The equations meant that the total time derivative of $\Phi$ along the trajectories was $0$, i.e. it was conserved. In 1809 he found a change of variables from $a_i$ to $q_i$, $p_i$, that satisfied the canonical commutation relations for his brackets. In terms of these elements, the
equations he derived "are known today as Hamilton's equations", with $\Phi$ as the Hamiltonian.

