Q:

What did the Thebans do to cause the wrath of Dionysus?

Pausanias tells the legend of the Teumessian fox, a fox destined never to be caught sent by Dionysus to destroy Thebes, the god's birthplace according to the Zeus and Semele narrative:

9.19.1 On this highway is a place called Teumessus, where it is said that Europa was hidden by Zeus. There is also another legend, which tells of a fox called the Teumessian fox, how owing to the wrath of Dionysus the beast was reared to destroy the Thebans, and how, when about to be caught by the hound given by Artemis to Procris the daughter of Erechtheus, the fox was turned into a stone, as was likewise this hound.
Pausanias. Pausanias Description of Greece with an English Translation by W.H.S. Jones, Litt.D., and H.A. Ormerod, M.A., in 4 Volumes. Cambridge, MA, Harvard University Press; London, William Heinemann Ltd. 1918.

What did the Thebans do to deserve this punishment?

A:

A Sphinx Replacement?
Book 7 of Ovid's Metamorphoses strongly implies that the attacks of the Teumessian Fox were revenge for the death of another monster, the Sphinx, which Thebes had been rid of thanks to Oidipous [Oedipus], who won the throne of Thebes by accomplishing this feat. Ovid says that the Teumessian Fox descended upon Thebes immediately after the Sphinx was gone. However, in his account, it is the goddess Themis who sends the fox, and, by inference, she was responsible for the Sphinx as well. 
No other ancient source (of which I am aware) specifies a reason for the Teumessian Fox being a punishment. The scholion on Hesiod's Theogony 326 says that it was Dionysos [Dionysus] who had sent the Sphinx. Meanwhile, Apollodorus says that it was Hera who had sent the Sphinx because Laios [Laius], who had been king of Thebes before Oidipous, had kidnapped Pelops's young son Khrysippos [Chrysippus] for the purpose of paederasty.
If we combined all the above versions together and pinned it all on Dionysos, the narrative would be that Dionysos sent the Sphinx because of Laios's crimes and then sent the fox to avenge the Sphinx. It, however, seems quite out of character for Dionysos to consider Laios's actions with Khrysippos a crime, on top of us having to doctor the information from the sources quite as much as I've just done.    
Having said that, then, there are some other, rather more personal reasons, why Dionysos would have beef with Thebes, with support from the only other ancient source (that I have found) which hints, obliquely, at why the fox was sent to Thebes. This source would be older than Ovid.
Three Transgressions
It may be that Dionysos bore a grudge against his closest maternal relatives, who happen to have been Thebans. In the myths' chronology, between the foundation of Thebes and the time of Prokris [Procris], there are only three instances (as far as I am aware) upon which Dionysos had occasion to be offended by the people of Thebes. The wine-god engages himself more directly with only two of these three instances.  
Number 1
One of the two direct encounters involves less carnage, whereupon Dionysos' Theban twin half-brothers Amphion and Zethos [Zethus] violently killed their great-aunt Dirke [Dirce] who had spent many years mistreating the twins' mother Antiope. Because Dirke had been a devotee of Dionysos, the wine-god retaliated by sending madness upon Antiope, which caused her to go wandering all over Greece before she was found by Phokos [Phocus] and cured by him. The region of Phokis [Phocis], which Phokos had named after himself, is where she settled with and was married to him.
Number 2
Roughly one generation before this, Dionysos entered into a vicious altercation with his mother's relatives, to whom Antiope was related through marriage. Dionysos' aunts, together with his cousin Pentheus who was king of Thebes at the time, had denied his divinity and claimed that he was not Zeus's son, in addition to which Pentheus had banned the wine-god's cult at Thebes when Dionysos arrived thereat with his entourage after his famous campaign around the world.
For this, Dionysos, in typical style, induced madness in the city's women, including his aunts, causing them to slaughter their own children. Pentheus was thus torn to pieces by his own mother, who then went to her old father Kadmos [Cadmus] and proudly displayed the king's severed head to the old man, thinking it to be that of a wild beast.
A Possible Hint
In both of the aforementioned instances it seems as though Dionysos' vengeance is as complete as he would want it to be, but the 2nd of the Epigoni fragments from the Epic Cycle perhaps offers a further sliver of information on the subject, saying:   

Those who have written on Theban affairs have given a full account of
  the Teumes(s)ian Fox. They relate that the creature was sent by the
  gods to punish the descendants of Kadmos, and that the
  Thebans therefore excluded those of the house of Kadmos from kingship.
  But (they say) a certain Kephalos [Cephalus], the son of Deion, an
  Athenian, who owned a hound which no beast ever escaped, had
  accidentally killed his wife Prokris, and being purified of
  the homicide by the Kadmeians, hunted the fox with his
  hound, and when they had overtaken it both hound and fox were turned
  into stones near Teumessos [Teumessus].

This tells us nothing about why "the gods" would want to punish Kadmos' descendants, although we do know that other deities apart from Dionysos (most notably Ares and Hephaistos [Hephaestus]) have been involved in bringing calamity upon the house of Kadmos. If, however, we interpret the fragment more narrowly as referring specifically to Dionysos, using your Pausanias quote as corroboration for this stance, we would be led towards the city's throne succession intrigues to help flesh this out further.
The City's Throne
Kadmos founded Thebes and was succeeded as its king by his grandson Pentheus. After Dionysos caused Pentheus' death, Kadmos' son Polydoros [Polydorus] acceded to the throne. Polydoros married Antiope's sister Nykteïs and they had a son named Labdakos [Labdacus], who was too young to rule by the time his father died. Labdakos' grandfather Nykteus [Nycteus]—the father of Nykteïs and Antiope—then served as regent king until Labdakos grew up. 
Labdakos had a son, Laios, and when Laios was one year old, Apollodorus tells us in Bibliotheka 3.5.5, Labdakos "perished after Pentheus because he was like-minded with him." As a footnote to that statement in his translation of the Bibliotheka, James George Frazer says:

Apollodorus implies that Labdacus was murdered by the Bacchanals
  because he set himself against the celebration of their orgiastic
  rites. But there seems to be no express mention of his violent death
  in ancient writers.

If that implication is accurate, then it makes up the third instance of Dionysos being offended by the Thebans. 
Nykteus was also dead at this point but he had a brother named Lykos [Lycus], who was married to Dirke, and who seized power now that Labdakos was dead and Laios was still a baby. About twenty years later Amphion and Zethos got rid of Lykos and Dirke, expelled Laios from the city, and essentially began a new dynasty there. This barely lasted a generation however, the twins both losing nearly all of their children, Amphion committing suicide, and his wife and his brother both dying of grief and heartbreak at their troubles.
Laios then returned to Thebes and resumed the Kadmeian grasp upon royal power. (It is prior to this, while in exile, that he had kidnapped Khrysippos.) Sometime afterwards while travelling through Phokis (where Antiope had lived after the end of her Dionysos madness) he was killed in a quarrel with a stranger. Laios' brother-in-law Kreon [Creon], himself a descendant of Pentheus, now became regent king. 
Soon afterwards the Sphinx came to Thebes. Laios had been married to Kreon's sister Iokasta [Jocasta], whose hand in marriage Kreon now offered as a prize to the man who would rid Thebes of the Sphinx. By marrying Laios' widow, the city's saviour would thus become its king. 
That is when Oidipous arrived as a foreigner to Thebes, got rid of the Sphinx, was wed to Iokasta and became king. Not too long after this Kephalos was called to Thebes and, with the help of his extraordinary hunting-dog, was able to solve the problem of the Teumessian Fox.
Attempted Reconstruction of the Fox's Career
Everyone in the throne succession thus far has been a direct descendant of Kadmos, with the exception of the consecutive intrusions of Lykos and Amphion, whose reigns are thus, collectively, the only time in the chronology that I can see in which to validate the claim of Epigoni Fragment 2 "that the Thebans... excluded those of the house of Kadmos from kingship." The only way to fit the fox into these intrigues would go something like so:
The wrath of Dionysos remained unquenched, even after he had brutally devastated his relatives and gotten rid of his own cousin, the king who had attempted to end the god's triumphant advent at his mother's hometown. When his uncle Polydoros replaced Pentheus on the throne, the new king died fairly young (through Dionysos' involvement?) and Polydoros' son Labdakos succeeded him. Labdakos seems to have also offended his cousin Dionysos and paid for it with his life.
Enter: The Teumessian Fox!
With Labdakos having reopened Dionysos' emotional wounds which had been inflicted by their cousin and aunts, Dionysos sent the Teumessian Fox to plague Thebes. Having ascertained the source of this problem, Labdakos' great-uncle Lykos used this a pretext to steal the throne from the deceased king's baby son Laios.
The monster fox then gave Thebes a break through the reign of Lykos, whose wife Dirke was especially on Dionysos' good side. Two decades later when Amphion and Zethos killed Dirke, Dionysos' rage against Thebes was rekindled, and only flared up further when, later on, Laios brought the house of Kadmos back into power. 
Even though Laios died violently, it was Kreon, none other than a great-grandson of the loathsome Pentheus, who took his place. So Dionysos sent the Sphinx, but Oidipous summarily handled business with that creature. Finally, then, it was time for the Teumessian Fox to return to Thebes, and it put the city in dire straits for quite some time before an end was made of it too. 

