Q:

How did Newton come up with his formula for gravitational force?

In high school students are taught the formula that describes the universal gravitational force $F=G\frac{m_1 m_2}{r^2}$. However it is not taught how and why Newton came up with it. Does Newton give a demonstration of the formula?

A:

The formula was a commonly discussed hypothesis at that time (Ch. Wren, Hooke, Halley). First attempt to test the formula was made when Newton was a young student in Cambridge: he compared acceleration from gravity on the Earth surface (easy to measure by observing falling apples for example:-) with acceleration of the Moon on
its orbit (easy to compute). And compared these accelerations with the Earth radius and the Moon orbit radius. Agreement was poor and Newton abandoned the topic.
(The reason for the poor agreement was the wrong value of the Earth radius which Newton was apparently taught in his university).
Second attempt was triggered by a letter from Hooke, many years later. Hooke literally proposed to
derive Kepler's laws (mainly the first law) assuming this formula. When Newton did this, this looked a convincing proof to him. Next time, when Edmund Halley asked him the same question, Newton was able to show him a proof.
It is still discussed whether Newton's proof was really a proof of what Halley asked (that the inverse square law implies elliptic orbits),
or he proved only the converse statement: that the motion on ellipses implies the inverse square law. In any case, any of the two implications constitute a convincing argument in favor of the inverse square law.
By the time Newton was writing the book, the precise Earth radius was already known to him, so his early argument was justified as well.
Another early successful test of the inverse square law was the prediction of return of the Halley comet, made by Halley. 
All this was a strong evidence for the universal gravitation but more testing was desired. (Only some principal features of the planet motions were explained, 
but one wanted to make sure that the law is exact, not approximate).
There were two crucial tests in 18th century.
 First the prediction of the shape of the Earth (tested in several expeditions in 18th century by precise measurement of
the arcs of meridians). Second, and most important was quantitative explanation of irregularities of the Moon motion (due to the disturbance arising from the Sun, Moon does not exactly obey Kepler's laws). Here Newton himself had only partial success, explaining the order of magnitude of the so-called "first inequality". Hard work of the best mathematicians of 18th century (Euler, Clairault, Lagrange and several others) finally achieved a success with quantitative prediction of the Moon motion. This was the decisive step in the proof of the Universal law of gravitation. Since then it was universally believed that this law is sufficient for explanation all observable features of the motion of planets.
More testing was performed in 19th century, the most famous one was the prediction of existence of Neptune and calculation of its orbit before it was observed. After that nobody had any doubts anymore.

A:

As Newton said he stood on the shoulders of giants. One of those giants was Kepler who found that the periodicity of a planetary orbit was related by
$$
T^2~\propto~r^3.
$$
This is Kepler's third law. Newton realized with the second law $\vec F~=~m\vec a$ of motion that centripetal force is
$$
\vec F~=~m\omega^2\vec r.
$$
Newton hypothesized there was some universal force between all masses. This is the basis of the semi-mythic story of the apple falling. Newton then said that with the second law the centripetal force is the $m\vec a$ and this force must be of the form $\vec F~=~r^n\vec r$ and so
$$
m\omega^2\vec r~=~Kr^n\vec r.
$$
It is clear that $n~=~3$ by Kepler. Also Kepler's third law has not dependency on the mass of the orbiting satellite. Newton did realize that the magnitude of this force must scale with the mass of the primary body. Hence $K~=~GMm$.

