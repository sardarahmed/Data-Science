Q:

Where does the formula $(1+\frac r n)^n$ for compound interest come from?

If we have an annual interest rate of $r$, meaning that each year we multiply our capital by $1+r$, but we want to compound it $n$ times throughout the year, then the usual formula for the amount of money at the end of the year is:
$$\left(1+\frac r n\right)^n$$
Which corresponds to compounding an interest rate of $r/n$ every $n$-th of a year. To me a more logical procedure would be to multiply the capital each $n$-th of a year by $\sqrt[n]{1+r}$, that way you're just interpolating the original annual interest rate.
To me the usual formula seems like exactly the kind of mistake someone who's not very good at mathematics might make - say a mediocre high school student. "Oh, we're applying an interest rate of $r$ a total of $n$ times throughout the year, so we should divide $r$ by $n$ to even things out". Err, no, that would make sense if we were adding, but we're multiplying.
My hypothesis is that this might really be how the formula for compound interest came about - invented by a medieval banker who didn't entirely understand mathematics beyond what he needed to count money. If this is true, then you might say banks are damn lucky that $\lim_{n\to\infty}(1+\frac 1 n)^n$ turned out to be finite! Someone suggested to me that it might have just been that $n$-th roots were too hard to calculate, but surely it wouldn't have been too bad with a log table.
Anyway, my idle speculation aside (and arrogant criticism of a field I know little about), is it known how old this formula is (even if used implicitly)? Was it invented independantly several times? Do we have any indication what the logic behind it was?

A:

Good accountants are aware of the difference between nominal and effective annual rates, but it is certainly likely that in practice they were often confused. The formula $\left(1+\frac r n\right)^{nt}$ is incorrect if $r$ is understood as the effective rate, the correct formula is $\left(1+\frac{i^{(n)}} n\right)^{nt}$, where $i^{(n)}$ is the (annualized) nominal rate for $n$ compounding cycles per year. In other words, if the compounding cycle is not a year the rate $i=i^{(n)}/n$ is set directly for it rather than derived from an annual rate, division by $n$ is for convenience. This is simpler, and more transparent, than calculating nominal rates for different $n$ from some prescribed effective rate. The correct relation between rates follows from  $\left(1+\frac{i^{(n)}} n\right)^{n}=1+r$, and simple calculus shows that even in the limit $n\to\infty$ the nominal rates $i^{(n)}$ converge to $\ln(1+r)$, the so-called "force of interest", rather than $r$. If one wishes to use the effective rate directly the correct formula is $\left(1+r \right)^{t}$ with fractional $t$, which is equivalent to the OP suggestion. 
As for history, "interest on interest" is much older than middle ages, much much older. It is mentioned, along with sample calculations, on Babylonian clay tablets dated to c. 2000–1600 BC. Although there are no compounding cycles of less than a year on the tablets there is one where the interest is compounded once in five years, and scribes already appear to make the "mistake" of adding up annual $20\%$ to five year $100\%$. More likely the agreement was directly that the amount doubles in five years since fractional time explicitly appears in calculations (there are no formulas of course). See Muroi's Oldest Example of Compound Interest in Sumer (p.7), who also argues that the use of compound interest can be traced to even earlier, c. 2600–2350 BC. Interestingly enough, compound interest was condemned by Aristotle as "usury", and mostly banned in the Christian world during middle ages. 
Nominal rates in formulas like $\left(1+\frac{i^{(n)}} n\right)^{nt}$ appear in 17th century, see Lewin's Compound Interest in Seventeenth Century. Harriot uses just such a formula to compute interest c. 1615 (p. 428), and even "approximates the limit" $n\to\infty$ using binomial expansion. His description of the answer is "the sum of interest on interest continually for every instant in seven years with the principal of £100 after the rate of 10 in the 100 for a year". Harriot keeps $i^{(n)}$ at $10\%$ throughout, which would amount to the same "mistake" if we insist that he keep the effective annual rate fixed rather than the nominal one. Witt's landmark Arithmetical Questions (1613) was the first book entirely devoted to compound interest, and is often called the first accounting textbook. It set many conventions that endure to our day, and is praised for accuracy, attention to detail and clarity of exposition.

