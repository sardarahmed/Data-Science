Q:

Can't include message of other package in Catkin

Hi,
we are trying to port our packages to catkin, but we have problems include messages from the other package.
The package map_merger need the message pointFromOther robot from adhoc_communication, but he does not find it.
CMakeList.txt from map_merger:
cmake_minimum_required(VERSION 2.8.3)
project(map_merger)

## Find catkin macros and libraries
## if COMPONENTS list like find_package(catkin REQUIRED COMPONENTS xyz)
## is used, also find other catkin packages
find_package(catkin REQUIRED COMPONENTS
  adhoc_communication
  nav_msgs
  roscpp
  message_generation
)

## System dependencies are found with CMake's conventions
# find_package(Boost REQUIRED COMPONENTS system)

## Uncomment this if the package has a setup.py. This macro ensures
## modules and global scripts declared therein get installed
## See http://ros.org/doc/api/catkin/html/user_guide/setup_dot_py.html
# catkin_python_setup()

################################################
## Declare ROS messages, services and actions ##
################################################

## To declare and build messages, services or actions from within this
## package, follow these steps:
## * Let MSG_DEP_SET be the set of packages whose message types you use in
##   your messages/services/actions (e.g. std_msgs, actionlib_msgs, ...).
## * In the file package.xml:
##   * add a build_depend and a run_depend tag for each package in MSG_DEP_SET
##   * If MSG_DEP_SET isn't empty the following dependencies might have been
##     pulled in transitively but can be declared for certainty nonetheless:
##     * add a build_depend tag for "message_generation"
##     * add a run_depend tag for "message_runtime"
## * In this file (CMakeLists.txt):
##   * add "message_generation" and every package in MSG_DEP_SET to
##     find_package(catkin REQUIRED COMPONENTS ...)
##   * add "message_runtime" and every package in MSG_DEP_SET to
##     catkin_package(CATKIN_DEPENDS ...)
##   * uncomment the add_*_files sections below as needed
##     and list every .msg/.srv/.action file to be processed
##   * uncomment the generate_messages entry below
##   * add every package in MSG_DEP_SET to generate_messages(DEPENDENCIES ...)

## Generate messages in the 'msg' folder
# add_message_files(
#   FILES
#   Message1.msg
#   Message2.msg
# )

## Generate services in the 'srv' folder
 add_service_files(
   DIRECTORY srv
   FILES
   transformPoint.srv
 )

## Generate actions in the 'action' folder
# add_action_files(
#   FILES
#   Action1.action
#   Action2.action
# )

## Generate added messages and services with any dependencies listed here
 generate_messages(
   DEPENDENCIES
   adhoc_communication
   std_msgs  # Or other packages containing msgs
)

###################################
## catkin specific configuration ##
###################################
## The catkin_package macro generates cmake config files for your package
## Declare things to be passed to dependent projects
## INCLUDE_DIRS: uncomment this if you package contains header files
## LIBRARIES: libraries you create in this project that dependent projects also need
## CATKIN_DEPENDS: catkin_packages dependent projects also need
## DEPENDS: system dependencies of this project that dependent projects also need
catkin_package(
#  INCLUDE_DIRS include
#  LIBRARIES map_merger
#  CATKIN_DEPENDS adhoc_communication roscpp
   CATKIN_DEPENDS message_runtime   adhoc_communication
#  DEPENDS system_lib
)

###########
## Build ##
###########

## Specify additional locations of header files
## Your package locations should be listed before other locations
# include_directories(include)
include_directories(
  ${catkin_INCLUDE_DIRS}
)

## Declare a cpp library
# add_library(map_merger
#   src/${PROJECT_NAME}/map_merger.cpp
# )

## Declare a cpp executable
# add_executable(map_merger_node src/map_merger_node.cpp)
find_package(OpenCV REQUIRED)
add_executable(map_merge_node src/main.cpp src/mapmerger.cpp src/mapmerger.h src/mapstitch.h src/mapstitch.cpp src/updateentry.cpp src/updateentry.h src/updatemanager.cpp src/updatemanager.h )
target_link_libraries(map_merge_node ${OpenCV_LIBS} ${catkin_LIBRARIES} )
## Add cmake target dependencies of the executable/library
## as an example, message headers may need to be generated before nodes
# add_dependencies(map_merger_node map_merger_generate_messages_cpp)
 add_dependencies(map_merger_node adhoc_communication_generate_messages_cpp)

## Specify libraries to link a library or executable target against
# target_link_libraries(map_merger_node
#   ${catkin_LIBRARIES}
# )

#############
## Install ##
#############

# all install targets should use catkin DESTINATION variables
# See http://ros.org/doc/api/catkin/html/adv_user_guide/variables.html

## Mark executable scripts (Python etc.) for installation
## in contrast to setup.py, you can choose the destination
# install(PROGRAMS
#   scripts/my_python_script
#   DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
# )

## Mark executables and/or libraries for installation
# install(TARGETS map_merger map_merger_node
#   ARCHIVE DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
#   LIBRARY DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
#   RUNTIME DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
# )

## Mark cpp header files for installation
# install(DIRECTORY include/${PROJECT_NAME}/
#   DESTINATION ${CATKIN_PACKAGE_INCLUDE_DESTINATION}
#   FILES_MATCHING PATTERN "*.h"
#   PATTERN ".svn" EXCLUDE
# )

## Mark other files for installation (e.g. launch and bag files, etc.)
# install(FILES
#   # myfile1
#   # myfile2
#   DESTINATION ${CATKIN_PACKAGE_SHARE_DESTINATION}
# )

#############
## Testing ##
#############

## Add gtest based cpp test target and link libraries
# catkin_add_gtest(${PROJECT_NAME}-test test/test_map_merger.cpp)
# if(TARGET ${PROJECT_NAME}-test)
#   target_link_libraries(${PROJECT_NAME}-test ${PROJECT_NAME})
# endif()

## Add folders to be run by python nosetests
# catkin_add_nosetests(test)

Out put after catkin_make:
-- +++ processing catkin package: 'map_merger'
-- ==> add_subdirectory(map_merger)
/opt/ros/groovy/share/genmsg/cmake/pkg-genmsg.cmake.em:41: error: <class 'genmsg.msg_loader.MsgNotFound'>: Cannot locate message [pointFromOtherRobot]: unknown package [map_merger] on search path [{{'nav_msgs': ['/opt/ros/groovy/share/nav_msgs/msg'], 'geometry_msgs': ['/opt/ros/groovy/share/geometry_msgs/msg'], 'std_msgs': ['/opt/ros/groovy/share/std_msgs/cmake/../msg'], 'adhoc_communication': ['/home/student/RosAriaWS/src/adhoc_communication/msg']}}]
Traceback (most recent call last):
  File "/usr/bin/empy", line 3288, in <module>
    if __name__ == '__main__': main()
  File "/usr/bin/empy", line 3286, in main
    invoke(sys.argv[1:])
  File "/usr/bin/empy", line 3269, in invoke
    interpreter.wrap(interpreter.file, (file, name))
  File "/usr/bin/empy", line 2273, in wrap
    self.fail(e)
  File "/usr/bin/empy", line 2264, in wrap
    apply(callable, args)
  File "/usr/bin/empy", line 2337, in file
    self.safe(scanner, done, locals)
  File "/usr/bin/empy", line 2379, in safe
    self.parse(scanner, locals)
  File "/usr/bin/empy", line 2399, in parse
    token.run(self, locals)
  File "/usr/bin/empy", line 1410, in run
    interpreter.execute(self.code, locals)
  File "/usr/bin/empy", line 2576, in execute
    exec statements in self.globals
  File "<string>", line 37, in <module>
  File "/opt/ros/groovy/lib/python2.7/dist-packages/genmsg/deps.py", line 68, in find_srv_dependencies
    genmsg.msg_loader.load_depends(msg_context, spec, search_paths)
  File "/opt/ros/groovy/lib/python2.7/dist-packages/genmsg/msg_loader.py", line 346, in load_depends
    depends = load_msg_depends(msg_context, spec.request, msg_search_path)
  File "/opt/ros/groovy/lib/python2.7/dist-packages/genmsg/msg_loader.py", line 313, in load_msg_depends
    depspec = load_msg_by_type(msg_context, resolved_type, search_path)
  File "/opt/ros/groovy/lib/python2.7/dist-packages/genmsg/msg_loader.py", line 119, in load_msg_by_type
    file_path = get_msg_file(package_name, base_type, search_path)
  File "/opt/ros/groovy/lib/python2.7/dist-packages/genmsg/msg_loader.py", line 78, in get_msg_file
    % (base_type, package, search_path))
genmsg.msg_loader.MsgNotFound: Cannot locate message [pointFromOtherRobot]: unknown package [map_merger] on search path [{{'nav_msgs': ['/opt/ros/groovy/share/nav_msgs/msg'], 'geometry_msgs': ['/opt/ros/groovy/share/geometry_msgs/msg'], 'std_msgs': ['/opt/ros/groovy/share/std_msgs/cmake/../msg'], 'adhoc_communication': ['/home/student/RosAriaWS/src/adhoc_communication/msg']}}]
CMake Error at /opt/ros/groovy/share/catkin/cmake/safe_execute_process.cmake:11 (message):
  
  execute_process(/home/student/RosAriaWS/build/catkin_generated/env_cached.sh
  "/usr/bin/empy" "--raw-errors" "-F"
  "/home/student/RosAriaWS/build/map_merger/cmake/map_merger-genmsg-context.py"
  "-o"
  "/home/student/RosAriaWS/build/map_merger/cmake/map_merger-genmsg.cmake"
  "/opt/ros/groovy/share/genmsg/cmake/pkg-genmsg.cmake.em") returned error
  code 1
Call Stack (most recent call first):
  /opt/ros/groovy/share/catkin/cmake/em_expand.cmake:23 (safe_execute_process)
  /opt/ros/groovy/share/genmsg/cmake/genmsg-extras.cmake:229 (em_expand)
  map_merger/CMakeLists.txt:69 (generate_messages)

-- Configuring incomplete, errors occurred!
make: *** [cmake_check_build_system] Error 1
Invoking "make cmake_check_build_system" failed

If you need more information, just tell me.
Regards Peter

Originally posted by pkohout on ROS Answers with karma: 336 on 2014-04-27
Post score: 1

A:

First things first: The adhoc_communication has to be catkinized, otherwise what you want will not work (as catkin packages can only depend on catkin packages, not rosbuild ones).
Assuming the above is the case, it probably is easiest to look at a somewhat similar example and make sure both your package containing the msg definitions and the one using them are not missing any required entries in both their package.xml and CMakeLists.txt files. One example I randomly found ist kobuki_msgs and kobuki_keyop with the first package providing the msg definition and the second one using it.

Originally posted by Stefan Kohlbrecher with karma: 24361 on 2014-04-27
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by joq on 2014-04-29:
See also: http://docs.ros.org/api/catkin/html/howto/cpp_msg_dependencies.html .

