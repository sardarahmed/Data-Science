Q:

ROS (Melodic) + Docker: rosrun not found

Hi there,
I am currently trying to run ROS Melodic on Docker to build the rosserial_arduino libraries for Arduino. Therefore I need to run
rosrun rosserial_arduino make_libraries.py in the Docker container. However I get a rosrun: command not found, despite sourcing the setup.bash. Here is my Dockerfile:
FROM osrf/ros:melodic-desktop-full-bionic as builder_base
SHELL ["/bin/bash", "-c"]
COPY . .
RUN apt-get update && apt-get install -y \
    ros-melodic-rosserial-arduino \
    ros-melodic-rosserial \
    python-rosdep \
    python-rosinstall \
    python-rosinstall-generator \
    python-wstool \
    build-essential \
    && rm -rf /var/lib/apt/lists/

RUN echo "source /opt/ros/melodic/setup.bash" >> ~/.bashrc
RUN source ~/.bashrc
WORKDIR /arduino
RUN rosrun rosserial_arduino make_libraries.py

I run this on Ubuntu 19.04.
Any ideas why I get this error and how to solve it?
Thanks in advance!

Originally posted by Julian98 on ROS Answers with karma: 69 on 2020-04-22
Post score: 1

A:

In Docker, all RUN statements are executed in a separate shell (this is not entirely correct, but it gets the point across). So source in one RUN statement does not affect the environment in which another is run.

RUN source ~/.bashrc

You can do this, but you'll need to run this in bash, otherwise it won't work (something like bash -c 'source ...').
But I believe there is an easier way to do this:
RUN /opt/ros/melodic/env.sh rosrun rosserial_arduino make_libraries.py

The env.sh script takes care of loading all the required environment variables.
I would also recommend to use relative paths as little as possible, as they may not resolve to where you expect them to resolve to in Docker builds.

Originally posted by gvdhoorn with karma: 86574 on 2020-04-22
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by gvdhoorn on 2020-04-22:
PS: technically this isn't really a ROS problem, but caused by the way Docker (builds) work(s).
Comment by Julian98 on 2020-04-22:
Thank you very much!
It is indeed, but I think it might be helpful for other people working with ROS to have it answered in this forum.

