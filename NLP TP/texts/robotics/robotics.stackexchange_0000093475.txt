Q:

How to create a python script that works with python3 and 2

In the install space, python scripts have their shebang changed to the version specified with PYTHON_EXECUTABLE. In the devel workspace this also happens for globally installed scripts. But when I run a normal script with rosrun, it will take the version specified in the shebang. How can I create a script that works in both python versions in the devel space?
I could change the shebang to python3 but then it's not backwards compatible. I would like to have this handled automatically.
Is this a good solution?
#!/usr/bin/env python$ROS_PYTHON_VERSION

/usr/bin/env: ‘python$ROS_PYTHON_VERSION’: No such file or directory

EDIT
I found that REP-151 will describe the path for switching from Python 2 to Python 3 in ROS 1. It's still WIP, but I found some answers there.
https://github.com/ros-infrastructure/rep/pull/201/files

Originally posted by Rayman on ROS Answers with karma: 128 on 2019-10-04
Post score: 1

A:

There is a documentation about UsingPython3 in the ROS wiki, with one specific section towards changing the shebang.
Does that help?
P.S: This documentation has been announced recently on discourse and as they say:

While it has had a few reviewers, I think this is the first time it’s been linked publicly, so if you have a wiki account please fix any issues you find.

Originally posted by mgruhler with karma: 12390 on 2019-10-07
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Rayman on 2020-07-03:
PR https://github.com/ros/catkin/pull/1044 greatly improves working with python2/3 due to automatically rewriting the shebang to the wanted python version. Now it's possible to follow the wiki.

