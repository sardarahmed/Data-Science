Q:

Kobuki "malformed subpayload"

I'm working with Turtlebot2 (with the Kobuki base) and running ROS Groovy.  I'm intermittently seeing error messages like the ones below.  Once these error messages start to appear, the robot becomes unresponsive.  Relaunching the Turtlebot by running:
roslaunch turtlebot_bringup minimal.launch
doesn't help.  Nor does power-cycling the robot. The only thing that seems to help is rebooting the notebook and re-launching.  This works for a few minutes until the error messages reappear.   I haven't been able to reliably reproduce the conditions that cause the error.  I'm running version 1.1.3 of the Kobuki firmware.  Any advice would be much appreciated.

[ERROR] [1358185944.885286960]: Kobuki : malformed sub-payload detected. [116][255] [74 FF 77 00 D6 FF 7B FF 10 10 01 00 D9 0F DA 0F D3 0F DB 0F EF 0F 00 00 00 00 62 AA 55 4D 01 0F 60 D8 00 00 00 69 5D FA 5B 00 00 00 00 9E 00 03 03 00 00 00 04 07 A9 FB F9 FF 00 00 00 05 06 2B 06 50 07 99 06 06 02 00 00 0D 0E 13 06 7D 00 DD FF 83 FF 75 00 E0 FF 8E FF 10 10 01 00 D9 0F DD 0F D6 0F D7 0F F1 0F ]
[ERROR] [1358185986.942876038]: Kobuki : Timed out while waiting for serial data stream [/mobile_base].
[ERROR] [1358185987.905898133]: Kobuki : malformed subpayload detected.
[ERROR] [1358185997.916354409]: Kobuki : malformed sub-payload detected. [177][255] [B1 FF 6A 00 DF FF A6 FF 10 10 01 00 D7 0F DE 0F D4 0F D8 0F EE 0F 00 00 00 00 ]
[ERROR] [1358186002.942891211]: Kobuki : Timed out while waiting for serial data stream [/mobile_base].
[ERROR] [1358186018.942877693]: Kobuki : Timed out while waiting for serial data stream [/mobile_base].
[ERROR] [1358186025.965638646]: Kobuki : malformed sub-payload detected. [15][219] [0F DB 0F D3 0F D8 0F EF 0F 00 00 00 00 B9 AA 55 4D 01 0F 68 15 00 00 00 69 5D FA 5B 00 00 00 00 9E 00 03 03 00 00 00 04 07 A9 FB F9 FF 00 00 00 05 06 2C 06 53 07 99 06 06 02 00 00 0D 0E DB 06 51 00 DC FF 8C FF 55 00 DD FF 92 FF 10 10 01 00 D7 0F DA 0F DC 0F D5 0F F1 0F 00 00 ]
[ERROR] [1358186047.963542755]: Kobuki : malformed sub-payload detected. [152][255] [98 FF 10 10 01 00 DB 0F D7 0F D4 0F DE 0F F0 0F 00 00 00 00 ]

EDIT:
After the error messages above, the ftdi device associated with the Kobuki no longer shows up after an lsusb.
Here is some additional output from dmesg in case it means anything to anyone:

[ 1798.755034] ftdi_sio ttyUSB0: ftdi_set_termios FAILED to set databits/stopbits/parity
[ 1799.766442] ftdi_sio ttyUSB0: ftdi_set_termios urb failed to set baudrate
[ 1800.777800] usb 2-1: clear tt 1 (00c0) error -110
[ 1809.784380] ftdi_sio ttyUSB0: urb failed to clear flow control
[ 1815.804665] usb 2-1: clear tt 1 (00c0) error -110
[ 1819.802188] ftdi_sio ttyUSB0: urb failed to clear flow control
[ 1824.811133] ftdi_sio ttyUSB0: urb failed to clear flow control
[ 1829.820075] ftdi_sio ttyUSB0: urb failed to clear flow control
[ 2021.126192] 
[ 2021.126197] 
[ 2021.126198] 

Then later...

[ 2506.845165] usb 2-1.3: USB disconnect, device number 12
[ 2506.845541] ftdi_sio ttyUSB0: FTDI USB Serial Device converter now disconnected from ttyUSB0
[ 2506.845576] ftdi_sio 2-1.3:1.0: device disconnected
[ 2541.821673] usb 2-1.4: USB disconnect, device number 8
[ 2541.821678] usb 2-1.4.1: USB disconnect, device number 9
[ 2541.822215] usb 2-1.4.2: USB disconnect, device number 11
[ 2546.878605] hub 2-1:1.0: hub_port_status failed (err = -110)
[ 2546.878613] hub 2-1:1.0: connect-debounce failed, port 4 disabled
[ 2553.498868] usb 2-1.4: new high-speed USB device number 13 using ehci_hcd
[ 2553.590734] ehci_hcd 0000:00:1d.0: fatal error
[ 2553.594616] ehci_hcd 0000:00:1d.0: HC died; cleaning up
[ 2553.597523] ehci_hcd 0000:00:1d.0: force halt; handshake ffffc9000066c024 00004000 00004000 -> -110
[ 2553.597530] ehci_hcd 0000:00:1d.0: HC died; cleaning up
[ 2553.606569] usb 2-1.4: device descriptor read/all, error -108
[ 2553.606582] hub 2-1:1.0: cannot disable port 4 (err = -19)
[ 2553.606606] hub 2-1:1.0: cannot reset port 4 (err = -19)
[ 2553.606614] hub 2-1:1.0: cannot disable port 4 (err = -19)
[ 2553.606624] hub 2-1:1.0: cannot reset port 4 (err = -19)
[ 2553.606630] hub 2-1:1.0: cannot disable port 4 (err = -19)
[ 2553.606639] hub 2-1:1.0: cannot reset port 4 (err = -19)
[ 2553.606646] hub 2-1:1.0: cannot disable port 4 (err = -19)
[ 2553.606651] hub 2-1:1.0: unable to enumerate USB device on port 4
[ 2553.606657] hub 2-1:1.0: cannot disable port 4 (err = -19)
[ 2553.606680] usb 2-1: USB disconnect, device number 2

EDIT 2
It looks like the problem is specific to the netbooks I'm using to connect to the robot: Acer Aspire One 756-4854.  I've run the same tests from several other computers and not seen this problem.  I won't close this question in case someone knows how to get this netbook to work with the Turtlebot.

Originally posted by nsprague on ROS Answers with karma: 228 on 2013-01-14
Post score: 2

Original comments
Comment by bit-pirate on 2013-01-23:
Hi nsprague! During the development of Kobuki, we once had an USB issue, which caused the netbook's USB controller to hang up. It also forced us to reboot the netbook to get it working again. Unfortunately, we were not able to reproduce this reliably.
Comment by bit-pirate on 2013-01-23:
The few times we did, we noticed that Kobuki's battery level was low. Could you test your netbook with Kobuki on fully loaded batteries again? My colleague is using an Acer Aspire One, but its model number is D255. He hasn't reported any issues with it, but I'll ask him again.
Comment by nsprague on 2013-02-11:
This definitely wasn't an issue with the battery.  It seems to be specific to the netbook model.  It turns out that this Acer has all three external USB ports on the same USB bus.  I've been told that there are issues with putting the Kinect and the Kobuki on the same bus.
Comment by Daniel Stonier on 2013-02-21:
Ok, thanks for the feedback nsprague.
Comment by fherrero on 2013-03-13:
I'm having the same exact issues with a Turtlebot2-kobuki and the netbook Acer Aspire One. Any workaround found?
Comment by Daniel Stonier on 2013-03-14:
Do you have the same situation fherroro? i.e. kinect and kobuki usb's on the same bus.
Comment by nsprague on 2013-03-20:
I never found a workaround.  I purchased new netbooks: Asus X201e's.  These don't have the kobuki issue described above, but they have their own issues.  Neither wired nor wireless Ethernet are well-supported under Ubuntu.
Comment by vik748 on 2017-05-25:
I just ordered brand new turtlebots and am using them on an Intel NUC model NUC5i7RYH with the Ubuntu provided on the USB stick.  I get the exact error messages.  Has any one figured out any workarounds in the last 4 years?

A:

@nsprague We found out that the same ASUS netbook model is distributed with varying hardware (different wired and wireless network cards). Hence, driver support is difficult. Two turtlebot distributors are working hard on finding a solution. Join the turtlebot mailing list to stay up to date!

Originally posted by bit-pirate with karma: 2062 on 2013-03-20
This answer was ACCEPTED on the original site
Post score: 0

