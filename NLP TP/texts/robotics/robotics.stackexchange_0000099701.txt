Q:

using nav msg map in UI

I am developoing a mission planner where nav_msgs/MapMeta data has been loaded into ui. Here i am trying to display the position of robot in given map with (x,y) coordinates. The map.yaml is as:
image: nic_map4.pgm
resolution: 0.050000
origin: [-51.224998, -51.224998, 0.000000]
negate: 0
occupied_thresh: 0.65
free_thresh: 0.196

Here for example if the robot position is comming as (1,1) a set the robot pose as x=1resolution, y=1resolution but the positions seems not correct. How exactly should i display the position of robot in given map.

Originally posted by dinesh on ROS Answers with karma: 932 on 2021-07-21
Post score: 0

A:

Hi,
The origin of the map.yaml [-51.224998, -51.224998, 0.000000] refers to the position of the bottom left corner pixel of your map image with respect to your map frame. So, in order to represent your robot's position at (1,1) [with respect to the map frame], your pixel value from the bottom left corner of the map image would be: [1044.49996 pixels,1044.49996 pixels]
Calculation:
pixel value of the map origin in x: +51.224998 / resolution = +51.224998 / 0.05 = 1024.49996 pixels
pixel value of the map origin in y: +51.224998 / resolution = +51.224998 / 0.05 = 1024.49996 pixels
Now,
pixel value of the position (1,1) with respect to your map frame in x:
1024.49996 pixels + (1/resolution) = 1024.49996 pixels + (1/0.05) = 1044.49996 pixels
pixel value of the position (1,1) with respect to your map frame in y:
1024.49996 pixels + (1/resolution) = 1024.49996 pixels + (1/0.05) = 1044.49996 pixels
Please note: I am considering the pixel values with respect to the bottom left corner of the image.

Originally posted by Immanuel with karma: 46 on 2021-07-22
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by dinesh on 2021-07-22:
I tried this in my code, the position of robot is somehow improved but still the robot seems to not be in exact place in given map as seen here. https://www.youtube.com/watch?v=lYn9nYN5zv8
Comment by Immanuel on 2021-07-22:
hmm. that is a little weird. It looks like there is some calculation error. What are your image dimensions (in pixels) (on ubuntu, right-click on the image, go to properties > image)
Comment by dinesh on 2021-07-22:
width, height = 384*384
map.yaml:
image: ./map.pgm
resolution: 0.050000
origin: [-10.000000, -10.000000, 0.000000]
negate: 0
occupied_thresh: 0.65
free_thresh: 0.196
Comment by Immanuel on 2021-07-22:
basically, if the robot pose is (x,y):
your pixel values would be (200 + x/0.05 pix, 184 - y/0.05 pix) [where your 0,0 is at the top left corner]
Comment by dinesh on 2021-07-22:
This is working, but can you tell me why 184 value is used instead of 200?
Comment by Immanuel on 2021-07-23:
so (200 + x/0.05, 200 + y/0.05) is the value when you consider it with respect to the bottom left corner but
when you consider it with respect to the top left corner (which is the way in which pixels are considered for image processing), you will need to subtract image height 384 - (200+y/0.05) = 184 - y/0.05. so with respect to the top left corner, it would be  (200 + x/0.05 pix, 184 - y/0.05 pix)
Comment by Immanuel on 2021-07-23:
Also, your application looks interesting. Are you kind of using some GUI to switch between the mapping mode and the localization mode?
Comment by dinesh on 2021-07-23:
I am developing a qt quick based GUI from where user can send the mission command to any service robot deployed, here in mapping mode user can assign unique name for location selected in map.
Comment by dinesh on 2021-07-23:
I am getting some trouble in getting correct location coordinated in the map from the UI, Can you tell me how do i properly convert the pixel coordinated to correct coordinate data from given map?

