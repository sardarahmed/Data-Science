Q:

Problem publishing at cmd_vel

Hello,
I have written the following code so I can send commands to my robots motors, which are listening to the /labrob/cmd_vel topic:
#include "ros/ros.h"
#include "geometry_msgs/Twist.h"

int main(int argc, char **argv)
{

  ros::init(argc, argv,"vel");
  ros::NodeHandle vel;
  ros::Publisher vel_pub = vel.advertise<geometry_msgs::Twist>("/labrob/cmd_vel", 100);
  ros::Rate loop_rate(10);
    geometry_msgs::Twist msg;
    msg.linear.x = 0.1;
    msg.linear.y = 0;
    msg.linear.z = 0;
    msg.angular.x = 0;
    msg.angular.y = 0;
    msg.angular.z = 0;
    vel_pub.publish(msg);
    ros::spin();

  return 0;
}

With the rostopic pub command via the terminal, I can move the robot fine, but with the code I posted, the robot does not respond. What I am doing wrong ?

Originally posted by patrchri on ROS Answers with karma: 354 on 2016-08-01
Post score: 0

A:

I don't know what went wrong, but I modified the code to this:
#include "ros/ros.h"
#include "geometry_msgs/Twist.h"

int main(int argc, char **argv)
{

  ros::init(argc, argv,"vel");
  ros::NodeHandle vel;
  ros::Publisher vel_pub = vel.advertise<geometry_msgs::Twist>("/labrob/cmd_vel", 100);
    while(ros::ok){
    geometry_msgs::Twist msg;
    msg.linear.x = 0.1;
    msg.linear.y = 0;
    msg.linear.z = 0;
    msg.angular.x = 0;
    msg.angular.y = 0;
    msg.angular.z = 0;
    vel_pub.publish(msg);
    ros::spinOnce();
    }
  return 0;
}

And it worked.

Originally posted by patrchri with karma: 354 on 2016-08-01
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Humpelstilzchen on 2016-08-03:
See http://answers.ros.org/question/11167/how-do-i-publish-exactly-one-message/

