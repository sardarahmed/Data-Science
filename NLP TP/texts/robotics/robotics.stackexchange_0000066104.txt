Q:

ROS Answers SE migration: IMU ignored

Thanks again for your feedback, Tom.
I  fined-tuned the rejection_threshold parameters and now the filter is responsive.
<param name="imu0_pose_rejection_threshold" value="4.0"/>

Also, enabling the 2D mode helped
<param name="two_d_mode" value="true"/>

But still the drift is way too much. After a few seconds of execution the twuist looks like this:
> twist: 
  twist: 
    linear: 
      x: 0.913357125234
      y: 0.430200660862
      z: -7.14791210599e-13
    angular: 
      x: -2.81627680375e-24
      y: 5.93552733918e-24
      z: -0.00848949772664

The IMU must be calibrated and I have to figure out the covariance matrix for the measurements. Is there any ROS package that is particularly suitable for my needs?
thanks,
marcello

Originally posted by scar on ROS Answers with karma: 13 on 2015-02-27
Post score: 0

Original comments
Comment by Tom Moore on 2015-02-28:
Sorry, I wasn't clear in my answer. Please post:

Your launch file for ekf_localization_node
Run rostopic echo on each input topic (just the IMU for you, I believe), and copy and paste one message here

You can remove the debug output, or perhaps post a link to it on DropBox.

A:

I need to add this to the wiki, but in general, it's best to post your launch file, a sample message from each sensor, and if possible, a bag file. In this case, though, the answer is here:
Innovation mahalanobis distance test failed. Squared Mahalanobis is 0.00026296 threshold was: 0.0001 Innovation: [-0.0016803 0.0017509 -0.0021135 ]

You set your rejection threshold too low for this sensor. I'd remove that setting from your launch file until you get everything else working.
EDIT 1 in response to comments and updates:
First, if your only sensor data is an IMU, I would expect your position to drift without bound. You have non-zero linear acceleration values, and those are going to be integrated into velocities, and then integrated again into position. A single IMU is insufficient for a good state estimate.
As far as your statement that the orientation appears to be ignored, try setting all non-orientation variables to false for imu0_config (this only serves to isolate the problem), and try again. If it still doesn't work, change your static transform publisher so it publishes at a faster rate. The last parameter is not frequency in Hz, it's period in ms, so with a value of 100, you're only publishing that transform at 10 Hz. If it still doesn't work, post the debug file to the DropBox location.
EDIT 2 in response to updated question: glad to hear it's working better. However, I should point out that even if you calibrate your IMU, you will most certainly get false motion resulting from your accelerometers. You need another velocity or position measurement to eliminate this effect.

Originally posted by Tom Moore with karma: 13689 on 2015-02-27
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by scar on 2015-02-28:
Thank you, Tom for your prompt reply, next you can see my answer with more details and a link to a shared dropbox folder where you can check the source files.
Marcello
Comment by scar on 2015-03-01:
Interesting outcome! This particular IMU I'm using removes the gravitational acceleration on-board.
So I set : <param name="imu0_remove_gravitational_acceleration" value="false"/>
And now I have the opposite effect. The imu seems drifting unbounded.
Besides, the rotation is not effective at all.

