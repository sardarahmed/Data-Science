Q:

white balance problem for USB camera

Hi All,
I have an Orbbec Astra Pro camera and I can get the RGB image using libuvc_camera package. However, the RGB image I get doesn't look very good. You can see the image below.

It looks like there's one yellow layer on top of the image. I was told this is due to a bad white balance. I tried to enable the auto_white_balance setting in libuvc but it makes no difference. This is the launch file I ran:
<launch>
  <group ns="camera">
    <node pkg="libuvc_camera" type="camera_node" name="mycam">
      <!-- Parameters used to find the camera -->
      <param name="vendor" value="0x0"/>
      <param name="product" value="0x0"/>
      <param name="serial" value=""/>
      <!-- If the above parameters aren't unique, choose the first match: -->
      <param name="index" value="0"/>

      <!-- Image size and type -->
      <param name="width" value="640"/>
      <param name="height" value="480"/>
      <!-- choose whichever uncompressed format the camera supports: -->
      <param name="video_mode" value="uncompressed"/> <!-- or yuyv/nv12/mjpeg -->
      <param name="frame_rate" value="15"/>

      <param name="timestamp_method" value="start"/> <!-- start of frame -->
      <param name="camera_info_url" value="file:///tmp/cam.yaml"/>

      <param name="auto_exposure" value="3"/> <!-- use aperture_priority auto exposure -->
      <param name="auto_white_balance" value="true"/>
    </node>
  </group>
</launch>

Does anyone known how to solve this while balance problem with my astra pro camera? I'm running this on Ros-Kinetic with Ubuntu 16.04. Thanks!

Originally posted by mzWang on ROS Answers with karma: 39 on 2018-05-30
Post score: 1

Original comments
Comment by psammut on 2018-05-30:
Hi! first step when messing is to make sure that the issue lays with ROS/libuvc driver and not the camera.
To do this, use whatever viewer/driver came with the orbtec camera. Also use guvcview (sudo apt install guvcview) and play with the settings.
Comment by mzWang on 2018-05-30:
Thank you! I think what you suggested makes sense. I used guvcview and tuned the white balance, the best result (lowest white balance temperature) I can get is not much better than what I have here. Does that mean this is a hardware problem?
Comment by mzWang on 2018-05-30:
BTW, I saw some other people can get a "whiter" image with Astra Pro. I have four of those cameras here but all of them have this "Yellow" image problem.
Comment by NEngelhard on 2018-05-30:
What happens if you use the astra_camera?
Comment by mzWang on 2018-05-30:
Hi NEngelHard, are you referring to the astra_camera package? Since I'm using Astra Pro, which has a separate uvc camera, I have to use libuvc to get the rgb image. With the astra_camera, I can only get the depth and ir image.
Comment by NEngelhard on 2018-05-31:
The astra_camera-package also supports rgb-streaming
Comment by mzWang on 2018-05-31:
Hi NEngelhard, can you give me more details? I tried to run "roslaunch astra_launch astrapro.launch" but no rgb topic was published. I read here that I a need a separate driver for RGB stream: https://answers.ros.org/question/246595/astra_launch-and-astra_camera-packages-problems-with-rgb/
Comment by NEngelhard on 2018-05-31:
I am using the Astra Mini S, I assumed that they behave the same, but it looks like I'm simply wrong :(

A:

This is a camera problem and not a ros driver issue. You can confirm this by using a dedicated viewer such as guvcview or the Orbbec Astra Pro's camera and seeing if the picture looks the same. If there is any check box or slider that relates to white balance, try messing with it. If it doesn't change anything, rest assured that that is the best you will get with that camera.
If you would like a better RGB image you should use a better dedicated RGB camera such as the logitech C920. Another slightly more pro and not much more expensive would be a USB3 color camera like this one: https://www.e-consystems.com/wide-temperature-range-hdr-usb-cameraboard.asp
Good luck!
PS. Always look for the more reasonable solution to the problem before committing endless hours to going into the rabbit hole that is messing with linux uvc drivers ;p

Originally posted by psammut with karma: 258 on 2018-05-31
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by mzWang on 2018-06-01:
Thanks for the tips! :)

