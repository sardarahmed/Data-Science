Q:

can't set any settings for uvc_camera

Hi guys,
I want to use a webcam with the uvc_camera Package. I'm using Ubuntu 11.10 server and compiled the package from source (because I use an ARM processor). It compiled without any problems but when I try to run the launchfile (camera_node.launch) I got the following failure message. I can see the video but its really slow and all settings (color, saturation, whitbalance etc.) are wrong and the picture looks almost crossprocessed.
camera_node.launch:
PARAMETERS
 * /uvc_camera/device
 * /rosdistro
 * /uvc_camera/fps
 * /uvc_camera/height
 * /uvc_camera/camera_info_url
 * /uvc_camera/frame
 * /rosversion
 * /uvc_camera/width

NODES
  /
    uvc_camera (uvc_camera/camera_node)

auto-starting new master
process[master]: started with pid [3736]
ROS_MASTER_URI=http://localhost:11311

setting /run_id to c57a2f6c-b5ae-11e1-bd3e-2e607c264e01
process[rosout-1]: started with pid [3751]
started core service [/rosout]
process[uvc_camera-2]: started with pid [3754]
[ INFO] [1339629806.595916290]: using default calibration URL
[ INFO] [1339629806.597411651]: camera calibration URL: file:///home/panda/.ros/camera_info/camera.yaml
[ERROR] [1339629806.598754424]: Unable to open camera calibration file [/home/panda/.ros/camera_info/camera.yaml]
[ WARN] [1339629806.599486846]: Camera calibration file /home/panda/.ros/camera_info/camera.yaml not found.
[ INFO] [1339629806.612029571]: camera calibration URL: file:///home/panda/ros_workspace/camera_umd/uvc_camera/example.yaml
[ERROR] [1339629806.612853545]: Unable to open camera calibration file [/home/panda/ros_workspace/camera_umd/uvc_camera/example.yaml]
[ WARN] [1339629806.613372344]: Camera calibration file /home/panda/ros_workspace/camera_umd/uvc_camera/example.yaml not found.
opening /dev/video2
pixfmt 0 = 'YUYV' desc = 'YUV 4:2:2 (YUYV)'
  discrete: 640x480:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 160x90:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 160x120:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 176x144:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 320x180:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 320x240:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 352x288:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 432x240:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 640x360:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 800x448:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 800x600:   1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 864x480:   1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 960x720:   1/15 1/10 2/15 1/5
  discrete: 1024x576:   1/15 1/10 2/15 1/5
  discrete: 1280x720:   1/10 2/15 1/5
  discrete: 1600x896:   2/15 1/5
  discrete: 1920x1080:   1/5
  discrete: 2304x1296:   1/2
  discrete: 2304x1536:   1/2
pixfmt 1 = '    ' desc = '34363248-0000-0010-8000-00aa003'
  discrete: 640x480:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 160x90:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 160x120:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 176x144:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 320x180:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 320x240:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 352x288:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 432x240:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 640x360:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 800x448:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 800x600:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 864x480:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 960x720:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 1024x576:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 1280x720:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 1600x896:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 1920x1080:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
pixfmt 2 = 'MJPG' desc = 'MJPEG'
  discrete: 640x480:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 160x90:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 160x120:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 176x144:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 320x180:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 320x240:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 352x288:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 432x240:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 640x360:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 800x448:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 800x600:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 864x480:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 960x720:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 1024x576:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 1280x720:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 1600x896:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  discrete: 1920x1080:   1/30 1/24 1/20 1/15 1/10 2/15 1/5
  int (Brightness, 0, id = 980900): 0 to 255 (1)
  int (Contrast, 0, id = 980901): 0 to 255 (1)
  int (Saturation, 0, id = 980902): 0 to 255 (1)
  bool (White Balance Temperature, Auto, 0, id = 98090c): 0 to 1 (1)
  int (Gain, 0, id = 980913): 0 to 255 (1)
  menu (Power Line Frequency, 0, id = 980918): 0 to 2 (1)
    0: Disabled
    1: 50 Hz
    2: 60 Hz
  int (White Balance Temperature, 0, id = 98091a): 2000 to 6500 (1)
  int (Sharpness, 0, id = 98091b): 0 to 255 (1)
  int (Backlight Compensation, 0, id = 98091c): 0 to 1 (1)
  menu (Exposure, Auto, 0, id = 9a0901): 0 to 3 (1)
  int (Exposure (Absolute), 0, id = 9a0902): 3 to 2047 (1)
  bool (Exposure, Auto Priority, 0, id = 9a0903): 0 to 1 (1)
  int (Pan (Absolute), 0, id = 9a0908): -36000 to 36000 (3600)
[  418.948883] uvcvideo: Failed to query (SET_CUR) UVC control 10 on unit 3: -32 (exp. 2).
  int (Tilt (Absolute), 0, id = 9a0909): -36000 to 36000 (3600)
  int (Focus (absolute), 0, id = 9a090a): 0 to 250 (5)
  bool (Focus, Auto, 0, id = 9a090c): 0 to 1 (1)
current value of 10094851 is 1
current value of 10094849 is 3
current value of 9963776 is 128
current value of 9963777 is 128
current value of 9963788 is 1
current value of 9963802 is 4000
unable to set control: Input/output error
ERROR: could not set some settings.
 unable to set control

When I use the nodelet launchfile it doesn't even start at all.
camera_nodelet.launch:
PARAMETERS
 * /uvc_camera/device
 * /rosdistro
 * /uvc_camera/fps
 * /uvc_camera/height
 * /uvc_camera/camera_info_url
 * /uvc_camera/frame
 * /rosversion
 * /uvc_camera/width

NODES
  /
    camera_process (nodelet/nodelet)
    uvc_camera (nodelet/nodelet)

auto-starting new master
process[master]: started with pid [966]
ROS_MASTER_URI=http://localhost:11311

setting /run_id to e9f6652a-b5bf-11e1-8fa8-2e607c264e01
process[rosout-1]: started with pid [981]
started core service [/rosout]
process[camera_process-2]: started with pid [984]
process[uvc_camera-3]: started with pid [985]
[ INFO] [1339637168.735869637]: Loading nodelet /uvc_camera of type uvc_camera/Camera to manager /camera_process with the following remappings:
[ INFO] [1339637168.761138191]: waitForService: Service [/camera_process/load_nodelet] has not been advertised, waiting...
[ INFO] [1339637169.621276130]: waitForService: Service [/camera_process/load_nodelet] is now available.
[ERROR] [1339637169.630278816]: Failed to load nodelet [/uvc_camera] of type [uvc_camera/Camera]: According to the loaded plugin descriptions the class uvc_camera/Camera with base class type nodelet::Nodelet does not exist. Declared types are  depth_image_proc/convert_metric depth_image_proc/disparity depth_image_proc/point_cloud_xyz depth_image_proc/point_cloud_xyzrgb depth_image_proc/register image_proc/crop_decimate image_proc/debayer image_proc/rectify image_view/disparity image_view/image openni_camera/OpenNINodelet openni_camera/driver pcl/BAGReader pcl/BoundaryEstimation pcl/ConvexHull2D pcl/EuclideanClusterExtraction pcl/ExtractIndices pcl/ExtractPolygonalPrismData pcl/FPFHEstimation pcl/FPFHEstimationOMP pcl/MomentInvariantsEstimation pcl/MovingLeastSquares pcl/NodeletDEMUX pcl/NodeletMUX pcl/NormalEstimation pcl/NormalEstimationOMP pcl/NormalEstimationTBB pcl/PCDReader pcl/PCDWriter pcl/PFHEstimation pcl/PassThrough pcl/PointCloudConcatenateDataSynchronizer pcl/PointCloudConcatenateFieldsSynchronizer pcl/PrincipalCurvaturesEstimation pcl/ProjectInliers pcl/SACSegmentation pcl/SACSegmentationFromNormals pcl/SegmentDifferences pcl/StatisticalOutlierRemoval pcl/TestListener pcl/TestPingPong pcl/TestTalker pcl/VFHEstimation pcl/VoxelGrid stereo_image_proc/disparity stereo_image_proc/point_cloud stereo_image_proc/point_cloud2 test_nodelet/ConsoleTest test_nodelet/Plus uvc_camera/CameraNodelet uvc_camera/StereoNodelet
[FATAL] [1339637169.662230720]: Service call failed!
[uvc_camera-3] process has died [pid 985, exit code 255].
log files: /home/panda/.ros/log/e9f6652a-b5bf-11e1-8fa8-2e607c264e01/uvc_camera-3*.log

Originally posted by dinamex on ROS Answers with karma: 447 on 2012-07-07
Post score: 3

A:

The uvc_camera wiki page states that dynamic control of the parameters is still on the TODO list (see here). A quick run through the code reveals that the parameters are being set starting at line 158 in src/uvc_cam.cpp.
The best way to change these parameters would be to set them up these calls through dynamic reconfigure. The driver already prints out the available controls and their ranges, and you can use these as a guide to set the appropriate values in the dynamic reconfigure gui.

Originally posted by piyushk with karma: 2871 on 2012-07-08
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by DocSmiley on 2012-08-17:
I've been having a similar issue. I have gone in and changed the control ranges in the area specified but it hasn't had an effect. According to the camera specs, I should not be setting the White Balance Temperature (Auto is there and set). The line is commented out but it's shown in the output.
Comment by RafBerkvens on 2013-04-12:
I also looked at the line suggested by @piyushk. The set_control() function calls a different id than the one printed: 9963776 would be brightness, while printed says brightness is 980900. However, my output suggests that the value set in the code is used, not the one printed. Very confusing.
Comment by lucasw on 2014-08-20:
https://github.com/ericperko/uvc_cam/blob/master/src/uvc_cam/uvc_cam.cpp#L233 (a fork) has some commented out lines like
set_control(V4L2_CID_BRIGHTNESS, 135);
Also from the command line:
uvcdynctrl -d /dev/video0 -s 'Brightness' 135

