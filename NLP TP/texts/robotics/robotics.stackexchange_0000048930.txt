Q:

How to remove a TF from a ROS bag?

I have a bag that contains a large TF tree where one TF (base_link->virtual_cam) was calculated based on several TFs and parameters. I would like to replay this bag without this generated TF in order to interactively re-generate it as a play the bag.
Hence the question, how do I remove this TF from the bag? Alternatively, can I play the bag without outputting this TF?
Specs: Ubuntu 12.04, Fuerte

Originally posted by Benoit Larochelle on ROS Answers with karma: 867 on 2013-03-03
Post score: 10

A:

You can use the rosbag filter command to generate a new bag file filtering out the topics you do not want.
For example, I used this command
rosbag filter input.bag output.bag 'topic == "/camera/image_raw/compressed" or topic == "/scan" or topic == "/timetag" or  topic == "/tf" and m.transforms[0].header.frame_id != "/odom" and m.transforms[0].child_frame_id != "/odom"' 

here I want to keep the topics /camera/image_raw/compressed , /scan and /timetag and also the /tf EXCEPT the ones that had /odom either as a frame_id or as a child_frame_id, effectively removing only some /tf messages instead of all of them.
in your case you can use adapt the above example to fit your needs:
rosbag filter input.bag output.bag 'topic == "ALL THE TOPICS YOU WANT TO KEEP" or topic == "/tf" and m.transforms[0].header.frame_id != "/base_link" and m.transforms[0].child_frame_id != "/virtual_cam"'

EDIT: as pointed by @Ben_S, this is a more concise form, with the same results (from this answer):
rosbag filter input.bag output.bag 'topic != "/tf" or topic == "/tf" and m.transforms[0].header.frame_id != "/base_link" and m.transforms[0].child_frame_id != "/virtual_cam"'

Originally posted by Proc贸pio with karma: 4402 on 2013-03-03
This answer was ACCEPTED on the original site
Post score: 32

Original comments
Comment by Benoit Larochelle on 2013-03-03:
This tool seems really useful (it could have its own page with many examples), but I don't see how to remove a particular TF. All TFs were published to /tf.
Comment by Proc贸pio on 2013-03-03:
check my first example code, there you have to play with the last two conditions to fit your case, meaning you remove tf messages where your frame_id is base_link and the child_frame_id is virtual_cam.
Comment by Benoit Larochelle on 2013-03-04:
I think that this alone should work, but I did not try it: rosbag filter input.bag output.bag 'm.transforms[0].child_frame_id != "/virtual_cam"'. I'm working with a recording of 30+ GB in several bags, so the other solution was more practical. I would mark this as correct if I could choose two. :-)
Comment by dornhege on 2013-03-04:
You'll need the more complex commands given in the answer as the condition will be evaluated for every message, not only tf. So accessing m.transforms will give you an assertion.
Comment by hitzg on 2014-01-08:
This will only work if you are sure that only one transformation is sent in every message (i.e. there is only one element in m.transforms).
Comment by Proc贸pio on 2014-01-09:
I know that what it looks like, due to the [0] index, but actually I tested it with many transformations in each message and it works. Have you tried it?
Comment by Tom Moore on 2015-05-14:
This should work for up to five transforms being broadcast in a single message, and it can be extended:
https://gist.github.com/ayrton04/662964298a82211a7e28
Comment by littlelordy2 on 2019-01-30:
@Proc贸pio there's a typo in the edited solution. It's 'topic != "tf" or ...' but it should be 'topic != "**/**tf" or ...'

