Q:

setup.bash error on OSX

I just reinstalled Groovy on OSX 10.8.4 using Homebrew. I moved my old ROS directory from /opt/ros to /opt/ros_old so this is a completely new install. Now when I do:
source /opt/ros/groovy/setup.bash

I get the following error:
[kevin@tardis ~]$ source /opt/ros/groovy/setup.bash
-bash: /opt/ros/groovy/etc/catkin/profile.d/05.catkin_make.bash: line 32: syntax error in conditional expression: unexpected token `('
-bash: /opt/ros/groovy/etc/catkin/profile.d/05.catkin_make.bash: line 32: syntax error near `-@(C'
-bash: /opt/ros/groovy/etc/catkin/profile.d/05.catkin_make.bash: line 32: `            if [[ ${words[i]} == -@(C|-directory) ]]; then'
-bash: /opt/ros/groovy/etc/catkin/profile.d/05.catkin_make_isolated.bash: line 30: syntax error in conditional expression: unexpected token `('
-bash: /opt/ros/groovy/etc/catkin/profile.d/05.catkin_make_isolated.bash: line 30: syntax error near `-@(C'
-bash: /opt/ros/groovy/etc/catkin/profile.d/05.catkin_make_isolated.bash: line 30: `            if [[ ${words[i]} == -@(C|-directory) ]]; then'

Any idea what is wrong? Things worked before with Groovy. I am using:
[kevin@tardis ~]$ bash --version
GNU bash, version 3.2.48(1)-release (x86_64-apple-darwin12)
Copyright (C) 2007 Free Software Foundation, Inc.

Originally posted by Kevin on ROS Answers with karma: 2962 on 2013-06-14
Post score: 1

Original comments
Comment by Dirk Thomas on 2013-06-14:
The two environment hooks 05.catkin_make(_isolated).bash have been recently added to catkin to provide auto completion on these two scripts. The issue seems to be specific to OS X or your setup. On Ubuntu it works as expected. Can you try looking what in these files bothers  your version of bash?
Comment by William on 2013-06-14:
I have this version of bash: âˆ« bash --version GNU bash, version 3.2.48(1)-release (x86_64-apple-darwin12) Copyright (C) 2007 Free Software Foundation, Inc.
Comment by William on 2013-06-14:
I can source the setup.bash with no problems, but I cannot use the autocompletion, I get: bash: _init_completion: command not found
Comment by Dirk Thomas on 2013-06-14:
Can you try to replace ${#words[ with ${#COMP_WORDS[ (twice) and ${words[ with ${COMP_WORDS[ (four times) and see if that solves your problem?
Comment by Kevin on 2013-06-14:
Tried that, it didn't help.
Comment by Dirk Thomas on 2013-06-14:
If you could come up with some kind of version check we could make that part of the completion optional. But without being able to reproduce it I can't help much with that.
Comment by Kevin on 2013-06-14:
why don't you just implement the solution below? The issue is really simple and involves expanding the or statement to look at --directory and -C instead of the original compound statement. I am not a bash guru, but I believe my solution is correct.

A:

You can install bash 4.2.45 from Homebrew as @William has done. It appeared to help @Art. I still needed to change both 05.catkin_make.bash (line 32) and 05.catkin_make_isolated.bash (line 30) located in /opt/ros/groovy/etc/catkin/profile.d to if [[ ${words[i]} == --directory || ${words[i]} == -C ]]; then. For some reason my system doesn't like the ${words[i]} == -@(C|-directory) part of the original line.

Originally posted by Kevin with karma: 2962 on 2013-06-14
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Artem on 2013-06-14:
Thanks! It works!
Comment by Dirk Thomas on 2013-06-14:
I applied the splitting of the condition upstream. The above patch still uses the variable "words" which is wrong. Auto completion won't work when having the -C / --directory options on the command line. The full patch looks like: http://goo.gl/lYtVC
Thanks for testing this and providing feedback!
Comment by Kevin on 2013-06-14:
Sorry ... why is words wrong? That is what was originally there? Maybe I have misunderstood something?
Comment by Dirk Thomas on 2013-06-14:
Because it was wrong before already.
Comment by Artem on 2013-06-17:
When these changes will be in the main repository? Every time I build my catkin work space it replaces the corrected 05.catkin_make.bash with the bad one.
Comment by Dirk Thomas on 2013-06-17:
The changes are committed to the source repo. So as a workaround you could just check it out in your workspace. The next release of catkin will likely happen during this week. But it will be at least one or two weeks until it is available in the public repos.

