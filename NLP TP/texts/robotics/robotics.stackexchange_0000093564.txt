Q:

avoid /map topic replacement

I am running ROS Melodic on Ubuntu 18.04.
I have been mapping an environment using Rviz and gmapping  with Gazebo as simulator and saved the map in a folder.
Now I want to load it back, so I run rosrun map_server map_server mymap.yaml, then I launch (in order) Gazebo and Rviz. If I don't launch gmapping, Rviz notifies me with an error, which is understandable, that says "Missing transform between /map and /odom". That is telling me that I didn't provide it (through gmapping, because in this case I haven't launched it).
The problem is that, if I do launch gmapping, the map gets updated with the new laserscan readings and I lose the previously-uploaded map.
How can I do in order to

Have the transform /map -> /odom
Render the map in Rviz correctely
Avoid /map updates through gmapping

Originally posted by davidem on ROS Answers with karma: 83 on 2019-10-15
Post score: 0

A:

Since you already have a map you don't need to use gmapping anymore. Gmapping is used for localization and mapping. You need to use the package AMCL that creates the transform map -> odom, it's only responsible for the localization of the robot.

Originally posted by Delb with karma: 3907 on 2019-10-15
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by davidem on 2019-10-15:
I already know the spawn position of my robot, therefore amcl will just guess where the robot is, without any reason to
Comment by Delb on 2019-10-15:\

amcl will just guess where the robot is

It will not just localize the robot but it will also publish the transform odom -> map that you need. Have you tried it ?
Comment by davidem on 2019-10-15:
I did, but while the transformation ends up correctly mapping the uploaded map in respect with the odometry, the position of the robot isn't mapped even after multiple iterations, resulting in no collisions whatsoever.
Comment by Delb on 2019-10-15:\

the position of the robot isn't mapped even after multiple iterations

Can you elaborate this ? If there is an "offset" when launching amcl whith the initial pose in amcl node and the initial pose of Gazebo then after moving the robot it should be corrected. If you don't move the robot then this offset won't be corrected. Is that what you meant ?
Comment by davidem on 2019-10-15:
Yes, there is an offset between the two positions that won't be corrected even after moving the robot
Comment by Delb on 2019-10-15:
You need to specify the same initial pose to the AMCL node and to the spawn_model node.
But maybe it's something else in the configuration : have you changed some frames/topics names ? If some like scan, odom or map don't have the default value you need to specify it to the AMCL node.
Finally, there are the parameters update_min_d and update_min_a that by default are at the value 0.2 and pi/6 meaning that the position won't be refreshed if the robot haven't moved by more than 20cm or rotated by more than pi/6 rad. So when you said you moved the robot, did you moved it more than those two values (or just one at least) ?
Comment by Delb on 2019-10-15:
Have a look at the wiki to see all the parameters
Comment by davidem on 2019-10-15:
Ok now it works! There's still a little bit of bias between the collision perceptions and the loaded map (some walls get hit slightly before than what's rendered) but I can take it. Thanks!

