Q:

rosbridge CPU usage

I've noticed on two of the development environments that I've been using that rosbridge has a tendency to consume a large amount of the CPU's resources. One dev environment is a VirtualBox VM, and the other is a Linode 512 server, both running Ubuntu 11.04 with ros-electric-brown-remotelab version 0.0.15-s1326515606. In each case establishing a connection to rosbridge through my web browser is enough to produce this behavior. Have others seen this? Are there suggested minimum machine requirements for rosbridge? If this is a common problem, is there anything that I can do to reduce the machine load?

Originally posted by Rodrigo Gutierrez on ROS Answers with karma: 23 on 2012-01-28
Post score: 2

A:

Victor,
Thanks so much for the bug-fix and for cross-posting this to our Google Code issue tracker ( http://code.google.com/p/brown-ros-pkg/issues/detail?id=11 ). I've just incorporated this fix into our SVN version ( svn co https://brown-ros-pkg.googlecode.com/svn/trunk/experimental/rosbridge rosbridge ) and it will be available in the Electric and Diamondback binaries as soon as Willow refreshes their distribution (the packages will be labeled 0.0.19).
What your fix basically does is make the loop sensitive to the HZ parameter. Since the default HZ in your version is so low (200Hz) CPU usage drops dramatically. However, at the moment most of our users are expecting performance to favor throughput. I've thus changed the default HZ to 100000 (equivalent to 100 kHz) coincident with applying your fix. This will mean that if you want to cut down on CPU usage, you'll need to specify your own HZ as the default will do quite a bit of spinning.
One other thing I should mention is that the 100% usage is a bit misleading and you should always try to run rosbridge alongside your planned load. While select operations will dominate a CPU on an "empty" processor according to top, they are still blocking (as called in rosbridge) and present yield opportunities. The end result is that while rosbridge will take 100% of a CPU with no other load, it will not in general effect the performance of other applications very much (if at all). For example, when you run Gazebo (a CPU-bound process) on the same core, rosbridge will only take up ~1% of the proc according to top.
Thanks again for the patch!
_Trevor

Originally posted by tjay with karma: 461 on 2012-02-03
This answer was ACCEPTED on the original site
Post score: 0

