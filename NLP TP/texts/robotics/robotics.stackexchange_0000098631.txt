Q:

LGSVL quits immediately upon starting

jumping from https://gitlab.com/autowarefoundation/autoware.auto/AutowareAuto/-/issues/938
I am trying to start LGSVL with a clean autoware.auto environment
I have installed docker, nvidia-docker2, ade, restarted pc, etc according to the documentation (https://autowarefoundation.gitlab.io/autoware.auto/AutowareAuto/lgsvl.html)
When I start lgsvl simulator inside ade, a window appears then suddenly disappears.
No error message, the program only returns with error code 1.
From the AutowareAuto master/1.0.0 branch I tried the following:
$ ade --rc .aderc-lgsvl start --update  --enter
$ /opt/lgsvl/simulator
The documentations mentions mesa-vulkan-drivers may conflict with lgsvl, but removing the driver does not fix the issue.
sourcing /opt/AutowareAuto/setup.bash does not fix the issue either
Full logs here: https://gitlab.com/-/snippets/2095270

Originally posted by vrichard on ROS Answers with karma: 108 on 2021-03-25
Post score: 2

Original comments
Comment by Josh Whitley on 2021-03-25:
What kind of GPU does your host machine have? What OS/kernel is it running? The one thing I didn't see you mention installing is the Nvidia proprietary graphics driver. Can you run nvidia-smi on your host and post the output?
Comment by vrichard on 2021-03-25:
I have the following setup:

Ubuntu 18.04
kernel 5.4.0-67-generic
nvidia driver 450.102.04
cuda 11.0
gpu is Quadro P4000
nvidia-smi gives this output from host: https://gitlab.com/-/snippets/2095278
result is similar from ade except no Processes are detected

Comment by Josh Whitley on 2021-03-29:
This one may need help from LG. Can you please create a new snippet with the contents of the file .config/unity3d/LG Silicon Valley Lab/LGSVL Simulator/player.log in your adehome folder? This is the log from the simulator and may help with troubleshooting.
Comment by vrichard on 2021-03-29:
https://gitlab.com/-/snippets/2097364
According to the logs it seems it is just the vulkan drivers that dont work
vulkaninfo also give me an error:
WARNING: [Loader Message] Code 0 : loader_icd_scan: Can not find 'ICD' object in ICD JSON file /usr/share/vulkan/icd.d/nvidia_layers.json.  Skipping ICD JSON
/build/vulkan-tools-136mCR/vulkan-tools-1.1.126.0+dfsg1/vulkaninfo/vulkaninfo.h:399: failed with ERROR_INITIALIZATION_FAILED
The first warning line is explained here: https://vulkan.lunarg.com/issue/home?limit=10;q=;mine=false;org=false;khronos=false;lunarg=false;indie=false;status=new,open
Moving the file /usr/share/vulkan/icd.d/nvidia_layers.json away does not fix the issue
As for the ERROR_INITIALIZATION_FAILED error, people usually face this issue when their GPU is too old and cannot support vulkan. According to this page: https://developer.nvidia.com/vulkan-driver#:~:text=Pascal%3A%20TITAN%20Xp%2C%20TITAN%20X,Volta%3A%20TITAN%20V, the Quadro P4000 is supposed to be supported
Comment by vrichard on 2021-03-29:
But after some more digging I realized some people had similar vulkan issues when using X forwarding. Nowadays I am working remotely using chrome-remote-desktop and it seems vulkan does not support such use case: https://askubuntu.com/questions/1231155/vulkan-driver-stops-working-when-running-in-google-remote-desktop
However the comment provides some workaround. I will try it out later

A:

This is a somewhat known issue, especially if your CPU also has integrated graphics. Inside the container, run sudo apt purge mesa-vulkan-drivers and the issue should be resolved. See https://gitlab.com/autowarefoundation/autoware.auto/AutowareAuto/-/issues/1140 for details.

Originally posted by Josh Whitley with karma: 1766 on 2021-05-26
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by kk2105 on 2021-06-08:
Thanks for the answer. Every time I enter inside the ade, I need to uninstall the vulkan-drivers. Is there a better way to remove so that it does not ask me everytime I enter ade?
Comment by Josh Whitley on 2021-06-08:
See https://gitlab.com/autowarefoundation/autoware.auto/AutowareAuto/-/issues/1140 for discussion about this issue.

