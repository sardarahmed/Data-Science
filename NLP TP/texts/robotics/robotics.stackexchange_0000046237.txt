Q:

Hector mapping does not display the map well

Hello
Im using hector mapping and have some small problems. I installed and compile the package. Than tried to load the map. At the beginning was working good, was loading the map from the bag file. Im using only laser and IMU as a sensor package and do not have any encoders ( so I do not have any odometry). After playing a different bag files I have some problems with the map. Actually the laser was not matching correctly the map during playing the bag file. I post a picture of the mapping . So you can see also my setting of the rviz and the launch file as well.
This is the launch file
<launch>
    
    <param name="/use_sim_time" value="true"/>
    <node name="rosplay" pkg="rosbag" type="play" args="/home/bojan/svn/POW/ROS/Fuerte/Data/User1/pow_freek_3_2011-04-01-14-21-48.bag       --clock"/>
    <node pkg="tf" type="static_transform_publisher" name="baselink_laser" args="0 0 0 0 0 0 /base_link /laser 100"/>
    <node pkg="tf" type="static_transform_publisher" name="corner_a" args="0.45 0.3 0 0 0 0 /base_link /corner1 10"/>
    <node pkg="tf" type="static_transform_publisher" name="corner_b" args="0.45 -0.3 0 0 0 0 /base_link /corner2 10"/>
    <node pkg="tf" type="static_transform_publisher" name="corner_c" args="-0.45 -0.3 0 0 0 0 /base_link /corner3 10"/>
    <node pkg="tf" type="static_transform_publisher" name="corner_d" args="-0.45 0.3 0 0 0 0 /base_link /corner4 10"/>

    <node name="hector_mapping" pkg="hector_mapping" type="hector_mapping" output="screen">
        <param name="pub_map_odom_transform" value="true"/>
    <param name="map_frame" value="map"/>
        <param name="base_frame" value="base_link"/>
        <param name="odom_frame" value="base_link"/>
 </node>
<node pkg="rviz" type="rviz" output="screen" name="rviz" args="-d $(find pow_analyzer)/launch/pow_rviz.vcg"/>
</launch>

And this are the shots of the rviz
Here still all ok

And now starting the troubles

Any help?

Originally posted by Astronaut on ROS Answers with karma: 330 on 2012-12-02
Post score: 0

A:

The bag file you are using has "holes" of ~0.5s in it every 10-15s (see the attached rxbag timeline).

It appears the outage with missing data at 45.8s leads to an error of the scanmatcher of hector_mapping. The robot is rotating pretty fast at that time, which makes it hard to recover from this.  It might be possible to fix this error with parameter tuning, but a bagfile without data outages will probably also work better (given that hector_mapping works well in the first 45s of the bagfile, even despite the erroneous bagfile).

Originally posted by Stefan Kohlbrecher with karma: 24361 on 2012-12-03
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by Astronaut on 2012-12-03:
We need it that for hard drive savings. So This bag file should remain as it is. Any help on tuning the parameters?? Which parameters should be tuned??
Comment by Stefan Kohlbrecher on 2012-12-03:
You need outages of 0.5s very 10-15s for hard drive savings? That doesn't make any sense. You can play around with the map resolution, the map resolution levels and the map_update_thresh parameters. In the end a non-broken logfile would make much more sense, though.
Comment by Astronaut on 2012-12-03:
Well the main point is that at the moment I can use the bag file that we have here at the institute. I have to find the way to improve the accuracy of estimated robot pose with the bag file we have. So hector mapping can not deal with this kind of bag files??
Comment by Stefan Kohlbrecher on 2012-12-03:
There are probably ways to work around it, but unfortunately I don't have the time to work on making hector_mapping work with essentially broken bag files. The outages in the bagfile could also present problems to other approaches, but you'd have to try that.
Comment by Astronaut on 2012-12-03:
so basicly have to tune map parameters, right??
Comment by Stefan Kohlbrecher on 2012-12-04:
It might work with parameter tuning, but there's no guarantees. How does the gmapping/laser_scan_matcher option work?
Comment by Astronaut on 2012-12-04:
Your comments about the outages data  in the bag file does not make sense. In your publish paper for hector mapping, it suppose to work fine in rescue robot where the environments is complicated. In this environment is normal to have bag file with outages of  data. So how is to explain that?
Comment by Astronaut on 2012-12-04:
I have to check that. Where to find this option of gmapping/laser_scan_matcher??
Comment by Stefan Kohlbrecher on 2012-12-05:
The laser scanner on our rescue robot provides scan data at 40Hz. This data is processed onboard at 40 Hz. Outages of 0.5 seconds would likely also be fatal there. I'm not sure where the outages in your bagfile come from. Looks like your storage medium couldn't keep up writing data.
Comment by Stefan Kohlbrecher on 2012-12-05:
For gmapping/laser_scan_matcher see here: http://answers.ros.org/question/10909/combining-laser_scan_matcher-with-gmapping/ and be sure to google "gmapping laser_scan_matcher". This should net you quite a few results, mainly here on ROS Answers.
Comment by Astronaut on 2012-12-05:
ok. Will check that, Dont know at the moment how to handle this problem with the outages in the bag file
Comment by Astronaut on 2012-12-05:
So mainly you suggest to fix the problem with the bag file with play around with the map resolution, the map resolution levels and the map_update_thresh. No other option??
Comment by Astronaut on 2012-12-05:
I fixed the problem with the bag file. Have to set the  map_multi_res_levels to value of 4. But what does it means exactly?? How does that parameter impact the accuracy of the localizer. I mean I will get more accurate pose estimation with this better scan matching??

