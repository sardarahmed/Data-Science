Q:

Amcl particlecloud topic not publishing

Hi,
I would like to know why rviz is not showing the particle cloud for any of my robots. Below I have provided my navigation stack launch file and my amcl parameters yaml file. Everything works (e.g. navigating from a to b), except the amcl localization.
Thank you very much.
move_base_decentralised.launch:
<launch>

  <master auto="start"/>
  Run the map server  
    <node name="map_server" pkg="map_server" type="map_server" args="$(find lasmultigazebo4)/maps/my_map.yaml"/>
  <node pkg="lasmulticontrol4" type="fixed_tf_broadcaster.py" name="broadcaster_fixed" />
  
  <group ns="n_1">

   <node pkg="amcl" type="amcl" name="amcl">
    <rosparam file="$(find lasmultigazebo4)/config/amcl_params.yaml" command="load" />
    <remap from="scan" to="/n_1scan"/>
    <param name="odom_frame_id" value="n_1/odom" />
    <param name="global_frame_id" value="map" />
    <param name="base_frame_id" value="n_1base_footprint" />
    <param name="use_map_topic" value="true"/>
   </node>

   <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">
    <param name="base_local_planner" value="dwa_local_planner/DWAPlannerROS" />
    <rosparam file="$(find lasmultigazebo4)/config/robot1config/costmap_common_params.yaml" command="load" ns="global_costmap" /> 
    <rosparam file="$(find lasmultigazebo4)/config/robot1config/costmap_common_params.yaml" command="load" ns="local_costmap" />
    <rosparam file="$(find lasmultigazebo4)/config/robot1config/local_costmap_params.yaml" command="load" />
    <rosparam file="$(find lasmultigazebo4)/config/robot1config/global_costmap_params.yaml" command="load" /> 
    <rosparam file="$(find lasmultigazebo4)/config/robot1config/dwa_local_planner_params.yaml" command="load" />
    <!--<remap from="odom" to="n_1/odom"/>-->
    <remap from="cmd_vel" to="Ug_cmd_vel"/>
   </node>
  </group>
  
  <group ns="n_2">

   <node pkg="amcl" type="amcl" name="amcl">
    <rosparam file="$(find lasmultigazebo4)/config/amcl_params.yaml" command="load" />
    <remap from="scan" to="/n_2scan"/>
    <param name="odom_frame_id" value="n_2/odom" />
    <param name="global_frame_id" value="map" />
    <param name="base_frame_id" value="n_2base_footprint" />
    <param name="use_map_topic" value="true"/>
   </node>

   <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">
    <param name="base_local_planner" value="dwa_local_planner/DWAPlannerROS" />
    <rosparam file="$(find lasmultigazebo4)/config/robot2config/costmap_common_params.yaml" command="load" ns="global_costmap" /> 
    <rosparam file="$(find lasmultigazebo4)/config/robot2config/costmap_common_params.yaml" command="load" ns="local_costmap" />
    <rosparam file="$(find lasmultigazebo4)/config/robot2config/local_costmap_params.yaml" command="load" />
    <rosparam file="$(find lasmultigazebo4)/config/robot2config/global_costmap_params.yaml" command="load" /> 
    <rosparam file="$(find lasmultigazebo4)/config/robot2config/dwa_local_planner_params.yaml" command="load" />
    <!--<remap from="odom" to="n_1/odom"/>-->
    <remap from="cmd_vel" to="Ug_cmd_vel"/>
   </node>
  </group>
  
  <group ns="n_3">

   <node pkg="amcl" type="amcl" name="amcl">
    <rosparam file="$(find lasmultigazebo4)/config/amcl_params.yaml" command="load" />
    <remap from="scan" to="/n_3scan"/>
    <param name="odom_frame_id" value="n_3/odom" />
    <param name="global_frame_id" value="map" />
    <param name="base_frame_id" value="n_3base_footprint" />
    <param name="use_map_topic" value="true"/>
   </node>

   <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">
    <param name="base_local_planner" value="dwa_local_planner/DWAPlannerROS" />
    <rosparam file="$(find lasmultigazebo4)/config/robot3config/costmap_common_params.yaml" command="load" ns="global_costmap" /> 
    <rosparam file="$(find lasmultigazebo4)/config/robot3config/costmap_common_params.yaml" command="load" ns="local_costmap" />
    <rosparam file="$(find lasmultigazebo4)/config/robot3config/local_costmap_params.yaml" command="load" />
    <rosparam file="$(find lasmultigazebo4)/config/robot3config/global_costmap_params.yaml" command="load" /> 
    <rosparam file="$(find lasmultigazebo4)/config/robot3config/dwa_local_planner_params.yaml" command="load" />
    <!--<remap from="odom" to="n_1/odom"/>-->
    <remap from="cmd_vel" to="Ug_cmd_vel"/>
   </node>
  </group>

  <group ns="n_4">

   <node pkg="amcl" type="amcl" name="amcl">
    <rosparam file="$(find lasmultigazebo4)/config/amcl_params.yaml" command="load" />
    <remap from="scan" to="/n_4scan"/>
    <param name="odom_frame_id" value="n_4/odom" />
    <param name="global_frame_id" value="map" />
    <param name="base_frame_id" value="n_4base_footprint" />
    <param name="use_map_topic" value="true"/>
   </node>

   <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">
    <param name="base_local_planner" value="dwa_local_planner/DWAPlannerROS" />
    <rosparam file="$(find lasmultigazebo4)/config/robot4config/costmap_common_params.yaml" command="load" ns="global_costmap" /> 
    <rosparam file="$(find lasmultigazebo4)/config/robot4config/costmap_common_params.yaml" command="load" ns="local_costmap" />
    <rosparam file="$(find lasmultigazebo4)/config/robot4config/local_costmap_params.yaml" command="load" />
    <rosparam file="$(find lasmultigazebo4)/config/robot4config/global_costmap_params.yaml" command="load" /> 
    <rosparam file="$(find lasmultigazebo4)/config/robot4config/dwa_local_planner_params.yaml" command="load" />
    <!--<remap from="odom" to="n_1/odom"/>-->
    <remap from="cmd_vel" to="Ug_cmd_vel"/>
   </node>
  </group>
</launch>

amcl_params.yaml:
odom_model_type: omni
odom_alpha5: 0.2
transform_tolerance: 0.2
gui_publish_rate: 10.0
laser_max_beams: 30
min_particles: 500
max_particles: 5000
kld_err: 0.05
kld_z : 0.99
odom_alpha1: 0.2
odom_alpha2: 0.2
  <!-- translation std dev, m -->
odom_alpha3: 0.8
odom_alpha4: 0.2
laser_z_hit: 0.5
laser_z_short: 0.05
laser_z_max: 0.05
laser_z_rand: 0.5
laser_sigma_hit: 0.2
laser_lambda_short: 0.1
laser_lambda_short: 0.1
laser_model_type: likelihood_field
  <!-- <param name="laser_model_type" value="beam"/> -->
laser_likelihood_max_dist: 2.0
update_min_d: 0.2
update_min_a: 0.5
resample_interval: 1
transform_tolerance: 0.1
recovery_alpha_slow: 0.0
recovery_alpha_fast: 0.0

Originally posted by Pytrik on ROS Answers with karma: 13 on 2020-03-26
Post score: 1

A:

My guess is that AMCL subscribes to (namespace)/map instead of /map. Check rosnode info on your amcl nodes and make sure they subscribe to correct topics.
You can force the amcl nodes to subscribe to the /map topic with:
<remap from="map" to="/map"/>

Originally posted by bob-ROS with karma: 525 on 2020-03-26
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Pytrik on 2020-03-26:
That seems to be the trick. I had some new errors, namely flickering and jittery control behaviour.
I had to remove my 'odom' frame and my odom frame transform to map, since amcl does the transform from map to n_1/odom, n_2/odom, n_3/odom ... n_n/odom on its own.

