Q:

ROSSerial Arduino Arrays

Hi All,
I'm trying to use Rosserial Arduino to process some data from a low cost laser rangefinder. Over the course of a scan I try to add the data to an array of float in arduino:
float snd_distance = getDistance(servo_pos);
distance_array[servo_pos] = snd_distance;

Then I have a function which populates the message:
void populateMessage(float distances[145]){  
 //Set up frame data
  scanData.header.frame_id = "1";
  scanData.header.seq = scanData.header.seq++;
  scanData.header.stamp = nh.now();
  scanData.angle_min = 0.0;
  scanData.angle_max = 2.53072742;
  scanData.angle_increment = 0.0174532925; 
  scanData.range_min = 0;
  scanData.range_max = 40;  
  for(int i = 0; i <= 144; i++){
    scanData.ranges[i] = distances[i];
  }
  pub_scan.publish(&scanData);
  nh.spinOnce();
}

However, there seems to be a problem copying the values of distances over to scanData.ranges. I see no errors during compilation, however execution locks up at that step and I seem unable to get past it. Has anyone seen this before? Many thanks.

Originally posted by aak2166 on ROS Answers with karma: 593 on 2015-02-21
Post score: 1

A:

A few things jump out immediately:
scanData.header.seq = scanData.header.seq++;

Won't do what you expect (http://stackoverflow.com/questions/24853/what-is-the-difference-between-i-and-i)

for(int i = 0; i <= 144; i++){
scanData.ranges[i] = distances[i];   }

You can't just write into an array like this (http://wiki.ros.org/rosserial/Overview/Limitations#Arrays). You either need to allocate the array, and then move the data, or just set the array pointer to the appropriate destination:
scanData.ranges = &distances;

Don't forget to set the size as well:
scanData.ranges_length = 145;

Originally posted by paulbovbel with karma: 4518 on 2015-02-21
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by aak2166 on 2015-02-21:
Thanks for the tips. Didn't realize the ranges_length was a field I could write to looking at the message definition for laser scan. Suppose its implicit to all these arrays?
Comment by paulbovbel on 2015-02-21:
Yep. In roscpp those wouldn't be arrays either, they would be std::vectors. But rosserial API is different than roscpp.

