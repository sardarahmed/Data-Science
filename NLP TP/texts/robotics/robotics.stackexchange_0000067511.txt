Q:

Moveit PlanningSceneInterface addBox not showing in Rviz

My goal is to be able to add and remove object dynamically then do path planning. Even moving objects should be nice but I don't know if it's possible
I want to add box or meshes to my Planning scene to do path planning avoiding some object. The problem is that after adding object to the scene interface I don't have any visual feedback in RViz. Later I would like to spawn this object in gazebo as well to be able to have physics.
This is what I do.
rospy.init_node('scene_test', anonymous=True)

scene = moveit_commander.PlanningSceneInterface()

p = PoseStamped()
p.pose.position.x = 0.
p.pose.position.y = 0.
p.pose.position.z = 0.
scene.add_box("table", p, (1, 1, 1))

rospy.sleep(10)

I don't know how to check the scene because the interface doesn't provide any method to do so, but nothing appear in RViz. I suspect something is missing to notice Rviz a new object is here but I can't find anything related to this issue.
Thank you for reading, any help will be much appreciated

Originally posted by Arowana on ROS Answers with karma: 381 on 2015-05-11
Post score: 4

A:

I finally find out why, the pose header was missing and the node need a sleep before adding box to scene otherwise it will skip it.
scene = moveit_commander.PlanningSceneInterface()
robot = moveit_commander.RobotCommander()

rospy.sleep(2)

p = PoseStamped()
p.header.frame_id = robot.get_planning_frame()
p.pose.position.x = 0.
p.pose.position.y = 0.
p.pose.position.z = 0.
scene.add_box("table", p, (0.5, 1.5, 0.6))

Originally posted by Arowana with karma: 381 on 2015-05-13
This answer was ACCEPTED on the original site
Post score: 11

Original comments
Comment by alexpad on 2016-04-22:
thanks for posting this!
Comment by Markus Eich on 2016-12-12:
Darn. I was struggling one week to solve this issue!!. My objects were simply not added. Is this somewhere in the tutorial? How did you find out about this little hack? Thnx for posting.
Comment by Markus Eich on 2016-12-12:
Only thing missing is: How can I visualise the added scene in RVIZ? The objects are there (I can see the collision when moving the arm) but the scene in rviz is not updated. Any ideas?
Comment by urielo on 2017-01-10:
To visualize the scene in rviz add the PlanningScene display with the 'add' button
Comment by buckley.toby on 2017-05-18:
I don't understand this... so confusing, but ok
Comment by v4hn on 2017-05-19:
The frame has to be specified. Otherwise MoveIt wouldn't know how to interpret the pose w.r.t. the rest of the setup.
The sleep might be necessary to ensure the scene interface is connected to the move_group. As always in ROS, the connection is created in the background.
Comment by v4hn on 2017-05-19:
Currently, we don't export the applyCollisionObject methods of the C++ PlanningSceneInterface to the Python class. This would add the box synchronously to the move_group and does not need the additional sleep.
Patches are welcome.
Comment by boooooosh on 2017-07-24:
That's true, when using applyCollisionObject method in c++, the object appears in the scene immediately, I guess the addCollisionObject method add the object asynchronously so that the RViz is not notified.
Comment by enrico on 2018-08-29:
Hi, as long as you know, is there a function that allows to remove the collision object immediately? Because the planning_scene_interface.removeCollisionObjects(object_ids) function requires at least 0.4/0.5 seconds delay to be effective on Rviz...

