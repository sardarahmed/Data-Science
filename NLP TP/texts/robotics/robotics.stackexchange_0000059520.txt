Q:

converting PointCloud2 to pcl::PointCloud is slow with RGB field

I measured a time to convert sensor_msgs::PointCloud2, pcl::PointCloud and pcl::PCLPointCloud2.
https://github.com/garaemon/pcl_ros_conversion_benchmark
I found that converting from pcl::PCLPointCloud2 to pcl::PointCloud takes a long time when the input data had RGB field.
Is there any way to speed up this conversion?

Originally posted by Ryohei Ueda on ROS Answers with karma: 317 on 2014-05-20
Post score: 1

A:

My best guess is that when transforming from PCL2 to PCL you need to get rid of the RGB field.
If I am not mistaken, the representation in memory of the point cloud for PCL2 is something like:
[X0, Y0, Z0, RGB0, X1, Y1, Z1, RGB1, ... Xn, Yn, Zn, RGBn]

and for PCL is:
[X0, Y0, Z0, X1, Y1, Z1, ... Xn, Yn, Zn]

So the only way to transform from PCL2 to PCL is by iterating over the data on PCL2 and ignoring each 4th component (the RGB component) and this takes time, because you can not do a simple memcpy.
Inside the implementation of fromPCLPointCloud2 between lines 202 and 217 you will see what I mean.

Originally posted by Martin Peris with karma: 5625 on 2014-05-20
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Ryohei Ueda on 2014-05-21:
Thanks! you are correct.
When I use pcl::PointXYZRGBA, the conversion time decreases.

