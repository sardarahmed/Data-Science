Q:

Running rtabmap on bag of rgb and depth images

Hi,
I want to run ros rtabmap on a bag of rgb and depth images, with the following topics:
rostopic  list
/camera/depth/camera_info
/camera/depth/image
/camera/rgb/camera_info
/camera/rgb/image_color

I am using the well known canned bag rgbd_dataset_freiburg1_xyz as a reference example. This bag has the following topics:
rosbag info /mnt/hdd3/avnerm/avner/slam/data/rgbd_dataset_freiburg1_xyz/rgbd_dataset_freiburg1_xyz.bag
...
topics:      /camera/depth/camera_info
             /camera/depth/image      
             /camera/rgb/camera_info  
             /camera/rgb/image_color  
             /cortex_marker_array     
             /imu                     
             /tf                      

In my bag I don't have /imu, /tf topics.
To get the program to flow, I added the following transforms.
I added the transform with 0 values for x,y,z,rot,pitch,yaw (i.e. no effect), except for the yaw argument to align the orientation of 3d points with the image
<node pkg="tf" type="static_transform_publisher" name="openni_rgb_optical_frame_to_world" args="0 0 0 0.0 0 -$(arg pi) /openni_rgb_optical_frame /world 100" />
<node pkg="tf" type="static_transform_publisher" name="world_to_kinect" args="0.0 0.0 0.0 0.0 0.0 0.0 /world /kinect 100" />
<node pkg="tf" type="static_transform_publisher" name="world_to_map" args="0.0 0.0 0.0 0.0 0.0 0.0 /world /map 100" />

If I just play my bag, I can see in rviz the images (rgb, depth) and the 3d points (via /voxel_cloud), but in local frame coordinates.
With these tf nodes the rtabmap runs, but the /rtabmap/mapData shows incorrect - the 3d points are just laid on top of each other without a proper 3d model.
I created a bag rgbd_dataset_freiburg1_xyz_no_tf.bag without the topics: /cortex_marker_array /imu /tf, (and replaced with static transforms)
With this setting, rtabmap creates the mapData incorrectly as well.
So it looks like the launch file that I am using from here requires the topics that were filtered above.
My questions:

Can rtabmap handle a bag with just rgb and depth images?
Is there an example canned bag that only uses rgb and depth images?

Thanks,
Avner

Originally posted by Avner on ROS Answers with karma: 96 on 2019-01-24
Post score: 1

A:

I was able to run ros rtabmap on a bag of rgb and depth images.
The solution was to follow the guidelines in here.
I also had to run static_transform_publisher and produce the following static transformations:

camera_link camera_depth_frame
camera_link camera_rgb_frame
camera_depth_frame camera_depth_optical_frame
camera_rgb_frame camera_rgb_optical_frame
base_link camera_link
base_link base_scan
world map

Originally posted by Avner with karma: 96 on 2019-02-11
This answer was ACCEPTED on the original site
Post score: 1

