Q:

ROS Answers SE migration: c++ api gazebo

Hi, i'm new in Ros.
I want to see a example of a program in c++ where i can see how i can move the joints.
I'm a beginner, so i can't know how I can find thiys information.
Thank you
Angelo

Originally posted by manang on ROS Answers with karma: 1 on 2012-02-28
Post score: 1

A:

You can use the ros libraries and plugins. You add a controller in gazebo which listens to a topic, e.g. gazebo_ros_force. For your case you might want to use gazebo_ros_p3d, to change the position instead of force.
Add a controller to your urdf file like so:
<controller:gazebo_ros_force name="controller_name" plugin="libgazebo_ros_force.so">
  <alwaysOn>true</alwaysOn>
  <updateRate>1000.0</updateRate>
  <topicName>force1</topicName>
  <bodyName>body_name</bodyName>
</controller:gazebo_ros_force>

This is a force controller which listen to the topic /force1.
You then use the roscpp api to publish and subscribe to the gazebo topics. You can find a good guide for creating these publisher and subscribers here.
But you change the example for publishing wrenches and listening to gazebo link states. Like i did with a force controller:
   ros::NodeHandle nh; 
   pub = nh.advertise<geometry_msgs::Wrench>("force1", 5);
   sub = nh.subscribe<gazebo_msgs::LinkStates>("gazebo/link_states", 1000, linkstatesCallback); //ROS gazebo publishes all joint states, you can use these.

I publish forces and i listen to positions and create a feedback loop. It is obviously easier to just change position with a different controller if that is what you are after.
Publishing is easy and goes like this:
 pub.publish(wrench);
 ros::spinOnce();

You can also work around ROS by using the actual gazebo API, however in my opinion the documentation for the older version is limited. I would not recommend this unless you really need direct access to the simulator.
Combine these snippets with the tutorials it should work

Originally posted by Erik_S with karma: 103 on 2012-02-28
This answer was ACCEPTED on the original site
Post score: 3

