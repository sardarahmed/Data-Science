Q:

Errors using Rtabmap and also in running gmapping and Rtabmap simultaneously

I have tried many methods suggested in Kinect + Odometry + 2D laser and changed odom and scan topics that suit my robot specifications. But, I could not get any data neither in RViz nor in Rtab GUI. and my launch file is rtabmap.launch.I am getting this error
    [ WARN] [1535559564.824509798]: /rtabmap/rtabmapviz: Did not receive data since 5 seconds! Make sure the input topics are published ("$ rostopic hz my_topic") and the timestamps in their header are set. If topics are coming from different computers, make sure the clocks of the computers are synchronized ("ntpdate"). If topics are not published at the same rate, you could increase "queue_size" parameter (current=10).
/rtabmap/rtabmapviz subscribed to (approx sync):
   /rtabmap/odom,
   /camera/rgb/image_rect_color,
   /camera/depth_registered/image_raw,
   /camera/rgb/camera_info,
   /rtabmap/odom_info

But when I echoed each topic some data is being published and I am able to get 2D map with this data. But I could not integrate 3D map to this odom and scan data. (odom = IMU and ENCODER data)
I am actually trying to integrate gmapping and RTabmap and found a launch file that suits my requirements. I don't know whether it works. Here is the launch file I am using
<!-- Launch RTAB-map with Kinect2 and RPLidar A2 -->
<launch>
  <include file="$(find self_e)/launch/bringup.launch"/>
  <include file="$(find self_e)/launch/xbox.launch"/>
   <!-- Image resolution of the Kinect to process in rtabmap: sd, qhd, hd -->
   <arg name="resolution" default="qhd" />
   
   <!-- Fixed frame id -->
   <arg name="frame_id" default="base_link"/>  
   
   <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">
    <remap from="scan" to="scan_filtered"/>
        <param name="base_frame" value="/base_footprint" />
        <param name="odom_frame" value="/odom" />
        <param name="map_update_interval" value="5.0"/>
        <param name="maxUrange" value="5.5"/>
        <param name="minRange" value="-0.5"/>
        <param name="sigma" value="0.05"/>
        <param name="kernelSize" value="1"/>
        <param name="lstep" value="0.05"/>
        <param name="astep" value="0.05"/>
        <param name="iterations" value="5"/>
        <param name="lsigma" value="0.075"/>
        <param name="ogain" value="3.0"/>
        <param name="lskip" value="0"/>
        <param name="minimumScore" value="50"/>
        <param name="srr" value="0.1"/>
        <param name="srt" value="0.2"/>
        <param name="str" value="0.1"/>
        <param name="stt" value="0.2"/>
        <param name="linearUpdate" value="0.2"/>
        <param name="angularUpdate" value="0.25"/>
        <param name="temporalUpdate" value="5.0"/>
        <param name="resampleThreshold" value="0.5"/>
        <param name="particles" value="50"/>
        <param name="xmin" value="-30.0"/>
        <param name="ymin" value="-30.0"/>
        <param name="xmax" value="30.0"/>
        <param name="ymax" value="30.0"/>
        <param name="delta" value="0.025"/>
        <param name="llsamplerange" value="0.01"/>
        <param name="llsamplestep" value="0.01"/>
        <param name="lasamplerange" value="0.005"/>
        <param name="lasamplestep" value="0.005"/>
        <param name="transform_publish_period" value="0.1"/>
   </node>
  
   <group ns="rtabmap">    
        <node name="rtabmap" pkg="rtabmap_ros" type="rtabmap" output="screen" args="--delete_db_on_start">
            <param name="subscribe_depth"      type="bool"    value="true"/>
            <param name="frame_id"             type="string"  value="$(arg frame_id)"/>
            <param name="subscribe_scan"       type="bool"    value="true"/>            
            <param name="Grid/DepthDecimation"                    value="2"/> 
            <param name="Grid/RangeMax"                     value="5.0"/> 
            <param name="Grid/CellSize"                    value="0.01"/> 
            <param name="map_cleanup"          type="bool"    value="false"/> 
        <param name="Grid/FromDepth" type="string" value="false"/> 
        <param name="RGBD/ProximityPathMaxNeighbors" type="string" value="10"/>     
    
            <remap from="rgb/image"            to="/camera/rgb/image_rect_color"/>
            <remap from="depth/image"          to="/camera/depth/image_rect"/>
            <remap from="rgb/camera_info"      to="/camera/depth/camera_info"/>
            <remap from="scan"                 to="/scan"/>
            <remap from="odom"                 to="/odom"/>

            <param name="approx_sync" type="bool" value="true"/>
            <param name="Reg/Strategy"       type="string" value="1"/>    <!-- 0=Visual, 1=ICP, 2=Visual+ICP -->
            <param name="Vis/MaxDepth"       type="string" value="8.0"/>  <!-- 3D visual words maximum depth 0=infinity -->
            <param name="Vis/InlierDistance" type="string" value="0.1"/>  <!-- 3D visual words correspondence distance -->
            <!--param name="Optimizer/Slam2D"   type="string" value="true"/-->
            <param name="Reg/Force3DoF"      type="string" value="true"/>
        </node>
   </group>
  
  
   <!-- Visualization in RVIZ -->
   <node pkg="rviz" type="rviz" name="rviz" args="-d $(find self_e)/rviz/2d_3d_slam.rviz"/>
  
   <node pkg="nodelet" type="nodelet" name="points_xyzrgb" args="load rtabmap_ros/point_cloud_xyzrgb standalone_nodelet">
        <remap from="rgb/image"       to="data_odom_sync/image"/>
        <remap from="depth/image"     to="data_odom_sync/depth"/>
        <remap from="rgb/camera_info" to="data_odom_sync/camera_info"/>
        <remap from="cloud"           to="voxel_cloud" />
        <param name="voxel_size"      type="double" value="0.01"/>
   </node>
   
</launch>

but I get this error again
[ WARN] [1535557635.247852489]: /rtabmap/rtabmap: Did not receive data since 5 seconds! Make sure the input topics are published ("$ rostopic hz my_topic") and the timestamps in their header are set. If topics are coming from different computers, make sure the clocks of the computers are synchronized ("ntpdate"). If topics are not published at the same rate, you could increase "queue_size" parameter (current=100).
/rtabmap/rtabmap subscribed to (approx sync):
   /odom,
   /camera/rgb/image_rect_color,
   /camera/depth/image_rect,
   /camera/rgb/camera_info,
   /scan_filtered

and gmapping is working.
i have done rostopic hz /odom /camera/rgb/image_rect_color /camera/depth/image_rect /camera/rgb/camera_info /scan_filtered
and i get
subscribed to [/odom]
subscribed to [/camera/rgb/image_rect_color]
subscribed to [/camera/depth/image_rect]
subscribed to [/camera/rgb/camera_info]
subscribed to [/scan_filtered]
           topic                rate   min_delta   max_delta    std_dev    window
=================================================================================
/odom                          10.0    0.09988     0.1001      6.796e-05   10    
/camera/rgb/image_rect_color   30.06   0.03095     0.03517     0.001068    10    
/camera/rgb/camera_info        30.1    0.03078     0.03476     0.001108    31    
/scan_filtered                 7.25    0.1376      0.1381      0.0001548   31    

I do not know how to overcome the errors and I do not understand what voxel_cloud is here and I am a newbie to RTabmap. Could some one suggest me the right way to do this 2d + 3d integration or integrating 3d map with IMU and ENCODER data of my robot. I am ok if some one suggests me the way to integrate hector_slam and RTabmap.

Originally posted by NAGALLA DEEPAK on ROS Answers with karma: 18 on 2018-08-29
Post score: 0

A:

Having slam_gmapping and rtabmap running at the same time is not very useful and it can potentially break the TF tree as they would publish the same TF (/map->/odom). They are both SLAM approaches, they are not meant to be working together. Choose one or the other.
For rtabmap, in the output of rostopic hz, we cannot see if /camera/depth/image_rect is published. If not, it could be the problem. If it is published, you may increase the queue_size parameter to be able to synchronize the topics with different frame rate.
Another note, if your odometry from IMU+Encoders is not very accurate, it is posible to refine odometry with the scan in rtabmap by setting RGBD/NeighborLinkRefining to true (similarly to Kinect+Odometry+2D laser example).
The voxel_cloud is only used for visualization. It constructs a point cloud from RGB-D images to be visualized in RVIZ.

Originally posted by matlabbe with karma: 6409 on 2018-08-30
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by NAGALLA DEEPAK on 2018-08-30:
I have edited /camera/depth/image_rect to /camera/depth_registered/image_raw and it is being published. I have also changed
<remap from="scan"                 to="/scan_filtered"/>
<remap from="odom"                 to="/odom"/>

and i am getting this error stated in below comment.
Comment by NAGALLA DEEPAK on 2018-08-30:
[FATAL] (2018-08-30 21:09:57.861) util3d_mapping.cpp:810::rayTrace() Condition (end.x >= 0 && end.x < grid.cols) not met! [end.x=236 grid.cols=191]
and the one stated in below comment
Comment by NAGALLA DEEPAK on 2018-08-30:
[rtabmap/rtabmap-27] process has died [pid 4668, exit code -6, cmd /home/user/mapping/devel/lib/rtabmap_ros/rtabmap --delete_db_on_start rgb/image:=/camera/rgb/image_rect_color depth/image:=/camera/depth_registered/image_raw rgb/camera_info:=/camera/rgb/camera_info depth_camera_info_topic:=/camera/d
Comment by NAGALLA DEEPAK on 2018-08-30:
Gmapping is running well which means sacn and odom are being published but rtabmap is dying. This is happening only when I use the above topics else the process is not dying but the same warning as stated in question is coming. waiting for data..........
Comment by matlabbe on 2018-08-30:
This is an issue with the released binaries version when Grid/CellSize is set to 1 cm, that issue is fixed in latest source code (see this issue). Set it back to 5 cm as a workaround if you don't want to rebuild rtabmap from source.
Comment by NAGALLA DEEPAK on 2018-08-31:
Thankyou, I am able to run both gmapping and RTabMap simultaneously now. Have to test how perfect and clear the 3D map is......but could I ask you for more information about what Grid/CellSize is?
Comment by matlabbe on 2018-08-31:
It is the size of the occupancy grid's cells. I think gmapping also uses 5 cm by default. In your gmapping config, you set it to 2.5 cm. (<param name="delta" value="0.025"/>).
Comment by NAGALLA DEEPAK on 2018-10-04:
Oh! thank you so much

