Q:

Unable to visualise point cloud from rosbag file in RViz

I have a .bag file which should contain point cloud and RGBD images. However, I'm unable to visualise them in RViz whilst playing the .bag file. This is what I have done:

Record using rosbag record camera/depth_registered/image_raw camera/depth_registered/camera_info camera/rgb/image_raw camera/rgb/camera_info --limit=120 -O astra

Start roscore

rosparam set use_sim_time true

rosrun tf static_transform_publisher 0 0 0 0 0 0 map dummy_frame 100

rosbag play --clock astra.bag

Start rviz

This is the result I get:

Here's my bag file.
Am I missing anything?

Originally posted by mun on ROS Answers with karma: 32 on 2019-08-28
Post score: 0

A:

I just tested it with you bag file and it works. You just need to change your static publisher to publish to a tf to between map and camera_depth_optical_frame:
rosrun tf static_transform_publisher 0 0 0 0 0 0 map camera_depth_optical_frame 100

Here is the result: 

Originally posted by pavel92 with karma: 1655 on 2019-08-29
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by mun on 2019-08-29:
I'm now trying your suggestion rosrun tf static_transform_publisher 0 0 0 0 0 0 map camera_depth_optical_frame 100 but the point cloud still doesn't show (screenshot) Is your configuration like this?
Comment by pavel92 on 2019-08-29:
you bag is pretty short (7secs) and maybe it fails to load it the first time. Try adding a looping when replaying the bag and check if it picks up the cloud:
rosbag play --clock -l astra.bag

Comment by mun on 2019-08-29:
That's what I thought too and I've tried the -l flag, but still no point cloud. Did you have to make any special setting to get it to show?
Comment by pavel92 on 2019-08-29:
do you get any warnings/errors when you launch your RViz config?
Comment by mun on 2019-08-29:
The only warning I get is [ WARN] [1567081149.663349526]: Messages of type 1 arrived closer (0.031979627) than the lower bound you provided (0.500000000) (will print only once). But I get that when I feed straight from the camera in real-time as well (which works fine).
Comment by pavel92 on 2019-08-29:
yes I get the same. There is something wrong with starting RViz with defined config. Try to disable and enable the plugins one by one. Also re-select the same topics and fixed frame when you load your RViz config. This fixed it for me
Comment by mun on 2019-08-29:
Strange. Do you mind uploading your config somewhere? I've tried reselecting the topics and fixed frame, but still on point cloud. My rviz is a fresh install and I don't have any custom plugin.
Comment by pavel92 on 2019-08-29:
well I am not using any custom plugins but you can still try with my config. If it does not work try re-selecting the fixed_frame, uncheck and check the DepthCloud display and re-select the two topics within it
Comment by mun on 2019-08-29:
Thanks a lot! Your config works fine on mine, even without tf running! In fact, if I have tf running and reselect came_depth_optical_frame, it stops. Is my tf bad? I'm already running it as you suggested earlier.
Comment by mun on 2019-08-29:
I think I know what went wrong. The fixed frame should have been camera_rgb_optical_frame. Do you know why it's camera_rgb_optical_frame and not camera_depth_optical_frame?
Comment by pavel92 on 2019-08-29:
Im glad it helped. You can accept the answer as correct now :) 
Otherwise yes it makes sense, it should work without the static tf as long as the frames are registered in RViz (you have to enter it manualy). The depth cloud probably grabs the frame from the rgb topic (I thought both camera frames are the same).
Comment by mun on 2019-08-29:
Can I ask how you figured out it was camera_rgb_optical_frame? rostopic echo camera/depth_registered/camera_info returns frame_id: "camera_depth_optical_frame" though.
Comment by pavel92 on 2019-08-30:
From this:
The Depth Cloud plugin is the first method to visualize the registered point cloud generated by the Depth and Video data streams. This plugin takes a depth image and an RGB image (both published in the same frame_id) and automatically generates a 3D RGB point cloud.

Your depth and RGB images are published in the camera_rgb_optical_frame frame. I dont know why both of your camera_info topics have different frames (/camera/depth_registered/camera_info  has camera_depth_optical_frame frame and /camera/rgb/camera_info has camera frame). However the Depth Cloud plugin uses only the raw image topics which means it uses the camera_rgb_optical_frame frame.
Comment by pavel92 on 2019-08-30:
Its common for the camera_info and image_raw topics for a specific camera to be in the same frame_id since the frame is representing the camera. The camera_info just provides some meta data for the captured image while the image_raw provides the raw image data but they should still be in the same frame since the frame is representing the camera
Comment by mun on 2019-08-31:
Can I ask how you figured that the depth and RGB images are published in the camera_rgb_optical_frame frame? Like you said, /camera/depth_registered/camera_info gives camera_depth_optical_frame.
Comment by pavel92 on 2019-08-31:
just run rostopic echo /camera/depth_registered/camera_info and you will see that the frame_id is camera_depth_optical_frame
Comment by mun on 2019-09-01:
Yes, I understand that. But I was wondering how you figured "depth and RGB images are published in the camera_rgb_optical_frame frame" like you suggested.
Comment by pavel92 on 2019-09-01:
I didnt at first. I thought all the topics were published in the same frame since they relate to the same camera but then decided to double check by echoing the topics and found out that they differed.
Comment by mun on 2019-09-02:
I see. Thanks!

