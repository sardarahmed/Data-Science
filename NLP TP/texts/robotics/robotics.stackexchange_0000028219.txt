Q:

Why does my robot shake / wobble?

Dear Gazebo community,
I am having a problem with the simulation of a ABB IRB2400 robot in Gazebo. After sending a command to a controller of any link the robot model starts to misbehave.
I took the IRB2400 model from here: https://github.com/culletom/abb_dev/tree/master/abb_irb2400_gazebo
When I use the EffortJointInterface with a controller for every joint the model starts spinning out of control as shown.

Since I wanted to use MoveIt! I changed the EffortJointInterface to PositionJointInterface and the controller to a JointTrajectoryController. Sending a command now makes the model shake a little bit (shown in the following gif). I don't know where this comes from. Is this the fault of the controllers or is the model decription incorrect? Or is this even a problem with gazebo?

Turning the gravity on lets the models shake right from the beginning. I guess that the problem is the controller. Is there a way to manipulate the way the position controller works? If i understood correctly you can't set PID parameters for a position controller. I tried to give PID parameters anyways but that don't seem to have any effect.
I am using Ubuntu 14.04, Gazebo 2.2 and ROS Indigo.
Any ideas or hints are much appreciated.
My Controller YAML:
    # Publish all joint states -----------------------------------
joint_state_controller:
  type: joint_state_controller/JointStateController
  publish_rate: 50  

# Controlls the given joints 
arm_controller:
  type: position_controllers/JointTrajectoryController
  joints:
     - joint_1
     - joint_2
     - joint_3
     - joint_4
     - joint_5
     - joint_6
  constraints:
     goal_time: 0.6
     stopped_velocity_tolerance: 0.05
     joint_1: {trajectory: 0.1, goal: 0.1}
     joint_2: {trajectory: 0.1, goal: 0.1}
     joint_3: {trajectory: 0.1, goal: 0.1}
     joint_4: {trajectory: 0.1, goal: 0.1}
     joint_5: {trajectory: 0.1, goal: 0.1}
     joint_6: {trajectory: 0.1, goal: 0.1}
  gains: # Required because we're controlling an effort interface
     joint_1: {p: 1000,  d: 0, i: 0, i_clamp: 1}
     joint_2: {p: 1000,  d: 0, i: 0, i_clamp: 1}
     joint_3: {p: 1000,  d: 0, i: 0, i_clamp: 1}
     joint_4: {p: 1000,  d: 0, i: 0, i_clamp: 1}
     joint_5: {p: 1000,  d: 0, i: 0, i_clamp: 1}
     joint_6: {p: 1000,  d: 0, i: 0, i_clamp: 1}
  stop_trajectory_duration: 0.5
  state_publish_rate:  25
  action_monitor_rate: 10

The URDF
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from /home/richard/catkin_ws/src/abb_dev/abb_irb2400_gazebo/urdf/irb2400.xacro | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="abb_irb2400" xmlns:xacro="http://www.ros.org/wiki/xacro">
  <!--  <gazebo>
        <static>false</static>
    </gazebo> -->
  <!-- ros_control plugin -->
  <gazebo>
    <plugin filename="libgazebo_ros_control.so" name="gazebo_ros_control">
      <!-- <robotNamespace>/abb_irb2400</robotNamespace> -->
      <robotNamespace>/</robotNamespace>
      <robotSimType>gazebo_ros_control/DefaultRobotHWSim</robotSimType>
    </plugin>
  </gazebo>
  <gazebo reference="base_link">
    <material>Gazebo/Orange</material>
    <turnGravityOff>true</turnGravityOff>
    <!-- org: true -->
  </gazebo>
  <gazebo reference="link_1">
    <material>Gazebo/Orange</material>
    <turnGravityOff>true</turnGravityOff>
    <mu1>0.0</mu1>
    <!-- org: 0.2 -->
    <mu2>0.0</mu2>
    <!-- org: 0.2 -->
  </gazebo>
  <gazebo reference="link_2">
    <material>Gazebo/Orange</material>
    <turnGravityOff>true</turnGravityOff>
    <mu1>0.0</mu1>
    <mu2>0.0</mu2>
  </gazebo>
  <gazebo reference="link_3">
    <material>Gazebo/Orange</material>
    <turnGravityOff>true</turnGravityOff>
    <mu1>0.0</mu1>
    <mu2>0.0</mu2>
  </gazebo>
  <gazebo reference="link_4">
    <material>Gazebo/Orange</material>
    <turnGravityOff>true</turnGravityOff>
    <mu1>0.0</mu1>
    <mu2>0.0</mu2>
  </gazebo>
  <gazebo reference="link_5">
    <material>Gazebo/Orange</material>
    <turnGravityOff>true</turnGravityOff>
    <mu1>0.0</mu1>
    <mu2>0.0</mu2>
  </gazebo>
  <gazebo reference="link_6">
    <material>Gazebo/Orange</material>
    <turnGravityOff>true</turnGravityOff>
    <mu1>0.0</mu1>
    <mu2>0.0</mu2>
  </gazebo>
  <material name="black">
    <color rgba="0.0 0.0 0.0 1.0"/>
  </material>
  <material name="blue">
    <color rgba="0.0 0.0 0.8 1.0"/>
  </material>
  <material name="green">
    <color rgba="0.0 0.8 0.0 1.0"/>
  </material>
  <material name="grey">
    <color rgba="0.2 0.2 0.2 1.0"/>
  </material>
  <material name="orange">
    <color rgba="1.0 0.423529411765 0.0392156862745 1.0"/>
  </material>
  <material name="abb_orange">
    <color rgba="1.0 0.43 0.0 1.0"/>
  </material>
  <material name="yellow">
    <color rgba="0.0 1.0 1.0 1.0"/>
  </material>
  <material name="brown">
    <color rgba="0.870588235294 0.811764705882 0.764705882353 1.0"/>
  </material>
  <material name="red">
    <color rgba="0.8 0.0 0.0 1.0"/>
  </material>
  <material name="white">
    <color rgba="1.0 1.0 1.0 1.0"/>
  </material>
  <!-- link list -->
  <link name="base_link">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/visual/base_link.dae"/>
      </geometry>
      <material name="orange"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/collision/base_link.stl"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="148"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
  </link>
  <link name="link_1">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/visual/link_1.dae"/>
      </geometry>
      <material name="orange"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/collision/link_1.stl"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="127"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
  </link>
  <link name="link_2">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/visual/link_2.dae"/>
      </geometry>
      <material name="orange"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/collision/link_2_whole.stl"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="44.8"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
  </link>
  <link name="link_3">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/visual/link_3.dae"/>
      </geometry>
      <material name="orange"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/collision/link_3.stl"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="41"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
  </link>
  <link name="link_4">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/visual/link_4.dae"/>
      </geometry>
      <material name="orange"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/collision/link_4.stl"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="17.9"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
  </link>
  <link name="link_5">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/visual/link_5.dae"/>
      </geometry>
      <material name="orange"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/collision/link_5.stl"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="1"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
  </link>
  <link name="link_6">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/visual/link_6.dae"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://abb_irb2400_support/meshes/irb2400/collision/link_6.stl"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="0.3"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
  </link>
  <link name="tool0"/>
  <!-- end of link list -->
  <!-- joint list -->
  <joint name="joint_1" type="revolute">
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <parent link="base_link"/>
    <child link="link_1"/>
    <axis xyz="0 0 1"/>
    <limit effort="100" lower="-3.1416" upper="3.1416" velocity="2.618"/>
    <dynamics damping="0.7" friction="0.0"/>
  </joint>
  <joint name="joint_2" type="revolute">
    <origin rpy="0 0 0" xyz="0.1 0 0.615"/>
    <parent link="link_1"/>
    <child link="link_2"/>
    <axis xyz="0 1 0"/>
    <limit effort="100" lower="-1.7453" upper="1.9199" velocity="2.618"/>
    <dynamics damping="0.7" friction="0.0"/>
  </joint>
  <joint name="joint_3" type="revolute">
    <origin rpy="0 0 0" xyz="0 0 0.705"/>
    <parent link="link_2"/>
    <child link="link_3"/>
    <axis xyz="0 1 0"/>
    <limit effort="100" lower="-1.0472" upper="1.1345" velocity="2.618"/>
    <dynamics damping="0.7" friction="0.0"/>
  </joint>
  <joint name="joint_4" type="revolute">
    <origin rpy="0 0 0" xyz="0.258 0 0.135"/>
    <parent link="link_3"/>
    <child link="link_4"/>
    <axis xyz="1 0 0"/>
    <limit effort="100" lower="-3.49" upper="3.49" velocity="6.2832"/>
    <dynamics damping="0.7" friction="0.0"/>
  </joint>
  <joint name="joint_5" type="revolute">
    <origin rpy="0 0 0" xyz="0.497 0 0"/>
    <parent link="link_4"/>
    <child link="link_5"/>
    <axis xyz="0 1 0"/>
    <limit effort="100" lower="-2.0944" upper="2.0944" velocity="6.2832"/>
    <dynamics damping="0.7" friction="0.0"/>
  </joint>
  <joint name="joint_6" type="revolute">
    <origin rpy="0 0 0" xyz="0.085 0 0"/>
    <parent link="link_5"/>
    <child link="link_6"/>
    <axis xyz="1 0 0"/>
    <limit effort="100" lower="-6.9813" upper="6.9813" velocity="7.854"/>
    <dynamics damping="0.7" friction="0.0"/>
    <!-- org: damping 0.7 friction 0.0 -->
  </joint>
  <joint name="joint_6-tool0" type="fixed">
    <parent link="link_6"/>
    <child link="tool0"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
  </joint>
  <!-- end of joint list -->
  <transmission name="tran1">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint_1">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
      <!-- org: EffortJointInterface -->
    </joint>
    <actuator name="motor1">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <!-- org: EffortJointInterface -->
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="tran2">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint_2">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor2">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="tran3">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint_3">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor3">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="tran4">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint_4">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor4">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="tran5">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint_5">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor5">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="tran6">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint_6">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor6">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <!-- Used for fixing robot to Gazebo world -->
  <link name="world"/>
  <joint name="fixed" type="fixed">
    <parent link="world"/>
    <child link="base_link"/>
  </joint>
</robot>

Originally posted by Panda1638 on Gazebo Answers with karma: 13 on 2017-07-12
Post score: 1

A:

Shaking can be caused by bad model parameters (joint constraints, damping, etc), bad physics parameters (large step size for example), bad controllers (high torque values for example), or combinations of the three.
I would recommend narrowing down the possibilities. For example, you can disable controllers an check your model parameters.
I also recommend switching to gazebo 7 or gazebo 8. Gazebo 2.2 is very old, and many issues in Gazebo have been resolved since its release.

Originally posted by nkoenig with karma: 7676 on 2017-07-12
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Panda1638 on 2017-07-13:
Thanks for your answer. Also i came across a solution yesterday. The shaking stopped after lowering the mass of the links to a unrealistic small number (to one). I tried everything else in advance. The way the robot shaked made me think it was unintentional behavior.
Is there a way i can tune the position controllers inside of gazebo so i can work with realistic mass values? I will try the effort controllers now and see if the robot will not be totally messed up.
Comment by dpak.shimpo on 2018-03-23:
Is there any way to do this automatically, it is tiring and frustrating to see this behavior. I am using the braccio arm and trying to tune PID and friction and damping is very frustrating. Can we disable the Physics engine acting on the robot model somehow and get the arm movements to work by rostopic pub or something?
Comment by matthewmarkey on 2020-05-20:
Could this shaking also be a result of joint_states receiving states from multiple places?

