Q:

Problem declaring a service server within a class

Hi everyone,
I am a beginner in c++ especially with classes,
I am trying to declare a service server within a class but it doesn't work, I have already  had the same problem declaring a subscriber within a class, I tried applying the same thing to service server declaration without success.
#include "ros/ros.h"
#include "geometry_msgs/Vector3Stamped.h" //Message type for the torque values
#include "std_msgs/Float32.h"
#include "std_srvs/Empty.h"

class Torque
{
private:
    std_msgs::Float32 totalTorque;
    ros::NodeHandle n;
    ros::Subscriber subscription_torque;
    ros::Publisher publisher_torque;
    ros::ServiceServer service_server_torque;
public:

  void Torque(){
    this->service_server_torque = n.advertiseService("/omniROS/resetTotalTorque",&Torque::resetService,this);
    this->subscription_torque = this->n.subscribe("/omniROS/torque", 100,&Torque::callbackTorque,this);
    this->publisher_torque = this->n.advertise<std_msgs::Float32>("/omniROS/totalTorque", 100);
  }

  void callbackTorque(const geometry_msgs::Vector3Stamped::ConstPtr& torque)
  {
    this->totalTorque.data += std::abs(torque->vector.x);
    this->publisher_torque.publish(this->totalTorque);
  }

  void resetService(std_srvs::Empty::Request &req,std_srvs::Empty::Response &res){
    //This is a service server that will reset the totalTorque, it's a function that takes a void as input and returns a void as an output
    this->totalTorque.data=0.0;
  }
};

int main(int argc, char **argv)
{
  ros::init(argc, argv, "total_torque_node");
  Torque torque;
  // torque.initialisation();
  while (ros::ok())
   {
       ros::spin();
   }
  return 0;
}

And i have the following error :
/home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp: In member function ‘void Torque::initialisation()’:
/home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:17:108: error: no matching function for call to ‘ros::NodeHandle::advertiseService(const char [26], void (Torque::*)(std_srvs::Empty::Request&, std_srvs::Empty::Response&), Torque*)’
     this->service_server_torque = n.advertiseService("/omniROS/resetTotalTorque",&Torque::resetService,this);
                                                                                                            ^
In file included from /opt/ros/kinetic/include/ros/ros.h:45:0,
                 from /home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:1:
/opt/ros/kinetic/include/ros/node_handle.h:879:17: note: candidate: template<class T, class MReq, class MRes> ros::ServiceServer ros::NodeHandle::advertiseService(const string&, bool (T::*)(MReq&, MRes&), T*)
   ServiceServer advertiseService(const std::string& service, bool(T::*srv_func)(MReq &, MRes &), T *obj)
                 ^
/opt/ros/kinetic/include/ros/node_handle.h:879:17: note:   template argument deduction/substitution failed:
/home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:17:108: note:   mismatched types ‘bool’ and ‘void’
     this->service_server_torque = n.advertiseService("/omniROS/resetTotalTorque",&Torque::resetService,this);
                                                                                                            ^
In file included from /opt/ros/kinetic/include/ros/ros.h:45:0,
                 from /home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:1:
/opt/ros/kinetic/include/ros/node_handle.h:924:17: note: candidate: template<class T, class MReq, class MRes> ros::ServiceServer ros::NodeHandle::advertiseService(const string&, bool (T::*)(ros::ServiceEvent<MReq, MRes>&), T*)
   ServiceServer advertiseService(const std::string& service, bool(T::*srv_func)(ServiceEvent<MReq, MRes>&), T *obj)
                 ^
/opt/ros/kinetic/include/ros/node_handle.h:924:17: note:   template argument deduction/substitution failed:
/home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:17:108: note:   mismatched types ‘bool’ and ‘void’
     this->service_server_torque = n.advertiseService("/omniROS/resetTotalTorque",&Torque::resetService,this);
                                                                                                            ^
In file included from /opt/ros/kinetic/include/ros/ros.h:45:0,
                 from /home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:1:
/opt/ros/kinetic/include/ros/node_handle.h:970:17: note: candidate: template<class T, class MReq, class MRes> ros::ServiceServer ros::NodeHandle::advertiseService(const string&, bool (T::*)(MReq&, MRes&), const boost::shared_ptr<X>&)
   ServiceServer advertiseService(const std::string& service, bool(T::*srv_func)(MReq &, MRes &), const boost::shared_ptr<T>& obj)
                 ^
/opt/ros/kinetic/include/ros/node_handle.h:970:17: note:   template argument deduction/substitution failed:
/home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:17:108: note:   mismatched types ‘bool’ and ‘void’
     this->service_server_torque = n.advertiseService("/omniROS/resetTotalTorque",&Torque::resetService,this);
                                                                                                            ^
In file included from /opt/ros/kinetic/include/ros/ros.h:45:0,
                 from /home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:1:
/opt/ros/kinetic/include/ros/node_handle.h:1017:17: note: candidate: template<class T, class MReq, class MRes> ros::ServiceServer ros::NodeHandle::advertiseService(const string&, bool (T::*)(ros::ServiceEvent<MReq, MRes>&), const boost::shared_ptr<X>&)
   ServiceServer advertiseService(const std::string& service, bool(T::*srv_func)(ServiceEvent<MReq, MRes>&), const boost::shared_ptr<T>& obj)
                 ^
/opt/ros/kinetic/include/ros/node_handle.h:1017:17: note:   template argument deduction/substitution failed:
/home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:17:108: note:   mismatched types ‘bool’ and ‘void’
     this->service_server_torque = n.advertiseService("/omniROS/resetTotalTorque",&Torque::resetService,this);
                                                                                                            ^
In file included from /opt/ros/kinetic/include/ros/ros.h:45:0,
                 from /home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:1:
/opt/ros/kinetic/include/ros/node_handle.h:1061:17: note: candidate: template<class MReq, class MRes> ros::ServiceServer ros::NodeHandle::advertiseService(const string&, bool (*)(MReq&, MRes&))
   ServiceServer advertiseService(const std::string& service, bool(*srv_func)(MReq&, MRes&))
                 ^
/opt/ros/kinetic/include/ros/node_handle.h:1061:17: note:   template argument deduction/substitution failed:
/home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:17:108: note:   mismatched types ‘bool (*)(MReq&, MRes&)’ and ‘void (Torque::*)(std_srvs::Empty::Request&, std_srvs::Empty::Response&) {aka void (Torque::*)(std_srvs::EmptyRequest_<std::allocator<void> >&, std_srvs::EmptyResponse_<std::allocator<void> >&)}’
     this->service_server_torque = n.advertiseService("/omniROS/resetTotalTorque",&Torque::resetService,this);
                                                                                                            ^
In file included from /opt/ros/kinetic/include/ros/ros.h:45:0,
                 from /home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:1:
/opt/ros/kinetic/include/ros/node_handle.h:1104:17: note: candidate: template<class MReq, class MRes> ros::ServiceServer ros::NodeHandle::advertiseService(const string&, bool (*)(ros::ServiceEvent<MReq, MRes>&))
   ServiceServer advertiseService(const std::string& service, bool(*srv_func)(ServiceEvent<MReq, MRes>&))
                 ^
/opt/ros/kinetic/include/ros/node_handle.h:1104:17: note:   template argument deduction/substitution failed:
/home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:17:108: note:   mismatched types ‘bool (*)(ros::ServiceEvent<MReq, MRes>&)’ and ‘void (Torque::*)(std_srvs::Empty::Request&, std_srvs::Empty::Response&) {aka void (Torque::*)(std_srvs::EmptyRequest_<std::allocator<void> >&, std_srvs::EmptyResponse_<std::allocator<void> >&)}’
     this->service_server_torque = n.advertiseService("/omniROS/resetTotalTorque",&Torque::resetService,this);
                                                                                                            ^
In file included from /opt/ros/kinetic/include/ros/ros.h:45:0,
                 from /home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:1:
/opt/ros/kinetic/include/ros/node_handle.h:1145:17: note: candidate: template<class MReq, class MRes> ros::ServiceServer ros::NodeHandle::advertiseService(const string&, const boost::function<bool(MReq&, MRes&)>&, const VoidConstPtr&)
   ServiceServer advertiseService(const std::string& service, const boost::function<bool(MReq&, MRes&)>& callback, 
                 ^
/opt/ros/kinetic/include/ros/node_handle.h:1145:17: note:   template argument deduction/substitution failed:
/home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:17:108: note:   mismatched types ‘const boost::function<bool(MReq&, MRes&)>’ and ‘void (Torque::*)(std_srvs::Empty::Request&, std_srvs::Empty::Response&) {aka void (Torque::*)(std_srvs::EmptyRequest_<std::allocator<void> >&, std_srvs::EmptyResponse_<std::allocator<void> >&)}’
     this->service_server_torque = n.advertiseService("/omniROS/resetTotalTorque",&Torque::resetService,this);
                                                                                                            ^
In file included from /opt/ros/kinetic/include/ros/ros.h:45:0,
                 from /home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:1:
/opt/ros/kinetic/include/ros/node_handle.h:1190:17: note: candidate: template<class S> ros::ServiceServer ros::NodeHandle::advertiseService(const string&, const boost::function<bool(S&)>&, const VoidConstPtr&)
   ServiceServer advertiseService(const std::string& service, const boost::function<bool(S&)>& callback, 
                 ^
/opt/ros/kinetic/include/ros/node_handle.h:1190:17: note:   template argument deduction/substitution failed:
/home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:17:108: note:   mismatched types ‘const boost::function<bool(S&)>’ and ‘void (Torque::*)(std_srvs::Empty::Request&, std_srvs::Empty::Response&) {aka void (Torque::*)(std_srvs::EmptyRequest_<std::allocator<void> >&, std_srvs::EmptyResponse_<std::allocator<void> >&)}’
     this->service_server_torque = n.advertiseService("/omniROS/resetTotalTorque",&Torque::resetService,this);
                                                                                                            ^
In file included from /opt/ros/kinetic/include/ros/ros.h:45:0,
                 from /home/user/omniROS/omniROS_ws/src/total_torque/src/totalTorque.cpp:1:
/opt/ros/kinetic/include/ros/node_handle.h:1222:17: note: candidate: ros::ServiceServer ros::NodeHandle::advertiseService(ros::AdvertiseServiceOptions&)
   ServiceServer advertiseService(AdvertiseServiceOptions& ops);
                 ^
/opt/ros/kinetic/include/ros/node_handle.h:1222:17: note:   candidate expects 1 argument, 3 provided
total_torque/CMakeFiles/totalTorque.dir/build.make:62: recipe for target 'total_torque/CMakeFiles/totalTorque.dir/src/totalTorque.cpp.o' failed
make[2]: *** [total_torque/CMakeFiles/totalTorque.dir/src/totalTorque.cpp.o] Error 1
CMakeFiles/Makefile2:2274: recipe for target 'total_torque/CMakeFiles/totalTorque.dir/all' failed
make[1]: *** [total_torque/CMakeFiles/totalTorque.dir/all] Error 2
Makefile:127: recipe for target 'all' failed
make: *** [all] Error 2
Invoking "make -j8 -l8" failed

For the topic subscriber, I have used the pointer to the class function and this, which doesn't work with advertiseService().
Can you tell my what I have done wrong ?
I didn't managed to find this answer online

Originally posted by RobinB on ROS Answers with karma: 23 on 2018-11-11
Post score: 0

Original comments
Comment by gvdhoorn on 2018-11-11:\

Can you tell my what I have done wrong ?

well, you haven't told us what "doesn't work" ..
Comment by RobinB on 2018-11-11:
Sorry I forgot to paste the error message , i just edited it

A:

The callback function  has to be  bool instead  of void.

Originally posted by Dimitar Rakov with karma: 26 on 2018-11-11
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by gvdhoorn on 2018-11-12:
This is indeed the problem.
Comment by RobinB on 2018-11-12:
Indeed, thank you very much, I will pay attention to this for later
Comment by gvdhoorn on 2018-11-12:
@RobinB: please accept the answer by @Dimitar Rakov by clicking the checkmark to the left of his answer.

