Q:

OccupancyGrid not getting published - Python

Hi, so I want to publish an occupancy grid of a map.png file I have.
After running this node, I do rostopic list but it doesn't show me any published map. Can someone tell what am I doing wrong?
#!/usr/bin/env python

import rospy 
import cv2 as cv
from nav_msgs.msg import *
from std_msgs.msg import *

grid = OccupancyGrid()
def load():
    img = cv.imread('map.png', 0)

    for i in range(len(img)):
        img[i] = (img[i] / 255) * 100
    
    grid.data = img
    pub.publish(grid)
    

def main():
    rospy.init_node('loadmap', anonymous = True)
    global pub
    pub = rospy.Publisher('/map', OccupancyGrid, queue_size = 10)
    load()
    rospy.spin
    
if __name__ == '__main__':
    try:
        main()
    except rospy.ROSInterruptException:
        pass

Originally posted by ros-noob on ROS Answers with karma: 7 on 2020-01-01
Post score: 0

A:

It is most likely being published, but only once, and too fast after creating the Publisher. This doesn't leave any time for any potential Subscribers to actually notice it, register, prepare to receive the data and then actually receive it.
If you want to give "late joiners" a chance to receive the message -- and you don't publish periodically, or have messages changing contents often, you could try using a latched Publisher. From wiki/rospy/Overview/Publishers and Subscribers: rospy.Publisher initialization:

There are additional advanced options that allow you to configure the Publisher:

[..]

latch=False

Enable 'latching' on the connection. When a connection is latched, a reference to the last message published is saved and sent to any future subscribers that connect. This is useful for slow-changing or static data like a map. The message is not copied! If you change the message object after publishing, the change message will be sent to future subscribers.

Note how publishing data "like a map" is given as one of the cases in which this could be useful.

Originally posted by gvdhoorn with karma: 86574 on 2020-01-01
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by gvdhoorn on 2020-01-01:
There are quite a few Q&As about publishing too fast, or not "seeing any message" here on this site. To find them, use Google with site:answers.ros.org and your keywords.
Comment by ros-noob on 2020-01-01:
That seems do it! Thanks a lot!

