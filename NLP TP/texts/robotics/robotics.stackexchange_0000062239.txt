Q:

[Navigation stack] A question about move_base

As stated here, the move_base package is going to compute the velocity to publish on /cmd_vel in order to drive the robot to reach the goal (if present).
In the tutorial about Navigation stack there an example on "How to publish Odometry Transform".
But looking at the file the author is going to define some variables for velocity and position:
  12   double x = 0.0;
  13   double y = 0.0;
  14   double th = 0.0;
  15 
  16   double vx = 0.1;
  17   double vy = -0.1;
  18   double vth = 0.1;

integrating them later in a loop:
  30     //compute odometry in a typical way given the velocities of the robot
  31     double dt = (current_time - last_time).toSec();
  32     double delta_x = (vx * cos(th) - vy * sin(th)) * dt;
  33     double delta_y = (vx * sin(th) + vy * cos(th)) * dt;
  34     double delta_th = vth * dt;
  35 
  36     x += delta_x;
  37     y += delta_y;
  38     th += delta_th;

Now, my question is:

are those variable necessary in the file just to give the reader an idea on how to move the robot using odometry? And they MUST be removed when the robot is receiving data over /cmd_vel form the move_base?
Since they are integrating above time in the loop they are going to put wrong cmd_vel information to the robot (in my opinion). Or are they necessary in any case?
What about if the robot is going to be simulated? Since I dn t have any odometry source I should create some data. Are in this case those variables necessary?

Thanks

Originally posted by Andromeda on ROS Answers with karma: 893 on 2014-08-31
Post score: 1

A:

Yes; the vx, vy and vth values in the tutorial are samples, and should be replaced with real encoder data when using a real robot.
Note that the tutorial you linked to is publishing odometry messages, not cmd_vel, and that odometry represents the position feedback from the wheel sensors, not a command to move the robot.

Originally posted by ahendrix with karma: 47576 on 2014-08-31
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Andromeda on 2014-09-01:
Hendrix: if you look at line 69 to 72 it is going to publish velocity as well.
odom.twist.twist.linear....
Comment by ahendrix on 2014-09-01:
No. Those lines are setting the velocity estimate within the Odometry message. It's still part of the Odometry message and published on the odom topic, not cmd_vel
Comment by Andromeda on 2014-09-01:
Ok, but you said: not a command to move the robot.
Reading the tutorial one gets the impression that odometry information is used to updated the new position of the robot, then braodcasted over ROS and then move_base use that informations to calculate /cmd_vel.  Many times uses the word "velocity"
Comment by ahendrix on 2014-09-01:
The Odometry represents the current state of the robot: position and speed. move_base calculates a new  velocity command based on the current speed, position, acceleration limits, obstacles and goal of the robot.

