Q:

About Lifecycle, And how to call `on_deactivate()` in `hardware_interface` of ros2_control by controller_manager CLI or other method?

I have implemented a hardware interface in ros2_control and added code to free my hardware resources in the on_deactivate() method.
When I try to stop the controller with the command ros2 control set_controller_state diffbot_base_controller inactive and try to free the hardware, on_deactivate() doesn't seem to be called.
I can't find console output from deactivate, and the read/write method is still being called. Unlike before, only the value from hw_command_ is 0.
It's very confusing.Maybe I'm confused about the life cycle concept in controller_manager of ros2_control. I was hoping to get some tips or links to relevant materials.

A:

Be aware that hardware components and controllers are different parts of ros2_control. You try to deactivate the controller -> this does not deactivate the hardware component.
Lifecycle of hardware components is not 100% implemented as by now, and there are some issues with the current implementation. Moreover, controller won't be deactivated currently if you deactivate the hardware_component, where the controller claimed the interfaces.
Have a look at this draft example, which should make things more clear.

