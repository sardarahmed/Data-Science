Q:

static transform shrinking and expanding randomly

Video link: https://dl.dropboxusercontent.com/u/3743872/StaticTransformScalingIssueRviz.ogv
Transform /map to /base_footprint is a 2d transform consisting of only position x and y, and orientation z and w. Transform /base_footprint to /asdf is constant and only consists of a shift in z of 1.5. This suggests the transform from /map to /asdf should always have a z component of exactly 1.5, but the transform lookup seems to scale randomly. Also all transforms relative to /base_footprint scale the same amount as shown in the video.
I have also seen this behaviour outside of rviz when calling tf::TransformListener::lookupTransform().
Has anyone else observed this behavior?
What could be causing this, and how can it be fixed?
This recording is Indigo with Gazebo, but I have seen this behavior in Hydro and Indigo, Gazebo and real-time.

Originally posted by kmhallen on ROS Answers with karma: 1416 on 2014-07-23
Post score: 1

A:

The custom Kalman filter node that generated the transform from /map to /base_footprint did not normalize the quaternion representing orientation at each step. The tf library must assume the quaternion is normalized, and propagate the error through the tf tree. Normalizing fixed the issue completely.
The position jitter in this case comes from a noisy position estimate, not multiple publishing.

Originally posted by kmhallen with karma: 1416 on 2014-07-24
This answer was ACCEPTED on the original site
Post score: 1

