Q:

Autoware Localization Failure

I often get a lot of failures with localization. The indicator for localization (circular red Lidar lines) flies around randomly.
This problem can occur at any time whether the vehicle is moving or not. It is more frequent more at the at the start. One thing that I have observed is that it occurs occur more frequently using LGSVL simulator and my one field data than in Gazebo. (I do not use GPS since I am not in Japan).
With Gazebo, the problem is rare and I think I have seen it only occurring  at the start.
I have also read about other people getting this problem like in these links
https://www.youtube.com/watch?v=3mPNijctUG4&t=58s
https://www.youtube.com/watch?v=vd9BwFGIowY
https://discourse.ros.org/t/i-cant-use-the-autoware-to-control-the-lgsvl-simulator/8198/22
Environment
Ubuntu 16.04
ROS Kinetic
Autoware 1.11.0

Originally posted by John272 on ROS Answers with karma: 11 on 2019-06-21
Post score: 0

Original comments
Comment by gvdhoorn on 2019-06-21:\

I have attached a gif showing what happens.

you didn't have sufficient karma for that, so we can't see anything.
I've fixed that, so please (re)attach the gif.
Comment by Geoff on 2019-06-24:
You need to be more specific about what "a lot of failures" means. When do they happen? Is it always at the start? What sort of data are you using? Please review the support guidelines for what information you should provide and update your question.
Comment by John272 on 2019-06-25:
I have already mentioned what a lot of failures means by saying the lidar circular lines flies around randomly as shown in the video links.  I have also updated my question above.
Comment by Geoff on 2019-06-25:
I don't mean what the failure is, I mean that "a lot of failures" tells us nothing about how often they actually occur nor when then occur for you. If possible you should provide a sample that exhibits the problem so that others can debug it rather than just make guesses at the cause.
Comment by John272 on 2019-06-25:
I have already mentioned some of what you are asking above. The failure rate is generally over 70% for LGSVL and field testing.
I have also been trying to attach a gif to explain my position but the site does not attach it. But it is just similar to the video links above. Please open the links above,
Comment by i_robot_flight on 2019-07-01:
You said you are not using GPS, but your GNSS option is enabled for ndt_matching (at least from what I see in your video) Can you try turning it off?
Comment by John272 on 2019-07-05:
The videos are not mine. But is something similar to what  I experienced. I am yet to test the solution provided by Maximus5684 below.

A:

@John272 - AutonomouStuff has made minor modifications to 1.11.0 (basically just adding the deadreckoner feature branch and one unrelated change of our own) to our fork on Gitlab. The deadreckoner feature significantly improved localization for us by using vehicle odometry. You can get our fork of the project at https://gitlab.com/astuff/autoware. The default branch that is pulled should be as/master but verify with git status once you have it cloned. Then, all you should have to do is build with colcon_release add something like this to your launch file:
<include file="$(find deadreckoner)/launch/deadreckoner.launch">
  <arg name="current_twist" default="/vehicle/twist" />
  <arg name="current_odom" default="/vehicle/odom" />
</include>

Make sure your vehicle platform is publishing it's current twist and odom to those two topics and then set the use_odom argument of the ndt_matching.launch file to true (or use the GUI to do the same) and it should improve things greatly! Let me know if this works.

Originally posted by Josh Whitley with karma: 1766 on 2019-06-27
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by John272 on 2019-07-02:
@Maximus5684, Thank you for you response. One more question, How do you get /vehicle/odom data to show up? The topic is published but there is no data. That is, if I enter rostopic echo /vehicle/odom, nothing gets printed
Comment by Josh Whitley on 2019-07-02:
@John272 What type of vehicle are you using and what drive-by-wire system? The Autoware interface node for your drive-by-wire system should publish the /vehicle/odom topic.
Comment by John272 on 2019-07-03:
@Maximus5684, I was testing with LGSVL simulator. Now, I know I have to test with a real car to see the topic. Thank you very much for your answers to my questions.

