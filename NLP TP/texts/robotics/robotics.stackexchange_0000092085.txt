Q:

ros2 run - symbol not found on custom msg

Hi,
I've defined a custom message as described below.
Obstacle.msg:
geometry_msgs/Point32 polygon
float32 size_uncertainty
uint8 obstacle_class

..and the msg and associated publisher that uses it compiles just fine.
When I go to execute the node, the wheels fall off:
$ ros2 run obstacle_publisher obstacle_publisher
    /home/paul/code/eclipse_ws/ROS2/install/obstacle_publisher/lib/obstacle_publisher/obstacle_publisher: symbol lookup error: 
    /home/paul/code/eclipse_ws/ROS2/install/obstacle_msgs/lib/libobstacle_msgs__rosidl_typesupport_fastrtps_cpp.so: 
    undefined symbol: _ZN13geometry_msgs3msg24typesupport_fastrtps_cpp27max_serialized_size_Point32ERbm

I have std_msgs and geometry_msgs set with depend in the package.xml of both the package that creates the message (obstacle_msgs) and the package that uses the message (obstacle_publisher).
Any pointers would be appreciated.
Sincerely, Paul.

Originally posted by AwooOOoo on ROS Answers with karma: 117 on 2019-06-17
Post score: 5

A:

Without seeing the code it is hard to tell for sure.
But my guess is that your obstacle_msgs package does not list the dependencies properly when generating the messages.
When invoking rosidl_generate_interfaces in CMake, the message dependencies need to be specified using the DEPENDENCIES argument.
rosidl_generate_interfaces(${PROJECT_NAME}
  ${my_msg_files}
  ${my_srv_files}
  DEPENDENCIES geometry_msgs my_custom_msgs
)

For example, here is the line used in the sensor_msgs package: https://github.com/ros2/common_interfaces/blob/8fa6936cf0a5fd743e1456a88b2c1450c173e7aa/sensor_msgs/CMakeLists.txt#L54

Originally posted by marguedas with karma: 3606 on 2019-06-17
This answer was ACCEPTED on the original site
Post score: 18

Original comments
Comment by AwooOOoo on 2019-06-18:
Thank you,
That was it =). I'd forgotten to include the msg dependencies.
Sincerely, Paul.
Comment by MH_Ahmed on 2020-03-02:
Thanks to Allah, you saved my day.
Great thanks!
Mohamed
Comment by lokeshtarala on 2021-06-14:
Thank you, it worked I used sensor_msgs to build a custom message adding dependencies worked for me..
rosidl_generate_interfaces(${PROJECT_NAME}
"msg/PixyVector.msg"
DEPENDENCIES sensor_msgs
)
Comment by max11gen on 2021-10-01:
Thanks for this. This is unfortunately not mentioned in https://docs.ros.org/en/foxy/Tutorials/Custom-ROS2-Interfaces.html . Where can I report this?
Comment by mihota on 2022-03-03:
Can't believe they missed this in the tutorial. Anyone know and can point me to how to edit the tutorials?
Comment by RFRIEDM_Trimble on 2022-07-10:
This is still not documented on the humble tutorials. I created an issue here:
https://github.com/ros2/rosidl/issues/687

