Q:

How to read depth_registered image in callback?

Hello,
I am trying to read depth_registered/image_rect image in my callback function as following
cv_bridge::CvImagePtr cv_ptr;
try
{
    cv_ptr     = cv_bridge::toCvCopy(msg, enc::TYPE_32FC1);
    depthImage = cv_ptr->image.clone();
}

I know the image consists of float values in meter. But what I get is really white-black image.
I need to get the depth of a pixel to find 3D position. Can you help me how to read depth or how to find 3d location from pixel directly ?
Thanks.

Originally posted by CHz on ROS Answers with karma: 13 on 2013-08-07
Post score: 1

A:

If you use imshow() then values <= 0 are black and >= 1 white.
Because of this a typical depth image should be black (distance unknown->0) and white (Distance > ca.1m).
To get the 3D position use:
point.y=(y - centerY) / depthFocalLength;
point.x=(x - centerX) / depthFocalLength;
point.z=depthvalue_at(y,x);
where (x,y) are the coordinates from the depth image and the rest should be calibrated.
I think the default parameter for the kinect camera are:
centerX = 319.5,
centerY = 239.5,
depthFocalLength = 525.

Originally posted by MichaelKorn with karma: 1480 on 2013-08-07
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by CHz on 2013-08-07:
Thank you very much ! I have read the image as;
cv_ptr     = cv_bridge::toCvCopy(msg,enc::TYPE_32FC1);
depthImage = cv_ptr->image.clone();
And read the values as float;
depthImage.at(p2D.y, p2D.x) ;
Comment by stfn on 2014-01-01:
Is that working? Usually those depth-images are 16bit unsigned integers (cv_16uc1?), not floating point. The value is the distance in mm.
Comment by CHz on 2014-01-01:
Yes, it is working well.
Comment by MichaelKorn on 2014-03-25:
@stfn: Just /camera/depth/image_raw is uint16
Comment by ROSkinect on 2014-07-17:
can you send me your callback function please ?

