Q:

OpenCV Error: Image step is wrong () in cvInitMatHeader

Hi,
Recently, whenever I enter the command "rosbag record -a" while trying to run vslam, my bumblebee camera will stop working and the following error comes up:
OpenCV Error: Image step is wrong () in cvInitMatHeader, file /tmp/buildd/ros-diamondback-vision-opencv-1.4.2/debian/ros-diamondback-vision-opencv/opt/ros/diamondback/stacks/vision_opencv/opencv2/build/opencv-svn/modules/core/src/array.cpp, line 162
terminate called after throwing an instance of 'cv::Exception'
  what():  /tmp/buildd/ros-diamondback-vision-opencv-1.4.2/debian/ros-diamondback-vision-opencv/opt/ros/diamondback/stacks/vision_opencv/opencv2/build/opencv-svn/modules/core/src/array.cpp:162: error: (-13)  in function cvInitMatHeader

I was wondering if anyone could help me with this. Here are other info that might be needed.
Message in rosbag record window
ccm@robot-Dell-DM051:~/VSLAMDIR/vslam_system/bags$ rosbag record -a
[ INFO] [1306737580.335900373]: Recording to 2011-05-30-14-39-40.bag.
[ INFO] [1306737581.340443662]: Subscribing to /bumblebee2/left/image_rect_color/compressed/parameter_updates
[ INFO] [1306737581.346024663]: Subscribing to /bumblebee2/right/image_rect/theora/parameter_descriptions
[ INFO] [1306737581.349022810]: Subscribing to /bumblebee2/right/image_rect/compressed
[ INFO] [1306737581.351694410]: Subscribing to /bumblebee2/right/image_rect_color/theora
[ INFO] [1306737581.355132437]: Subscribing to /bumblebee2/left/image_mono/theora/parameter_descriptions
[ INFO] [1306737581.357699539]: Subscribing to /bumblebee2/left/image_rect_color/theora/parameter_updates
[ INFO] [1306737581.360281000]: Subscribing to /bumblebee2/right/image_raw/compressed/parameter_descriptions
[ INFO] [1306737581.362835132]: Subscribing to /bumblebee2/right/image_rect_color/compressed/parameter_descriptions
[ INFO] [1306737581.365451070]: Subscribing to /vslam/vo_tracks/image/compressed
[ INFO] [1306737581.372123405]: Subscribing to /bumblebee2/points
[ INFO] [1306737581.375330508]: Subscribing to /bumblebee2/right/image_rect/compressed/parameter_descriptions
[ INFO] [1306737581.384072804]: Subscribing to /bumblebee2/left/image_rect/compressed
[ INFO] [1306737581.387289104]: Subscribing to /bumblebee2/right/image_mono
[ INFO] [1306737581.390304456]: Subscribing to /bumblebee2/left/image_mono/compressed
[ INFO] [1306737581.393146818]: Subscribing to /bumblebee2/right/image_rect/theora/parameter_updates
[ INFO] [1306737581.396144688]: Subscribing to /bumblebee2/left/image_color/theora
[ INFO] [1306737581.399083173]: Subscribing to /bumblebee2/right/image_rect_color/theora/parameter_updates
[ INFO] [1306737581.402292286]: Subscribing to /bumblebee2/right/image_rect/theora
[ INFO] [1306737581.405286759]: Subscribing to /bumblebee2/points2
[ INFO] [1306737581.412194093]: Subscribing to /bumblebee2/left/image_rect_color/theora
[ INFO] [1306737581.420921503]: Subscribing to /vslam/points
[ INFO] [1306737581.425428170]: Subscribing to /bumblebee2/right/image_color/theora/parameter_updates
[ INFO] [1306737581.430461941]: Subscribing to /bumblebee2/left/image_rect
[ INFO] [1306737581.433240906]: Subscribing to /bumblebee2/parameter_descriptions
[ INFO] [1306737581.436205964]: Subscribing to /bumblebee2/right/image_rect
[ INFO] [1306737581.439064088]: Subscribing to /bumblebee2/left/image_raw/theora/parameter_updates
[ INFO] [1306737581.444591341]: Subscribing to /bumblebee2/right/image_raw/compressed/parameter_updates
[ INFO] [1306737581.447676394]: Subscribing to /vslam/vo_tracks/camera_info
[ INFO] [1306737581.450656623]: Subscribing to /wide_stereo/stereo_vslam_node/parameter_descriptions
[ INFO] [1306737581.454267416]: Subscribing to /vslam/vo_tracks/image/theora/parameter_descriptions
[ INFO] [1306737581.457781634]: Subscribing to /bumblebee2/left/image_rect/compressed/parameter_descriptions
[ INFO] [1306737581.460913910]: Subscribing to /vslam/vo_tracks/image
[ INFO] [1306737581.464131789]: Subscribing to /bumblebee2/left/image_mono/compressed/parameter_updates
[ INFO] [1306737581.478871635]: Subscribing to /bumblebee2/right/image_color/compressed/parameter_updates
[ INFO] [1306737581.482000397]: Subscribing to /bumblebee2/left/image_rect_color/theora/parameter_descriptions
[ INFO] [1306737581.485449787]: Subscribing to /bumblebee2/left/image_rect_color/compressed
[ INFO] [1306737581.488316787]: Subscribing to /bumblebee2/right/image_mono/compressed/parameter_descriptions
[ INFO] [1306737581.491363975]: Subscribing to /bumblebee2/right/image_mono/theora/parameter_descriptions
[ INFO] [1306737581.494404492]: Subscribing to /bumblebee2/left/image_mono/theora/parameter_updates
[ INFO] [1306737581.500500337]: Subscribing to /bumblebee2/right/image_rect_color/compressed/parameter_updates
[ INFO] [1306737581.503633810]: Subscribing to /bumblebee2/disparity
[ INFO] [1306737581.508423991]: Subscribing to /vslam/vo_tracks/image/theora/parameter_updates
[ INFO] [1306737581.511663241]: Subscribing to /vslam/vo_tracks/image/compressed/parameter_descriptions
[ INFO] [1306737581.515121556]: Subscribing to /bumblebee2/right/camera_info
[ INFO] [1306737581.517784551]: Subscribing to /bumblebee2/right/image_rect_color
[ INFO] [1306737581.521103561]: Subscribing to /tf
[ INFO] [1306737581.524563134]: Subscribing to /bumblebee2/left/image_raw/theora
[ INFO] [1306737581.554815995]: Subscribing to /bumblebee2/left/image_color/theora/parameter_updates
[ INFO] [1306737581.574205203]: Subscribing to /bumblebee2/left/image_rect_color
[ INFO] [1306737581.580031026]: Subscribing to /bumblebee2/left/image_rect/theora
[ INFO] [1306737581.597063317]: Subscribing to /bumblebee2/stereo_image_proc/parameter_updates
[ INFO] [1306737581.604601801]: Subscribing to /bumblebee2/right/image_mono/compressed/parameter_updates
[ INFO] [1306737581.607889566]: Subscribing to /bumblebee2/left/image_rect/theora/parameter_updates
[ INFO] [1306737581.625009295]: Subscribing to /bumblebee2/right/image_color/theora
[ INFO] [1306737581.635166403]: Subscribing to /vslam/cameras
[ INFO] [1306737581.638119036]: Subscribing to /bumblebee2/right/image_color/theora/parameter_descriptions
[ INFO] [1306737581.641095882]: Subscribing to /wide_stereo/stereo_vslam_node/parameter_updates
[ INFO] [1306737581.645973461]: Subscribing to /bumblebee2/left/image_mono
[ INFO] [1306737581.660372678]: Subscribing to /rosout
[ INFO] [1306737581.664372591]: Subscribing to /bumblebee2/left/image_raw/compressed
[ INFO] [1306737581.668140402]: Subscribing to /bumblebee2/right/image_raw
[ INFO] [1306737581.670818022]: Subscribing to /bumblebee2/stereo_image_proc/parameter_descriptions
[ INFO] [1306737581.674075069]: Subscribing to /bumblebee2/right/image_rect/compressed/parameter_updates
[ INFO] [1306737581.694080622]: Subscribing to /bumblebee2/left/image_mono/theora
[ INFO] [1306737581.697244703]: Subscribing to /bumblebee2/right/image_color/compressed/parameter_descriptions
[ INFO] [1306737581.700569732]: Subscribing to /bumblebee2/left/image_raw/compressed/parameter_updates
[ INFO] [1306737581.704367775]: Subscribing to /bumblebee2/left/image_raw/theora/parameter_descriptions
[ INFO] [1306737581.718989801]: Subscribing to /bumblebee2/right/image_raw/theora/parameter_descriptions
[ INFO] [1306737581.722669899]: Subscribing to /rosout_agg
[ INFO] [1306737581.725647878]: Subscribing to /vslam/pointcloud
[ INFO] [1306737581.728318952]: Subscribing to /bumblebee2/left/image_rect/theora/parameter_descriptions
[ INFO] [1306737581.730993654]: Subscribing to /vslam/vo_tracks/image/compressed/parameter_updates
[ INFO] [1306737581.735017108]: Subscribing to /vo
[ INFO] [1306737581.747074759]: Subscribing to /bumblebee2/left/camera_info
[ INFO] [1306737581.750307263]: Subscribing to /bumblebee2/left/image_mono/compressed/parameter_descriptions
[ INFO] [1306737581.753269905]: Subscribing to /bumblebee2/right/image_mono/theora/parameter_updates
[ INFO] [1306737581.759324818]: Subscribing to /bumblebee2/left/image_color/theora/parameter_descriptions
[ INFO] [1306737581.762590400]: Subscribing to /bumblebee2/right/image_rect_color/theora/parameter_descriptions
[ INFO] [1306737581.770045606]: Subscribing to /bumblebee2/right/image_rect_color/compressed
[ INFO] [1306737581.773984098]: Subscribing to /vslam/vo_tracks/image/theora
[ INFO] [1306737581.777537975]: Subscribing to /bumblebee2/left/image_raw/compressed/parameter_descriptions
[ INFO] [1306737581.780849702]: Subscribing to /bumblebee2/left/image_color
[ INFO] [1306737581.784393651]: Subscribing to /bumblebee2/right/image_raw/theora
[ INFO] [1306737581.787853405]: Subscribing to /bumblebee2/left/image_rect/compressed/parameter_updates
[ INFO] [1306737581.791046816]: Subscribing to /bumblebee2/right/image_raw/compressed
[ INFO] [1306737581.824873176]: Subscribing to /bumblebee2/right/image_mono/theora
[ INFO] [1306737581.851105285]: Subscribing to /bumblebee2/parameter_updates
[ INFO] [1306737581.873566029]: Subscribing to /bumblebee2/right/image_color/compressed
[ INFO] [1306737581.884832665]: Subscribing to /initialpose
[ INFO] [1306737581.901349871]: Subscribing to /bumblebee2/right/image_raw/theora/parameter_updates
[ INFO] [1306737581.918634447]: Subscribing to /bumblebee2/right/image_mono/compressed
[ INFO] [1306737581.946088690]: Subscribing to /bumblebee2/right/image_color
[ INFO] [1306737581.962276569]: Subscribing to /goal
[ INFO] [1306737581.969111029]: Subscribing to /bumblebee2/left/image_color/compressed/parameter_updates
[ INFO] [1306737581.974507417]: Subscribing to /bumblebee2/left/image_rect_color/compressed/parameter_descriptions
[ INFO] [1306737581.977987795]: Subscribing to /bumblebee2/left/image_color/compressed/parameter_descriptions
[ INFO] [1306737581.998317729]: Subscribing to /bumblebee2/left/image_raw
[ INFO] [1306737582.001145320]: Subscribing to /bumblebee2/left/image_color/compressed
^CClosing 2011-05-30-14-39-40.bag.

Usually, the camera crashes right after all the messages in the rosbag record window pops up.
Many thanks

Originally posted by ccm on ROS Answers with karma: 226 on 2011-05-29
Post score: 1

A:

What does the rosbag output have to do with the problem? "rosbag record -a" is not a good idea, it's better to subsribe to the specific topics you need or use rosbag record --node=xxx to subscribe to all topics of node xxx (which needs to be running at that time).
The reason for the error is, that the amount of bytes per pixel is "wrong", i.e. probably incongruent with the amount of pixels and bytes per row. Why that is, is mysterious though. So I suggest to run the node in the debuger (e.g. gdb) and look at the backtrace, where that happens. Then have a look at the relevant code.

Originally posted by Felix Endres with karma: 6468 on 2011-05-30
This answer was ACCEPTED on the original site
Post score: 1

