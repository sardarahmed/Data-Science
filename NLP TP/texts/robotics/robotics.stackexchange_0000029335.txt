Q:

Change static model pose in `PostUpdate`

Hi,
I'm working on a System plugin in Gazebo Garden and I need to move a model in the PostUpdate callback.
I found the SetWorldPoseCmd function, but it requires a not constant Entity Component Manager and it cannot be used.
What is the correct way to set a new position for static objects?
I tried with this, but as expected it does not work:
gz::math::Pose3d newPose(mCalibX,mCalibY,mCalibZ,mCalibRoll,mCalibPitch,mCalibYaw);

gz::sim::EntityComponentManager ecm;
ecm.CopyFrom(_ecm);

mModel.SetWorldPoseCmd(ecm,newPose);

Originally posted by Myzhar on Gazebo Answers with karma: 5 on 2022-11-14
Post score: 0

A:

I think the main problem is that you're trying to set the model's pose form PostUpdate. The PostUpdate callback has a read-only access to the ECM. This is where systems update their internal state, not the state of the ECM. The PreUpdate is where systems are allowed to update the ECM and that's where you should try to set the pose of the model. See https://gazebosim.org/api/sim/7/createsystemplugins.html for more info.
Also, you shouldn't copy the ECM since any modifications you make to the copy will not affect the rest of the systems in the simulation.

Originally posted by azeey with karma: 704 on 2022-11-16
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Myzhar on 2022-11-22:
This is a really interesting note. I could not understand why ecm was read only in PostUpdate, but I was not considering the PreUpdate callback and it's scope. Thank you for pointing it.

