Q:

IMU plugin erratic acceleration measurements

Hi,
I am trying to use the IMU plugin in Gazebo (v2.2.5) but am seeing weird behavior. I am running the IMU without biases or noise, and the acceleration/rate outputs integrate to trajectories I expect, but the measurements are nevertheless erratic: they are constantly switching sign. I publish sinusoidal velocities in gazebo so I know what to expect from the acceleration measurements, but they look like this:
Whole dataset (a_x, a_y, w)
Zoomed in
I don't expect perfectly smooth trajectories but 50m/s^2 accels at times seems too unstable, something must be wrong. If I just look at the gravity vector in rviz it jumps all over the place. I tried to set everything to zero...
<!-- Chassis -->
    <link name="base_link">
        <inertial>
            <mass value="10.0"/>
            <origin xyz="0 0 0.177"/>
            <inertia 
                 ixx="0.3338" ixy="0.0" ixz="0.0"
                 iyy="0.4783" iyz="0.0"
                 izz="0.3338"/>
        </inertial>
        <visual name="base_visual">
            <origin xyz="0 0 0.177" rpy="0 0 0"/>
            <geometry name="pioneer_geom">
                <mesh filename="package://dopebot_description/meshes/chassis.stl"/>
            </geometry>
            <material name="ChassisRed">
                <color rgba="0.851 0.0 0.0 1.0"/>
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0.177" rpy="0 0 0"/>
                <geometry>
                    <mesh filename="package://dopebot_description/meshes/chassis.stl"/>
                </geometry>
        </collision>
    </link> 

<!-- IMU -->
<link name="imu_link">
  <inertial>
    <mass value="0.001"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <inertia ixx="0.0001" ixy="0" ixz="0" iyy="0.0001" iyz="0" izz="0.0001"/>
  </inertial>

  <visual>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <geometry>
      <box size="0.1 0.1 0.1"/>
    </geometry>
  </visual>

  <collision>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <geometry>
      <box size="0.1 0.1 0.1"/>
    </geometry>
  </collision>
</link>

<!-- IMU Joint -->
  <joint name="imu_joint" type="fixed">
    <axis xyz="1 0 0"/> <!-- 0 1 0 -->
    <origin xyz="0 0 0.28"/>
    <parent link="base_link"/>
    <child link="imu_link"/>
  </joint>

      <plugin name="imu_plugin" filename="libhector_gazebo_ros_imu.so">
            <updateRate>1000</updateRate>
            <bodyName>base_link</bodyName>
            <topicName>/imu</topicName>
            <serviceName>/imu/calibrate</serviceName>
            <accelOffset>0.0 0.0 0.0</accelOffset>
            <accelDrift>0.0 0.0 0.0</accelDrift>
            <accelDriftFrequency>0.0 0.0 0.0</accelDriftFrequency>
            <accelGaussianNoise>0.0 0.0 0.0</accelGaussianNoise>
            <rateOffset>0.0 0.0 0.0</rateOffset>
            <rateDrift>0.0 0.0 0.0</rateDrift>
            <rateDriftFrequency>0.0 0.0 0.0</rateDriftFrequency>
            <rateGaussianNoise>0.0 0.0 0.0</rateGaussianNoise>
            <headingOffset>0.0</headingOffset>
            <headingDrift>0.0</headingDrift>
            <headingDriftFrequency>0.0</headingDriftFrequency>
            <headingGaussianNoise>0.0</headingGaussianNoise>
            <rpyOffset>0.0 0.0 0.0</rpyOffset>
            <xyzOffset>0.0 0.0 0.0</xyzOffset>
            <gaussianNoise>0.0</gaussianNoise>
        </plugin>

but the problem remains. Any ideas?
Thank you,
Jacob

Originally posted by Jacob Lambert on ROS Answers with karma: 63 on 2015-09-08
Post score: 2

Original comments
Comment by l0g1x on 2015-09-08:
+1. Noticed the same thing on my end.
Comment by l0g1x on 2015-09-08:
Can you update your question with which gazebo version your running? And would you also mind attaching a code snippet of the link that you attach the imu plugin to, as well as any links/joints related?
Comment by Jacob Lambert on 2015-09-08:
Updated. I guess you had no luck fixing it? I tried finding a model that includes a hector IMU but could not find one. I haven't seen any examples out there, just this guy who seems to have managed to get it to behave
Comment by l0g1x on 2015-09-09:
The jackal simulation model from clearpath uses it.

A:

This could be related to interplay between your model and Gazebo's (real-time) physics engine. Simulating dynamics is difficult and doing so in real-time requires a trade-off of speed vs. fidelity. It might be the case that your model indeed jitters at high frequency. I also often observed high noise in joint velocities (and thus, also accelerations) for complex robot models. You can decrease the physics engine step size and increase iterations from the Gazebo GUI. If things look better after you do so, the underlying simulation is indeed the cause. You then have the choice of either running simulation with these parameters (which will be slow), or trying to modify your model so there is less noise in simulation. The latter can be an art however and involves tweaking masses and inertias (and their relative magnitudes) while trying not to modify it too much.

Originally posted by Stefan Kohlbrecher with karma: 24361 on 2015-09-09
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by Jacob Lambert on 2015-09-09:
I thought it might be something like that but wasn't sure what to do about it. I'll see how much I can mitigate these effects and report back. TY
Comment by l0g1x on 2015-09-09:
This actually makes sense, as another simulation i have uses the skid steer plugin for 4 wheels has no issue with the hector imu plugin, but the model i have issues with is 6 wheels. hector's 6w plugin doesnt work on gz5, so i have to use the skid steer plugin, leaving two wheels free to move. Thx!
Comment by Jacob Lambert on 2015-09-09:
Decreased step size dramatically, increased number of iterations. Gravity vector is well behaved but accelerations in the plane are still crazy. Played around with the model but it didn't seem to help, I'll take a look at how the Jackal does it.

