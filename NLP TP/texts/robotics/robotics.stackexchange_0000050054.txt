Q:

PID position controller in Gazebo

Can someone point me to a simple example of how to use a PID controlled actuator in Gazebo? I found an example here but there is command topic (in rostopic list) I just want to be able to send a joint to a position. Do I need an action server for this?
My urdf (sorry fo the long file, launch file is below).
    <?xml version="1.0"?>

<gazebo>   
     <controller:gazebo_ros_controller_manager name="gazebo_ros_controller_manager" plugin="libgazebo_ros_controller_manager.so">
          <alwaysOn>true</alwaysOn>
          <updateRate>1000.0</updateRate>
          <robotNamespace></robotNamespace>
          <robotParam>robot_description</robotParam>
          <interface:audio name="gazebo_ros_controller_manager_dummy_iface" />
     </controller:gazebo_ros_controller_manager>
</gazebo>

 <robot name="ar_arm">

 <link name="world" />

 <link name="arm_base">
 <inertial>
    <origin xyz="0.000000 0.000000 0.000990" rpy="0.000000 -0.000000 0.000000"/>
    <mass value="101.000000" />
    <inertia ixx="1.110000" ixy="0.000000" ixz="0.000000" iyy="100.110000" iyz="0.000000" izz="1.010000"/>
  </inertial>
  <collision name="arm_base_geom">
    <origin  xyz="0.000000 0.000000 0.050000" rpy="0.000000 -0.000000 0.000000"/>
    <geometry>
      <box size="1.000000 1.000000 0.100000"/>
    </geometry>
  </collision>
  <visual>
    <origin xyz="0.000000 0.000000 0.050000" rpy="0.000000 -0.000000 0.000000"/>
    <geometry>
      <box size="1.000000 1.000000 0.100000"/>
    </geometry>
    <material name="Cyan">
     <color rgba="0 1 1  1.0"/>
    </material>     
  </visual> 
</link>

<link name="arm_cylinder">
 <inertial>
     <origin xyz="0.000000 0.000000 0.600000" rpy="0.000000 -0.000000 0.000000"/>
  <mass value="1.000000" />
  <inertia ixx="0.110000" ixy="0.000000" ixz="0.000000" iyy="100.110000" iyz="0.000000" izz="1.010000"/>
  </inertial>
  <collision name="arm_base_geom_arm_trunk">
    <origin  xyz="0.000000 0.000000 0.600000" rpy="0.000000 -0.000000 0.000000"/>
    <geometry>
      <cylinder radius="0.050000" length="1.00000"/>
    </geometry>
  </collision>
  <visual name="arm_base_geom_arm_trunk_visual" cast_shadows="1">
    <origin xyz="0.000000 0.000000 0.650000" rpy="0.000000 -0.000000 0.000000"/>
    <geometry>
      <cylinder radius="0.050000" length="1.100000"/>
    </geometry>
    <material name="Red">
    <color rgba="255 0 0 1"/>
    </material>
  </visual>
</link>
    
<link name="arm_shoulder_pan">
  <inertial>  
    <mass value="1.100000"/>
    <origin xyz="0.045455 0.000000 0.000000" rpy="0.000000 -0.000000 0.000000"/>
    <inertia ixx="0.011000" ixy="0.000000" ixz="0.000000" iyy="0.022500" iyz="0.000000" izz="0.013500"/>
  </inertial>
 
  <collision name="arm_shoulder_pan_geom_arm_shoulder">
    <origin xyz="0.550000 0.000000 0.050000" rpy="0.000000 -0.000000 0.000000"/>
    <geometry>
      <box size="1.000000 0.050000 0.100000"/>
    </geometry>
  </collision>
  <visual name="arm_shoulder_pan_geom_arm_shoulder_visual" cast_shadows="1">
    <origin xyz="0.550000 0.000000 0.050000" rpy="0.000000 -0.000000 0.000000"/>
    <geometry>
      <box size="1.000000 0.050000 0.100000"/>
    </geometry>
    <material name="Cyan">
     <color rgba="0 1 1  1.0"/>
    </material>
  </visual>
</link>    

<link name="arm_shoulder_pivot">
   <inertial>  
    <mass value="0.100001"/>
    <origin xyz="0.045455 0.000000 0.000000" rpy="0.000000 -0.000000 0.000000"/>
    <inertia ixx="0.011000" ixy="0.000000" ixz="0.000000" iyy="0.022500" iyz="0.000000" izz="0.013500"/>
  </inertial>
<collision name="arm_shoulder_pan_geom">
    <origin pose="0.000000 0.000000 0.050000 0.000000 -0.000000 0.000000"/>
    <geometry>
      <cylinder radius="0.050000" length="0.100000"/>
    </geometry>
  </collision>
  <visual name="arm_shoulder_pan_geom_visual" cast_shadows="1">
    <origin pose="0.050000 0.000000 0.050000" rpy="0.000000 0.000000 0.000000"/>
    <geometry>
      <cylinder radius="0.050000" length="0.200000"/>
    </geometry>
    <material name="Red">
    <color rgba="255 0 0 1"/>
    </material>
  </visual>
</link>

<link name="arm_elbow_pan">
<inertial>
<mass value="1.200000"/>
    <origin xyz="0.087500 0.000000 0.083333" rpy="0.000000 -0.000000 0.000000"/>
    <inertia ixx="0.031000" ixy="0.000000" ixz="-0.005000" iyy="0.072750" iyz="0.000000" izz="0.044750"/>
 </inertial>
<collision name="arm_elbow_pan_geom_arm_elbow">
    <origin  xyz="0.300000 0.000000 0.150000" rpy="0.000000 -0.000000 0.000000"/>
    <geometry>
      <box size="0.500000 0.030000 0.100000"/>
    </geometry>
  </collision>
  <visual name="arm_elbow_pan_geom_arm_elbow_visual" cast_shadows="1">
    <origin  xyz="0.2500000 0.000000 0.000000" rpy="0.000000 0.000000 0.000000"/>
    <geometry>
      <box size="0.500000 0.030000 0.100000"/>
    </geometry>
    <material name="Cyan">
     <color rgba="0 1 1  1.0"/>
     </material>
  </visual>
</link>

<joint name="arm_base_joint" type="fixed">    
  <parent link="world"/>
  <child link="arm_base"/>
  <axis xyz="0.000000 0.000000 1.00000">
    <limit lower="0.000000" upper="0.000000"/>
     <dynamics damping="10.0" friction="10.0"/>
  </axis>
</joint>
 
<joint name="arm_base_cylinder" type="fixed">   
 <parent link="arm_base"/>
  <child link="arm_cylinder"/>
  <axis xyz="0.000000 0.000000 1.000000">
    <limit lower="0.000000" upper="0.000000"/>
     <dynamics damping="10.0" friction="10.0"/>
  </axis>
</joint>
   
<joint name="arm_shoulder_pan_joint" type="continuous">
  <parent link="arm_cylinder"/>
  <child link="arm_shoulder_pan"/>
  <origin xyz="0.000000 0.000000 1.100000"/>
  <axis xyz="0.000000 0.000000 1.000000">
     <dynamics damping="10.0" friction="10.0"/>
  </axis>
</joint>

<joint name="arm_elbow_fix" type="fixed">
  <parent link="arm_shoulder_pan"/>
  <child link="arm_shoulder_pivot"/>
  <origin xyz="1.100000 0.000000 0.100000"/>
  <axis xyz="0.000000 0.000000 1.000000">
     <dynamics damping="10.0" friction="10.0"/>
  </axis>
</joint>

<joint name="arm_elbow_pan_joint" type="continuous">
  <parent link="arm_shoulder_pivot"/>
  <child link="arm_elbow_pan"/>
  <origin xyz="0.00000 0.000000 0.0500000"/>
  <axis xyz="0.000000 0.000000 1.000000">
     <dynamics damping="10.0" friction="10.0"/>
  </axis>
</joint>

 <transmission type="pr2_mechanism_model/SimpleTransmission" name="kinect_trans">
    <actuator name="kinect_motor" />
    <joint name="arm_shoulder_pan_joint" />
    <mechanicalReduction>1.0</mechanicalReduction>
    <motorTorqueConstant>1.0</motorTorqueConstant>
 </transmission>
</robot>

  </model>
</gazebo>

Launch file:
<launch>
<!-- start gazebo with an empty plane -->
<node name="gazebo" pkg="gazebo" type="gazebo" args="$(find ar_joint_controller)/model/empty_throttled.world" respawn="false" output="screen">
</node> 

<!-- start gui -->
<node name="gazebo_gui" pkg="gazebo" type="gui" respawn="false" output="screen"/> 

<!-- spawn model -->
<node name="spawn_arm" pkg="gazebo" type="spawn_model" args="-file $(find ar_joint_controller)/model/single_actuated_joint.urdf -urdf -model single_actuated_joint" respawn="false" output="screen" >
</node> 

<rosparam file="$( find ar_joint_controller)/cfg/conf_file.yaml" command="load" />

<param name="pr2_controller_manager/joint_state_publish_rate" value="100.0" />

<!-- Spawn some controllers stopped/started -->
<node pkg="pr2_controller_manager" type="spawner" args="kinect_controller" name="spawn_dynamix" output="screen"/>

</launch>

Originally posted by davinci on ROS Answers with karma: 2573 on 2013-04-04
Post score: 0

Original comments
Comment by inflo on 2013-04-05:
http://gazebosim.org/wiki/Tutorials/1.3/intermediate/pid_control_joint
Comment by Mehdi. on 2018-11-20:
@inflo deadlink

A:

hello, there is a tutorial that can help you with implementing a pid controller in gazebo
please check out here

Originally posted by cagatay with karma: 1850 on 2013-04-04
This answer was ACCEPTED on the original site
Post score: 3

