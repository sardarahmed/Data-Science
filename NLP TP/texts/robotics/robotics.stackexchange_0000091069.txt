Q:

How to change subscribed topics of depth_image_proc/point_cloud_xyz node?

Hi, how do I change the topic subscriptions of  depth_image_proc's  depth_image_proc/point_cloud_xyz node?
I have made a node which publishes a sensor_msgs/Image topics which is:
/face_detector/depth_image_roi

Through openni_launch, I also have topic camera/depth/camera_info published.
If I understand correctly, the depth_image_proc/point_cloud_xyz node subscribes to the following topics:
depth/camera_info (sensor_msgs/CameraInfo)
depth_registered/image_rect (sensor_msgs/Image)

As such, I think I have the required topics published.
I found this. However, I don't know how to change the topic subscriptions to suit my needs.
Any help would be appreciated!
edit 1:
rosnode info /standalone_nodelet:
    Node [/standalone_nodelet]
    Publications: 
     * /point_cloud/points [sensor_msgs/PointCloud2]
     * /rosout [rosgraph_msgs/Log]
     * /standalone_nodelet/bond [bond/Status]
    
    Subscriptions: 
     * /camera/rgb/camera_info [sensor_msgs/CameraInfo]
     * /face_detector/depth_image_roi [sensor_msgs/Image]
     * /face_detector/rgb_image_roi [sensor_msgs/Image]
     * /standalone_nodelet/bond [bond/Status]
    
    Services: 
     * /standalone_nodelet/get_loggers
     * /standalone_nodelet/list
     * /standalone_nodelet/load_nodelet
     * /standalone_nodelet/set_logger_level
     * /standalone_nodelet/unload_nodelet
    
[....]

depth_image_proc/point_cloud_xyz launch file:
<!-- Convert the depth image and the rgb image into a xyzrgb Point Cloud -->
<launch>
    <!-- Nodelet manager for this pipeline -->
    <node pkg="nodelet" type="nodelet" args="manager" name="standalone_nodelet" output="screen"/>

    <!-- Convert to point cloud -->
    <node pkg="nodelet" type="nodelet" name="depth_image_proc" args="load depth_image_proc/point_cloud_xyzrgb standalone_nodelet" output="screen">

        <!-- Input: Camera calibration and metadata.  (sensor_msgs/CameraInfo) -->
        <remap from="rgb/camera_info" to="/camera/rgb/camera_info"/>

        <!-- Input: Rectified color image. (sensor_msgs/Image) -->
        <remap from="rgb/image_rect_color" to="/face_detector/rgb_image_roi"/>
        
        <!-- Input: Rectified depth image, registered to the RGB camera. (sensor_msgs/Image) -->
        <remap from="depth_registered/image_rect" to="/face_detector/depth_image_roi"/>
        
        <!-- Output: XYZ point cloud. If using PCL, subscribe as PointCloud<PointXYZ>.  (sensor_msgs/PointCloud2)  -->
        <remap from="depth_registered/points" to="/point_cloud/points"/>

    </node>
</launch>

Also based on depth_image_proc's lazy subscribing behavior, my face_detector node subscribes to output /point_cloud/points.
Without subscribing to the output, the depth_image_proc/point_cloud_xyz node will not subscribe to the required topics stated above.

Originally posted by ZeroSan on ROS Answers with karma: 55 on 2019-03-23
Post score: 1

Original comments
Comment by Jasmin on 2019-03-23:
Do you mean that the depth_image_proc/point_cloud_xyzrgb  node is subscribed to the topics mentioned above but receiving nothing?
Comment by ZeroSan on 2019-03-23:
Sorry, I edited the question. I meant depth_image_proc/point_cloud_xyz node. By default, I think that node subscribes to default topic names of depth/camera_info and depth_registered/image_rect which is not publishing anything since those topic names does not exist. Is there any way to change those default subscribed topics to camera/depth/camera_info and /face_detectoe/depth_image_roi ?

A:

Hello ZeroSan,
your question is actually relating to a concept called remapping.
What you want to do is to remap depth_image_proc/point_cloud_xyz topics to your topics.
You can do it in two ways...
First, remap it directly by doing the following:
rosrun depth_image_proc point_cloud_xyz camera_info:=camera/depth/camera_info image_rect:=/face_detectoe/depth_image_roi

Second, you could write a launch file in which you can use remap tag.
<node pkg="depth_image_proc" type="point_cloud_xyz" name="point_cloud_xyz">
    <remap from="camera_info" to="camera/depth/camera_info"/>
    <remap from="image_rect" to="/face_detectoe/depth_image_roi"/>
</node>

You can read more about remapping here and here.
If you have any further questions, feel free to ask. :)

Originally posted by dljubic with karma: 516 on 2019-03-23
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by ZeroSan on 2019-03-24:
Hi dljubic. Thanks for the reply! I will look into this tomorrow when I get back to the lab.
Comment by ZeroSan on 2019-03-26:
I managed to get the topic subscriptions correct. However, there was no pointcloud2 messages displayed after doing rostopic echo. Should I make a new question?
Comment by dljubic on 2019-03-26:
Let's try a few more things before that... Could you provide the output of rosnode info for your point_cloud_xyz node?
Comment by ZeroSan on 2019-03-26:
Sure thing. I have edited the question and also included my launch file.
Comment by dljubic on 2019-03-27:
I have copied your launch file, modified topic names to mine and everything worked well.
How do you get your images? Do you play a .bag file or do you capture live images?
Comment by ZeroSan on 2019-03-27:
I'm using live images. I managed to convert depth image to pointcloud after digging around though. (Not using point_cloud_xyz node)
Comment by dljubic on 2019-03-28:
I'm glad to hear that. :)
Comment by sacco22 on 2019-09-16:
Dljubic - I am attempting something very similar to ZeroSan. I am doing some post-processing on the sensor_msgs/Image through a python node and would like to see the result of the point cloud using the depth_image_proc nodelet. I believe that the remapping is done correctly however I am getting an out-of-sync warning in the terminal and no output at the pointcloud_output topic.
Did you ever encounter this behaviour? If the nodelet cannot be used due to synchronisation issues I'd like to hear how ZeroSan generated the pointcloud from the depth image without using the nodelet.
Apologies if this comment is out of place (new to the forum).
Comment by dljubic on 2019-09-18:
@sacco22 It would be very helpful if you post the exact warning output. I don't believe that synchronization is the problem here since the nodelet is subscribed to only one topic - depth image.
Also, a copy-paste of your remapping command would help as well as the topics you are working with.
Thanks!
Comment by sacco22 on 2019-09-19:
Hi Dljubic - Kindly find this link with more information [https://drive.google.com/drive/folders/1HRR5xeMV9G0j55qRjOND4EfYCekE72iC?usp=sharing]

The diagram gives a brief overview of the system

The buffer image is showing an RVIZ visualization with the two Images (raw & buffered) and the raw point-cloud which I am trying to "de-noise". From the buffered image, it can be seen that the "wavy" noise is slightly diminished. My main intention now is to visualize the result in 3D using depth_image_proc nodelet.

Types image is indicating that the raw and buffered 2D image are of the same type

Remapping_working image is showing how the depth_image_proc is being called from the launch file

Remapping_notworking image is showing the remapping code when the point-cloud is not visualized and when I echo the topic there is no information

When I replicate the scenario I do not always obtain the out-of-sync warning - not sure how I can fix this and obtain the 3D format.
Comment by sacco22 on 2019-09-19:
UPDATE:
As you said Dljubic is was not a sync problem. It was because the newly created topic did not have header information and hence the nodelet couldn't process it.
THANKS!
Comment by dljubic on 2019-09-19:
@sacco22 I am happy that you have managed to solve the problem! Best of luck in future usage of ROS!

