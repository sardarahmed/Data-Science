Q:

Command Line mapstitch issue

Hi,
I am attempting to merge already created and saved maps of two rooms of my lab and getting below error although the two rooms are connected through door passage as is evident from the pgm files of rooms attached herewith.
c8ae7f36-1871-11e3-9ee8-efc69eb7ec00.png
e4b01bea-1871-11e3-8097-4cce4b2fd663.png
turtlebot@ubuntu:~/fuerte_workspace/sandbox/mapstitch$ bin/mapstitch -o testmerge.pgm -d 1.0 robo_lab2.pgm robo_lab2p2.pgm
OpenCV Error: Bad flag (parameter or structure field) (Unrecognized or unsupported array type) in cvGetMat, file /tmp/buildd/ros-fuerte-opencv2-2.4.2-1precise-20130312-1306/modules/core/src/array.cpp, line 2482
terminate called after throwing an instance of 'cv::Exception'
what(): /tmp/buildd/ros-fuerte-opencv2-2.4.2-1precise-20130312-1306/modules/core/src/array.cpp:2482: error: (-206) Unrecognized or unsupported array type in function cvGetMat

Aborted (core dumped)
I followed few ways as discussed in stackoverflow related to this OpenCV error which could be datatype mismatch or differences in Opencv C or C++ API's but didn't work.
Could anyone please let me know what could be the issue and reason for this error ?

Originally posted by Devasena Inupakutika on ROS Answers with karma: 320 on 2013-09-08
Post score: 0

Original comments
Comment by Jose Luis on 2014-06-27:
If you consider that the proposed solution is the correct one, you should mark the answer as correct to close the question. Thanks.
Comment by Devasena Inupakutika on 2014-06-27:
Done! Thanks!

A:

Hi Devasena,
I have the same problem. I am attempting to combine two maps, but always I get the same response:
"Segmentation fault (core dumped)"
I have tried with .pgm and .png maps with different weights but the result is the same.
The commands that I have tried are:
bin/mapstitch -o map_result.pgm map_part1.pgm map_part2.pgm
bin/mapstitch -o map_result.pgm -d 1.0 map_part1.pgm map_part2.pgm
bin/mapstitch -o map_result.pgm map_part1.png map_part2.png
bin/mapstitch -o map_result.png map_part1.png map_part2.png [with different map sizes]
....
Have you obtained some good result?

I have found the solution.
The correct command to run the mapstitch (offline) is:
bin/mapstitch -o mapResult.pgm -d 3 map_1.pgm map_2.pgm
In this case, i want to merge map_1.pgm with map_2.pgm, and save the merged map in mapReult.pgm. The target distance to match the detected points is 3. You can choose your own distance for your needs.
If the desired distance is small for the current images, sometimes the program returns a Core Dumped error. This is not debugged in the code source.
I have added the corrections to manage the error in the source in GitHub.
If you want to see how the program has matched both images (see the features points in the images), you need to add -v (verbose) before the  -o.
I hope that this help to the users.

Originally posted by Jose Luis with karma: 375 on 2014-05-26
This answer was ACCEPTED on the original site
Post score: 3

Original comments
Comment by bvbdort on 2014-08-15:
It didnt work for me,  Input pgm's size is 2048 x 2048. and i am getting Segmentation fault. And it is working fine if both image are same or without any rotation.

