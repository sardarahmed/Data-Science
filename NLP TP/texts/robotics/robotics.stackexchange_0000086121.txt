Q:

converting DisparityImage message to PointCloud2

Hi,
I want to convert a DisparityImage message to a PointCloud2 messages such that each pixel disparity value is now a x, y, z value of a point in space. The other information that comes as part of the DisparityImage message are the focal length, max disparity and baseline. I know how to calculate the z value using them but I'm not sure what the equation is for x and y?
I was looking at this opencv function reprojectImageTo3D() but that needs the Q perspective transformation matrix. How should I calculate that?
Thank you

Originally posted by 2ROS0 on ROS Answers with karma: 1133 on 2018-03-23
Post score: 0

A:

Take a look at the stereo_image_proc/point_cloud2 nodelet. That should do what you want.

Originally posted by Thomas D with karma: 4347 on 2018-03-23
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by 2ROS0 on 2018-03-23:
Yeah but I would rather just construct the Q matrix myself and make the opencv call. I guess what I'm asking is, does the DisparityImage message have enough information to make the Q matrix? I found the equations here but don't have required fields...
Comment by 2ROS0 on 2018-03-23:
http://answers.opencv.org/question/4379/from-3d-point-cloud-to-disparity-map/
Comment by 2ROS0 on 2018-03-23:
Probably not... The page you linked says "Combines a rectified color image and disparity image to produce a point cloud" so maybe the image_rect has the remainder of the information, that's a bummer. I would've thought the disparity message should come with all required values.
Comment by Thomas D on 2018-03-23:
Most of the remaining information should come from the camera_info topics.

