Q:

Compiler Segmantion fault durint ROS installation on OSX Lion

Hi all,
I know that Osx is only "experimental" supported and that Lion is really new.
Despite that, I'm trying to install ROS on my machine.
I'm following the guide on this page but I had a segmentation fault error.
The output is the following:
Bootstrapping ROS build
Detected ros_comm bootstrapping it too.
[ rosmake ] Packages requested are: ['ros', 'ros_comm']                                                                                         
[ rosmake ] Logging to directory/Users/luca/.ros/rosmake/rosmake_output-20110722-113953                                                         
[ rosmake ] Expanded args ['ros', 'ros_comm'] to:
['rosunit', 'rospack', 'rosmake', 'rosemacs', 'rosdep', 'roscreate', 'rosclean', 'rosboost_cfg', 'rosbash', 'test_rospack', 'test_rosmake', 'test_roslib', 'test_rosdep', 'test_roscreate', 'roslib', 'roslang', 'rosbuild', 'mk', 'xmlrpcpp', 'roswtf', 'rostime', 'message_filters', 'cpp_common', 'topic_tools', 'rostopic', 'rostest', 'rosservice', 'rosrecord', 'rosparam', 'rosout', 'rosnode', 'rosmsg', 'rosmaster', 'roslaunch', 'rosgraph', 'rosconsole', 'rosbagmigration', 'rosbag', 'test_topic_tools', 'test_roswtf', 'test_rostopic', 'test_rostime', 'test_rostest', 'test_rosservice', 'test_rospy', 'test_rosparam', 'test_rosnode', 'test_rosmsg', 'test_rosmaster', 'test_roslib_comm', 'test_roslaunch', 'test_rosgraph', 'test_roscpp_serialization_perf', 'test_roscpp_serialization', 'test_roscpp', 'test_rosbag', 'test_ros', 'test_crosspackage', 'perf_roscpp', 'roscore_migration_rules', 'std_srvs', 'std_msgs', 'rosgraph_msgs', 'rospy', 'roslisp', 'roscpp_traits', 'roscpp_serialization', 'roscpp']
[ rosmake ] Generating Install Script using rosdep then executing. This may take a minute, you will be prompted for permissions. . .            
rosdep executing this script:
{{{
set -o errexit
#No packages to install
}}}
[ rosmake ] rosdep successfully installed all system dependencies                                                                               
[ rosmake ] Starting >>> tools/rospack                                                                                                          
[ rosmake ] Finished <<< tools/rospack                                                                                                          
[rosmake-0] Starting >>> roslib [ make ]                                                                                                        
[rosmake-1] Starting >>> rosemacs [ make ]                                                                                                      
[rosmake-1] Finished <<< rosemacs  No Makefile in package rosemacs                                                                              
[rosmake-1] Starting >>> rosboost_cfg [ make ]                                                                                                  
[rosmake-1] Finished <<< rosboost_cfg  No Makefile in package rosboost_cfg                                                                      
[rosmake-1] Starting >>> rosbash [ make ]                                                                                                       
[rosmake-1] Finished <<< rosbash  No Makefile in package rosbash                                                                                
[rosmake-1] Starting >>> rosbuild [ make ]                                                                                                      
[rosmake-1] Finished <<< rosbuild  No Makefile in package rosbuild                                                                              
[rosmake-1] Starting >>> roslang [ make ]                                                                                                       
[rosmake-1] Finished <<< roslang  No Makefile in package roslang                                                                                
[rosmake-1] Starting >>> mk [ make ]                                                                                                            
[rosmake-1] Finished <<< mk  No Makefile in package mk                                                                                          
[rosmake-1] Starting >>> xmlrpcpp [ make ]                                                                                                      
[rosmake-0] Finished <<< roslib [PASS] [ 13.94 seconds ]                                                                                        
[rosmake-0] Starting >>> rosunit [ make ]                                                                                                       
[rosmake-1] Finished <<< xmlrpcpp [PASS] [ 14.36 seconds ]                                                                                      
[rosmake-1] Starting >>> rosdep [ make ]                                                                                                        
[rosmake-1] Finished <<< rosdep  No Makefile in package rosdep                                                                                  
[rosmake-1] Starting >>> rosmake [ make ]                                                                                                       
[rosmake-0] Finished <<< rosunit [PASS] [ 1.69 seconds ]                                                                                        
[rosmake-0] Starting >>> roscreate [ make ]                                                                                                     
[rosmake-1] Finished <<< rosmake [PASS] [ 1.60 seconds ]                                                                                        
[rosmake-1] Starting >>> rosclean [ make ]                                                                                                      
[rosmake-0] Finished <<< roscreate [PASS] [ 2.01 seconds ]                                                                                      
[rosmake-0] Starting >>> test_rospack [ make ]                                                                                                  
[rosmake-1] Finished <<< rosclean [PASS] [ 1.93 seconds ]                                                                                       
[rosmake-1] Starting >>> test_rosmake [ make ]                                                                                                  
[rosmake-1] Finished <<< test_rosmake [PASS] [ 2.82 seconds ]                                                                                   
[rosmake-1] Starting >>> test_roslib [ make ]                                                                                                   
[rosmake-0] Finished <<< test_rospack [PASS] [ 4.15 seconds ]                                                                                   
[rosmake-0] Starting >>> test_rosdep [ make ]                                                                                                   
[rosmake-0] Finished <<< test_rosdep [PASS] [ 2.62 seconds ]                                                                                    
[rosmake-0] Starting >>> test_roscreate [ make ]                                                                                                
[rosmake-0] Finished <<< test_roscreate [PASS] [ 1.79 seconds ]                                                                                 
[rosmake-0] Starting >>> std_msgs [ make ]                                                                                                      
[rosmake-1] Finished <<< test_roslib [PASS] [ 7.34 seconds ]                                                                                    
[rosmake-1] Starting >>> rosgraph [ make ]                                                                                                      
[rosmake-1] Finished <<< rosgraph [PASS] [ 1.97 seconds ]                                                                                       
[rosmake-1] Starting >>> rosmaster [ make ]                                                                                                     
[rosmake-1] Finished <<< rosmaster [PASS] [ 1.57 seconds ]                                                                                      
[rosmake-1] Starting >>> cpp_common [ make ]                                                                                                    
[rosmake-1] Finished <<< cpp_common [PASS] [ 1.66 seconds ]                                                                                     
[rosmake-1] Starting >>> roscpp_traits [ make ]                                                                                                 
[rosmake-1] Finished <<< roscpp_traits [PASS] [ 1.42 seconds ]                                                                                  
[rosmake-1] Starting >>> rostime [ make ]                                                                                                       
[rosmake-0] Finished <<< std_msgs [PASS] [ 10.67 seconds ]                                                                                      
[rosmake-0] Starting >>> rosgraph_msgs [ make ]                                                                                                 
[rosmake-1] Finished <<< rostime [PASS] [ 3.25 seconds ]                                                                                        
[rosmake-1] Starting >>> roscpp_serialization [ make ]                                                                                          
[rosmake-1] Finished <<< roscpp_serialization [PASS] [ 2.41 seconds ]                                                                           
[rosmake-1] Starting >>> rosconsole [ make ]                                                                                                    
[rosmake-0] Finished <<< rosgraph_msgs [PASS] [ 9.76 seconds ]                                                                                  
[rosmake-0] Starting >>> rospy [ make ]                                                                                                         
[rosmake-0] Finished <<< rospy [PASS] [ 4.57 seconds ]                                                                                          
[rosmake-0] Starting >>> rosnode [ make ]                                                                                                       
[rosmake-0] Finished <<< rosnode [PASS] [ 7.86 seconds ]                                                                                        
[rosmake-0] Starting >>> rosparam [ make ]                                                                                                      
[ rosmake ] All 22 linesosconsole: 28.1 sec ] [ rosparam: 9.3 sec ]                                                  [ 2 Active 29/68 Complete ]
{-------------------------------------------------------------------------------
  mkdir -p bin
  cd build && cmake -Wdev -DCMAKE_TOOLCHAIN_FILE=`rospack find rosbuild`/rostoolchain.cmake  ..
  [rosbuild] Building package rosconsole
  [rosbuild] Including /Users/luca/ros/ros_comm/clients/roslisp/cmake/roslisp.cmake
  [rosbuild] Including /Users/luca/ros/ros_comm/clients/rospy/cmake/rospy.cmake
  [rosbuild] Including /Users/luca/ros/ros_comm/clients/cpp/roscpp/cmake/roscpp.cmake
  -- Configuring done
  -- Generating done
  CMake Warning: The variable, 'CMAKE_TOOLCHAIN_FILE', specified manually, was not used during the generation.
  -- Build files have been written to: /Users/luca/ros/ros_comm/tools/rosconsole/build
  cd build && make -l2
  [  0%] Built target rospack_genmsg_libexe
  [  0%] Built target rosbuild_precompile
  [ 50%] Building CXX object CMakeFiles/rosconsole.dir/src/rosconsole/rosconsole.o
  /Users/luca/ros/ros_comm/tools/rosconsole/src/rosconsole/rosconsole.cpp:684: internal compiler error: Segmentation fault: 11
  Please submit a full bug report,
  with preprocessed source if appropriate.
  See <URL:http://developer.apple.com/bugreporter> for instructions.
  make[3]: *** [CMakeFiles/rosconsole.dir/src/rosconsole/rosconsole.o] Error 1
  make[2]: *** [CMakeFiles/rosconsole.dir/all] Error 2
  make[1]: *** [all] Error 2
-------------------------------------------------------------------------------}
[ rosmake ] Output from build of package rosconsole written to:ec ]                                                  [ 2 Active 29/68 Complete ]
[ rosmake ]    /Users/luca/.ros/rosmake/rosmake_output-20110722-113953/rosconsole/build_output.log
[rosmake-1] Finished <<< rosconsole [FAIL] [ 28.12 seconds ]                                                                                    
[ rosmake ] Halting due to failure in package rosconsole. 
[ rosmake ] Waiting for other threads to complete.                                   
[rosmake-0] Finished <<< rosparam [PASS] [ 14.99 seconds ]                                                                                      
[ rosmake ] Results:                                                                                                                            
[ rosmake ] Built 31 packages with 1 failures.                                                                                                  
[ rosmake ] Summary output to directory                                                                                                         
[ rosmake ] /Users/luca/.ros/rosmake/rosmake_output-20110722-113953                                                                             
Traceback (most recent call last):
  File "/usr/local/bin/rosinstall", line 5, in <module>
    pkg_resources.run_script('rosinstall==0.5.16', 'rosinstall')
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/pkg_resources.py", line 489, in run_script
    self.require(requires)[0].run_script(script_name, ns)
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/pkg_resources.py", line 1214, in run_script
    exec script_code in namespace, namespace
  File "/Library/Python/2.7/site-packages/rosinstall-0.5.16-py2.7.egg/EGG-INFO/scripts/rosinstall", line 556, in <module>
    
  File "/Library/Python/2.7/site-packages/rosinstall-0.5.16-py2.7.egg/EGG-INFO/scripts/rosinstall", line 547, in rosinstall_main
    
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/subprocess.py", line 504, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command 'source /Users/luca/ros/setup.sh && rosmake ros ros_comm --rosdep-install' returned non-zero exit status 1

What can I do to solve the problem?
Thanks,
Luca

Originally posted by LucaGhera on ROS Answers with karma: 128 on 2011-07-21
Post score: 2

Original comments
Comment by mjcarroll on 2011-08-22:
@mrath asks "I uncommented the print function as well, however I don't get any output in rxconsole - could this be what the function does? I've only tried ROS the past few days, so I'm not sure if the problem is something else.."
Comment by William on 2011-08-08:
So an update: commenting lines 569 and 576 out in file rosconsole.cpp will allow it to compile.  No idea why this happens.  I just used a binary search like approach to commenting in order to find those lines =p. I will try to figure it out, but input from others would be awesome.
Comment by William on 2011-08-08:
I am looking into this issue.  While it is definitely a compiler bug, I think it might be triggered by something in the code.  See: https://lists.nongnu.org/archive/html/igraph-help/2011-07/msg00053.html.  igraph ran into a similar problem and they managed to work around it with code changes.

A:

I haven't found the problem with the compiler or ROS (specifically rosconsole), but I have found out what to comment out to work around the issue.  The print(...) function with an ellipsis in it (rosconsole.cpp) causes the issue.  I don't know why it does and I worked at it for quite a while, but then I realized that it doesn't seem to be being used (someone correct me if I am wrong), so I just commented it out.
You can see the fix here:
https://github.com/wjwwood/ros_comm/commit/71ccc123db3c7cd4c3343750ae0ef5803f7a828c
Or apply the patch yourself by downloading it from the ticket:
https://code.ros.org/trac/ros/ticket/3626
UPDATE:
There is a new patch that forces rosconsole to build with clang++ rather than llvm-g++ and it allows you to build cleanly without commenting out code.
https://code.ros.org/trac/ros/ticket/3626#comment:7

Originally posted by William with karma: 17335 on 2011-08-08
This answer was ACCEPTED on the original site
Post score: 4

Original comments
Comment by William on 2011-08-12:
I don't know exactly, it looks like there are three print statements and they are only using one, and there fore you can safely comment the one in my patch out.  I didn't look very hard though, and that function might be needed, but I haven't run into problems yet.
Comment by LucaGhera on 2011-08-11:
@William  Fine! It works, now I can finally compile the base stacks. Does this patch exclude some important feature?

