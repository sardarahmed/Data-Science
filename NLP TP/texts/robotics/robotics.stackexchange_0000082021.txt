Q:

px4flow velocity calcuation

Hi,
I have a px4flow smart camera sensor, and use the px4flow_node to read the sensor output.
The topic /px4flow/optflow has a message type:
Header header

float32 ground_distance  # distance to ground in meters
int16   flow_x           # x-component of optical flow in pixels
int16   flow_y           # y-component of optical flow in pixels
float32 velocity_x       # x-component of scaled optical flow in m/s
float32 velocity_y       # y-component of scaled optical flow in m/s
uint8   quality          # quality of optical flow estimate

But when I see the output I only have values for flow_x and flow_y.
I am only using it for a 2D robot so assuming I always know the ground distance, can someone please tell me how to calculate the x and y velocities using the flow_x and flow_y values?

Originally posted by b-sriram on ROS Answers with karma: 105 on 2017-07-27
Post score: 0

A:

real point P (X,Y,Z), image plane projection p (x,y,z), focal-length f, distance-to-scene Z
X = xZ / f
Y = yZ / f
Divide X and Y by the flow integration time(time between frames for which optical flow was calculated) to get velocity. Based on: https://github.com/PX4/Flow/blob/6c8cdb3cc04a5854a7b50e76e267e35507a0a0c4/src/modules/flow/main.c#L434-L438

Originally posted by ashwinvk94 with karma: 16 on 2020-06-09
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by gvdhoorn on 2020-06-10:
Please use permalinks in the future.
Comment by gvdhoorn on 2020-06-11:
What I added to your answer was already a permalink and took you directly to the file and lines in question. Why did you change it?

