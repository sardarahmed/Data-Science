Q:

Problem with building workspace in ros2

I was trying to set up a simple client in ROS1 (melodic) and a simple server in ROS2 (eloquent). Following the tutorial https://github.com/osrf/free_fleet/blob/master/README.md. However I got stuck at the point where I am building my workspace in ROS2 (at colcon build)
cd ~/server_ws
source /opt/ros/eloquent/setup.bash

# build cyclonedds first with the necessary cmake flags
colcon build --packages-select cyclonedds --cmake-args -DBUILD_IDLC=NO

# build the rest of the packages
colcon build

These were the following error messages.
Starting >>> rmf_traffic
--- stderr: rmf_traffic                                                  
CMake Error at /usr/share/cmake-3.10/Modules/FindPkgConfig.cmake:415 (message):
  A required package was not found
Call Stack (most recent call first):
  /usr/share/cmake-3.10/Modules/FindPkgConfig.cmake:593 (_pkg_check_modules_internal)
  CMakeLists.txt:26 (pkg_check_modules)
---
Failed   <<< rmf_traffic    [ Exited with code 1 ]
Aborted  <<< rmf_fleet_msgs                       
Aborted  <<< rmf_door_msgs                        
Aborted  <<< building_map_msgs
Aborted  <<< rmf_lift_msgs                         
Aborted  <<< rmf_workcell_msgs                     
Aborted  <<< rmf_dispenser_msgs                    
Aborted  <<< rmf_traffic_msgs

Please advise.

Originally posted by AHJL001 on ROS Answers with karma: 27 on 2020-03-26
Post score: 0

Original comments
Comment by marguedas on 2020-03-26:
Can you clarify what you mean by "stuck"?
It looks like the package succeeded to build (I believe the error message can be ignored).
Do you have any errors running the code ?
Comment by AHJL001 on 2020-03-26:
@marguedas Perhaps my problem is another issue. The following line which I have to run is colcon build
The error messages are as follows:
Starting >>> rmf_traffic
--- stderr: rmf_traffic                                                  
CMake Error at /usr/share/cmake-3.10/Modules/FindPkgConfig.cmake:415 (message):
  A required package was not found
Call Stack (most recent call first):
  /usr/share/cmake-3.10/Modules/FindPkgConfig.cmake:593 (_pkg_check_modules_internal)
  CMakeLists.txt:26 (pkg_check_modules)
---
Failed   <<< rmf_traffic    [ Exited with code 1 ]
Aborted  <<< rmf_fleet_msgs                       
Aborted  <<< rmf_door_msgs                        
Aborted  <<< building_map_msgs
Aborted  <<< rmf_lift_msgs                         
Aborted  <<< rmf_workcell_msgs                     
Aborted  <<< rmf_dispenser_msgs                    
Aborted  <<< rmf_traffic_msgs 

Do you have any idea? Thank you for your time
Comment by marguedas on 2020-03-26:
Yes this looks like an actual error. Can you please edit your original question and title to reflect that this is the problem you are looking for a solution for ?

A:

Based on the updated description, rmf_traffic is failing to build due to missing dependencies.
The reason is that the tutorial fails to mention to install the packages dependencies before building.
In order to install the dependencies of the packages in your workspace, it is recommended to use rosdep
rosdep update
rosdep install --from-paths src --ignore-src -y

So in the tutorial you are using it will look like:
cd ~/client_ws
source /opt/ros/melodic/setup.bash

# Tell rosdep to ignore the ROS 2 packages as this is the ROS 1 melodic workspace
touch ~/client_ws/src/free_fleet/free_fleet_examples_ros2/CATKIN_IGNORE
touch ~/client_ws/src/free_fleet/free_fleet_server_ros2/CATKIN_IGNORE

# install dependencies
rosdep update
rosdep install --from-paths src --ignore-src -y --rosdistro melodic

# build cyclonedds first with the necessary cmake flags
catkin build cyclonedds --cmake-args -DBUILD_IDLC=NO

# build the rest of the packages
catkin build

and
cd ~/server_ws
source /opt/ros/eloquent/setup.bash

# install dependencies
rosdep update
rosdep install --from-paths src --ignore-src -y --rosdistro eloquent

# build cyclonedds first with the necessary cmake flags
colcon build --packages-select cyclonedds --cmake-args -DBUILD_IDLC=NO

Originally posted by marguedas with karma: 3606 on 2020-03-26
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by AHJL001 on 2020-03-28:
Thank you for the looking into the issue. After I entered rosdep install --from-paths src --ignore-src -y into the terminal, the following pops up.
ERROR: the following packages/stacks could not have their rosdep keys resolved
to system dependencies:
free_fleet_examples_ros1: Cannot locate rosdep definition for [map_server]

How can I go about this? Once again, thank you so much for your time.
Comment by marguedas on 2020-03-29:
did you properly source /opt/ros/melodic/setup.bash and ran rosdep update before ?
The map_server package definitely exist for that distribution:
root@0834a3c5b792:/# rosdep resolve map_server
#apt
ros-melodic-map-server

Comment by AHJL001 on 2020-03-29:
@marguedas Yes, this is the message when trying to use rosdep install --from-paths src --ignore-src -y in the client_ws after sourcing the environment and entering the command rosdep update
computer:~/client_ws$ rosdep install --from-paths src --ignore-src -y
    ERROR: the following packages/stacks could not have their rosdep keys resolved
    to system dependencies:
    free_fleet_examples_ros2: Cannot locate rosdep definition for [rmf_fleet_msgs]
    free_fleet_server_ros2: Cannot locate rosdep definition for [ament_lint_common]

The above mentioned comment regarding the other system dependencies is the error message after using rosdep install --from-paths src --ignore-src -y in the server_ws.
Please advise
Comment by marguedas on 2020-03-30:
The only reason I see for this to be happening is if you're mixing ROS distributions in your terminal, and rosdep is looking for the packages for the wrong distribution.
Do you still have the map_server error if you do the following:
Open a new terminal
cd ~/client_ws
source /opt/ros/melodic/setup.bash
rosdep install --from-paths src --ignore-src -y --rosdistro melodic

Comment by AHJL001 on 2020-03-30:
@marguedas
I have solved the map_server error by installing it on the melodic distribution from debian packages. However, the current issue is the one that is mentioned recently.
rosdep install --from-paths src --ignore-src -y
    ERROR: the following packages/stacks could not have their rosdep keys resolved
    to system dependencies:
    free_fleet_examples_ros2: Cannot locate rosdep definition for [rmf_fleet_msgs]
    free_fleet_server_ros2: Cannot locate rosdep definition for [ament_lint_common]

I believe it is saying I am lacking the above packages. Unfortunately, I am unable to locate the missing packages. I have tried sudo apt install ros-eloquent-ament-lint-common which told me that I do have the latest version but rosdep still shows the same error message.
Comment by marguedas on 2020-03-30:
Installing it by hand prevents you from finding the source of your rosdep problem...
For ament_lint_common, it's most likely the same issue as above.
And the solution is likely the same:
Open a **new** terminal
cd ~/server_ws
source /opt/ros/eloquent/setup.bash
rosdep install --from-paths src --ignore-src -y --rosdistro eloquent

rmf_fleet_msgs should be in your workspace as it's a package provided by rmf_core
Comment by AHJL001 on 2020-03-30:
@marguedas I think I mentioned it wrongly. The cilent_ws which is the workspace to be done in ros-melodic  has the error messages
 ERROR: the following packages/stacks could not have their rosdep keys resolved
    to system dependencies:
    free_fleet_examples_ros2: Cannot locate rosdep definition for [rmf_fleet_msgs]
    free_fleet_server_ros2: Cannot locate rosdep definition for [ament_lint_common]

As for the server_ws which is to be done in a ros-eloquent environment shows #All required rosdeps installed successfully now.
Comment by marguedas on 2020-03-30:
oh I see. It's because client_ws includes both ROS 1 and ROS 2 packages.
In that case you'd want to ignore the ROS 2 packages:
touch ~/client_ws/src/free_fleet/free_fleet_examples_ros2/CATKIN_IGNORE
touch ~/client_ws/src/free_fleet/free_fleet_server_ros2/CATKIN_IGNORE

This should solve your issue.
Once solved I recommend you to open an issue on the github repository to report the problems you have been facing, this way maintainers can update the instructions for a more straight forward installation.
Comment by AHJL001 on 2020-03-30:
Thank you, this works! Yes, I will do so! Thank you so much!
Comment by marguedas on 2020-03-31:
Glad you figured it out. I edited my answer to reflect the final solution.
Could you please review that answer and accept it (by clicking the checkmark on the left) if it solves your issue ? This will remove this question from the unanswered list

