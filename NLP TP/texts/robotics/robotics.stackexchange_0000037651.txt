Q:

What am I doing wrong? Gmapping on Turtlebot Clone. I've pictures!

Hello all,
I've been scratching my head over this for a while now, and I would appreciate an explanation. If some of the angels on top high (like Melonee) could just give me a straightforward answer, it would be awesome.
Basically, I have been putting together my Turtlebot Clone over the past few weeks. Gotten around to doing some mapping recently, I am just using the standard demo as per suggested by the tutorials. However, I get errors, and mutated maps that even their own mothers couldn't love.
So, I have taken some screenshots to give you a step by step of what I am doing.

I start off with the above. I have my robot model, laser, map and camera all good to go. I have ran the gmapping launch file. You can see that the first parts of the occupancy grid is filling in. I have not moved the robot yet. There are no errors and we are all green on the dashboard.

Now, I have moved the turtlebot slightly to the left. The occupancy grid expands, however errors start to appear from the dashboard. What do those errors look like you might ask? I'll show you.

It is damn ugly I know. If I continue going around the environment, I will keep getting the error where the transform from base_link to odom fails. The only thing I touch in relation to launch files etc, is the minimal.launch. I don't use startup because teleop would not run when I did. I did the usual gyro config beforehand, and instead of putting the parameters into turtlebot.launch, I place them in minimal.launch. From what I can figure this should work fine. Correct me if I am wrong.

Now, if I continue around the map. I get another flavor of error. This time this is to do with a loop rate that isn't being met. It is usually just shy of it.

Now, if I continue on my merry way around the simple rectangular arena you see that obviously something is wrong. The two differences I can see from anyone else is how I do the bringup with the calibration values in the minimal.launch instead of the turtlebot.launch and I have a weaker netbook than what is suggest. If I had to put my money on it, I would say that it is the netbook not being fast enough.
You can look at the specs of the netbook I bought here.
Samsung NC110
My hands were a little tied with the choice, so this is why I didn't get something more powerful.
Again, I would really and truly like some feedback on what I might be doing wrong here, so I can zero in on the problem faster.
Thank you in advance.

Originally posted by osuairt on ROS Answers with karma: 69 on 2012-02-06
Post score: 0

Original comments
Comment by osuairt on 2012-02-11:
I've found that, and now I get an average load around 2.0. The problem still persists and now thinking that it must be a transform problem.
Comment by mmwise on 2012-02-10:
the parameter is in the kinect.launch file.
Comment by Lorenz on 2012-02-09:
The output shows that there is no odom transform but an odom_combined transform. Can you please also provide the output of rosrun tf tf_monitor and rostopic info /odom?
Comment by osuairt on 2012-02-09:
I've played around a bit more, and I have throttled the point cloud at 10Hz and getting a load average of around 2.0, mostly below. So, I take it that that possibility can be crossed off. Now this leaves the transform as Lorenz is saying. rosrun tf tf_echo base_footprint....) http://imgur.com/TAa70
Comment by Lorenz on 2012-02-09:
I still think that something is wrong with your transform tree, maybe with robot_pose_ekf. Otherwise tf_echo would be able to find odom_combined. Did you verify that robot_pose_ekf is actually connected to all required topics as I mentioned in one comment below?
Comment by osuairt on 2012-02-09:
Thank you very much. I have altered the point cloud throttle max rate down to 1Hz even. Then I get a load of 2.4 while driving around, and I still get the Transform from base_link to odom failure. Your thoughts?
Comment by Lorenz on 2012-02-08:
turtlebot_bringup/kinect.launch
Comment by osuairt on 2012-02-08:
:) Thank you. Can you tell me which config file I can change this parameter? I'll let  you know if that helps. Thanks again!!
Comment by mmwise on 2012-02-08:
a load average of 5 might be your problem. Try changing the point cloud throttle max rate to 10Hz. see if that helps.. You want to have a load average less than 2.
Comment by osuairt on 2012-02-08:
Hi Melonee, thank you for taking the time to get back to me. I've written up the upstart stuff at: http://answers.ros.org/question/3901/turtlebot-upstart-install-failure . And, I went ahead and ran top while do the mapping http://pastebin.com/zsUapqpH .
Comment by mmwise on 2012-02-07:
on your TurtleBot run the command top and tell me what the load average is...
Comment by mmwise on 2012-02-07:
p.s. you should use upstart..ask a new question about the teleop and I'll help you make it work...
Comment by osuairt on 2012-02-29:
From what it seems it looks like a problem with the tf. http://dl.dropbox.com/u/36264864/second.bag

A:

To me it looks like something is wrong with your odometry or with the laser data that is coming in You could check the following:

Is odometry running and publishing sane values (check with rostopic echo /odom). Move around and verify that odometry is changing.
Check if the odom transform is coming in (rosrun tf tf_echo odom base_footprint). Try setting the fixed frame in rviz to odom and move the robot around. Verify that the robot is moving correctly in rviz, i.e. when you move one meter forward, it should also be approximately one meter in rviz (the grid display helps here).

Originally posted by Lorenz with karma: 22731 on 2012-02-07
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by osuairt on 2012-02-10:
Hi. Yes, I am using gmapping_demo.launch. This is the result of rosnode info robot_pose_ekf - http://imgur.com/BoJC6.
Comment by Lorenz on 2012-02-10:
Ok. One thing I see already is that gmapping publishes a wrong transform so I guess something is wrong with its config. Which gmapping launch file did you use? turtlebot_navigation/gmapping_demo.launch? Please also post rosnode info robot_pose_ekf.
Comment by osuairt on 2012-02-10:
Also, there is my minimal.launch - http://imgur.com/q034D
Comment by osuairt on 2012-02-10:
Well I pulled down and did the Turtlebot Ubuntu install as usual, there was no mention in the install instructions that additional modifications had to be made. I've removed the mapping at the end robot_pose_ekf. tf_monitor - http://imgur.com/befc4. rostopic - http://imgur.com/fExHx
Comment by Lorenz on 2012-02-09:
Is that really the launch file you are using. It is PR2 specific. Remove the remapping line at the end or change it to match your setup. Also, to solve your problem, it is really important to understand your setup, so please provide the output of rosrun tf tf_monitor and rostopic info odom.
Comment by osuairt on 2012-02-09:
I see what you are saying that it should be odom_combined. http://imgur.com/SlCrn
Comment by Lorenz on 2012-02-07:
robot_pose_ekf is started by minimal.launch. Check with rxgraph or rosnode info robot_pose_ekf if all input topics are connected. I don't know which launch file you were using for gmapping but the odom frame needs to be set to odom_combined there. You don't need to start move_base for just mapping
Comment by osuairt on 2012-02-07:
I performed the standard calibration for the gyro and odometry from the tutorials and included them in minimal.launch. Lets go with the second option. Can you give me a idea of how I go about configuring the robot_pose_ekf and for move_base to use odom_combined?
Comment by Lorenz on 2012-02-07:
The topic is actually odom :) Did you configure and run robot_pose_ekf for fusing odometry and the gyro? You have two choices now: 1) don't use robot_pose_ekf (requries a patch to turtlebot_node) 2) configure robot_pose_ekf and change ros parameters for gmapping and move_base to use odom_combined.
Comment by osuairt on 2012-02-07:
Hi. In both cases of the rosparam get above, it was odom instead of odom_combined as you mentioned. Also, when I run rostopic list, there is only odom no odom_combined. The tf_echo also says that odom_combined does not exist. What do you think?
Comment by osuairt on 2012-02-13:
Hi, do you have any thoughts on my last comment?
Comment by Lorenz on 2012-02-13:
Sorry. I was very busy and didn't have time yet to answer. In general, people are answering as soon as they have time. See http://www.ros.org/wiki/Support#Guidelines_for_asking_a_question_.28Please_read_before_posting.29
Comment by Lorenz on 2012-02-13:
After double-checking the turtlebot launch files, I see that the turtlebot is actually using odom, not odom_combined. I'll edit my answer accordingly. My guesses are now: either you don't get updated laser data or you get bad odometry data. Please verify that both data sources look good.
Comment by osuairt on 2012-02-27:
The laser data looks good. Odom data on the other hand not so much. If I am traveling around the environment taking the mapping, I will get the odom to base_link transform error, then odometry readings skip off to some other area of the map, this is probably why I cannot close the loop.
Comment by osuairt on 2012-02-27:
The following is an image of Rviz http://imgur.com/3NJZ0 . You can see what I mean by the skipping of odometry. I've swapped out the Create for another I had and the behavior still persists.
Comment by osuairt on 2012-02-29:
From what it seems it looks like a problem with the tf. http://dl.dropbox.com/u/36264864/second.bag

