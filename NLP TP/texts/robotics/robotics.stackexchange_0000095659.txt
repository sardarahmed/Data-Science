Q:

Problems with boost::bind in a class with message_filter

Hello,
I am attempting to use a class to synchronize subscription to a detection message [vision_msgs/Detection2DArray] and a camera_info message.  I am getting compile errors when binding the TimeSynchronizer to the callback.  I have viewed [https://answers.ros.org/question/172772/writing-a-c-class-with-message_filters-member/] but have not found any clues yet...  The code and errors are below.  Any help would be appreciated.  Boost version 1.65.1, gcc version 7.5, ubuntu Bionic, Ros Melodic.
#include <ros/ros.h>
#include <image_geometry/pinhole_camera_model.h>
#include <message_filters/subscriber.h>
#include <message_filters/time_synchronizer.h>
#include <vision_msgs/Detection2D.h>
#include <vision_msgs/Detection2DArray.h>
#include <vision_msgs/ObjectHypothesisWithPose.h>
#include <sensor_msgs/CameraInfo.h>

using namespace vision_msgs;

class myClass{
  public:
  myClass():sync(det_sub, info_sub, 20)
  { 
    det_sub.subscribe(nh, "det", 20);
    info_sub.subscribe(nh, "camera_info", 20);
    sync.registerCallback(boost::bind(&myClass::callback, _1, _2 ));
  }
  
  private:
  void callback(Detection2DArrayConstPtr& det,sensor_msgs::CameraInfoConstPtr& cam_info)
  {
      //do stuff
      
      //publish stuff
  }
  
  ros::NodeHandle nh;
  message_filters::Subscriber<Detection2DArray> det_sub;
  message_filters::Subscriber<sensor_msgs::CameraInfo> info_sub;
  message_filters::TimeSynchronizer<Detection2DArray,sensor_msgs::CameraInfo> sync;
  image_geometry::PinholeCameraModel cam_model;
  
};

int main(int argc, char** argv)
{
  ros::init(argc, argv, "vision_node");

  /* 
  //want this in a class -- it compiles fine on its own
  message_filters::Subscriber<Detection2DArray> det_sub(nh, "det", 1);
  message_filters::Subscriber<sensor_msgs::CameraInfo> info_sub(nh, "camera_info", 1);
  message_filters::TimeSynchronizer<Detection2DArray,
            sensor_msgs::CameraInfo> sync(det_sub, info_sub, 10);
  sync.registerCallback(boost::bind(&callback, _1, _2));*/
  myClass aTest;
  ros::spin();

  return 0;
}

the errors are:
In file included from /usr/include/boost/bind.hpp:22:0,
                 from /opt/ros/melodic/include/ros/publisher.h:35,
                 from /opt/ros/melodic/include/ros/node_handle.h:32,
                 from /opt/ros/melodic/include/ros/ros.h:45,
                 from /home/hrrnxt/Workspace/RosStuff/camera_ws/src/bbox_undistort/src/bbox_undistort_node.cpp:1:
/usr/include/boost/bind/bind.hpp: In instantiation of ‘struct boost::_bi::result_traits<boost::_bi::unspecified, void (myClass::*)(boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&)>’:
/usr/include/boost/bind/bind.hpp:1284:48:   required from ‘class boost::_bi::bind_t<boost::_bi::unspecified, void (myClass::*)(boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&), boost::_bi::list2<boost::arg<1>, boost::arg<2> > >’
/home/hrrnxt/Workspace/RosStuff/camera_ws/src/bbox_undistort/src/bbox_undistort_node.cpp:18:66:   required from here
/usr/include/boost/bind/bind.hpp:75:37: error: ‘void (myClass::*)(boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&)’ is not a class, struct, or union type
     typedef typename F::result_type type;
                                     ^~~~
In file included from /usr/include/boost/function/detail/maybe_include.hpp:58:0,
                 from /usr/include/boost/function/detail/function_iterate.hpp:14,
                 from /usr/include/boost/preprocessor/iteration/detail/iter/forward1.hpp:92,
                 from /usr/include/boost/function.hpp:64,
                 from /opt/ros/melodic/include/ros/forwards.h:40,
                 from /opt/ros/melodic/include/ros/common.h:37,
                 from /opt/ros/melodic/include/ros/ros.h:43,
                 from /home/hrrnxt/Workspace/RosStuff/camera_ws/src/bbox_undistort/src/bbox_undistort_node.cpp:1:
/usr/include/boost/function/function_template.hpp: In instantiation of ‘static void boost::detail::function::void_function_obj_invoker9<FunctionObj, R, T0, T1, T2, T3, T4, T5, T6, T7, T8>::invoke(boost::detail::function::function_buffer&, T0, T1, T2, T3, T4, T5, T6, T7, T8) [with FunctionObj = boost::_bi::bind_t<boost::_bi::unspecified, boost::_bi::bind_t<boost::_bi::unspecified, void (myClass::*)(boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&), boost::_bi::list2<boost::arg<1>, boost::arg<2> > >, boost::_bi::list9<boost::arg<1>, boost::arg<2>, boost::arg<3>, boost::arg<4>, boost::arg<5>, boost::arg<6>, boost::arg<7>, boost::arg<8>, boost::arg<9> > >; R = void; T0 = const boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&; T1 = const boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&; T2 = const boost::shared_ptr<const message_filters::NullType>&; T3 = const boost::shared_ptr<const message_filters::NullType>&; T4 = const boost::shared_ptr<const message_filters::NullType>&; T5 = const boost::shared_ptr<const message_filters::NullType>&; T6 = const boost::shared_ptr<const message_filters::NullType>&; T7 = const boost::shared_ptr<const message_filters::NullType>&; T8 = const boost::shared_ptr<const message_filters::NullType>&]’:
/usr/include/boost/function/function_template.hpp:925:38:   required from ‘void boost::function9<R, T1, T2, T3, T4, T5, T6, T7, T8, T9>::assign_to(Functor) [with Functor = boost::_bi::bind_t<boost::_bi::unspecified, boost::_bi::bind_t<boost::_bi::unspecified, void (myClass::*)(boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&), boost::_bi::list2<boost::arg<1>, boost::arg<2> > >, boost::_bi::list9<boost::arg<1>, boost::arg<2>, boost::arg<3>, boost::arg<4>, boost::arg<5>, boost::arg<6>, boost::arg<7>, boost::arg<8>, boost::arg<9> > >; R = void; T0 = const boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&; T1 = const boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&; T2 = const boost::shared_ptr<const message_filters::NullType>&; T3 = const boost::shared_ptr<const message_filters::NullType>&; T4 = const boost::shared_ptr<const message_filters::NullType>&; T5 = const boost::shared_ptr<const message_filters::NullType>&; T6 = const boost::shared_ptr<const message_filters::NullType>&; T7 = const boost::shared_ptr<const message_filters::NullType>&; T8 = const boost::shared_ptr<const message_filters::NullType>&]’
/usr/include/boost/function/function_template.hpp:716:7:   required from ‘boost::function9<R, T1, T2, T3, T4, T5, T6, T7, T8, T9>::function9(Functor, typename boost::enable_if_c<(! boost::is_integral<Functor>::value), int>::type) [with Functor = boost::_bi::bind_t<boost::_bi::unspecified, boost::_bi::bind_t<boost::_bi::unspecified, void (myClass::*)(boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&), boost::_bi::list2<boost::arg<1>, boost::arg<2> > >, boost::_bi::list9<boost::arg<1>, boost::arg<2>, boost::arg<3>, boost::arg<4>, boost::arg<5>, boost::arg<6>, boost::arg<7>, boost::arg<8>, boost::arg<9> > >; R = void; T0 = const boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&; T1 = const boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&; T2 = const boost::shared_ptr<const message_filters::NullType>&; T3 = const boost::shared_ptr<const message_filters::NullType>&; T4 = const boost::shared_ptr<const message_filters::NullType>&; T5 = const boost::shared_ptr<const message_filters::NullType>&; T6 = const boost::shared_ptr<const message_filters::NullType>&; T7 = const boost::shared_ptr<const message_filters::NullType>&; T8 = const boost::shared_ptr<const message_filters::NullType>&; typename boost::enable_if_c<(! boost::is_integral<Functor>::value), int>::type = int]’
/usr/include/boost/function/function_template.hpp:1061:16:   required from ‘boost::function<R(T0, T1, T2, T3, T4, T5, T6, T7, T8)>::function(Functor, typename boost::enable_if_c<(! boost::is_integral<Functor>::value), int>::type) [with Functor = boost::_bi::bind_t<boost::_bi::unspecified, boost::_bi::bind_t<boost::_bi::unspecified, void (myClass::*)(boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&), boost::_bi::list2<boost::arg<1>, boost::arg<2> > >, boost::_bi::list9<boost::arg<1>, boost::arg<2>, boost::arg<3>, boost::arg<4>, boost::arg<5>, boost::arg<6>, boost::arg<7>, boost::arg<8>, boost::arg<9> > >; R = void; T0 = const boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&; T1 = const boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&; T2 = const boost::shared_ptr<const message_filters::NullType>&; T3 = const boost::shared_ptr<const message_filters::NullType>&; T4 = const boost::shared_ptr<const message_filters::NullType>&; T5 = const boost::shared_ptr<const message_filters::NullType>&; T6 = const boost::shared_ptr<const message_filters::NullType>&; T7 = const boost::shared_ptr<const message_filters::NullType>&; T8 = const boost::shared_ptr<const message_filters::NullType>&; typename boost::enable_if_c<(! boost::is_integral<Functor>::value), int>::type = int]’
/opt/ros/melodic/include/message_filters/signal9.h:281:40:   required from ‘message_filters::Connection message_filters::Signal9<M0, M1, M2, M3, M4, M5, M6, M7, M8>::addCallback(C&) [with C = const boost::_bi::bind_t<boost::_bi::unspecified, void (myClass::*)(boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&), boost::_bi::list2<boost::arg<1>, boost::arg<2> > >; M0 = vision_msgs::Detection2DArray_<std::allocator<void> >; M1 = sensor_msgs::CameraInfo_<std::allocator<void> >; M2 = message_filters::NullType; M3 = message_filters::NullType; M4 = message_filters::NullType; M5 = message_filters::NullType; M6 = message_filters::NullType; M7 = message_filters::NullType; M8 = message_filters::NullType]’
/opt/ros/melodic/include/message_filters/synchronizer.h:310:40:   required from ‘message_filters::Connection message_filters::Synchronizer<Policy>::registerCallback(const C&) [with C = boost::_bi::bind_t<boost::_bi::unspecified, void (myClass::*)(boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&), boost::_bi::list2<boost::arg<1>, boost::arg<2> > >; Policy = message_filters::sync_policies::ExactTime<vision_msgs::Detection2DArray_<std::allocator<void> >, sensor_msgs::CameraInfo_<std::allocator<void> >, message_filters::NullType, message_filters::NullType, message_filters::NullType, message_filters::NullType, message_filters::NullType, message_filters::NullType, message_filters::NullType>]’
/home/hrrnxt/Workspace/RosStuff/camera_ws/src/bbox_undistort/src/bbox_undistort_node.cpp:18:67:   required from here
/usr/include/boost/function/function_template.hpp:159:11: error: no match for call to ‘(boost::_bi::bind_t<boost::_bi::unspecified, boost::_bi::bind_t<boost::_bi::unspecified, void (myClass::*)(boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&), boost::_bi::list2<boost::arg<1>, boost::arg<2> > >, boost::_bi::list9<boost::arg<1>, boost::arg<2>, boost::arg<3>, boost::arg<4>, boost::arg<5>, boost::arg<6>, boost::arg<7>, boost::arg<8>, boost::arg<9> > >) (const boost::shared_ptr<const vision_msgs::Detection2DArray_<std::allocator<void> > >&, const boost::shared_ptr<const sensor_msgs::CameraInfo_<std::allocator<void> > >&, const boost::shared_ptr<const message_filters::NullType>&, const boost::shared_ptr<const message_filters::NullType>&, const boost::shared_ptr<const message_filters::NullType>&, const boost::shared_ptr<const message_filters::NullType>&, const boost::shared_ptr<const message_filters::NullType>&, const boost::shared_ptr<const message_filters::NullType>&, const boost::shared_ptr<const message_filters::NullType>&)’
           BOOST_FUNCTION_RETURN((*f)(BOOST_FUNCTION_ARGS));
           ^
bbox_undistort/CMakeFiles/bbox_undistort_node.dir/build.make:62: recipe for target 'bbox_undistort/CMakeFiles/bbox_undistort_node.dir/src/bbox_undistort_node.cpp.o' failed
make[2]: *** [bbox_undistort/CMakeFiles/bbox_undistort_node.dir/src/bbox_undistort_node.cpp.o] Error 1
CMakeFiles/Makefile2:10378: recipe for target 'bbox_undistort/CMakeFiles/bbox_undistort_node.dir/all' failed
make[1]: *** [bbox_undistort/CMakeFiles/bbox_undistort_node.dir/all] Error 2
Makefile:140: recipe for target 'all' failed
make: *** [all] Error 2
Invoking "make -j4 -l4" failed

Originally posted by Narton on ROS Answers with karma: 83 on 2020-04-30
Post score: 0

A:

There are two problems.
The parameters to your callback function must be declared const. Change from
void callback(Detection2DArrayConstPtr& det,sensor_msgs::CameraInfoConstPtr& cam_info)

to
void callback(const Detection2DArrayConstPtr& det, const sensor_msgs::CameraInfoConstPtr& cam_info)

Pass this to bind. Change from
sync.registerCallback(boost::bind(&myClass::callback, _1, _2 ));

to
sync.registerCallback(boost::bind(&myClass::callback, this, _1, _2 ));

Originally posted by Thomas D with karma: 4347 on 2020-04-30
This answer was ACCEPTED on the original site
Post score: 2

