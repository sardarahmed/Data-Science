Q:

how do I make a ros publisher run under python 3?

I made a python3 script that will read left, right  encoder ticks from an arduino. I am trying to now get that same code to publish those ticks. This is what I have so far. sorry I not at all good with python.
    #!/usr/bin/env python3
import serial
import time
import rospy
from std_msgs.msg import Int16
# assign your port and speed
ser = serial.Serial('/dev/ttyUSB0', 1152000)
print("Reset Arduino")
time.sleep(3)
while (1)  # WORKING PART
    #left encoder read
    ser.write(bytes('l', 'UTF-8'))
    left = ser.readline().decode('ascii').strip()
    print("left")
    #print(left)
        #right encoder read
    ser.write(bytes('r', 'UTF-8'))
    right = ser.readline().decode('ascii').strip()
    right = right.rstrip('\r\n')
    print('right')
    #print(right)
    time.sleep(.0125)
    #node to publish left to lwheel (std_msgs/Int16)
#not working part
    def leftticks():
        pub = rospy.Publisher('lwheel', Int16)
        rospy.init_node('leftticks')
        while not rospy.is_shutdown():
            lstr = left
            rospy.loginfo(lstr)
            pub.publish(String(lstr))
            rospy.sleep(.5)

    if __name__ == '__main__':
        try:
            leftticks()
        except rospy.ROSInterruptException:
            pass

    #node to pulish right to rwheel (std_msgs/Int16)
    def rightticks():
        pub = rospy.Publisher('rwheel', Int16)
        rospy.init_node('rightticks')
        while not rospy.is_shutdown():
            rstr = right
            rospy.loginfo(rstr)
            pub.publish(String(rstr))
            rospy.sleep(.5)

    if __name__ == '__main__':
        try:
            rightticks()
        except rospy.ROSInterruptException:
            pass

How do I get it all to work together. As you can tell I have no clue what I am doing. Thanks for any help you can give.

Originally posted by packrat on ROS Answers with karma: 51 on 2013-04-14
Post score: 1

Original comments
Comment by joq on 2013-04-15:
Right now that is really hard to do. You don't mention what OS or ROS version you are using.
Comment by joq on 2013-04-15:
BTW, the shebang (#!) needs to be left justified.
Comment by packrat on 2013-04-15:
I am using Ubuntu 12.04lts and groovy. If I can't get to work on python3 how do I make it work under python 2.7 or what ros uses?

A:

The ROS Groovy release on Ubuntu Precise 12.04 uses Python 2.7, which is the default interpreter for that system.
Precise also provides Python 3.2, which you can install, but the ROS distribution was not built to use that. It is probably possible to get it working by building everything from source, but I do not recommend that approach.
If you are willing to use Python 2, things will be much easier for now. Note that handling of bytes and strings differs between Python 2 and Python 3. It is possible to write code that works with either, but that gets tricky. Keep it simple until you have something that works.
First, you need to get comfortable with basic ROS programming in Python. This tutorial will explain how to publish ROS messages.
It's a little hard to untangle the code you posted. If you are new to Python: beware that indentation is significant because it defines the block structure of your program. So, be careful.
You should not try to create two ROS nodes in that single script. You don't need to, anyway, one node will suffice. Your main function will probably look more like this:
rospy.init_node('ticks')
lpub = rospy.Publisher('lwheel', Int16)
rpub = rospy.Publisher('rwheel', Int16)
hz_rate = rospy.Rate(80)
while not rospy.is_shutdown():
    # read left encoder
    lpub.publish(Int16(data=int(left)))
    # read right encoder
    rpub.publish(Int16(data=int(right)))
    hz_rate.sleep()

That is just a simplified overview. Your actual logic will be more complex.

Originally posted by joq with karma: 25443 on 2013-04-16
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by packrat on 2013-04-16:
Awesome. I made the changes, and it runs until I try to subscribe to the topic. I get this error
Comment by packrat on 2013-04-16:
Traceback (most recent call last):
File "Desktop/try3.py", line 20, in 
lpub.publish(Int16(left))
File "/opt/ros/groovy/lib/python2.7/dist-packages/rospy/topics.py", line 801, in publish
raise ROSSerializationException(str(e))
Comment by packrat on 2013-04-16:
rospy.exceptions.ROSSerializationException: field data must be an integer type
Comment by joq on 2013-04-16:
See edited version above.

