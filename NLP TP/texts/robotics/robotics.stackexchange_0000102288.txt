Q:

Dynamically adding prohibited zones to costmap

Hello World,
I want to dynamically (at will) add and remove "prohibited" zones to the costmap.
The zones should be simple polygons which prevent the local planner from driving through them.
They should be controllable by publishing, for example a Polygon, to certain topics.
I looked at the following solutions:

costmap_prohibition_layer: zones are static

static map layer with subscribe_to_updates: updates are not displayed
rostopic pub /map_updates map_msgs/OccupancyGridUpdate  "header:
    frame_id: 'map'
x: 10
y: 10
width: 10
height: 10
data: [100,100,100,100,100,100,100,100,100,100,...]"

I checked that move_base_flex had subscribed to /map_updates, maybe always_send_full_costmap: true or gmapping pulishing to /map has something to do with it?

Environment:

ROS: noetic
uname -a: Linux husarion 5.4.0-1-generic #0~upboard5-Ubuntu SMP Fri Jan 7 11:53:57 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux
navigation: mbf_costmap_nav 0.4.0, costmap_2d 1.17.2, gmapping 1.4.2

What can I use to solve this problem?
Thank you for you attention :)

Originally posted by Armin Wolf on ROS Answers with karma: 3 on 2022-08-17
Post score: 0

Original comments
Comment by Armin Wolf on 2022-08-17:
I will try to publish the updates to a seperate static layer called "prohibited_layer", listening on the topics prohibited and prohibited_updates.
Changes should be seen since the layer is above static_layer and not potentially overwritten by gmapping publishing to /map.

A:

I don't think you want a "static layer". But you could start with the source code for the costmap_prohibition_layer, and enhance it with the ability to take dynamic updates.
The idea is to use a subscriber (or a service) to add/remove from an internal list of polygons. Using a ros service would be more reliable because the caller gets a result message back.

Originally posted by Mike Scheutzow with karma: 4903 on 2022-08-19
This answer was ACCEPTED on the original site
Post score: 1

