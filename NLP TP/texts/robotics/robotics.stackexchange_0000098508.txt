Q:

Get logging output to /rosout using rclutils (writing a client library)

I'm writing a ROS2 client library for SWI-Prolog.   Basic pub/sub works.  Next step is to get logging to work.  Calling rcutils_log() works fine for loging to the console, but nothing appears in /rosout or in rqt.   It doesn't seem to matter whether I leave the initialization to RCUTILS_LOGGING_AUTOINIT or call rcutils_logging_initialize().  Controlling the level affects the output in the console, so the basics seem to work.   I tried with and without a creating a ROS node.   The subscription works fine and the node is visible in rqt.
Platform is Ubuntu 20.04 using ROS2 foxy.
Any clue, including clues on how to debug this?

Originally posted by Jan Wielemaker on ROS Answers with karma: 36 on 2021-03-08
Post score: 0

A:

After a lot of searching in the rcl and rcutils sources and some gdb breakpoints, I got it working.   Key are

Initialize logging right after creating the rcl context, notably before creating a node in this context.
Use rcl_logging_configure_with_output_handler() with rcl_logging_multiple_output_handler as handler, also before creating a node.
Make sure options.enable_rosout is true for rcl_node_init().  This is by default the case, but it was set to false in my code based on rclpy (which I guess sets it somewhere else).

Originally posted by Jan Wielemaker with karma: 36 on 2021-03-08
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by gvdhoorn on 2022-08-12:
This is probably rather niche, but thanks @Jan Wielemaker for posting the solution. Saved my quite a bit of time.

