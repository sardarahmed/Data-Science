Q:

PCL Trunk and ROS Hydro - Assembler Messages

I'm playing with Kinfu in PCL, so I had to clone and compile the PCL trunk from bitbucket. However, one of my own packages does not compile anymore using catkin_make:

/tmp/ccj7RxYq.s: Assembler messages:

/tmp/ccj7RxYq.s:865: Error: no such instruction: `vfmadd312sd
(%rbx,%rdi,8),%xmm5,%xmm4'

[...]

The file that the errors seem to be related to does not contain anything related to assembler code. The includes are:
"Eigen/Dense", <pcl/kdtree/kdtree_flann.h>, and <pcl/search/organized.h>.
When I restrict the compiler flags to -fopenmp -Wno-deprecated, it compiles fine. However, when adding -DNDEBUG -O3, the errors occur.

Originally posted by atp on ROS Answers with karma: 529 on 2014-03-25
Post score: 0

Original comments
Comment by MichaelKorn on 2014-03-25:\

What compiler (version) do you use?
What CPU do you have?

Comment by atp on 2014-03-26:
Compiler: gcc version 4.6.3 (Ubuntu/Linaro 4.6.3-1ubuntu5). CPU model name: Intel(R) Core(TM) i7-4770K.

A:

I think Haswell support was added in gcc 4.7. I suppose you are using Ubuntu 12.04. I know 2 solutions:

You can update gcc:
You can add a PPA (https://launchpad.net/~ubuntu-toolchain-r/+archive/test) and update to 4.7 or 4.8. I'm using this PPA with Ubuntu 12.04, gcc 4.7, i7-4770 and PCL/KinFu.

You can use compiler flags to specify the architecture (e.g. "-march=corei7"). This should work, but it maybe not allows to use the full potential of the CPU.

Originally posted by MichaelKorn with karma: 1480 on 2014-03-26
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by atp on 2014-03-26:
Changing the optimization level to O2 helped.
Comment by MichaelKorn on 2014-03-26:
I am not surprised by that. But this is like solution 2, you just don't use this Fused Multiply-Add instructions.

