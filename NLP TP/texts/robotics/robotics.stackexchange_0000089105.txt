Q:

[solved] How to publish multiple messages from single topic?

hai,
I have a problem in my code. i have to publish multiple messages from single topic, to display 2 voltages which is data type of Float64.
#include <ros.h>
#include <std_msgs/Float64.h>

ros::NodeHandle nh;

float voltage1 = 23.44, voltage2 = 74.43;

std_msgs::Float64 test;
ros::Publisher p("my_topic", &test);

void setup()
{

  nh.initNode();
  nh.advertise(p);

}

void loop()
{
  test.data = voltage1;
  test.data = voltage2;
  p.publish( &test );
  nh.spinOnce();
  delay(10);
}

when i did this, i only getting

voltage2

value.how can i publish both?
melvin@melvin-HP-Notebook:~$ rosrun rosserial_arduino serial_node.py /dev/ttyACM0
[INFO] [1537962733.845694]: ROS Serial Python Node
[INFO] [1537962733.851536]: Connecting to /dev/ttyACM0 at 57600 baud
[INFO] [1537962735.962522]: Requesting topics...
[INFO] [1537962740.982019]: Packet Failed :  Failed to read msg data
[INFO] [1537962740.983027]: expected msg length is 84
[WARN] [1537962740.984163]: Last read step: data
[WARN] [1537962740.985069]: Run loop error: Serial Port read failure: Returned short (expected 84 bytes, received 83 instead).
[INFO] [1537962740.985887]: Requesting topics...

I got this error while connecting through serial_node after add this line test.layout.dim_length = 2;

Originally posted by sudo_melvinyesudas on ROS Answers with karma: 54 on 2018-09-26
Post score: 0

A:

hi
you must to use Float32MultiArray
#include <ros.h>
#include "std_msgs/Float64MultiArray.h"

ros::NodeHandle nh;

float voltage1 = 23.44, voltage2 = 74.43;

std_msgs::Float64MultiArray test;

ros::Publisher p("my_topic", &test);

void setup()
{

  nh.initNode();
  nh.advertise(p);
  test.data = (float*)malloc(sizeof(float) *2);
  test.data_length =2;

}

void loop()
{
  test.data[0]= voltage1;
  test.data[1] = voltage2;
  p.publish( &test );
  nh.spinOnce();
  delay(10);
}

if you want to publish single float via topic change this part of code:
void loop()
{
  test.data = voltage1;
  p.publish( &test );// add this line
  test.data = voltage2;
  p.publish( &test );
  nh.spinOnce();
  delay(10);
}

Originally posted by Hamid Didari with karma: 1769 on 2018-09-26
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by sudo_melvinyesudas on 2018-09-26:
Hi Hamid, i got this error
exit status 1
request for member 'at' in 'test.std_msgs::Float64MultiArray::data', which is of non-class type 'std_msgs::Float64MultiArray::_data_type* {aka float*}'

Comment by Hamid Didari on 2018-09-26:
change test.data.at(0)  to test.data[0] and see the err is gone?
Comment by sudo_melvinyesudas on 2018-09-26:
No Hamid. same error.
Comment by Hamid Didari on 2018-09-26:
did you chang both line :
test.data.at(0) = voltage1;
test.data.at(1) = voltage2;

to:
test.data[0] = voltage1;
test.data[1] = voltage2;

Comment by sudo_melvinyesudas on 2018-09-26:
yes Hamid
exit status 1
request for member 'resize' in 'test.std_msgs::Float64MultiArray::data', which is of non-class type 'std_msgs::Float64MultiArray::_data_type* {aka float*}'

same error.
Comment by Hamid Didari on 2018-09-26:
i update the code in answer It will work   , some syntax different in Arduino and c++
Comment by Hamid Didari on 2018-09-26:
first and second err not the same ;)
Comment by sudo_melvinyesudas on 2018-09-26:
oh sorry. my bad. The code executed without error and uploaded. but how to get those particular values?when i did rostopic echo /my_topic  it returns
layout: 
  dim: []
  data_offset: 0
data: []

The voltage not showing.How to subscribe those voltage1 and 2 separately?
Comment by Hamid Didari on 2018-09-26:
add this line at the end of setup
test.layout.dim_length = 2;

Comment by sudo_melvinyesudas on 2018-09-26:
i updated my question. can you check?
Comment by Hamid Didari on 2018-09-26:
change
test.layout.dim_length = 2;

to
test.data_length =2;

Comment by sudo_melvinyesudas on 2018-09-27:
Thank you so much  @hamid . its working.
Comment by Marcus Barnet on 2021-05-31:
Thanks, this helped me a lot!

