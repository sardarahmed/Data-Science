Q:

Layered costmap performance

After switching to the plugin implementation of costmap_2d in order to be able to work with layers, the layers load extremely slowly and in chunks, it's a bit difficult to explain, so I've included pictures:
Using pre-hydro configuration:

Using plugins:

It's a problem since it also affects the planners.
Here are my config files:
costmap_common_params.yaml:
  obstacle_range: 3.5
  raytrace_range: 4.0
  robot_radius: 0.4
  inflation_radius: 0.7

  obstacle_layer:
    observation_sources: laser_scan_sensor
    laser_scan_sensor: {sensor_frame: /sensor_link, data_type: LaserScan, topic: /navbot/scan_data, marking: true, clearing: true}

global_costmap_params:
global_costmap:
  global_frame: /map
  robot_base_frame: /platform
  update_frequency: 5.0
  static_map: true
  plugins:
    - {name: inflation_layer,   type: "costmap_2d::InflationLayer", output: "screen"}
    - {name: static_map,        type: "costmap_2d::StaticLayer"}
    - {name: obstacle_layer,    type: "costmap_2d::ObstacleLayer", output: "screen"}

local_costmap_params.yaml:
local_costmap:
  global_frame: /map
  robot_base_frame: /platform
  update_frequency: 8.0
  publish_frequency: 4.0
  rolling_window: true
  static_map: false
  width: 6.0
  height: 6.0
  resolution: 0.05
  plugins:
    - {name: inflation_layer,        type: "costmap_2d::InflationLayer", output: "screen"}
    - {name: obstacle_layer,         type: "costmap_2d::ObstacleLayer", output: "screen"}

Thank you.

Originally posted by SleepyTurtle on ROS Answers with karma: 30 on 2019-02-08
Post score: 0

A:

The order of your layers is probably not what you intended. Move the inflation layer from the first position to the last position in each configuration.

Originally posted by David Lu with karma: 10932 on 2019-02-08
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by SleepyTurtle on 2019-02-09:
Thank you, I'll try it out on Monday and update the question.
EDIT: That solved the problem, thank you again.
Comment by parzival on 2020-07-04:
@david-lu so the order in which you add the layers makes a difference? Could you please provide a reference link where I can read more about it?
Comment by David Lu on 2020-07-10:
http://wustl.probablydavid.com/entry200.html
Comment by parzival on 2020-07-14:
Thanks a lot for sharing the paper, helped me a lot to understand. So if I have laser scanner+sonar, what should be the order of my layers?
Please tell me if this is correct:

Static
Obstacle
Sonar
Inflation
Should inflation always be the last item?
Thanks again

Comment by David Lu on 2020-07-16:
That looks fine. Whether you switch Obstacle and Sonar depends on what kind of obstacles you'll see. Inflation is very often the last item, but I won't say always.

