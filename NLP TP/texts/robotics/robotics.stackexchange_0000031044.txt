Q:

openni_node internal throttle to limit cpu usage

When running openni_node on an embedded system I realized the CPU usage is quite high, actually that high, that the rest of the system lags.
The cpu load only goes high, when someone is actually subscribed, so my guess is that the marshalling takes time. Is this the correct assumption?
Switching down the resolution with dynamic_reconfigure already helps, but I'm wondering if there is an option (planned?) to throttle the output in the node internally, so the data is not marshalled, if needed at a lower rate.

Originally posted by dornhege on ROS Answers with karma: 31395 on 2011-04-12
Post score: 2

A:

Marshalling does take a good amount of time.  The recent driver is already a nodelet in it's implementation and can use the nodelet_throttle.  For an example of doing this see the turtlebot_bringup robot.launch
That launch file shows how you can downsample while only passing pointers.  The existing settings doesn't throttle the frequency much as we can keep up mostly, but just change the parameters if you need less CPU usage.
PS you may want to experiment with running more things as nodelets on the embedded board for by doing that you can entirely avoid serializing.  Depending on what you are doing it may be more efficient to operate on the data in place.

Originally posted by tfoote with karma: 58457 on 2011-04-12
This answer was ACCEPTED on the original site
Post score: 4

Original comments
Comment by Felix Endres on 2011-04-19:
To update the last comment: With an update rate of 1hz the nodelet has about 50% single-core cpu usage on an IntelCore2 Quad CPU Q9650@3.00GHz (instead of ~110% for the non-throttled node). Plus the XnSensorServer with ~20%, but I assume that is independent.
Comment by Felix Endres on 2011-04-19:
Thanks for this info. I had a look at the launch file and the code of CloudThrottle, but a remaining problem seems to be, that the point cloud will still be computed from depth and pixelwhich will still consume cpu time. But maybe that is insignificant versus the marshalling, I haven't tried yet.

