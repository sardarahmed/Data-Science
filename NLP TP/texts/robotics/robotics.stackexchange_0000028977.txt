Q:

How to work with camera image

I am trying to create a sensor plugin for camera sensor. Following the source code for gazebo_ros_camera plugin, I assume, that a CameraPlugin has an OnNewFrame() callback function that is called whenever the camera captures a frame. The callback function than gets the image as *const unsigned char _image. But I do not understand how to get the actual image out of this data type. I want to add some information into each frame, such as simulation time, and then save the frame into a folder. How can this be done?

Originally posted by kumpakri on Gazebo Answers with karma: 755 on 2020-04-17
Post score: 0

A:

I found one way to get the image into cv::Mat format.
#include <cv.h>

void AddSimTimeToFrame::OnNewFrame(const unsigned char *_image,
                                    unsigned int _width, 
                                    unsigned int _height, 
                                    unsigned int _depth,
                                    const std::string &_format)
{
    // must be casted to void * to trigger the correct cv::Mat constructor
    void* data = (void*)_image;
    cv::Mat img(_height, _width, CV_8UC3, data);
    // the red and blue channels are switched 
    cv::cvtColor(img, img, CV_BGR2RGB);
    
    // image processing
}

Originally posted by kumpakri with karma: 755 on 2020-04-21
This answer was ACCEPTED on the original site
Post score: 0

