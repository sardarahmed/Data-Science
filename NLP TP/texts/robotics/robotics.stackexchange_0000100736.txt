Q:

[Autoware.Auto] trying to get AVP demo work in Borregas avenue map

Using latest ADE 4.3.0. with LGSVL 2021.3 and latest Autoware.Auto (commit 9ffc6c65), I'm trying to run the AVP demo in the borregas avenue map. I downloaded the lanelet file from here and PCD map from here, so I'm guessing I'm using the correct map files.
So far I only changed the paths for the map files in avp_sim.launch.py and avp_core.launch.py in src/launch/autoware_demos/launch. After doing colcon build. I can get rviz working and localize the ego car using 2D point estimateby running:
source ~/AutowareAuto/install/setup.bash && ros2 launch autoware_auto_launch autoware_auto_visualization.launch.py

source ~/AutowareAuto/install/setup.bash && ros2 launch autoware_demos avp_sim.launch.py

However, my problem is, the car won't drive to goal position that I give on rviz. It outputs.
[behavior_planner_node_exe-18] [INFO] [1638796056.866125361] [planning.behavior_planner_node]: Received route 
[behavior_planner_node_exe-18] [INFO] [1638796056.875813804] [planning.behavior_planner_node]: Received map 
[behavior_planner_node_exe-18] [INFO] [1638796056.884309758] [planning.behavior_planner_node]: Sent lane trajectory action goal 
[lane_planner_node_exe-15] [INFO] [1638796056.884397920] [planning.lane_planner_node]: received new goal 
[lane_planner_node_exe-15] [INFO] [1638796056.892634521] [planning.lane_planner_node]: Start planning 
[lane_planner_node_exe-15] [INFO] [1638796056.892814385] [planning.lane_planner_node]: Finished planning 
[lane_planner_node_exe-15] [INFO] [1638796056.892964663] [planning.lane_planner_node]: Sent planned trajectory with 3 points 
[behavior_planner_node_exe-18] [INFO] [1638796056.892988632] [planning.behavior_planner_node]: Received trajectory from planner
[object_collision_estimator_node_exe-17] [WARN] [1638796215.875013710] [planning.object_collision_estimator_node]: Unable to get a valid transform before a new obstacle message arrived

I have test the behavior and global planner as shown in the documentation, and outputs are similar to those that are shown there. However, I can't figure out the problem now. Any hint would be much appreciated.

Originally posted by hakan on ROS Answers with karma: 15 on 2021-12-06
Post score: 0

Original comments
Comment by Josh Whitley on 2021-12-11:
When you say "Won't drive to the goal," do you mean "doesn't move at all" or something different? Could you be more specific about the behavior?
Additionally, could you please answer the following questions?

Autoware Version or Git Hash
ADE or not?

Comment by hakan on 2021-12-13:
I've added the version information. The issue I'm facing is: after giving a goal position with 2D Goal Pose, the car doesn't move at all. It makes a break (rear lights turn red) and then stays where it is.
Comment by Maxime on 2021-12-16:
Please try running Autoware with option with_obstacles:=false.

ros2 launch autoware_demos avp_sim.launch.py with_obstacles:=false

Object detection can have some false positive which might prevent the vehicle from moving. This option completely removes obstacle detection.
Comment by hakan on 2021-12-20:
Hey Maxime, I tried running with with_obstacles:=false, but it didn't make any difference.

A:

I managed to make it work.
Like you I updated the map paths in the following files:

src/launch/autoware_demos/param/avp/lanelet2_map_provider.param.yaml
src/launch/autoware_demos/param/avp/map_publisher_sim.param.yaml

This includes the lanelet map (.osm) and pointcloud (.pcd) files you linked to, but also a .yaml file for the map_yaml_file parameter of map_publisher_sim.param.yaml. I started from the latitude and longitude values found in the lanelet map and had to fine tune it to align the map and the pointcloud. Here are the values I used in the end:
map_config:
  latitude: 37.416910205894
  longitude: -122.016032188409
  elevation: -2.256
  roll: 0.0
  pitch: 0.0
  yaw: 0.0

Here is a video where you can see everything working fine apart from some issues with the control (maybe due to the lanelet map).

Originally posted by Maxime with karma: 96 on 2021-12-21
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by hakan on 2021-12-21:
Hey Maxime, I was able to reproduce your results, although in my case car moves a lot more shaky. Anyway,  thanks so much!
Comment by Maxime on 2021-12-21:
I should have mentioned I am using the new controller (changes to the launch files can be found here: https://gitlab.com/autowarefoundation/autoware.auto/AutowareAuto/-/merge_requests/1312).
Comment by Sneha on 2022-08-03:
Hi I am trying to run lanlet2 map which I have created, with AVPdemo but after giving goal position car is not moving to goal position.

