Q:

Not able to set 2D pose in Autoware.auto valet parking demo

Hi,
I'm learning Autoware.auto and ros2. I'm trying to run the valet parking demo described here: https://autowarefoundation.gitlab.io/autoware.auto/AutowareAuto/avpdemo.html
I'm not able to set initial 2D pose in rviz2 or it's not updating in the Autoware stack (I think). When I draw the 2D arrow there's this message in rviz2 terminal:

[rviz2-1] [INFO] [1639588780.655812900] [rviz2]: Setting estimate pose: Frame:map, Position(-57.6281, -40.7876, 0), Orientation(0, 0, -0.981921, 0.189291) = Angle: -2.76071

That looks sensible to me.
The mock-up car doesn't move where I point and the Autoware stack terminal just keeps spewing these messages:

[freespace_planner_node_exe-17] [INFO] [1639589683.268449200] [planning.freespace_planner]: Waiting for costmap generator action service...

[costmap_generator_node_exe-16] [INFO] [1639589683.286138200] [planning.costmap_generator_node]: Waiting for initial pose...

Any idea what the problem could be?
Info about my setup (because it may not be completely traditional):

I'm running the Autoware ADE on Windows WSL2.
I have Docker desktop.
I'm running VcXSrv as X terminal server (so rviz2 runs through that).
I'm running LGSVL simulator on Windows.
I have been able to view LIDAR point cloud from LGSVL on rviz2 when running lgsvl_bridge.
I have this stuff at the end of adehome's .bashrc:

source AutowareAuto/install/setup.bash

export DISPLAY=172.23.64.1:0.0

export COLCON_DEFAULTS_FILE=/usr/local/etc/colcon-defaults.yaml

sudo cp .hosts /etc/hosts
sudo cp .locale /etc/default/locale

Originally posted by mmikkone on ROS Answers with karma: 21 on 2021-12-15
Post score: 1

Original comments
Comment by Maxime on 2021-12-15:
Can you try to set the pose via command line
or try try the localization demo using rosbag ?
Comment by mmikkone on 2021-12-16:
No, I'm not able to set the pose via command line. Yes, the localization demo works. BTW I had an error in the initial version of the question. There was a missing line in the Autoware stack terminal: "Waiting for initial pose..." I've updated the question.
Comment by mmikkone on 2021-12-16:
Actually, I was now able to set the pose. It seems that the WebSocket ROS bridge was somehow the quilty component. I first started lgsvl_bridge. Then I started rviz. Then I started the Autoware stack (at this point rosbridge_websocket-3 started to complain about not being able to start the server, apparently because lgsvl_bridge had already reserved the port). Then I started the LGSVL. Then I set the pose in rviz and it got picked up. Also setting the pose via command line works now.

A:

So it sounds like the issue was caused by the bridge.
There are 2 bridges available to interface between ROS2 and SVL:

ROS2: the default bridge of SVL which requires running a separate executable (https://github.com/lgsvl/ros2-lgsvl-bridge).
ROS2ForUnitySVLBridge: this bridge requires installing extra files to the SVL simulator (`https://github.com/RobotecAI/ROS2ForUnitySVLBridge#using-ros2forunitysvlbridge-plugin, already done in the ADE environment) but does not require running a separate executable.

The documentation of Autoware.auto is written for the ROS2ForUnitySVLBridge (https://autowarefoundation.gitlab.io/autoware.auto/AutowareAuto/lgsvl.html) and your issues might have been caused by a mixup between the 2 bridges.
It looks like you managed to make Autoware work with the ROS2 bridge but if you have further issues in the future I recommend using ROS2ForUnitySVLBridge which in your use case will need to be installed to the SVL simulator of your Windows environment.

Originally posted by Maxime with karma: 96 on 2021-12-16
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by mmikkone on 2021-12-21:
I tried the ROS2ForUnitySVLBridge, but then the simulator won't start. There are issues with the simulation with ROS2 bridge, too... The parking starts well but the car won't back up to the parking spot. Also the motion is sometimes a bit jerky and break lights flash rapidly.
Comment by Maxime on 2021-12-21:
If the ROS2ForUnitySVLBridge is not working correctly on Windows then this is a problem with the SVL simulator. Please double check you correctly installed the necessary files from https://github.com/RobotecAI/ROS2ForUnitySVLBridge#using-ros2forunitysvlbridge-plugin and if it is still not working then you should open a ticket on the LGSVL github.

