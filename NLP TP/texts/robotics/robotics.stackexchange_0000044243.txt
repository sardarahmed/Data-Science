Q:

If a service process dies in the middle of servicing a request, how does the client avoid waiting forever?

It appears that if a service's process dies in the middle of handling a request, the service call on the client side will hang forever.
Is there any way around this besides putting the service call in its own thread and killing the thread after a timeout?
see: https://code.ros.org/trac/ros/ticket/2913

Originally posted by Asomerville on ROS Answers with karma: 2743 on 2012-09-18
Post score: 6

Original comments
Comment by Lorenz on 2012-09-18:
How long did you wait? I think the sockets should die at some point, maybe after 2 minutes or so. Does the service client not throw an exception in that case? (I believe in roslisp, it does :))
Comment by Lorenz on 2012-09-19:
Wow. I just tested your code and it really seems like the service call blocks forever...

A:

Based on the client code attached in the ticket, I added the line:
    if(!client.waitForExistence(ros::Duration(5.0))) continue;
before the service call (line 21). This allows the client to carry on and make service calls once the server comes up again.
Retried the code again after Lorenz's comment. It seems this worked only when the server was killed at specific points in time (just before the service call I presume). Though I still don't understand why it worked previously when the "Failed to call service" line wasn't printed.

Originally posted by weiin with karma: 2268 on 2012-09-18
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Lorenz on 2012-09-18:
I don't think that solves the problem of blocking service calls in the client that never return because the server went down.
Comment by weiin on 2012-09-19:
It is true that particular service call (when server dies) does not return (I do not get the message "Failed to call service add_two_ints"). But the client does continue to run its next loop until waitForExistence and until the server comes up again. ie the client does not hang
Comment by Lorenz on 2012-09-19:
The client actually cannot continue with its loop since the service call is blocking. I still don't see how waitForExistence could help if the service call just does not return, which is apparently the case.

