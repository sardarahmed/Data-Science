Q:

Node is not shutting down on ros::ok()

Hi all,
Mine is just a noob question about the expected behaviour of ros::ok() function.
I've written this very simple piece of code :
int main(int argc, char **argv)
{
    ros::init(argc, argv, "bot");
    ros::NodeHandle nh("~");

    ros::Publisher odo_pub = nh.advertise<sensor_msgs::JointState>("odometry", 1000);
    ros::Subscriber cmd_sub = nh.subscribe(sub.c_str(), 1000, chatterCallback);

    // Define the odometry msg
    sensor_msgs::JointState msg;
    msg.header.frame_id="bot";
    msg.position.resize(4);
    msg.velocity.resize(4);
    msg.effort.resize(4);

    while( ros::ok())
    {
        ROS_INFO("In loop %d",ros::ok());

        msg.header.stamp=ros::Time::now();
        odo_pub.publish(msg);
        ros::spinOnce();
    }
    ROS_INFO("Exit");

    return 0;
}

Should the node exit when I Ctrl-c the ros framework (by killing the terminal on which roscore has been started)?
Thanks!
P.S. I'm running ROS hydro on Ubuntu 12.04.2 LTS

Originally posted by RagingBit on ROS Answers with karma: 706 on 2014-07-21
Post score: 0

A:

do Ctrl-c  on terminal where your node is running (not roscore terminal).
you need to call ros::shutdown() to shutdown your node.
you use ros::master::check() in code to check.
thanks to http://answers.ros.org/question/36733/check-if-roscore-is-started-in-c/?answer=36737#post-id-36737

Originally posted by bvbdort with karma: 3034 on 2014-07-21
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by RagingBit on 2014-07-21:
That works.
Anyway, I was wondering if there is a way to check from my node if roscore has been turned off, in order to terminate the node as well. Checking on ros::ok() seems not to be working like that...
Comment by bvbdort on 2014-07-21:
you use  ros::master::check() thanks to http://answers.ros.org/question/36733/check-if-roscore-is-started-in-c/?answer=36737#post-id-36737
Comment by RagingBit on 2014-07-21:
Yes, that was what I was looking for.
Thanks!

