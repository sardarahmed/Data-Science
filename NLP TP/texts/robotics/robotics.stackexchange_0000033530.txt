Q:

Playing back large files with rosbag

Does rosbag read the whole bag file or a large portion of it before playing?
Often when I play back a large bag file it can take a long time before the playback
starts.

Originally posted by Hordur on ROS Answers with karma: 544 on 2011-08-08
Post score: 5

A:

I looked over the rosbag code. There is function called startReadingVersion200 in bag.cpp that reads in chunk headers and connection index records. The chunk headers are spaced at 1MB interval in the file. So for a 30GB file you have 30000 chunks. I'm guessing that reading each chunk is causing a seek, so with a 5ms seek time reading the file would take around 2min. Which matches what I have seeing. This would explain why it loads quickly when reloading. Because the header don't take up that much space and are probably being buffered by the OS.
The load time could be improved if the chunk headers could be processed as they are encountered in the bag file. I'm not familiar with the bag format so I don't know how easy or hard that would be.

Originally posted by Hordur with karma: 544 on 2011-08-09
This answer was ACCEPTED on the original site
Post score: 9

Original comments
Comment by jbohren on 2013-03-11:
Note that this is still an issue: https://github.com/ros/ros_comm/issues/117
Comment by Avio on 2016-02-16:
I'm still having this issue. I have to replay a 270Gb bagfile and iotop shows painfully slow disk reads:
Actual DISK READ: 35.90 M/s | Actual DISK WRITE: 0.00 B/s
17726 be/4 root 17.11 M/s 0.00 B/s  0.00 %  3.69 % play --queue 100 --rate 1.0 --delay 2.0 --start 0.0 2016-02-12-11-15-41.bag

