Q:

How does wf_simulator works with gnss?

I have read the source code "wf_simulator_core" "op_global_planner_core"and other code depends to those two cpp files.
I wonder know how wf_simulator localizes with gnss ,and show initial pose on the global path in rviz or does it have other forms?
I know how to use rviz to localize(2D Pose Estimate),but don't know how with GNSS.
I can't find any connection from wf_simulator to any other localized source code by using GNSS,can someone help me?

Originally posted by fantasyplus on ROS Answers with karma: 17 on 2020-07-27
Post score: 1

Original comments
Comment by Josh Whitley on 2020-07-27:
@mitsudome-r I know you're familiar with wf_simulator - can you help here? I'm pretty sure that localizing using only GNSS is a separate issue from wf_simulator but I haven't used AI recently enough to be confident.

A:

I will answer about "how wf_simulator localizes with gnss".
In the wf_simulator, the GNSS info is used for the initialization as a code, but in fact, it is used to move the vehicle position by GNSS in the simulation.
By connecting the GNSS to the wf_simulator, the vehicle position is constantly updated when the GNSS data is received. This will drive the simulator and some topics that other Autoware modules need is published (e.g. /current_pose, current_velocity, vehicle_status, and TF from map to base_link).
The following is how to connect the GNSS data to the wf_sinulator.

launch the runtime manager.
setup data (load pcd map, vector map, TF (world_to_map and baselink_to_localizer). Please follow the ROSBAG Demo document.
run the Rviz and select the autoware config file following the document.
run the rosbag including the gnss data (the sample_moriyama_150324.bag of the ROSBAG demo includes /nmea_sentence topic)
run the nmea2tfpose node in the runtime manager. (with the sample_moriyama_150324.bag, you need click the [app] button and select the 7 for the Plane number.) Then, the nmea2tfpose node starts and publishes the /gnss_pose topic.
run the wf_simulator in the runtime manager with initialize source being GNSS (select on [app] window).

Then, you will see the lidar sensor data is visualized on the Rviz (not as well localized as the NDT).
If you want to use the GNSS data with only for the initialization, you need to stop publishing the /gnss_pose after initialization is done (just kill the node by clicking the checkbox again).
I hope this would be helpful for you.

Originally posted by TakaHoribe with karma: 181 on 2020-07-29
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by fantasyplus on 2020-08-01:
Thanks for you detailed answer!!
I reproduce the wf_simulator car moving with only demo gnss data successfully ,and I will try it on my own data and map.
BTW,do you know how to create the correct vector map for autoware?I create a map by Tier4(V1.12) and op_global_planner can't show globalpath on that map(with rviz goals config),do you know why?
Comment by TakaHoribe on 2020-08-02:
@fantasyplus Sorry, I'm not familiar with the vectormap. If you couldn't create any short path from any points, maybe some necessary data is not in your vector map and the related topic is not published. Is there any non-published topic which the op_global_planner subscribes?
Comment by fantasyplus on 2020-08-05:
I have done it successfully!Thanks for response.

