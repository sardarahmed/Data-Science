Q:

Save an image during the subscription

Using that simple program how can I save an image during the subscription: like when I press a key (ctrl+s for example or s) I get an image *.jpeg file (or other extension doesn't matter) ?
void imageCallback(const sensor_msgs::ImageConstPtr& msg)
    {

        cv_bridge::CvImagePtr cv_ptr;
        try
        {
            cv_ptr = cv_bridge::toCvCopy(msg, sensor_msgs::image_encodings::BGR8);
        }

        catch (cv_bridge::Exception& e)
        {
            ROS_ERROR("cv_bridge exception: %s", e.what());
            return;
        }

        cv::imshow("OpenCV viewer uEye RGB", cv_ptr->image);
        cv::waitKey(3);

    }

Originally posted by ROSkinect on ROS Answers with karma: 751 on 2014-07-24
Post score: 0

A:

some Utilities:
#include <sstream>
#include <string>

#define SPACE_KEY (32)

    template<typename T> 
    inline std::string toString( const T& ao_Obj )
    {
      std::stringstream lo_stream;
      
      lo_stream << ao_Obj;
      
      return lo_stream.str();
    }

Then later in your code
  cv::imshow("OpenCV viewer uEye RGB", cv_ptr->image);    
  int key = cv::waitKey( 50 );
    
    if ( key == SPACE_KEY )
    {
       static int count = 0;
       ROS_ASSERT( cv::imwrite( std::string( "file" )  + toString( count++ )  + std::string( ".png" ), cv_ptr->image ) );
    }

Note that the cv window has to be the active one when the space key is pressed in order for saving the image. Note that your space press has to hit the 50 ms waiting duration, maybe a longer value is better here, but it will slow down your node....

Originally posted by Wolf with karma: 7555 on 2014-07-24
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by ROSkinect on 2014-07-24:
where the image file.png will be saved ..?
and when I look for it I can't find it !
Comment by Wolf on 2014-07-24:
in the local folder where you started your node ( if rosrun used ). If you use roslaunch is used, you have no way of knowing;) I. e. if using roslaunch you would need to give it a full path in some way. Saving images like this with ros would be moreless only for debugging purposes...

