Q:

3D Navigation (navigation in uneven terrain)

I am trying to develop a project in which I have to navigate a robot through a cave. The problem is that the cave's terrain is very uneven and so creating a 2D costmap to use Nav2 afterwards isn't an option, as the 2D costmap contains a lot of "occupied spots" because of the uneven of the terrain.
Do you know any package/project that performs 3D navigation? Or is it possible to use Nav2 with a workaround (how would it be)?
I am using ROS2 in ubuntu 20.04, my simulation is runnning on Gazebo, and I am performing the SLAM with RTABMap.
Thank you!!

Originally posted by marpeja on ROS Answers with karma: 63 on 2022-06-24
Post score: 0

Original comments
Comment by Fetullah Atas on 2022-06-24:
do you have a pointcloud map of the environment you are trying to navigate ?
Comment by marpeja on 2022-06-24:
Yes! in .ply format, but I can save it in other formats if needed (RTABMap allows different formats)
Comment by Fetullah Atas on 2022-06-24:
please see my answer
Comment by marpeja on 2022-06-24:
Thank you very much!! I will try to use it!

A:

vox_nav is a project that is aimed for navigation in unstructured/uneven terrains.
See, the robot navigating in uneven terrain with vox_nav; https://youtu.be/ZQdy22LmeP0
So far I have used the project only where GPS is available,
the pointcloud map is geo-referenced. I assume in your case there is no GPS ?,there could be some work in order to accommodate replacement of GPS localization with your SLAM based localization. But I would like to work on that and make this possible.
Feel free to contact me or use the issue tracker in vox_nav repo to test the project, I am interested to see how vox_nav could be useful to your case.
Disclaimer; vox_nav is still a research project and is far from stable/reliable, so you should expect certain amount of hassle while trying to use vox_nav.

Originally posted by Fetullah Atas with karma: 819 on 2022-06-24
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by stevemacenski on 2022-06-24:
That's pretty neat! My hope is next year (or more realistically, the year after) I can really dedicate time to getting height map implementations in Nav2. My hope is to start branching out to having alternate controller/planner server options based on 3D voxel grids and height maps to offer the full gambit of options for full 3D, height, and 2D navigation. Its a hassle to port all the algorithms over to each, but at least the basis will be done.
Comment by Fetullah Atas on 2022-06-24:
Thanks Steve!, I came to the conclusion that using a full 3D representation is more useful in terms of scalability (e.g. if I were to extend navigation for flying robots) for my case. At the moment I am using Octomap, planners are mostly from OMPL so a collision check module to FCL-Octomap serves well for now. However, I have plans to add OpenVDB to speed up planners, I met few people who have integrated/refined OpenVDB as an environment representation. Namely vdb_mapping, you might take a look at them too.
Comment by stevemacenski on 2022-06-24:
I'll say that I won't plan to use OpenVDB in the future. Its a great piece of software, but the binaries have had SO many problems over the years, you just can't rely on them. For 20.04 for over a year you couldn't use the binaries due to a messed up compiler flag. Now in 22.04 there are issues with the version that someone decided to release. And since none of the releases are controlled by the OpenVDB people themselves, its a real struggle to get real issues dealt with.
There are a number of options now for sparse voxel representations, I'd probably look at another one. But definitely i wouldn't use Octomap, that's too old and slow at this point. But its a reasonable starting point for a research project in ROS given its history
Comment by marpeja on 2022-06-26:
Hi Fetullah! I was trying to install all deps and vox_nav as shown in your Getting started page. However, when executing colcon build --symlink-install --cmake-args -DCMAKE_BUILD_TYPE=Release -DACADOS_WITH_QPOASES=ON -DACADO_CODE_IS_READY=ON -DWITH_IPOPT=true --packages-skip-regex archive --packages-skip vox_nav_control vox_nav_cupoch; \ right after source install/setup.bash I get an error in the librtabmap_core.so.0.20.18 reporting that there is an undefined reference to octomath::Pose6D::Pose6D(octomath::Pose6D const&), but I have been using RTABMap before and I had no issues... Do you know how to solve this?
Comment by Fetullah Atas on 2022-06-26:
HI!, I dont remember facing such issue, are you using source build of rtabmap or octomap?,
it could be that different versions of octomap are installed. Please name the packages that are on your src directory, I will see whether I can reproduce the issue. You might want to open an issue or a new question for better track and documentation of the problem.
Comment by marpeja on 2022-06-26:
These are the packages I have:
ACADOtoolkit
gazebo_ros2_control
perception_pcl
ros2_control
rtabmap
TALTECH_RM3_ROS_PACKAGES
casadi
ompl
RM3_gazebo
ros2_controllers
rtabmap_ros
vox_nav
Moreover I installed rtabmap with:
sudo apt install ros-foxy-rtabmap-ros

And Octomap with:
sudo apt-get install ros-foxy-octomap

Comment by Fetullah Atas on 2022-06-26:
You seem to already do source build of rtabmap_ros, you dont need to apt-get install it, you may remove that Debian installation of rtabmap_ros and use source build. I was able to build both rtabmap_ros and rtabmap with foxy-devel branches. I could not reproduce this issue, I have installed Debian octomap  just as you.
Here my versions;
octomap;
  <version>1.9.8</version>

rtabmap_ros;
  <version>0.20.18</version>

You can check your versions with;
ros2 pkg xml octomap

Overall, my suggestion would be to remove Debian installation of rtabmap_ros, clean up your build workspace with ;
cd colcon_ws &&
rm -rf build/*

and try to build again.
Comment by marpeja on 2022-06-26:
Thanks mate! Problem solved! I will start working with it now.
Comment by Fetullah Atas on 2022-06-27:
No problem, please do use issue tracker if you face issue while trying to configure vox_nav, if your repo is open source, you can provide the link and I can take a  look too
Comment by marpeja on 2022-06-28:
I am afraid the repo is not open source... However I can describe you the robot and the procedure to see if you can help me (I am a little bit lost at the moment). We have an omnidirectional robot that uses two screws as wheels. Moreover, it mounts an RGBD camera and an IMU, and the odometry is provided by the Gazebo planar move plugin.
You told me I should geo-reference the map using a GPS, this is, should I mount a GPS in the robot and read the first info provided by it manually when I start performing the SLAM, and then put this info in the vox_nav_default_params.yaml? If so, is there any specific place where I should mount the GPS? You also said that it could be localized using the localization of my SLAM service (RTABMap in my case), and I think I read something in the robot_localization wiki, but I am unable to find it now.
In addition, which planner should I use, and how can I configure it for my omnidirectional (holonomic) robot?
I will leave the MCP controller for later.
Thx
Comment by Fetullah Atas on 2022-06-28:
You can see an example robot configured with vox_nav
botanbot.
By geo-referencing the map, I meant that, given a GPS sensor on robot and datum of the map (defined in vox_nav_default_params.yaml), vox_nav's map_server will place your map W.R.T initial pose of robot, hence, you do not need to manually do anything, but you do need a GPS sensor and map datum for this to work. Place GPS sensor as close as possible to the sensor you constructed map with, its camera in your case ?  I am not too familiar with RTABMap, but typically SLAM algorithms have a pure-localization mode, where the algorithm provides you map->base_link transform, you can include this as a pseudo sensor info and include it in robot_localization to improve your localization accuracy. You should use OptimalElevationPlanner . The best way for me to help you would be that you open source your project or add me as contributor, Unfortunately configuring this is very
Comment by Fetullah Atas on 2022-06-28:
burdensome and confusing. Again please use the issue tracker, it is hard to be descriptive in this comment section as there is character limits and no images.

