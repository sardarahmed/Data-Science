Q:

subscribe to arduino message

Hello all,
My arduino send geometry twist message about robot path on /robotpath topic, when i type rostopic echo /robotpath i see the values (x,y,theta) change, but my subscribe node on ros read just the first value when it runs and hold it. I need to build a path controller for my project.
Thanks a lot.
my code is:
#include <ros/ros.h>
#include <geometry_msgs/Twist.h>

class robocont
{
public:
  robocont();

private:
  void roboCallback(const geometry_msgs::Twist::ConstPtr& robotpath);
  ros::NodeHandle nh_controller;
  ros::Subscriber robo_sub; 
};

 robocont::robocont()
{ 
  robo_sub = nh_controller.subscribe<geometry_msgs::Twist>("/robotpath", 1000, &robocont::roboCallback, this);
}

void robocont::roboCallback(const geometry_msgs::Twist::ConstPtr& robotpath)
{
  while(nh_controller.ok()){  
  ROS_INFO("Robot Postion:(%.2f, %.2f. %.2f)" ,robotpath->linear.x, robotpath->linear.y, robotpath->angular.z);
}
}

int main(int argc, char** argv)
{
  ros::init(argc, argv, "odometry_Control");
  robocont odometry_Control;
  ros::spin();
}

Originally posted by hana on ROS Answers with karma: 3 on 2015-10-23
Post score: 0

A:

Did you write ros::spin() in your code? See this for more information. Most probably, that is the problem. Otherwise, can you post your ros subscriber code?
Update:
This is the correct code:
#include <ros/ros.h>
#include <geometry_msgs/Twist.h>

class robocont
{
public:
  robocont();

private:
  void roboCallback(const geometry_msgs::Twist::ConstPtr& robotpath);
  ros::NodeHandle nh_controller;
  ros::Subscriber robo_sub; 
};

 robocont::robocont()
{ 
  robo_sub = nh_controller.subscribe<geometry_msgs::Twist>("/robotpath", 1000, &robocont::roboCallback, this);
}

void robocont::roboCallback(const geometry_msgs::Twist::ConstPtr& robotpath)
{
  ROS_INFO("Robot Postion:(%.2f, %.2f. %.2f)" ,robotpath->linear.x, robotpath->linear.y, robotpath->angular.z);
}

int main(int argc, char** argv)
{
  ros::init(argc, argv, "odometry_Control");
  robocont odometry_Control;
  ros::spin();
}

In your callback function, you had while(nh_controller.ok()){  } because of which it was stuck in the loop and kept on printing the same value.

Originally posted by Naman with karma: 1464 on 2015-10-23
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by hana on 2015-10-24:
Thank you, this is my code, i don't know where the problem
Comment by hana on 2015-10-24:
Thank u very much .... the problem has been solved
Comment by Naman on 2015-10-24:
Then, can you accept the answer so that it will be helpful for others also
Comment by hana on 2015-10-24:
I need to ask if the Callback function can read two topic at the same time (refernce path and real path)
Comment by Naman on 2015-10-25:
Ask a new question

