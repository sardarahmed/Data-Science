Q:

RTABMAP problems with Turtlebot2

Does RTABMAP require a kinect camera? My turtlebot2 has different model of camera. I installed the ROS kinetic version of rtabmap-ros. I am trying to follow the instructions from the rtab-map ROS wiki. I put in the following command for mapping in RVIZ:
roslaunch rtabmap_ros demo_robot_mapping.launch rviz:=true rtabmapviz:=false

I get this as a result:
process[rtabmap/rtabmap-1]: started with pid [5055]
process[rviz-2]: started with pid [5056]
process[points_xyzrgb-3]: started with pid [5057]
QXcbConnection: Could not connect to display 
[ INFO] [1647482776.248565386]: Starting node...
[ INFO] [1647482776.417708363]: Initializing nodelet with 4 worker threads.
[ INFO] [1647482776.777906091]: /rtabmap/rtabmap(maps): map_filter_radius          = 0.000000
[ INFO] [1647482776.777977848]: /rtabmap/rtabmap(maps): map_filter_angle           = 30.000000
[ INFO] [1647482776.778018951]: /rtabmap/rtabmap(maps): map_cleanup                = true
[ INFO] [1647482776.778057888]: /rtabmap/rtabmap(maps): map_always_update          = false
[ INFO] [1647482776.778099100]: /rtabmap/rtabmap(maps): map_empty_ray_tracing      = true
[ INFO] [1647482776.778137790]: /rtabmap/rtabmap(maps): cloud_output_voxelized     = true
[ INFO] [1647482776.778180610]: /rtabmap/rtabmap(maps): cloud_subtract_filtering   = false
[ INFO] [1647482776.778220574]: /rtabmap/rtabmap(maps): cloud_subtract_filtering_min_neighbors = 2
[ INFO] [1647482776.802018001]: /rtabmap/rtabmap(maps): octomap_tree_depth         = 16
[ INFO] [1647482776.845843450]: rtabmap: frame_id      = base_footprint
[ INFO] [1647482776.845905574]: rtabmap: odom_frame_id = odom
[ INFO] [1647482776.845962735]: rtabmap: map_frame_id  = map
[ INFO] [1647482776.846005998]: rtabmap: use_action_for_goal  = false
[ INFO] [1647482776.846056815]: rtabmap: tf_delay      = 0.050000
[ INFO] [1647482776.846102556]: rtabmap: tf_tolerance  = 0.100000
[ INFO] [1647482776.846145424]: rtabmap: odom_sensor_sync   = false
[ INFO] [1647482776.847155235]: rtabmap: gen_scan  = false
[ INFO] [1647482776.847199478]: rtabmap: gen_depth  = false
[ INFO] [1647482777.005215514]: Setting RTAB-Map parameter "Grid/FromDepth"="false"
[ INFO] [1647482777.095074314]: Setting RTAB-Map parameter "Icp/CorrespondenceRatio"="0.2"
[ INFO] [1647482777.107023110]: Setting RTAB-Map parameter "Icp/MaxCorrespondenceDistance"="0.05"
[ INFO] [1647482777.127037131]: Setting RTAB-Map parameter "Icp/PointToPlane"="false"
[ INFO] [1647482777.150835779]: Setting RTAB-Map parameter "Icp/VoxelSize"="0.05"
[ INFO] [1647482777.293845616]: Setting RTAB-Map parameter "Mem/IncrementalMemory"="true"
[ INFO] [1647482777.294775076]: Setting RTAB-Map parameter "Mem/InitWMWithAllNodes"="false"
[ INFO] [1647482777.334131948]: Setting RTAB-Map parameter "Mem/STMSize"="30"
[ INFO] [1647482777.439849005]: Setting RTAB-Map parameter "RGBD/LocalRadius"="5"
[ INFO] [1647482777.459867701]: Setting RTAB-Map parameter "RGBD/NeighborLinkRefining"="true"
[ INFO] [1647482777.463624132]: Setting RTAB-Map parameter "RGBD/OptimizeFromGraphEnd"="false"
[ INFO] [1647482777.464586942]: Setting RTAB-Map parameter "RGBD/OptimizeMaxError"="4"
[ INFO] [1647482777.476480904]: Setting RTAB-Map parameter "RGBD/ProximityBySpace"="true"
[ INFO] [1647482777.477365421]: Setting RTAB-Map parameter "RGBD/ProximityByTime"="false"
[ INFO] [1647482777.489614859]: Setting RTAB-Map parameter "RGBD/ProximityPathMaxNeighbors"="10"
[ INFO] [1647482777.498687861]: Setting RTAB-Map parameter "Reg/Force3DoF"="true"
[ INFO] [1647482777.502359325]: Setting RTAB-Map parameter "Reg/Strategy"="1"
[ INFO] [1647482777.779966849]: Setting RTAB-Map parameter "Vis/MinInliers"="12"
[ WARN] [1647482777.861114501]: Rtabmap: Parameter name changed: "Icp/PM" -> "Icp/Strategy". Please update your launch file accordingly. Value "false" is still set to the new parameter name.
[rviz-2] process has died [pid 5056, exit code -6, cmd /opt/ros/kinetic/lib/rviz/rviz -d /home/turtlebot/catkin_ws/src/rtabmap_ros/launch/config/demo_robot_mapping.rviz __name:=rviz __log:=/home/turtlebot/.ros/log/fd7c7f06-a594-11ec-97d5-a0510b03a27d/rviz-2.log].
log file: /home/turtlebot/.ros/log/fd7c7f06-a594-11ec-97d5-a0510b03a27d/rviz-2*.log
[ INFO] [1647482778.236528887]: Setting "Grid/RangeMax" parameter to 0 (default 5.000000) as "subscribe_scan", "subscribe_scan_cloud" or "gen_scan" is true and Grid/FromDepth is false.
[ INFO] [1647482778.238815186]: RTAB-Map detection rate = 1.000000 Hz
[ INFO] [1647482778.239261842]: rtabmap: Deleted database "/home/turtlebot/.ros/rtabmap.db" (--delete_db_on_start or -d are set).
[ INFO] [1647482778.239342011]: rtabmap: Using database from "/home/turtlebot/.ros/rtabmap.db" (0 MB).
[ INFO] [1647482778.511724193]: rtabmap: Database version = "0.20.10".
[ INFO] [1647482778.511833071]: rtabmap: SLAM mode (Mem/IncrementalMemory=true)
[ INFO] [1647482778.581727791]: /rtabmap/rtabmap: subscribe_depth = true
[ INFO] [1647482778.581804542]: /rtabmap/rtabmap: subscribe_rgb = true
[ INFO] [1647482778.581843904]: /rtabmap/rtabmap: subscribe_stereo = false
[ INFO] [1647482778.581884292]: /rtabmap/rtabmap: subscribe_rgbd = false (rgbd_cameras=1)
[ INFO] [1647482778.581930318]: /rtabmap/rtabmap: subscribe_odom_info = false
[ INFO] [1647482778.581979161]: /rtabmap/rtabmap: subscribe_user_data = false
[ INFO] [1647482778.582015543]: /rtabmap/rtabmap: subscribe_scan = true
[ INFO] [1647482778.582052614]: /rtabmap/rtabmap: subscribe_scan_cloud = false
[ INFO] [1647482778.582089146]: /rtabmap/rtabmap: subscribe_scan_descriptor = false
[ INFO] [1647482778.582126235]: /rtabmap/rtabmap: queue_size    = 10
[ INFO] [1647482778.582162296]: /rtabmap/rtabmap: approx_sync   = true
[ INFO] [1647482778.582295214]: Setup depth callback
[ INFO] [1647482778.660733399]: 
/rtabmap/rtabmap subscribed to (approx sync):
   /data_throttled_image/compressed \
   /data_throttled_image_depth/compressedDepth \
   /data_throttled_camera_info \
   /jn0/base_scan
[ INFO] [1647482779.071204597]: rtabmap 0.20.10 started...

But RVIZ doesnt pop up. as seen above I get:
     [ WARN] [1647482777.861114501]: Rtabmap: Parameter name changed: "Icp/PM" -> "Icp/Strategy". Please update your launch file accordingly. Value "false" is still set to the new parameter name.
        [rviz-2] process has died [pid 5056, exit code -6, cmd /opt/ros/kinetic/lib/rviz/rviz -d /home/turtlebot/catkin_ws/src/rtabmap_ros/launch/config/demo_robot_mapping.rviz __name:=rviz __log:=/home/turtlebot/.ros/log/fd7c7f06-a594-11ec-97d5-a0510b03a27d/rviz-2.log].
        log file: /home/turtlebot/.ros/log/fd7c7f06-a594-11ec-97d5-a0510b03a27d/rviz-2*.log
        [ INFO] [1647482778.236528887]: Setting "Grid/RangeMax" parameter to 0 (default 5.000000) as "subscribe_scan", 
"subscribe_scan_cloud" or "gen_scan" is true and Grid/FromDepth is false.

I know obviously something is wrong I just don't know how to fix it. I need help on this issue.

Originally posted by distro on ROS Answers with karma: 167 on 2022-03-16
Post score: 1

A:

You may start rviz alone and add displays you want. RTAB-Map can work with any RGB-D cameras, but you have to adjust the color/depth topic names. The launch file you used is very specific to corresponding demo rosbag and cannot be used on your robot "as is".
If you are on turtlebot2, look at this page instead: http://wiki.ros.org/rtabmap_ros/Tutorials/MappingAndNavigationOnTurtlebot

Originally posted by matlabbe with karma: 6409 on 2022-04-10
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by distro on 2022-04-10:
@matlabbe This is the page I have been using to try to figure this out, it didn't help me. Here is what I do,
 $ roslaunch turtlebot_bringup minimal.launch
 $ roslaunch rtabmap_ros demo_turtlebot_mapping.launch
Visualization (turtlebot_navigation.rviz):

 $ roslaunch rtabmap_ros demo_turtlebot_rviz.launch
or
 $ rosrun rviz rviz -d turtlebot_navigation.rviz

I'm guessing when the terminal displays rtabmap 0.20.10 started..., I should open another terminal and run  roslaunch rtabmap_ros demo_turtlebot_rviz.launch ?
Comment by matlabbe on 2022-04-10:
Yes, you should launch in a second terminal. If the rviz launch is crashing, it is maybe because of the RobotModel plugin (I saw it crashing on some computers, don't remember exactly the reason). Edit the rviz config and remove RobotModel plugin (or set enabled at false): https://github.com/introlab/rtabmap_ros/blob/88ca603b99c885dd898804e370d99131a343b97d/launch/config/turtlebot_navigation.rviz#L54-L230

