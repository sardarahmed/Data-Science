Q:

Unable to compile subscriber PointCloud

Hi,
I have a node written by someone else that I do not want to modify. The node publish a pcl::PointCloud<PointXYZRGB>
I just want to take the cloud, process it and publish a new cloud of the same type. I tried the simplest  code possible, but it does not compile. Here there is the code (note that I commented out many things to make the example as simple as possible):
#include <ros/ros.h>
// PCL specific includes
#include <pcl_conversions/pcl_conversions.h>
#include <pcl/point_cloud.h>
#include <pcl/point_types.h>
#include <std_msgs/String.h>
#include <sstream>
#include <iostream>

using namespace std;

ros::Publisher pub;
//bool firstone = true;
//int banana = 0;
//pcl::PointCloud<pcl::PointXYZRGB> firstCloud;
//pcl::PointCloud<pcl::PointXYZRGB> secondCloud;

void cloud_cb(const pcl::PointCloud<pcl::PointXYZRGB>::ConstPtr& input) {
    
//    if (firstone) {
//        firstCloud = (*input);
//        firstone = false;
//    } else {
//        secondCloud = (*input);
//        firstone = true;
//    }
//
//    std_msgs::String msg;
//    std::stringstream ss;
//
//    ss << banana << "  " << "Width: " << (*input).width << "Height: " << (*input).height << endl;
//    banana++;
//
//    msg.data = ss.str();
//
//    pub.publish(msg);

}

int main(int argc, char** argv) {
    ros::Rate rate(10);
    // Initialize ROS
    ros::init(argc, argv, "hyq_registration");
    ros::NodeHandle nh;

    // Create a ROS subscriber for the input point cloud
    ros::Subscriber sub = nh.subscribe("triclops/point_cloud_topic", 1, cloud_cb);

    // Create a ROS publisher for the output point cloud
    pub = nh.advertise <std_msgs::String> ("output", 1);
    ros::spin();
}

catkin_make shoots this:
In file included from /opt/ros/hydro/include/ros/serialization.h:37:0,
                 from /opt/ros/hydro/include/ros/publisher.h:34,
                 from /opt/ros/hydro/include/ros/node_handle.h:32,
                 from /opt/ros/hydro/include/ros/ros.h:45,
                 from /home/mcamurri/hyq-ws/src/hyq_registration/src/hyq_registration.cpp:1:
/opt/ros/hydro/include/ros/message_traits.h: In static member function ‘static const char* ros::message_traits::MD5Sum<M>::value() [with M = pcl::PointCloud<pcl::PointXYZRGB>]’:
/opt/ros/hydro/include/ros/message_traits.h:228:103:   instantiated from ‘const char* ros::message_traits::md5sum() [with M = pcl::PointCloud<pcl::PointXYZRGB>]’
/opt/ros/hydro/include/ros/subscribe_options.h:110:5:   instantiated from ‘void ros::SubscribeOptions::init(const string&, uint32_t, const boost::function<void(const boost::shared_ptr<const M>&)>&, const boost::function<boost::shared_ptr<T>()>&) [with M = pcl::PointCloud<pcl::PointXYZRGB>, std::string = std::basic_string<char>, uint32_t = unsigned int]’
/opt/ros/hydro/include/ros/node_handle.h:666:5:   instantiated from ‘ros::Subscriber ros::NodeHandle::subscribe(const string&, uint32_t, void (*)(const boost::shared_ptr<const M>&), const ros::TransportHints&) [with M = pcl::PointCloud<pcl::PointXYZRGB>, std::string = std::basic_string<char>, uint32_t = unsigned int]’
/home/mcamurri/hyq-ws/src/hyq_registration/src/hyq_registration.cpp:49:81:   instantiated from here
/opt/ros/hydro/include/ros/message_traits.h:121:37: error: ‘__s_getMD5Sum’ is not a member of ‘pcl::PointCloud<pcl::PointXYZRGB>’
/opt/ros/hydro/include/ros/message_traits.h: In static member function ‘static const char* ros::message_traits::DataType<M>::value() [with M = pcl::PointCloud<pcl::PointXYZRGB>]’:
/opt/ros/hydro/include/ros/message_traits.h:237:105:   instantiated from ‘const char* ros::message_traits::datatype() [with M = pcl::PointCloud<pcl::PointXYZRGB>]’
/opt/ros/hydro/include/ros/subscribe_options.h:111:5:   instantiated from ‘void ros::SubscribeOptions::init(const string&, uint32_t, const boost::function<void(const boost::shared_ptr<const M>&)>&, const boost::function<boost::shared_ptr<T>()>&) [with M = pcl::PointCloud<pcl::PointXYZRGB>, std::string = std::basic_string<char>, uint32_t = unsigned int]’
/opt/ros/hydro/include/ros/node_handle.h:666:5:   instantiated from ‘ros::Subscriber ros::NodeHandle::subscribe(const string&, uint32_t, void (*)(const boost::shared_ptr<const M>&), const ros::TransportHints&) [with M = pcl::PointCloud<pcl::PointXYZRGB>, std::string = std::basic_string<char>, uint32_t = unsigned int]’
/home/mcamurri/hyq-ws/src/hyq_registration/src/hyq_registration.cpp:49:81:   instantiated from here
/opt/ros/hydro/include/ros/message_traits.h:138:39: error: ‘__s_getDataType’ is not a member of ‘pcl::PointCloud<pcl::PointXYZRGB>’
In file included from /opt/ros/hydro/include/ros/publisher.h:34:0,
                 from /opt/ros/hydro/include/ros/node_handle.h:32,
                 from /opt/ros/hydro/include/ros/ros.h:45,
                 from /home/mcamurri/hyq-ws/src/hyq_registration/src/hyq_registration.cpp:1:
/opt/ros/hydro/include/ros/serialization.h: In static member function ‘static void ros::serialization::Serializer<T>::read(Stream&, typename boost::call_traits<T>::reference) [with Stream = ros::serialization::IStream, T = pcl::PointCloud<pcl::PointXYZRGB>, typename boost::call_traits<T>::reference = pcl::PointCloud<pcl::PointXYZRGB>&]’:
/opt/ros/hydro/include/ros/serialization.h:163:3:   instantiated from ‘void ros::serialization::deserialize(Stream&, T&) [with T = pcl::PointCloud<pcl::PointXYZRGB>, Stream = ros::serialization::IStream]’
/opt/ros/hydro/include/ros/subscription_callback_helper.h:132:5:   instantiated from ‘ros::VoidConstPtr ros::SubscriptionCallbackHelperT<P, Enabled>::deserialize(const ros::SubscriptionCallbackHelperDeserializeParams&) [with P = const boost::shared_ptr<const pcl::PointCloud<pcl::PointXYZRGB> >&, Enabled = void, ros::VoidConstPtr = boost::shared_ptr<const void>]’
/home/mcamurri/hyq-ws/src/hyq_registration/src/hyq_registration.cpp:54:1:   instantiated from here
/opt/ros/hydro/include/ros/serialization.h:136:5: error: ‘class pcl::PointCloud<pcl::PointXYZRGB>’ has no member named ‘deserialize’
make[2]: *** [hyq_registration/CMakeFiles/hyq_registration_node.dir/src/hyq_registration.cpp.o] Error 1
make[1]: *** [hyq_registration/CMakeFiles/hyq_registration_node.dir/all] Error 2
make: *** [all] Error 2
Invoking "make" failed

I have Hydro on Ubuntu 12.04.

Originally posted by mark_vision on ROS Answers with karma: 275 on 2014-01-30
Post score: 0

A:

OK I figured it out:
I was supposed to use
#include <pcl_ros/point_cloud.h>

instead of:
#include <pcl/point_cloud.h>

This is very confusing, though.
Why is ROS using so many types (PointCloud, PointCloud2, etc.) with similar features? Why don't they use only the pcl::PointCloud type and then create proper functions to manage it instead of using custom header files?

Originally posted by mark_vision with karma: 275 on 2014-01-30
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by mark_vision on 2014-01-30:
I don't know why the code is like that, the preview was correct.
Comment by bchr on 2014-01-30:
Because PCL's data types evolved. More information here: http://wiki.ros.org/pcl/Overview

