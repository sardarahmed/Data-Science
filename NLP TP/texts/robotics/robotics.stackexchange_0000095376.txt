Q:

Extract a Volume of points from a PointCloud2 message

Hi all, I'm trying to achieve something simple, yet I can't seem to find a way to do this. I have a PointCloud2 (as a .pcd file) and a bounding box defined in the same frame as the PointCloud2. I want to extract all the points that lie inside that bounding box and save them as a new .pcd file with the centroid of the box set as the origin of that point cloud.
A sample bounding box looks like this:
"bbox": {
            "position": {
                "position": {
                    "y": -24.204870224, 
                    "x": 23.0722198486, 
                    "z": -2.88637971878
                }, 
                "orientation": {
                    "y": -0.0256392564625, 
                    "x": 0.01510348171, 
                    "z": 0.704603254795, 
                    "w": 0.708977282047
                }
            }, 
            "size": {
                "y": 1.84718394279, 
                "x": 3.94384384155, 
                "z": 1.66313385963
            }
        }

So I have the position (which I want to be the origin of the new PointCloud), the size of the box, and also the orientation as a quaternion.
How can I do this? Any pointers to PCL tutorials would be helpful as well. Thank you!

Originally posted by deepaktalwardt on ROS Answers with karma: 23 on 2020-04-08
Post score: 0

A:

What you want is exactly the box filter http://docs.pointclouds.org/trunk/classpcl_1_1_crop_box.html
All pcl filter derived classes can be inverted with the negative command as well so you get only the points contained inside the box.

Originally posted by stevemacenski with karma: 8272 on 2020-04-09
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by deepaktalwardt on 2020-04-09:
Thanks, Steve! I'm not sure how I didn't stumble upon this before.
Comment by deepaktalwardt on 2020-04-22:
Steve, a follow-up question. Is there a way to visually draw these cropboxes in the original pointcloud so I could debug if I'm extracting the correct points? Or would there be a way to "color" the extracted points. I want to make sure I'm extracting the correct points before using them. Thank you.
Comment by stevemacenski on 2020-04-22:
All of those things are possible, but its pretty application specific. You could just trivially run this filter, take the inliers and publish to a topic with them and publish to another topic the outliers and display them in rviz with different colors. You could also pretty easily just stow the bounding box in the same way but using visualization_msgs markers. Either would work, just depends on what floats your boat more.
Comment by deepaktalwardt on 2020-04-22:
Thanks Steve, those make a ton of sense! I'm actually doing this filtering on a bunch of PCD files (and not from pointclouds streaming from ROS), do you know if I could do something similar without having to publish to RViz? I saw this question and was wondering if you had any clue what they are using here to render those boxes. https://stackoverflow.com/questions/60474707/pcl-cropbox-doesnt-work-means-it-doesnt-filter-the-points-i-want-to And again, I really appreciate your help!

