Q:

Disparity image publishing

Hi,
I am new to opencv. Need some help in publishing the disparity image in ROS.
i am getting left, right and disparity images from the custom stereo camera SDK. The disparity image that i am getting from SDK is mono8 format.
Now i want to publish the disparity image from the ROS so that "disparity_view" can display the disparity image.
It looks the disparity_view expects the images to be in TYPE_32FC1 format, but the disparity image that i have is mono8 format because of this it is not able to display disparity image.
Is there any sample program or tutorial which will guide to publish disparity image in TYPE_32FC1 format from mono8 format.
Warm Regards,
pramod

Originally posted by prbhagwat on ROS Answers with karma: 33 on 2011-03-20
Post score: 1

Original comments
Comment by Augusto Luis Ballardini on 2015-06-30:
i'm going to add some lines of code, the question has an answer but with code is better ;-)

A:

disparity_view expects disparities to have type float, so you'll need to convert your uint8_t disparity values. In your DisparityImage message, resize image.data to width * size * sizeof(float), and get a float pointer to your data buffer: float* ptr = reinterpret_cast<float*>(&image.data[0]). Then copy the disparities over one by one. You may need to scale the uint8_t disparities down by some factor if the custom SDK does sub-pixel correspondence like OpenCV's block matcher. The float disparities are in pixels. Don't forget to set image.encoding = sensor_msgs::image_encodings::TYPE_32FC1.

Originally posted by Patrick Mihelich with karma: 4336 on 2011-04-01
This answer was ACCEPTED on the original site
Post score: 2

