Q:

groovy script failed in Krel_reconfigura-jobs

Hi,
I was trying to setup a buildfarm for my group. I have ran import_upstream successfully. Then next I triggered "Krel_reconfigure-jobs". It took a lot of time to finish configuring tons of jobs. After this, the job failed when it ran the generated groovy files, complaining unable to resolve imports. The tail of the log is pasted as below.
I was also thinking about write a tutorial about some of the problems I met configuring the buildfarm (https://gist.github.com/prclibo/90fc9587f8382c069a3fb525291d2a39). Maybe after I succeed setup the buildfarm I can fiinsh this.

......
18:06:17 Configuration for jobs: Ksrc_uX__zeroconf_avahi_suite__ubuntu_xenial__source, Kbin_uX64__zeroconf_avahi_suite__ubuntu_xenial_amd64__binary
18:06:17 Configuration for jobs: Ksrc_dJ__zeroconf_avahi_suite__debian_jessie__source, Kbin_dJ64__zeroconf_avahi_suite__debian_jessie_amd64__binary
18:06:21 Writing groovy script '/tmp/reconfigure_jobs/reconfigure_jobs.groovy' to reconfigure 4 views and 5704 jobs
18:06:22 + echo # END SECTION
18:06:22 # END SECTION
18:06:23 ERROR: Build step failed with exception
18:06:23 org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
18:06:23 Script1.groovy: 12: unable to resolve class org.apache.xml.serialize.OutputFormat
18:06:23  @ line 12, column 1.
18:06:23    import org.apache.xml.serialize.OutputFormat
18:06:23    ^
18:06:23 
18:06:23 Script1.groovy: 13: unable to resolve class org.apache.xml.serialize.XMLSerializer
18:06:23  @ line 13, column 1.
18:06:23    import org.apache.xml.serialize.XMLSerializer
18:06:23    ^
18:06:23 
18:06:23 Script1.groovy: 1: unable to resolve class difflib.DiffUtils
18:06:23  @ line 1, column 1.
18:06:23    import difflib.DiffUtils
18:06:23    ^
18:06:23 
18:06:23 3 errors
18:06:23 
18:06:23    at org.codehaus.groovy.control.ErrorCollector.failIfErrors(ErrorCollector.java:310)
18:06:23    at org.codehaus.groovy.control.CompilationUnit.applyToSourceUnits(CompilationUnit.java:946)
18:06:23    at org.codehaus.groovy.control.CompilationUnit.doPhaseOperation(CompilationUnit.java:593)
18:06:23    at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:542)
18:06:23    at groovy.lang.GroovyClassLoader.doParseClass(GroovyClassLoader.java:298)
18:06:23    at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:268)
18:06:23    at groovy.lang.GroovyShell.parseClass(GroovyShell.java:688)
18:06:23    at groovy.lang.GroovyShell.parse(GroovyShell.java:700)
18:06:23    at groovy.lang.GroovyShell.parse(GroovyShell.java:736)
18:06:23    at groovy.lang.GroovyShell.parse(GroovyShell.java:727)
18:06:23    at org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript.evaluate(SecureGroovyScript.java:165)
18:06:23    at hudson.plugins.groovy.SystemGroovy.run(SystemGroovy.java:95)
18:06:23    at hudson.plugins.groovy.SystemGroovy.perform(SystemGroovy.java:59)
18:06:23    at hudson.tasks.BuildStepMonitor$1.perform(BuildStepMonitor.java:20)
18:06:23    at hudson.model.AbstractBuild$AbstractBuildExecution.perform(AbstractBuild.java:779)
18:06:23    at hudson.model.Build$BuildExecution.build(Build.java:205)
18:06:23    at hudson.model.Build$BuildExecution.doRun(Build.java:162)
18:06:23    at hudson.model.AbstractBuild$AbstractBuildExecution.run(AbstractBuild.java:534)
18:06:23    at hudson.model.Run.execute(Run.java:1728)
18:06:23    at hudson.model.FreeStyleBuild.run(FreeStyleBuild.java:43)
18:06:23    at hudson.model.ResourceController.execute(ResourceController.java:98)
18:06:23    at hudson.model.Executor.run(Executor.java:404)
18:06:23 Build step 'Execute system Groovy script' marked build as failure
18:06:23 Sending e-mails to: ros-buildfarm-testfarm@googlegroups.com
18:06:23 ERROR: Could not connect to SMTP host: localhost, port: 25
18:06:24 javax.mail.MessagingException: Could not connect to SMTP host: localhost, port: 25;
18:06:24   nested exception is:
18:06:24    java.net.ConnectException: Connection refused (Connection refused)
18:06:24    at com.sun.mail.smtp.SMTPTransport.openServer(SMTPTransport.java:1934)
18:06:24    at com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:638)
18:06:24    at javax.mail.Service.connect(Service.java:295)
18:06:24    at javax.mail.Service.connect(Service.java:176)
18:06:24    at javax.mail.Service.connect(Service.java:125)
18:06:24    at javax.mail.Transport.send0(Transport.java:194)
18:06:24    at javax.mail.Transport.send(Transport.java:124)
18:06:24    at hudson.tasks.MailSender.run(MailSender.java:131)
18:06:24    at hudson.tasks.Mailer.perform(Mailer.java:170)
18:06:24    at hudson.tasks.BuildStepCompatibilityLayer.perform(BuildStepCompatibilityLayer.java:78)
18:06:24    at hudson.tasks.BuildStepMonitor$1.perform(BuildStepMonitor.java:20)
18:06:24    at hudson.model.AbstractBuild$AbstractBuildExecution.perform(AbstractBuild.java:779)
18:06:24    at hudson.model.AbstractBuild$AbstractBuildExecution.performAllBuildSteps(AbstractBuild.java:720)
18:06:24    at hudson.model.Build$BuildExecution.post2(Build.java:185)
18:06:24    at hudson.model.AbstractBuild$AbstractBuildExecution.post(AbstractBuild.java:665)
18:06:24    at hudson.model.Run.execute(Run.java:1753)
18:06:24    at hudson.model.FreeStyleBuild.run(FreeStyleBuild.java:43)
18:06:24    at hudson.model.ResourceController.execute(ResourceController.java:98)
18:06:24    at hudson.model.Executor.run(Executor.java:404)
18:06:24 Caused by: java.net.ConnectException: Connection refused (Connection refused)
18:06:24    at java.net.PlainSocketImpl.socketConnect(Native Method)
18:06:24    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)
18:06:24    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)
18:06:24    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)
18:06:24    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
18:06:24    at java.net.Socket.connect(Socket.java:580)
18:06:24    at com.sun.mail.util.SocketFetcher.createSocket(SocketFetcher.java:286)
18:06:24    at com.sun.mail.util.SocketFetcher.getSocket(SocketFetcher.java:231)
18:06:24    at com.sun.mail.smtp.SMTPTransport.openServer(SMTPTransport.java:1900)
18:06:24    ... 18 more
18:06:24 Finished: FAILURE

Originally posted by Bo Li on ROS Answers with karma: 1 on 2017-07-21
Post score: 0

Original comments
Comment by gvdhoorn on 2017-07-21:\

Sending e-mails to: ros-buildfarm-testfarm@googlegroups.com

ERROR: Could not connect to SMTP host: localhost, port: 25

please fix this also: disable notification emails for both maintainers and committers in all your *.yaml files in your fork of ros_buildfarm_config ..
Comment by gvdhoorn on 2017-07-21:
.. and make sure to update the email addresses listed under the notification_emails keys.
Comment by Bo Li on 2017-07-22:
@gvdhoorn Yes, thanks for the remind.

A:

According to the error messages you are missing some Java packages. Until recently the buildfarm downloaded e.g. diffutils on demand. But as of https://github.com/ros-infrastructure/ros_buildfarm/pull/418 the Jenkins Groovy plugin provides that library already.
Your instructions mention that you are using an older version of Jenkins and therefore likely older plugins. You might want to try using the same version as on the ROS buildfarm (currently Jenkins 2.46.2 and Groovy 2.0).
Please also note that there is an active effort to update the buildfarm_deployment to use Xenial instead of Trusty. That upgrade will also move us from Java 7 to Java 8 which will allow us to upgrade to a newer Jenkins version which requires Java 8.

Originally posted by Dirk Thomas with karma: 16276 on 2017-07-21
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Bo Li on 2017-07-22:
Thanks for the reply. Switched to Jenkins 2.46.2 and the Groovy plugin is 2.0 but still get the same error. Is there a way to check why Groovy plugin is not downloading the libraries? I checked /var/lib/jenkins/plugins/groovy/WEB-INF/lib and see commons-exec-1.2.jar  groovy.jar.
Comment by Bo Li on 2017-07-23:
The above issue is solved by following  buildfarm_deployment/issues/147 and also downloading apache-xml-xerces.jar. Thanks again for the hint. Then after approving some scripts I reached another error "com.thoughtworks.xstream.mapper.CannotResolveClassException: hudson.plugins.view.dashboard.Dashboa
Comment by Bo Li on 2017-07-23:
The full error is updated to the end of the tutorial gist. Just wanna seek help again:)
Comment by Bo Li on 2017-07-23:
OK, finally got it worked. Thanks for the answer. The later error requires the dashboard view plugin.
Comment by Dirk Thomas on 2017-07-24:
If you provision the machines manually please make sure to include all the plugins and configurations from the buildfarm_deployment repo (in this case https://github.com/ros-infrastructure/buildfarm_deployment/blob/e63a990e292175360d58de247b5af43bfc013239/master/manifests/site.pp#L128).

