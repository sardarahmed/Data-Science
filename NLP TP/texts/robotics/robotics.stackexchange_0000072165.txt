Q:

segfault when reading rosbag

Hi all,
I'm trying to parse a rosbag file. According to the guide here, I wrote something like this:
rosbag::Bag bag;
std::vector<std::string> topics;
std::cout << "Opening " << filename_ << std::endl;
bag.open(filename_.c_str(), rosbag::bagmode::Read);
std::cout << "Mode: " << bag.getMode() << std::endl;

topics.push_back(std::string("/Imu"));
topics.push_back(std::string("/joint_states"));
rosbag::View view(bag, rosbag::TopicQuery(topics));
foreach(rosbag::MessageInstance const m, view) {
    std::cout << "Found message of type "  << m.getDataType() << std::endl;
    if(m.getDataType().compare("sensor_msgs/Imu") == 0) {
        sensor_msgs::ImuConstPtr s = m.instantiate<sensor_msgs::Imu>();

        cout << "S = " << s << std::endl;
        double ax = s->linear_acceleration.x;
}

The address printed by S is not NULL, but when I reach the last line to get the data, I get a SEGFAULT.

Originally posted by mark_vision on ROS Answers with karma: 275 on 2016-02-18
Post score: 0

A:

The issue has been solved by de-referentiating the pointer and using the local variable for data usage:
sensor_msgs::ImuConstPtr s = m.instantiate<sensor_msgs::Imu>();
sensor_msgs::Imu imu = (*s);
double ax = imu.linear_acceleration.x;

Originally posted by mark_vision with karma: 275 on 2016-02-25
This answer was ACCEPTED on the original site
Post score: 0

