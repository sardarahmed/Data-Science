Q:

Watchdog to monitor node status

Hi,
I'm working on autonomous quadcopter system and I'm using ROS for my algorithms. What I would like to achieve is to create some watchdogs monitoring all my ROS nodes. I also want it to be able to restart node if it detects it's shutdown (for whatever reason).
But I'm quite lost. Can someone give me an advice or perhaps reference to existing code which does exactly this?
Thank you.

Originally posted by l4ncelot on ROS Answers with karma: 826 on 2017-04-05
Post score: 0

A:

You could use a bond:
#! /usr/bin/python

import rospy
from bondpy import bondpy

def formed():
    print "We got a bond"

def broken():
    print "SOMEONE DIED"

rospy.init_node("A", anonymous=True)
b = bondpy.Bond("heartbeat_topic_name","bond_name", on_broken=broken, on_formed=formed)
b.start()
if not b.wait_until_formed(): 
    raise Exception('Bond could not be formed')

rospy.spin()

Just start this node twice, wait for the bond to be established and kill one of the nodes. After a short timeout (4 seconds) the other node will notice the missing partner. With this method, you don't need to poll rosnode list or even know the name of the other node, you just have to use the same topic and bond_name to establish the connection and have a callback triggered as soon as one node does not send its heartbeat anymore.

Originally posted by NEngelhard with karma: 3519 on 2017-04-06
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by gstavrinos on 2017-04-06:
Interesting answer! Didn't know this technique! But how would use bonding with pre-existing nodes?
Comment by l4ncelot on 2017-04-06:
So basically if I understand it correctly, if I want to monitor e.g. 10 different nodes I would have to create some watchdog node connected to all of those 10 different nodes with 10 different bonds?
Comment by NEngelhard on 2017-04-06:
To be honest, this code was the first time I used a bond :) But yeah, you can bond exactly two processes, so you will have N bonds.
Comment by l4ncelot on 2017-04-06:
Cool, I'll try that option. Thanks
Comment by NEngelhard on 2017-04-06:
@gstavrinos: you have to change the node, so it won't work with existing nodes.

