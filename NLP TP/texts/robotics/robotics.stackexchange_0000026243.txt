Q:

DRC Vehicle - Handbrake functionality broken

Seems like the following code is clamping low handbrake values to high and vice versa.
So sending 0 for the handbrake doesn't disengage it - but gets set to high. - Should be reversed
if (this->handBrakeCmd < (handBrakeLow + handBrakeCmdEps) &&
    this->GetHandBrakePercent() > (0.5 + handBrakeHysteresis) &&
    curTime.sec >= 1)
{
  gzdbg << "Handbreak Low : " << this->handBrakeLow << 
  "Handbreak High : " << this->handBrakeHigh << 
  " Handbrake Command : " << this->handBrakeCmd  << "\n"; 
  this->handBrakeCmd = this->handBrakeHigh;
  gzdbg << "Hand brake manually enabled\n";
}

else if (this->handBrakeCmd > (handBrakeHigh - handBrakeCmdEps) &&
    this->GetHandBrakePercent() < (0.5 - handBrakeHysteresis) &&
    curTime.sec >= 1)
{
  gzdbg << "Handbreak Low : " << this->handBrakeLow << 
  "Handbreak High : " << this->handBrakeHigh << 
  " Handbrake Command : " << this->handBrakeCmd  << "\n"; 
  this->handBrakeCmd = this->handBrakeLow;
  gzdbg << "Hand brake manually disabled\n";
}

Originally posted by sachih on Gazebo Answers with karma: 11 on 2013-04-16
Post score: 1

Original comments
Comment by ThomasK on 2013-04-16:
Told Steve about this a few weeks ago, he didn't believe me though! :P The way it is it works for manual manipulation though as far as I remember, just drive by wire is a little screwed up (you have to send e.g. 0.5 first prior to sending 1 or 0), same goes for the steering wheel which has lowered gains which makes drive by wire slower. When you increase those gains though it gets more difficult to drive / turn the steering wheel.
Comment by sachih on 2013-04-21:
Well, for the steering its understandable - however, it doesn't seem right to expect to put the handbrake to 0.5 before putting it to 0 or vice versa. This looks like a bug. Clearly if the handbrake command value is less than the low threshold - it should not be set to high (but to low)

A:

This was fixed in drcsim 2.6.0 by pull request 252. As of 2.6.0, you should be able to command the hand_brake from 0 to 1 and back to 0 with intermediate commands of 0.5.

Originally posted by scpeters with karma: 2861 on 2013-07-23
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Joao Luis on 2014-08-19:
Is this really working? I've tried to aply the changes but it isn't effective. I still have to put a value like 0.5 to change the state of the hand brake
Comment by scpeters on 2014-08-20:
I'm away from the office for the next week and a half. I'll have someone else from OSRF check this when they have a chance. Can you describe your installation to help diagnose the issue (OS version, ROS version, drcsim version, installation type (source, deb))? Thanks
Comment by Joao Luis on 2014-08-20:
Thanks for your attention man, but I managed to solve it. I've forgotten to install my new libraries with the changes. But now I'm getting this error => Error [Publisher.cc:103] Publishing an uninitialized message on topic[/gazebo/default/visual]. Required field [parent_name] missing. I'm still looking for what maybe is going wrong.

