Q:

ROS Answers SE migration: UM6 Hanging

Hello,
I am using a CHR um6 imu on a Clearpath Robotics Husky A200. I am using Clearpath's um6 package to get data from the imu. When I send the command rosrun um6 um6_driver _port:=/dev/ttyUSB1 the terminal tells me

[ INFO] [1384801673.621856253]: Successfully connected to serial port.

[ WARN] [1384801673.964338871]: Discarding packet due to bad checksum.

[ WARN] [1384801673.966617365]: Discarded 13 junk byte(s) preceeding packet.

[ INFO] [1384801673.990920390]: Sending command: zero gyroscopes

At this point it just hangs there. I ran rostopic list in another terminal tab, and none of the topics that um6 should be publishing appeared. Anyone else have this problem or know how to fix it?
Thanks

Originally posted by Icehawk101 on ROS Answers with karma: 955 on 2013-11-18
Post score: 1

Original comments
Comment by Ryan on 2013-11-18:
Which version of the package are you using?
Comment by Icehawk101 on 2013-11-18:
The latest one for Hydro.

A:

Hi, I'm the author of the package. Two quick suggestions:
First, confirm that your UM6 is indeed sending data. Check it with picocom, for example:
picocom -b 115200 /dev/ttyUSB1

It's binary output, but you should see snp packet headers in among the noise. Ctrl-A Ctrl-Q to exit from picocom.
Second, try turning on debug output for the node, which may give more clues as to what's gone wrong. Add the following line to /opt/ros/hydro/share/ros/config/rosconsole.config:
log4j.logger.ros.um6=DEBUG

And then roslaunch the node with the --screen option.

To follow up, the structure of theum6 driver is that messages all get published at once by the publishMsgs function. This function only gets called when a trigger packet arrives. This has been set to be the temperature report, which the UM6 always publishes last in its output batch. It's possible that for some reason your UM6 doesn't produce that message, or the configuration string which is supposed to turn on the temperature output isn't getting set.
Do you know which version of the firmware you have? You may be able to upgrade the firmware to a more recent version which would provide the temperature packet.
Alternatively, feel free to fork the driver on Github and provide a parameter which uses some other message to trigger the ROS publishers (for example, UM6_ERROR_COV_30, which is the one right before UM6_TEMPERATURE).

Originally posted by mikepurvis with karma: 1153 on 2013-11-18
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by Icehawk101 on 2013-11-19:
Hi Mike,
I can see the headers when running picocom, and when I run with debug output on it says

Received packet [hex #] with batched (2 or 4) data.

So it seems like data is being received. It still is not publishing any topics though when I run rostopic list.
Comment by mikepurvis on 2013-11-24:
Hey Icehawk, I've updated my answer with some other suggestions; please take a look.
Comment by Icehawk101 on 2013-11-25:
Hey Mike, I am using UM1B. I shall update to the latest firmware. Thanks for the help.
Comment by Icehawk101 on 2013-11-25:
Updated the firmware and ros is now publishing the topics. Thanks for your help Mike.
Comment by mikepurvis on 2013-11-26:
Awesome, glad to hear!

