Q:

Is there a memory leak when changing visual color from model plugin?

I am trying to change the visual of a mobile robot based on the state of the robot.
Though this works (i.e. the visual of the model changes to the desired color), the gazebo simulator starts to freeze.
When I delete the section of code that changes the model's colour, gazebo simulation works as normal (i.e. without freezing).
Please what am I doing wrong here?
This is the code snippet:
        gazebo::common::Color newColor(0.0,1.0,0.0,1.0);
        msgs::Color *homColMsg = new gazebo::msgs::Color(gazebo::msgs::Convert(newColor));
        msgs::Color *homDiffMsg = new gazebo::msgs::Color(*homColMsg);
        gazebo::physics::LinkPtr link = this->model->GetLink("chassis");
        
        
        
        msgs::Visual visMsg = link->GetVisualMessage("visual");
        msgs::Material *materialMsg = visMsg.mutable_material();
        materialMsg->clear_ambient();
        materialMsg->clear_diffuse();
        
        visMsg.set_name(link->GetScopedName());
        visMsg.set_parent_name(this->model->GetScopedName());
        
        materialMsg->set_allocated_ambient(homColMsg);
        materialMsg->set_allocated_diffuse(homDiffMsg);
        
        this->pub_visual->Publish(visMsg);

The inspiration for this approach is from:
handsim implementation

Originally posted by elcymon on Gazebo Answers with karma: 37 on 2017-11-29
Post score: 0

Original comments
Comment by chapulina on 2017-11-29:
Interesting that on Handsim the link name is used on the visual message, I'd expect that to be the visual name. i.e. model::link::visual instead of model::link
Comment by elcymon on 2017-11-29:
I changed it to 'model::link::visual' and it works fine now!
Thanks.
Comment by chapulina on 2017-11-29:
Great! I added an answer so feel free to accept it and close the question ;)

A:

As mentioned on the comments, the solution was to use the scoped visual name instead of the scoped link name.

Originally posted by chapulina with karma: 7504 on 2017-11-29
This answer was ACCEPTED on the original site
Post score: 0

