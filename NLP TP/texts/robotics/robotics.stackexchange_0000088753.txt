Q:

Dropping connection due to Datatype mismatch

Hi All,
Kindly help me in finding a fix for this.
I am playing a rosbag which has 5 topics. I want to create a new node and subscribe to one of topic from the rosbag.
I am getting the below error when I try to subscribe to the topic.
 [ERROR] [XXXXX]: Client [/A] wants topic /B to have datatype/md5sum [std_msgs/String/], but our version has [visualization_msgs/MarkerArray/]. Dropping connection.

Looks like the data type from bag file is visualization_msgs/MarkerArray/, how would I make modifications in code so that subscription happens without any issue ?
Subscriber Code given below:
 #include "ros/ros.h"
 #include "std_msgs/String.h"
 #include <visualization_msgs/Marker.h>

 void chatterCallback(const std_msgs::String::ConstPtr& msg)
 {
  ROS_INFO("Control has come inside the function");
  ROS_INFO("I heard: [%s]", msg->data.c_str());
 }

 int main(int argc, char **argv)
 {
  ros::init(argc, argv, "listener");
  ros::NodeHandle n;
  ros::Subscriber sub = n.subscribe("my_topic", 1000, chatterCallback);
  ROS_INFO("Initiated the ROS node and subscriber");
  ros::spin();
  return 0;
 }

Updating the question:
I am trying the same code outside and inside the docker.
Outside the docker:
Fixed the error by changing the datatype of the parameter in call back to const visualization_msgs::MarkerArray::ConstPtr& msg
But inside the docker the issue remains the same. The control doesn't come inside the callback function at all.
Waiting 0.2 seconds after advertising topics.../rrrrrr/platform/ros/ros_comm/roscpp/src/libros/publication.cpp:629 Publication::validateHeader() [ERROR] [1535722434.248608746]: Client [/my_c] wants topic /topic to have datatype/md5sum [visualization_msgs/MarkerArray/90da67007c26525f655c1c269094e39f], but our version has [visualization_msgs/MarkerArray/d155b9ce5188fbaf89745847fd5882d7]. Dropping connection.

Thank you,
KK

Originally posted by kk2105 on ROS Answers with karma: 262 on 2018-08-28
Post score: 1

Original comments
Comment by gvdhoorn on 2018-08-28:
Change the subscription callback signature to accept visualization_msgs/MarkerArray?

A:

The subscriber in your code is still expecting a message type of std_msgs/String as defined in the function declaration here, which is why the node is producing the error message:
 void chatterCallback(const std_msgs::String::ConstPtr& msg)

You need to change this so it matches the type of the topic you're trying to subscribe to, in this case a visualization_msgs/MarkerArray. The new function declaration will look like this:
 void chatterCallback(const visualization_msgs::MarkerArray::ConstPtr& msg)

However there are two more changes you need to make to your code and one that you should.
First, you're currently including the Marker message header not the MarkerArray header, so this should be:
#include <visualization_msgs/MarkerArray.h>

Second, the MarkerArray message type doesn't have a string member called data as string does, so you'll need to print some other information out to test this or the code won't compile. You could for example print out the number of markers in the array:
ROS_INFO("I received a MarkerArray with [%s] markers", (int)msg->markers.size());

Finally you should remove the #include "std_msgs/String.h" header because it's no longer used.
Hope this helps.

Originally posted by PeteBlackerThe3rd with karma: 9529 on 2018-08-28
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by kk2105 on 2018-08-28:
@PeteBlackerThe3rd Thanks for the quickly. I am doing the changes in my code.
There is one more doubt, since we are adding a new library in this case visualization_msgs/MarkerArray.h in this case, do we need to make changes in CMakeLists.txt as well ?
Thank you,
KK
Comment by PeteBlackerThe3rd on 2018-08-28:
No problem you'll need a dependency setup for the visualization_msgs package in your CMakeLists.txt as well as build and runtime dependencies in your package.xml. This dependency is for the whole package of visualization_msgs so you may have it already, but add it if you haven't.
Comment by kk2105 on 2018-08-29:
@PeteBlackerThe3rd Thanks for the solution. I will update the CMakeLists.txt and let you know.
Comment by kk2105 on 2018-08-30:
@PeteBlackerThe3rd It seems like visualization_msgs is not found. Could you please help me to install/add it separately ?
Comment by PeteBlackerThe3rd on 2018-08-30:
visualization_msgs is a standard package within ROS, you should definitely have it already. Have you updated your package.xml file as well?
Comment by kk2105 on 2018-08-30:
@PeteBlackerThe3rd Yes, I have updated the package.xml
  <build_depend>visualization_msgs</build_depend>
  <run_depend>visualization_msgs</run_depend>

Updated CMakeLists.txt as well
find_package(catkin REQUIRED COMPONENTS roscpp std_msgs visualization_msgs)

Thank you,
KK
Comment by PeteBlackerThe3rd on 2018-08-30:
What is the actual error you're getting when you try and cakin_make this?
Comment by kk2105 on 2018-08-30:
@PeteBlackerThe3rd I was able to get rid of the error by changing the data type of the parameter inside callback function (Lets consider this was done on System A). catkin_make is successful and I can see the node is subscribed to the topic.
Comment by kk2105 on 2018-08-30:
Same code I am trying to run in System B, but getting the same data type mismatch error.
    [ERROR] [1535643295.309198089]: Client [/A] wants topic /mytopic to have datatype/md5sum [visualization_msgs/MarkerArray/90da67007c26525f655c1c269094e39f], but our version has [visualization_msgs/M

Comment by kk2105 on 2018-08-31:
@PeteBlackerThe3rd Update, the latest error I get when I run it inside docker.
The same code works perfectly fine outside docker.
Comment by PeteBlackerThe3rd on 2018-08-31:
Can you post this error as an update to your original question, it's being truncated in the comments so we can't see all of it. Thanks.
Comment by kk2105 on 2018-08-31:
@PeteBlackerThe3rd I have updated the question . Thank you.
Comment by kk2105 on 2018-09-03:
@PeteBlackerThe3rd Would the change in version makes issue ?

