Q:

Make ros to link against Opencv3

I have ros indigo and opencv 3.0.0 installed on my system and wanted to install object recognition kitchen with ork.rosinstall from their installation tutorial. I can't even compile the ork. Before, when I had opencv 2.4.8 everything was alright. I read somewhere that ros is linked against opencv 2.4 so I wonder if it is even possible to run it with opencv 3. While compiling ORK a get these errors, which I didn't get when I had 2.4.8 version of opencv. I could installed old version back but it doesn't seem as a good solution to me.
Base path: /home/tomas/ws
Source space: /home/tomas/ws/src
Build space: /home/tomas/ws/build
Devel space: /home/tomas/ws/devel
Install space: /home/tomas/ws/install
####
#### Running command: "make cmake_check_build_system" in "/home/tomas/ws/build"
####
####
#### Running command: "make -j8 -l8" in "/home/tomas/ws/build"
####
[  0%] Built target rosgraph_msgs_generate_messages_py
[  1%] Built target openni_wrapper
[  1%] Built target nav_msgs_generate_messages_cpp
[  1%] Built target roscpp_generate_messages_lisp
[  1%] [  1%] [  1%] Building CXX object ork_renderer/src/CMakeFiles/object_recognition_renderer_2d.dir/renderer2d.cpp.o
Building CXX object opencv_candidate/src/opencv_candidate/CMakeFiles/opencv_candidate.dir/datamatrix.cpp.o
Built target object_recognition_renderer_3d
[  1%] Built target sensor_msgs_generate_messages_cpp
[  1%] Built target sensor_msgs_generate_messages_lisp
[  1%] Building CXX object ecto_image_pipeline/src/CMakeFiles/ecto_image_pipeline.dir/calibration.cpp.o
[  1%] Built target sensor_msgs_generate_messages_py
[  1%] Built target topic_tools_generate_messages_cpp
[  4%] Built target ecto
[  4%] Built target geometry_msgs_generate_messages_py
[  4%] Built target geometry_msgs_generate_messages_cpp
[  4%] [  4%] Built target topic_tools_generate_messages_lisp
Building CXX object ecto_opencv/cells/cv_bp/opencv/CMakeFiles/opencv_boost_python.dir/cv_mat.cpp.o
[  4%] [  5%] Built target geometry_msgs_generate_messages_lisp
Building CXX object ecto_opencv/cells/cv_bp/opencv/CMakeFiles/opencv_boost_python.dir/cv_highgui.cpp.o
[  5%] Built target roscpp_generate_messages_py
make[2]: *** No rule to make target `/usr/lib/x86_64-linux-gnu/libopencv_videostab.so.2.4.8', needed by `/home/tomas/ws/devel/lib/python2.7/dist-packages/ecto_opencv/cv_bp.so'.  Stop.
make[2]: *** Waiting for unfinished jobs....
[  5%] Building CXX object ecto_opencv/cells/cv_bp/opencv/CMakeFiles/opencv_boost_python.dir/highgui_defines.cpp.o
[  5%] [  5%] Built target rosgraph_msgs_generate_messages_lisp
Built target topic_tools_generate_messages_py
[  5%] Built target actionlib_msgs_generate_messages_py
[  5%] Built target std_msgs_generate_messages_lisp
[  5%] Built target nav_msgs_generate_messages_py
[  5%] Built target rosgraph_msgs_generate_messages_cpp
[  5%] Built target std_msgs_generate_messages_cpp
[  5%] Built target actionlib_msgs_generate_messages_lisp
[  5%] Built target std_msgs_generate_messages_py
[  5%] Built target nav_msgs_generate_messages_lisp
[  5%] Built target actionlib_msgs_generate_messages_cpp
[  5%] Built target roscpp_generate_messages_cpp
/home/tomas/ws/src/opencv_candidate/src/opencv_candidate/datamatrix.cpp:4:37: fatal error: opencv2/legacy/compat.hpp: No such file or directory
 #include <opencv2/legacy/compat.hpp>
                                     ^
compilation terminated.
make[2]: *** [opencv_candidate/src/opencv_candidate/CMakeFiles/opencv_candidate.dir/datamatrix.cpp.o] Error 1
make[1]: *** [opencv_candidate/src/opencv_candidate/CMakeFiles/opencv_candidate.dir/all] Error 2
make[1]: *** Waiting for unfinished jobs....
make[2]: *** No rule to make target `/usr/lib/x86_64-linux-gnu/libopencv_videostab.so.2.4.8', needed by `/home/tomas/ws/devel/lib/python2.7/dist-packages/ecto_ros/ecto_ros_main.so'.  Stop.
make[1]: *** [ecto_ros/src/CMakeFiles/ecto_ros_main_ectomodule.dir/all] Error 2
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp: In member function ‘virtual void Renderer2d::render(cv::Mat&, cv::Mat&, cv::Mat&, cv::Rect&) const’:
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:126:17: error: ‘numeric_limits’ is not a member of ‘std’
   float x_min = std::numeric_limits<float>::max(), y_min = x_min;
                 ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:126:37: error: expected primary-expression before ‘float’
   float x_min = std::numeric_limits<float>::max(), y_min = x_min;
                                     ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:132:5: error: ‘y_min’ was not declared in this scope
     y_min = std::min(res[1] / res[2], y_min);
     ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:138:44: error: ‘y_min’ was not declared in this scope
   T_img = cv::Matx33f(1, 0, -x_min, 0, 1, -y_min, 0, 0, 1) * T_img;
                                            ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp: In member function ‘virtual void Renderer2d::renderDepthOnly(cv::Mat&, cv::Mat&, cv::Rect&) const’:
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:227:17: error: ‘numeric_limits’ is not a member of ‘std’
   float x_min = std::numeric_limits<float>::max(), y_min = x_min;
                 ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:227:37: error: expected primary-expression before ‘float’
   float x_min = std::numeric_limits<float>::max(), y_min = x_min;
                                     ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:233:5: error: ‘y_min’ was not declared in this scope
     y_min = std::min(res[1] / res[2], y_min);
     ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:239:44: error: ‘y_min’ was not declared in this scope
   T_img = cv::Matx33f(1, 0, -x_min, 0, 1, -y_min, 0, 0, 1) * T_img;
                                            ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp: In member function ‘virtual void Renderer2d::renderImageOnly(cv::Mat&, const Rect&) const’:
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:325:17: error: ‘numeric_limits’ is not a member of ‘std’
   float x_min = std::numeric_limits<float>::max(), y_min = x_min;
                 ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:325:37: error: expected primary-expression before ‘float’
   float x_min = std::numeric_limits<float>::max(), y_min = x_min;
                                     ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:330:5: error: ‘y_min’ was not declared in this scope
     y_min = std::min(res[1] / res[2], y_min);
     ^
/home/tomas/ws/src/ork_renderer/src/renderer2d.cpp:336:44: error: ‘y_min’ was not declared in this scope
   T_img = cv::Matx33f(1, 0, -x_min, 0, 1, -y_min, 0, 0, 1) * T_img;
                                            ^
make[2]: *** [ork_renderer/src/CMakeFiles/object_recognition_renderer_2d.dir/renderer2d.cpp.o] Error 1
make[1]: *** [ork_renderer/src/CMakeFiles/object_recognition_renderer_2d.dir/all] Error 2
[ 10%] Built target ecto_pcl_ectomodule
/home/tomas/ws/src/ecto_image_pipeline/src/calibration.cpp: In function ‘void image_pipeline::calibrate_stereo(const observation_pts_v_t&, const observation_pts_v_t&, const object_pts_v_t&, const Size&, image_pipeline::PinholeCameraModel&, image_pipeline::PinholeCameraModel&)’:
/home/tomas/ws/src/ecto_image_pipeline/src/calibration.cpp:27:76: error: cannot convert ‘cv::TermCriteria’ to ‘int’ for argument ‘13’ to ‘double cv::stereoCalibrate(cv::InputArrayOfArrays, cv::InputArrayOfArrays, cv::InputArrayOfArrays, cv::InputOutputArray, cv::InputOutputArray, cv::InputOutputArray, cv::InputOutputArray, cv::Size, cv::OutputArray, cv::OutputArray, cv::OutputArray, cv::OutputArray, int, cv::TermCriteria)’
                                             cv::CALIB_FIX_INTRINSIC | flags);
                                                                            ^
make[2]: *** [ecto_image_pipeline/src/CMakeFiles/ecto_image_pipeline.dir/calibration.cpp.o] Error 1
make[1]: *** [ecto_image_pipeline/src/CMakeFiles/ecto_image_pipeline.dir/all] Error 2
In file included from /usr/lib/python2.7/dist-packages/numpy/core/include/numpy/ndarraytypes.h:1761:0,
                 from /usr/lib/python2.7/dist-packages/numpy/core/include/numpy/ndarrayobject.h:17,
                 from /usr/lib/python2.7/dist-packages/numpy/core/include/numpy/arrayobject.h:4,
                 from /home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_mat.cpp:3:
/usr/lib/python2.7/dist-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:15:2: warning: #warning "Using deprecated NumPy API, disable it by " "#defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION" [-Wcpp]
 #warning "Using deprecated NumPy API, disable it by " \
  ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_highgui.cpp:31:12: error: ‘map’ in namespace ‘std’ does not name a type
     static std::map<std::string,PyMCallBackData*> callbacks_;
            ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_highgui.cpp:34:3: error: ‘map’ in namespace ‘std’ does not name a type
   std::map<std::string,PyMCallBackData*> PyMCallBackData::callbacks_;
   ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_highgui.cpp: In function ‘void {anonymous}::setMouseCallback_(const string&, boost::python::api::object, boost::python::api::object)’:
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_highgui.cpp:41:9: error: ‘callbacks_’ is not a member of ‘{anonymous}::PyMCallBackData’
         PyMCallBackData::callbacks_[windowName] = NULL;
         ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_highgui.cpp:49:5: error: ‘callbacks_’ is not a member of ‘{anonymous}::PyMCallBackData’
     PyMCallBackData::callbacks_[windowName] = d;
     ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_highgui.cpp: In function ‘void opencv_wrappers::wrap_video_capture()’:
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_highgui.cpp:64:61: error: no matches converting function ‘open’ to type ‘open_1 {aka bool (class cv::VideoCapture::*)(const class std::basic_string<char>&)}’
     VideoCapture_.def("open", open_1(&cv::VideoCapture::open));
                                                             ^
In file included from /usr/local/include/opencv2/highgui.hpp:48:0,
                 from /usr/local/include/opencv2/highgui/highgui.hpp:48,
                 from /home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_highgui.cpp:8:
/usr/local/include/opencv2/videoio.hpp:419:26: note: candidates are: virtual bool cv::VideoCapture::open(int)
     CV_WRAP virtual bool open(int device);
                          ^
/usr/local/include/opencv2/videoio.hpp:414:26: note:                 virtual bool cv::VideoCapture::open(const cv::String&)
     CV_WRAP virtual bool open(const String& filename);
                          ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/highgui_defines.cpp: In function ‘void opencv_wrappers::wrap_highgui_defines()’:
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/highgui_defines.cpp:124:54: error: ‘CV_CAP_PROP_WHITE_BALANCE_U’ was not declared in this scope
     opencv.attr("CV_CAP_PROP_WHITE_BALANCE_U") = int(CV_CAP_PROP_WHITE_BALANCE_U);
                                                      ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/highgui_defines.cpp:129:48: error: ‘CV_CAP_PROP_MONOCROME’ was not declared in this scope
     opencv.attr("CV_CAP_PROP_MONOCROME") = int(CV_CAP_PROP_MONOCROME);
                                                ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/highgui_defines.cpp:139:54: error: ‘CV_CAP_PROP_WHITE_BALANCE_V’ was not declared in this scope
     opencv.attr("CV_CAP_PROP_WHITE_BALANCE_V") = int(CV_CAP_PROP_WHITE_BALANCE_V);
                                                      ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/highgui_defines.cpp:169:53: error: ‘CV_CAP_ANDROID_COLOR_FRAME’ was not declared in this scope
     opencv.attr("CV_CAP_ANDROID_COLOR_FRAME") = int(CV_CAP_ANDROID_COLOR_FRAME);
                                                     ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/highgui_defines.cpp:170:52: error: ‘CV_CAP_ANDROID_GREY_FRAME’ was not declared in this scope
     opencv.attr("CV_CAP_ANDROID_GREY_FRAME") = int(CV_CAP_ANDROID_GREY_FRAME);
                                                    ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_mat.cpp: In function ‘std::string {anonymous}::tostr(cv::Mat&)’:
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_mat.cpp:311:32: error: invalid conversion from ‘const char*’ to ‘int’ [-fpermissive]
     cv::Formatter::get("python")->write(ss,m);
                                ^
In file included from /usr/local/include/opencv2/core/core.hpp:48:0,
                 from /home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_mat.cpp:10:
/usr/local/include/opencv2/core.hpp:2874:27: error:   initializing argument 1 of ‘static cv::Ptr<cv::Formatter> cv::Formatter::get(int)’ [-fpermissive]
     static Ptr<Formatter> get(int fmt = FMT_DEFAULT);
                           ^
/home/tomas/ws/src/ecto_opencv/cells/cv_bp/opencv/cv_mat.cpp:311:35: error: ‘class cv::Formatter’ has no member named ‘write’
     cv::Formatter::get("python")->write(ss,m);
                                   ^
make[2]: *** [ecto_opencv/cells/cv_bp/opencv/CMakeFiles/opencv_boost_python.dir/highgui_defines.cpp.o] Error 1
make[2]: *** [ecto_opencv/cells/cv_bp/opencv/CMakeFiles/opencv_boost_python.dir/cv_highgui.cpp.o] Error 1
make[2]: *** [ecto_opencv/cells/cv_bp/opencv/CMakeFiles/opencv_boost_python.dir/cv_mat.cpp.o] Error 1
make[1]: *** [ecto_opencv/cells/cv_bp/opencv/CMakeFiles/opencv_boost_python.dir/all] Error 2
make: *** [all] Error 2
Invoking "make -j8 -l8" failed

Originally posted by sykatch on ROS Answers with karma: 109 on 2015-12-08
Post score: 0

A:

This problem of using OpenCV 3.0 in ROS-indigo has already been discussed here

Originally posted by Willson Amalraj with karma: 206 on 2015-12-08
This answer was ACCEPTED on the original site
Post score: 0

Original comments
Comment by Will Chamberlain on 2018-09-27:
Also see https://github.com/ros-perception/image_pipeline/issues/176 for detection of "2.4.8' apparently hardcoded in the ROS code.

