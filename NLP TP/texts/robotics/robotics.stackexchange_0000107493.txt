Q:

Colcon build does not build all of my packages (after I deleted and reinstalled older cmake)

I am working for a drone university project in a team and we set up a project in ROS2 galactic (https://github.com/AlboAlby00/CrazyflieControllers).
I wanted to try out a new github repository which required an update to my current cmake version (3.16.3). So I did the following:
sudo apt remove cmake.
In the removal dialog I noticed that it also removed cmake stuff in ros galactic subfolders and my heart sank, because I suspected a little that this meant trouble.
I proceeded with the update and manual installation of cmake 3.28.1:
I manually downloaded and installed the latest cmake 3.26 (in the /opt folder I did sudo bash cmake-3.28.1-linux-x86_64.sh
sudo ln -s /opt/cmake-3.28.1-linux-x86_64/bin/* /usr/local/bin
).
After noticing that colcon build does not recognize all but two of the packages (there are actually seven and it worked before the cmake deletion), I try to reverse the manual installation by deleting everything (in /opt folder with sudo rm -rf cmake-3.28.1-linux-x86_64/ cmake-3.28.1-linux-x86_64.sh and in symlinked /usr/local/bin sudo rm ccmake cmake cmake-gui  cpack  ctest ) and reinstalled ROS2 to get back the old cmake: sudo apt install ros-galactic-desktop
cmake --version returns
cmake version 3.16.3

CMake suite maintained and supported by Kitware (kitware.com/cmake).

I even tried to build it in a new folder with no success.
In the new folder ~/Projects/droneROS2_ws/src I do
git clone https://github.com/AlboAlby00/CrazyflieControllers
cd CrazyflieControllers && git checkout MPC (I work on the MPC on a branch)
(you don't have to do git submodule update --init --recursive for my MPC branch, because I don't need the submodules in the 3rd folder)
~/Projects/droneROS2_ws/src/CrazyflieControllers$ ls
3rd                   crazyflie_controllers  crazyflie_localization  crazyflie_ros2_driver  docs                    Readme.md
apt_dependencies.txt  crazyflie_detectors    crazyflie_msgs          crazyflie_teleop       KeyFrameTrajectory.txt  requirements.txt

cd ../../
~/Projects/droneROS2_ws$ colcon build
Starting >>> crazyflie_ros2_driver
Starting >>> crazyflie_teleop
Finished <<< crazyflie_ros2_driver [0.99s]                                                
Finished <<< crazyflie_teleop [1.05s]          

Summary: 2 packages finished [2.76s]

It is also supposed to build crazyflie_controllers for example in the src folder.
The package.xml of crazyflie_controllers is:
<?xml version="1.0"?>
<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>
<package format="3">
  <name>crazyflie_controllers</name>
  <version>0.0.0</version>
  <description>TODO: Package description</description>
  <maintainer email="">alboalby00</maintainer>
  <license>TODO: License declaration</license>

  <buildtool_depend>ament_cmake</buildtool_depend>
  <buildtool_depend>ament_cmake_python</buildtool_depend>
  
  <exec_depend>ros2launch</exec_depend>

  <depend>rclcpp</depend>
  <depend>rclpy</depend>
  <depend>std_msgs</depend>
  <depend>crazyflie_msgs</depend>
  <depend>geometry_msgs</depend>
  <depend>sensor_msgs</depend>

  
  <test_depend>ament_lint_auto</test_depend>
  <test_depend>ament_lint_common</test_depend>
  
  <export>
    <build_type>ament_cmake</build_type>
  </export>
  
</package>

It works at the setup of my team members.
I sourced with source /opt/ros/galactic/setup.bash and removed previous colcon builds rm -rf build/ install/ log/
My setup:
lsb_release -a
Distributor ID: Ubuntu
Description:    Ubuntu 20.04.6 LTS
Release:        20.04
Codename:       focal
uname -aLinux SurfBoard3 6.5.6-surface #3 SMP PREEMPT_DYNAMIC Sun Oct 15 20:52:00 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux
uname -r 6.5.6-surface
I would really appreciate your help

A:

I just solved it myself.
sudo apt install ros-galactic-desktop
sudo apt autoremove
colcon build
sudo apt install ros-galactic-desktop
sudo apt update
sudo apt install python3-colcon-common-extensions
colcon build

I was just trying one more time with reinstalling ROS2 and Ubuntu suggested sudo apt autoremove which I did and I noticed in the dialog that it also removed colcon. I suspect maybe that it detected that colcon was defect/unused?
After reinstalling colcon with sudo apt install python3-colcon-common-extensions it build all the packages.
I suspect that the previous cmake deletion, the previous colcon was somehow affected by it and de facto defect software and the observed behavior was maybe undefined behavior by a defect colcon version which cmake-dependencies was ripped out of it.
I suspect that this is a highly individual error and
that would explain why I couldn't google and find anyone with the same error.

