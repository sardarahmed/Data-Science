Q:

Height difference between base link and odom

Hey guys.
I was developing my robot model, I don't understand why the base link and odom is not aligned in rviz? Which parameter may cause this type of discrepancy?  This makes the robot float in the air. Please look into the below image
Thanks guys!
C:\fakepath\ros_q_A.png
EDIT: Adding the xacro files
This is the base link xacro file
<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="500">
<xacro:macro name="mp_500_base" params="name">
<link name="${name}">
<inertial>
<mass value="1.4" />
<origin xyz="0.000122063 0.106046383 0.229559509" rpy="0 0 0"/>
<inertia ixx="19.3007" ixy="-1.11893480243" ixz="-0.407945788144"
       iyy="131.584507173302" iyz="-53.615672236" 
       izz="25.601786" />

</inertial>
<visual name='body'>
<origin xyz="0.0 0.0 -0" rpy="0 0 1.570796" /><!-- for STL -->
<geometry>
 <mesh filename="package://path-to-BODY.dae" scale="0.001    0.001 0.001"/>
</geometry>
</visual>
<collision name='body_collision'>
<origin xyz="0.0 0.0 0.0" rpy=" 0 0. 1.570796" />
<geometry>
 <mesh filename="package://path-to-BODY.dae" scale="0.001 0.001 0.001"/>
</geometry>
</collision>
</link>

</xacro:macro>
Just putting the important snippet from gazebo xacro
<plugin name="b1_controller" filename="libgazebo_ros_planar_move.so">
<commandTopic>cmd_vel</commandTopic>
<odometryTopic>odom</odometryTopic>
<odometryFrame>odom</odometryFrame>
<odometryRate>20.0</odometryRate>
<robotBaseFrame>base_link</robotBaseFrame>
</plugin>
</gazebo>
</robot>

Originally posted by pmuthu2s on ROS Answers with karma: 224 on 2019-02-18
Post score: 0

A:

You should provide us your urdf model, it would be easier to help you.
Anyway, you have probably defined something like that :
 <joint name="my_joint" type="fixed">
    <origin xyz="0 0 1" rpy="0 0 0"/>
    <parent link="base_link"/>
    <child link="odom"/>
 </joint>

The line <origin xyz="0 0 1" rpy="0 0 0"/> here is the important part, it should be 0 0 0 if you want your frames to be at the same position.

EDIT : You have the offset because of your mesh file. The plugin set odom at z=0 in order to have your robot at the level of the ground. Since you use mesh files but don't change the origin within the visual and collision tags of your urdf the frame is created at the middle of your mesh file, so in order to have odom at z=0 the frame base_link is created at z=your_mesh_height/2.
Since you know that you always have an offset of 0.06 between the frames (I guess your mesh height is then 0.12) all you have to do is changing from:
 <origin xyz="0.0 0.0 0.0" rpy=" 0 0. 1.570796" /> 

To :
<origin xyz="0.0 0.0 0.06" rpy=" 0 0. 1.570796" />

Within the tags collision and visual.
Note :
A better way to do this would be to create another link base_footprint in your urdf and set a joint between base_link and base_footprint defining the offset between the two frames. You can see it in the gazebo tutorials (section Planar Move Plugin). You'll just have to change the robotBaseFrame to base_footprint.

Originally posted by Delb with karma: 3907 on 2019-02-18
This answer was ACCEPTED on the original site
Post score: 2

Original comments
Comment by pmuthu2s on 2019-02-18:
I have used xacros! Plus I don't have a joint for base link and odom. Maybe is there a problem with the mesh files derived from the CAD software?
Comment by Delb on 2019-02-18:
Mesh are only visuals so the frames aren't related.
Can you provide more details about what you actually did to get that result ? Like giving the urdf file first and the commands you used.
Moreover, have you created the frame odom or is it generated from another package ?
Comment by pmuthu2s on 2019-02-18:
Added them
Comment by pmuthu2s on 2019-02-19:
Any idea ?
Comment by Delb on 2019-02-19:
I'm currently investigating. Do you always have the exact same offset between your frames ? (and I would like to know the value too, is it 0.23 ?)
Comment by pmuthu2s on 2019-02-19:
Yes! The offset is 0.06
Comment by Delb on 2019-02-19:
I got it : it's because of your mesh file, I believe that if you try with something else (or just a cylinder or any shape) you would get a different offset.
Comment by pmuthu2s on 2019-02-19:
Thank you ! Worked fine!

