Q:

Problem when compiling OpenCV with ROS

I am using rosbuild to build a project with OpenCV and ROS. The OpenCV version is 2.4.9, built and installed from source. The ROS version is indigo.
When I include the nonfree module of OpenCV (has SIFT and SURF) in my project files, I got a linking error something like"libopencv.so.2.4.9: undefined reference to ocl::integral()" after I build the ROS package using the CMakeList.txt.
I noticed that the compilation information in the terminal shows the compiler is also trying to link to some existing OpenCV 2.4.8 libs in the directory /lib/x86_64-linux-gnu/libgopencv*.so.2.4.8.
I realized that the OpenCV 2.4.8 might come with the CV_Bridge package when I install it. It seems the cmake is trying to link to some libs of 2.4.8 and also 2.4.9, which leads to some undefined reference. Another observation is that without ROS,  I am able to compile a project with OpenCV (using pkg-config).
It seems the problem is the co-existence of two versions of OpenCV. How can I make it only link to the version I choose? I used find_package in the CMakeList file, but the compiler always tries to link to both version.
Thanks you very much.
Rui

Originally posted by RuiH on ROS Answers with karma: 1 on 2015-03-21
Post score: 0

Original comments
Comment by gvdhoorn on 2015-03-21:
Just to make sure: are you really using rosbuild or catkin?
Comment by RuiH on 2015-03-21:
I am using rosbuild.
Comment by Dinl on 2015-08-31:
Hi, I have the same problem when I use the nonfree module in ROS Indigo, have you found a solution for this error?

A:

My system info:

Ubuntu 14.04.3 LTS
OpenCV 2.4.13
ROS Jade

I have the same link error but fix by switching the following content in CMakeLists.txt

${OpenCV_LIBRARIES} ${catkin_LIBRARIES} in target_link_libraries
${OpenCV_INCLUDE_DIRS} ${catkin_INCLUDE_DIRS} in include_directories

OpenCV first, then catkin.
Hopefully this approach can resolve your problem.

Originally posted by willSapgreen with karma: 61 on 2016-05-22
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by michalszczepanski on 2017-04-14:
I had the same problem, these procedure solve it! Thanks

