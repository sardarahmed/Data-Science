Q:

What causes build error: cannot import name 'OVERRIDE_OPT' from 'em'?

When building a pure ROS2 message package (event_camera_msg) on github (CI) using the ros-tooling/action-ros-ci@v0.3 I get the following cryptic error when building on any ROS2 distro (humble, iron, rolling etc).
The package builds fine locally on humble. It also built fine on 24-11-2023 (last week) but without any modifications to the repo (no commits pushed, nothing), just rerunning the workflow today on 04-12-2023, the job fails.
  /usr/bin/bash -c source /opt/ros/humble/setup.sh && colcon build --symlink-install --event-handlers=console_cohesion+
  ERROR:colcon.colcon_core.entry_point:Exception loading extension 'colcon_core.environment_variable.powershell_command': cannot import name 'OVERRIDE_OPT' from 'em' (/usr/local/bin/em.py) The Python package 'empy' must be installed and 'em' must not be installed since both packages share the same namespace
  Traceback (most recent call last):
    File "/usr/local/lib/python3.10/dist-packages/colcon_core/entry_point.py", line 120, in load_entry_points
      extension_type = load_entry_point(entry_point)
    File "/usr/local/lib/python3.10/dist-packages/colcon_core/entry_point.py", line 166, in load_entry_point
      return entry_point.load()
    File "/usr/local/lib/python3.10/dist-packages/pkg_resources/__init__.py", line 2465, in load
      return self.resolve()
    File "/usr/local/lib/python3.10/dist-packages/pkg_resources/__init__.py", line 2471, in resolve
      module = __import__(self.module_name, fromlist=['__name__'], level=0)
    File "/usr/local/lib/python3.10/dist-packages/colcon_powershell/shell/powershell.py", line 17, in <module>
      from colcon_core.shell.template import expand_template
    File "/usr/local/lib/python3.10/dist-packages/colcon_core/shell/template/__init__.py", line 19, in <module>
      raise e from None
    File "/usr/local/lib/python3.10/dist-packages/colcon_core/shell/template/__init__.py", line 10, in <module>
      from em import OVERRIDE_OPT
  ImportError: cannot import name 'OVERRIDE_OPT' from 'em' (/usr/local/bin/em.py) The Python package 'empy' must be installed and 'em' must not be installed since both packages share the same namespace

Here a link to the full failed build log.

A:

Check: https://github.com/ros-tooling/action-ros-ci/issues/839
You can fix it by using a newer version of setup-ros.
Like:
  - uses: ros-tooling/setup-ros@0.7.1
        with:
          required-ros-distributions: humble
  - uses: ros-tooling/action-ros-ci@0.3.5

