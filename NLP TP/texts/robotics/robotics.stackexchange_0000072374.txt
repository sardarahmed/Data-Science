Q:

What does `Int32MultiArray.layout.data_offset` mean

Here's the contents of Int32MultiArray.msg:
# Please look at the MultiArrayLayout message definition for
# documentation on all multiarrays.

MultiArrayLayout  layout        # specification of data layout
int32[]           data          # array of data

And here's the contents of MultiArrayLayout
# The multiarray declares a generic multi-dimensional array of a
# particular data type.  Dimensions are ordered from outer most
# to inner most.

MultiArrayDimension[] dim # Array of dimension properties
uint32 data_offset        # padding bytes at front of data                         (A)

# Accessors should ALWAYS be written in terms of dimension stride
# and specified outer-most dimension first.
# 
# multiarray(i,j,k) = data[data_offset + dim_stride[1]*i + dim_stride[2]*j + k]    (B)
<snip>

Uh oh - contradiction! Is .layout.data_offset the offset in bytes (A) or the offset in words (B)? If the former, how are we supposed to adjust for something unaligned like data_offset = 3?

Originally posted by eric-wieser on ROS Answers with karma: 111 on 2016-02-27
Post score: 1

A:

It's true, the documentation contradicts itself for most data types. If data_offset is in bytes, then the indexing scheme described in B only applies to byte arrays.
If data_offset truly were in bytes, then it would take more complicated bitwise arithmetic to index into the array, particularly if offset were unaligned. The comment on line A should probably be changed to something like "Number of padding entries at front of data".
Of course, before changing the documentation, it might be good to understand how downstream packages are using MultiArrayLayout and if they consider data_offset to count bytes or words, but again I suspect that few users of std_msgs are doing the proper bitshifting necessary to accomodate byte padding for 32 or 64-bit int types.
Can you ticket this issue on https://github.com/ros/std_msgs? Thanks.

Originally posted by jackie with karma: 296 on 2016-02-29
This answer was ACCEPTED on the original site
Post score: 1

Original comments
Comment by eric-wieser on 2016-02-29:
I've submitted an issue
Comment by tfoote on 2016-03-10:
For the record the issue is here: https://github.com/ros/std_msgs/issues/9

