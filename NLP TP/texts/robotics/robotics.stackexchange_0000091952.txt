Q:

apt update fails / cannot install pkgs: key not working?

When trying to install packages, I'm seeing errors similar to the following:
Err:1 http://packages.ros.org/ros/ubuntu <YOUR_UBUNTU_VERSION>/main amd64 <SOME_ROS_PKG> amd64 0.13.3-0xenial-20190320-132757-0800
  404  Not Found [IP: 64.50.236.52 80]

While running sudo apt update I see the following error:
W: GPG error: http://packages.ros.org <YOUR_UBUNTU_VERSION> InRelease: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY 5523BAEEB01FA116

and or:
W: Failed to fetch http://packages.ros.org/ros/ubuntu/dists/<YOUR_UBUNTU_VERSION>/InRelease  The following signatures couldn't be verified because the public key is not available: NO_PUBKEY F42ED6FBAB17C654
W: Some index files failed to download. They have been ignored, or old ones used instead.

While running sudo apt install I see the following error:
WARNING: The following packages cannot be authenticated! <some_pkgs>

and also sometimes (just an example, could be any package or ROS version):
E: Failed to fetch http://packages.ros.org/ros/ubuntu/pool/main/r/ros-kinetic-realtime-tools/ros-kinetic-realtime-tools_1.11.1-0xenial-20190320-130942-0800_amd64.deb  404  Not Found [IP: 64.50.236.52 80]

This completely prevents me from installing ROS (and related) packages.

Originally posted by gvdhoorn on ROS Answers with karma: 86574 on 2019-06-08
Post score: 34

Original comments
Comment by gvdhoorn on 2019-06-08:
Related: #q324350.

A:

Cause
The old key has been revoked as part of the measures to deal with a recent security incident with build.ros.org (Security issue on ROS build farm).
The key has been updated and the old one is no longer valid, causing the issues with apt update and apt install.
The keys have also changed for the ROS 2 repositories, see: Key rotation for ROS 2 apt repositories.
Compare:

old key: 421C365BD9FF1F717815A3895523BAEEB01FA116
new key: C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654

Solution
Refer to New GPG keys deployed for packages.ros.org for the full write-up, but as a summary these are the commands for Ubuntu (and Debian):
Remove the old key

on Ubuntu 16.04 and newer (with ROS Kinetic, Melodic, etc):
 sudo apt-key del 421C365BD9FF1F717815A3895523BAEEB01FA116

on Ubuntu 15.10 and older (ie: 14.04, from here):
 sudo apt-key del B01FA116

Import the new key
This command should work on all versions of Ubuntu:
# add the new key
sudo -E apt-key adv --keyserver 'hkp://keyserver.ubuntu.com:80' --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654

if this results in errors (similar to "gpg: keyserver receive failed: End of file" or others indicating the key server could not be reached), an alternative would be (make sure curl is installed):
curl -s https://raw.githubusercontent.com/ros/rosdistro/master/ros.asc | sudo apt-key add -

Final step
At this point make sure to run sudo apt clean && sudo apt update. You should receive no errors and subsequent sudo apt install commands should also now work.
Additional notes
Installation tutorials are in the process of being updated, so if you're following one and you are seeing key-related errors, check that the tutorial is using the correct key.
If it isn't, notify the author or maintainer of the tutorial or website so it can be updated.

Originally posted by gvdhoorn with karma: 86574 on 2019-06-08
This answer was ACCEPTED on the original site
Post score: 114

Original comments
Comment by AlexR on 2019-06-10:
this helped me. Thanks a lot.
Comment by Zacryon on 2019-06-11:
Thank you!
A little addition: Add the "-E" option to sudo in order to use environment variables in case you are trying to connect from beyond a firewall. (This requires to set the proxy variables for apt e.g. in "/etc/apt/conf.d".)
sudo -E  apt-key adv --keyserver 'hkp://keyserver.ubuntu.com:80' --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654

See also: https://askubuntu.com/a/654973
Comment by gvdhoorn on 2019-06-11:
@Zacryon: I feel it's rather specific to your setup, but I've updated the answer.
Comment by Radeshwar on 2019-06-19:
This worked for me as well, thanks a lot.
Comment by cesarhcq on 2019-06-20:
Its work for Melodic as well
Comment by Oscar Lima on 2019-06-24:
Thanks! works :D (Ubuntu 18.04, melodic)
Comment by matteolucchi on 2019-07-24:
I tried this and it solved the issue with the key, but I still get:
Get:29 http://packages.ros.org/ros/ubuntu xenial/main amd64 Packages [3.150 kB]
Err:29 http://packages.ros.org/ros/ubuntu xenial/main amd64 Packages
Writing more data than expected (3151533 > 3149706) [IP: 64.50.236.52 80]
anyone else experiencing this?
Comment by cesarhcq on 2019-07-24:
Did you try to execute "sudo apt-get update" again? After modification of the key.
Comment by matteolucchi on 2019-07-24:
Yes I get this when executing "sudo apt-get update" . The same thing happens on 2 different pcs
Comment by matteolucchi on 2019-07-26:
what solved my problem was to run sudo apt-get clean before running sudo apt-update
Comment by ani on 2019-11-27:
That worked like a charm. Thank you.
Comment by Gaborka on 2020-07-17:
God bless you, man! This worked on kinetic and Ubuntu 16.04

